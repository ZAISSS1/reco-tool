<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯èƒ½æ°¸çºŒ-å ±åƒ¹æ¨¡çµ„</title>
    <!-- ä½¿ç”¨è‡ªå®šç¾©åœ–æ¨™ - å¼·åˆ¶é‡æ–°è¼‰å…¥ -->
    <link rel="icon" href="favicon.png?v=3" type="image/png">
    <link rel="shortcut icon" href="favicon.png?v=3" type="image/png">
    <link rel="apple-touch-icon" href="favicon.png?v=3">
    <meta name="theme-color" content="#667eea">
    <!-- SheetJS library for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #2a2a2a;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #404040;
        }

        .header {
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            color: #ffffff;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #1a1a1a;
            border-bottom: 2px solid #404040;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 6px;
            text-align: center;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #a0a0a0;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #2a2a2a;
            color: #ffffff;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover {
            background: #333333;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .info-box {
            background: #2a2a2a;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            color: #e0e0e0;
            border: 1px solid #404040;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #e0e0e0;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #555555;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #333333;
            color: #ffffff;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            width: 60px;
            height: 60px;
            margin: 20px auto;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-3px);
        }

        .btn.quote { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.quote:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .btn.monthly { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.monthly:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .btn.single { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.single:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .btn.clean { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.clean:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }



        .output-section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #404040;
        }

        .output-area {
            width: 100%;
            min-height: 300px;
            border: 2px solid #555555;
            border-radius: 8px;
            padding: 15px;
            background: #2a2a2a;
            color: #ffffff;
            font-family: monospace;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }

        .copy-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .copy-btn {
            width: 50px;
            height: 50px;
            margin: 15px auto;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .status {
            margin-top: 15px;
            text-align: center;
            min-height: 40px;
            padding: 10px;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 5px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #e0e0e0;
            cursor: pointer;
            margin-bottom: 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }

        h4 {
            color: #ffffff;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        small {
            color: #a0a0a0;
            font-size: 12px;
        }

        .mobile-text {
            display: none;
        }

        .desktop-text {
            display: inline;
        }

        .clear-btn-small {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(108, 117, 125, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-btn-small:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }

        /* æ‹–æ›³ä¸Šå‚³æ¨£å¼ */
        .drop-zone {
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #2a2a2a;
            transition: all 0.3s ease;
            position: relative;
            min-height: 120px;
        }

        .drop-zone:hover, .drop-zone.dragover,
        .drop-zone-inline:hover, .drop-zone-inline.dragover {
            border-color: #4CAF50 !important;
            background: #2f3f2f !important;
        }

        .drop-zone-content {
            pointer-events: none;
        }

        .drop-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .drop-text {
            color: #ccc;
            font-size: 16px;
        }

        /* ç…§ç‰‡åˆä½µæŒ‰éˆ•æ¨£å¼ */
        .btn-merge {
            background: linear-gradient(135deg, #1565C0, #0D47A1);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(21, 101, 192, 0.3);
        }

        .btn-merge:hover {
            background: linear-gradient(135deg, #0D47A1, #0A3880);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(21, 101, 192, 0.4);
        }

        .btn-clear {
            background: linear-gradient(135deg, #9E9E9E, #757575);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(158, 158, 158, 0.3);
        }

        .btn-clear:hover {
            background: linear-gradient(135deg, #757575, #616161);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(158, 158, 158, 0.4);
        }

        .btn-download {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }

        .btn-download:hover {
            background: linear-gradient(135deg, #1B5E20, #0F4318);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }



        /* ç…§ç‰‡é è¦½æ¨£å¼ */
        .photo-preview {
            display: inline-block;
            margin: 5px;
            border: 2px solid #444;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .photo-preview img {
            width: 120px;
            height: 90px;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .merged-photo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .merged-photo-content {
            flex: 1;
            text-align: left;
        }

        .merged-photo-controls {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .merged-photo img {
            max-width: 100%;
            height: auto;
            border: 2px solid #4CAF50;
            border-radius: 8px;
        }

        /* ç™»å…¥ç•Œé¢æ¨£å¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-container {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
            border: 1px solid #404040;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .login-title {
            font-size: 28px;
            color: #ffffff;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-input {
            padding: 15px;
            border: 2px solid #555555;
            border-radius: 10px;
            font-size: 16px;
            background: #333333;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .login-btn {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .login-error {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e74c3c;
            margin-top: 10px;
            display: none;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        @media (max-width: 768px) {
            /* æ•´ä½“å¸ƒå±€ */
            body {
                padding: 5px;
            }
            
            .container {
                margin: 0;
                border-radius: 8px;
            }
            
            /* ç™»å½•ç•Œé¢ */
            .login-container {
                padding: 25px 15px;
            }
            
            .login-title {
                font-size: 22px;
            }
            
            .logout-btn {
                top: 8px;
                right: 8px;
                padding: 6px 10px;
                font-size: 12px;
            }
            
            /* å¤´éƒ¨ */
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 18px;
                margin: 0;
            }
            
            /* æ ‡ç­¾å¯¼èˆª - ä¸¤è¡Œæ˜¾ç¤ºï¼Œæ¯è¡Œ3-4ä¸ª */
            .tabs {
                flex-wrap: wrap;
                gap: 4px;
                padding: 6px;
                position: sticky;
                top: 0;
                z-index: 1001;
            }
            
            .tab {
                flex: 1 1 calc(33.333% - 6px);
                min-width: 90px;
                padding: 10px 6px;
                font-size: 12px;
                border: 1px solid #404040;
                border-radius: 6px;
                white-space: nowrap;
            }
            
            .tab.active {
                border-bottom: 2px solid #667eea;
            }
            
            /* å†…å®¹åŒºåŸŸ */
            .tab-content {
                padding: 12px;
            }
            
            .section {
                margin-bottom: 15px;
            }
            
            .section h3 {
                font-size: 16px;
                margin-bottom: 8px;
            }
            
            h4 {
                font-size: 15px;
                margin-bottom: 8px;
                padding-bottom: 4px;
            }
            
            .info-box {
                padding: 10px;
                margin-bottom: 12px;
                font-size: 13px;
            }
            
            /* è¡¨å•å…ƒç´  */
            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 12px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            label {
                font-size: 13px;
                margin-bottom: 4px;
            }
            
            input, textarea, select {
                font-size: 16px;
                padding: 10px;
                border-radius: 6px;
            }
            
            textarea {
                min-height: 100px;
            }
            
            /* æŒ‰é’® */
            .btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                margin: 12px auto;
            }
            
            .copy-btn {
                padding: 10px 15px;
                font-size: 14px;
                margin: 10px auto;
            }
            
            /* è¾“å‡ºåŒºåŸŸ */
            .output-area {
                min-height: 150px;
                padding: 10px;
                font-size: 13px;
                line-height: 1.6;
            }
            
            .output-section {
                padding: 12px;
            }
            
            /* å¤é€‰æ¡†ç»„ */
            .checkbox-group {
                gap: 6px;
                margin-top: 5px;
            }
            
            .checkbox-group label {
                font-size: 13px;
                margin-bottom: 4px;
            }
            
            /* çŠ¶æ€ä¿¡æ¯ */
            .status {
                padding: 8px;
                margin-top: 8px;
                font-size: 13px;
            }
            
            /* æ–‡æœ¬æ˜¾ç¤ºåˆ‡æ¢ */
            .desktop-text {
                display: none;
            }
            
            .mobile-text {
                display: inline;
            }
            
            /* ç…§ç‰‡ä¸Šä¼  */
            .photo-upload-row {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .photo-upload-row #single-drop-zone {
                flex: 1 !important;
                min-width: auto !important;
            }
            
            .photo-upload-row #single-merge-controls {
                flex-direction: row !important;
                justify-content: center;
                gap: 10px !important;
            }
            
            /* æ¸…é™¤æŒ‰é’® */
            .clear-btn-small {
                width: 26px;
                height: 26px;
                font-size: 16px;
            }
            
            /* æ‹–æ‹½åŒºåŸŸ */
            .drop-zone {
                padding: 15px;
                font-size: 13px;
            }
            
            /* ç…§ç‰‡ç½‘æ ¼ */
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)) !important;
                gap: 8px !important;
            }
            
            .photo-item {
                height: 80px !important;
            }
            
            /* åˆå¹¶å›¾ç‰‡å®¹å™¨ */
            .merge-photo-container {
                max-width: 100% !important;
            }
            
            .merge-photo-container img {
                max-width: 100% !important;
            }
            
            /* æ•°æ®è¡¨æ ¼ */
            .data-table {
                font-size: 12px !important;
            }
            
            .data-table th,
            .data-table td {
                padding: 6px 4px !important;
                font-size: 11px !important;
            }
        }

        /* å¤–éƒ¨åƒ¹æ ¼è¡¨æ ¼æ¨£å¼ */
        .vendor-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #2a2a2a;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #404040;
        }
        
        .vendor-name-cell {
            text-align: left;
            vertical-align: middle;
        }
        
        .vendor-name-link {
            color: #28a745 !important;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-block;
        }
        
        .vendor-name-link:hover {
            color: #20c997 !important;
            text-decoration: underline;
            transform: translateY(-1px);
        }
        
        .vendor-name-no-url {
            color: #ffffff;
            font-weight: 600;
        }
        
        .vendor-edit-hint {
            color: #6c757d;
            font-size: 11px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .vendor-edit-hint:hover {
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }
        
        .vendor-edit-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .vendor-edit-input {
            padding: 6px 8px;
            border: 2px solid #28a745;
            border-radius: 4px;
            background: #333;
            color: #ffffff;
            font-size: 13px;
        }
        
        .vendor-edit-input:focus {
            outline: none;
            border-color: #20c997;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
        }
        
        .vendor-edit-buttons {
            display: flex;
            gap: 5px;
        }
        
        .vendor-save-btn, .vendor-cancel-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .vendor-save-btn {
            background: #28a745;
            color: white;
        }
        
        .vendor-save-btn:hover {
            background: #20c997;
        }
        
        .vendor-cancel-btn {
            background: #6c757d;
            color: white;
        }
        
        .vendor-cancel-btn:hover {
            background: #5a6268;
        }

        .vendor-table th {
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            color: #ffffff;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #404040;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .vendor-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #404040;
            background: #2a2a2a;
            color: #e0e0e0;
            position: relative;
        }

        .vendor-table tr:hover td {
            background: #333333;
        }

        .vendor-table td.editable {
            cursor: text;
            transition: all 0.3s ease;
        }

        .vendor-table td.editable:hover {
            background: #404040 !important;
            color: #ffffff;
        }

        .vendor-table td.editing {
            background: #667eea !important;
            color: #ffffff;
        }

        .vendor-table td input {
            width: 100%;
            background: transparent;
            border: none;
            color: #ffffff;
            text-align: center;
            padding: 5px;
            font-size: inherit;
        }

        .vendor-table td input:focus {
            outline: 2px solid #667eea;
            border-radius: 4px;
        }

        .delete-row-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-row-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .vendor-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .vendor-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
        }

        .vendor-controls .add-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .vendor-controls .add-btn:hover {
            background: linear-gradient(135deg, #218838 0%, #1c7a6b 100%);
            transform: translateY(-2px);
        }

        .vendor-controls .save-btn {
            background: linear-gradient(135deg, #007bff 0%, #667eea 100%);
        }

        .vendor-controls .save-btn:hover {
            background: linear-gradient(135deg, #0056b3 0%, #5a67d8 100%);
            transform: translateY(-2px);
        }

        .vendor-controls .export-btn {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
        }

        .vendor-controls .export-btn:hover {
            background: linear-gradient(135deg, #5a359a 0%, #d91a72 100%);
            transform: translateY(-2px);
        }

        .vendor-controls .import-btn {
            background: linear-gradient(135deg, #fd7e14 0%, #ffc107 100%);
        }

        .vendor-controls .import-btn:hover {
            background: linear-gradient(135deg, #dc6502 0%, #d39e00 100%);
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #404040;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .vendor-table {
                font-size: 12px;
            }
            
            .vendor-table th, .vendor-table td {
                padding: 8px 5px;
            }
            
            .vendor-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .vendor-controls button {
                margin-bottom: 10px;
            }
        }

        /* ç«¶çˆ­å» å•†æ¯”è¼ƒæ¨£å¼ */
        .vendor-comparison-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #404040;
            margin-top: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: #2a2a2a;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #404040;
            font-size: 14px;
        }

        .comparison-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #404040;
            background: #2a2a2a;
            color: #e0e0e0;
            font-size: 13px;
        }

        .comparison-table tr:hover td {
            background: #333333;
        }

        .comparison-table .vendor-name {
            font-weight: 600;
            color: #667eea;
        }

        .comparison-table .price-cell {
            font-weight: 600;
        }

        .no-comparison {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .comparison-table {
                font-size: 11px;
            }
            
            .comparison-table th, .comparison-table td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å…¥ç•Œé¢ -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-container">
            <h2 class="login-title">ğŸ”’ ç³»çµ±ç™»å…¥</h2>
            <form id="login-form" class="login-form">
                <input type="text" id="username" class="login-input" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" required>
                <input type="password" id="password" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                <button type="submit" class="login-btn">ç™»å…¥ç³»çµ±</button>
                <div id="login-error" class="login-error">å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡</div>
            </form>
        </div>
    </div>
    
    <!-- ç™»å‡ºæŒ‰éˆ• -->
    <button id="logout-btn" class="logout-btn" onclick="logout()" style="display: none;">ç™»å‡º</button>
    <div class="container">
        <div class="header">
            <h1>è¯èƒ½æ°¸çºŒ-å ±åƒ¹æ¨¡çµ„</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('auto-quote')"><span class="desktop-text">åŒ…æœˆè‡ªå‹•å ±åƒ¹</span><span class="mobile-text">è‡ªå‹•å ±åƒ¹</span></button>
            <button class="tab" onclick="showTab('single-quote')"><span class="desktop-text">å–®è¶Ÿè‡ªå‹•å ±åƒ¹</span><span class="mobile-text">å–®è¶Ÿå ±åƒ¹</span></button>
            <button class="tab" onclick="showTab('quote')"><span class="desktop-text">åŒ…æœˆæ‰‹å‹•å ±åƒ¹</span><span class="mobile-text">å®¢æˆ¶å ±åƒ¹</span></button>
            <button class="tab" onclick="showTab('monthly')"><span class="desktop-text">åŒ…æœˆä»»å‹™</span><span class="mobile-text">åŒ…æœˆä»»å‹™</span></button>
            <button class="tab" onclick="showTab('single')"><span class="desktop-text">å–®è¶Ÿä»»å‹™</span><span class="mobile-text">å–®è¶Ÿä»»å‹™</span></button>
            <button class="tab" onclick="showTab('clean')"><span class="desktop-text">å–®æ¬¡æ¸…æ½”</span><span class="mobile-text">æ¸…æ½”ä»»å‹™</span></button>
            <button class="tab" onclick="showTab('vendor-pricing')"><span class="desktop-text">å¤–éƒ¨åƒ¹æ ¼</span><span class="mobile-text">å¤–éƒ¨åƒ¹æ ¼</span></button>
        </div>

        <!-- å®¢æˆ¶å–®â®•è‡ªå‹•å ±åƒ¹å–® -->
        <div id="auto-quote" class="tab-content active">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">åŒ…æœˆè‡ªå‹•å ±åƒ¹</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearAutoQuoteForm()" title="æ¸…ç©ºè¡¨å–®">Ã—</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>ğŸ”— Googleè©¦ç®—è¡¨é€£çµ</h4>
                    <div style="display: flex; align-items: flex-end; gap: 10px; margin-bottom: 10px;">
                        <div style="flex: 2;">
                            <label for="sheets-url">è©¦ç®—è¡¨ç¶²å€ï¼š<small style="color: #888;">ğŸ’¡ è¨­å®šç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…ã€</small></label>
                            <input type="text" id="sheets-url" placeholder="è«‹è²¼ä¸ŠGoogleè©¦ç®—è¡¨çš„å…±äº«é€£çµ" style="width: 100%;" onchange="saveUrlToHistory()">
                        </div>
                        <div style="flex: 1;">
                            <label for="saved-urls">æ­·å²ç¶²å€ï¼š</label>
                            <select id="saved-urls" onchange="loadSavedUrl()" style="width: 100%;">
                                <option value="">é¸æ“‡æ­·å²ç¶²å€</option>
                            </select>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button id="manage-urls-btn" onclick="toggleUrlManager()" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">æ­·å²ç¶²å€</button>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button onclick="clearAllUrls()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">æ¸…ç©ºå…¨éƒ¨</button>
                        </div>
                    </div>
                    
                    <div id="url-manager" style="display: none; margin-top: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #404040;">
                        <h5 style="color: #fff; margin-bottom: 15px; text-align: center;">ğŸ“ æ­·å²ç¶²å€ç®¡ç†</h5>
                        <!-- ç¶²å€åˆ—è¡¨å°‡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>âš™ï¸ è³‡æ–™è¼¸å…¥</h4>
                    <!-- ç¬¬ä¸€è¡Œï¼šæ”¶å–æ˜ŸæœŸã€æ”¶å–æ™‚é–“ã€æ¨“å±¤ã€æœˆè²»ã€è¶Ÿæ•¸ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="manual-days">æ”¶å–æ˜ŸæœŸï¼š</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±ä¸€" style="width: 14px; height: 14px; margin-right: 4px;"> é€±ä¸€
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±äºŒ" style="width: 14px; height: 14px; margin-right: 4px;"> é€±äºŒ
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±ä¸‰" style="width: 14px; height: 14px; margin-right: 4px;"> é€±ä¸‰
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±å››" style="width: 14px; height: 14px; margin-right: 4px;"> é€±å››
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±äº”" style="width: 14px; height: 14px; margin-right: 4px;"> é€±äº”
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±å…­" style="width: 14px; height: 14px; margin-right: 4px;"> é€±å…­
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="é€±æ—¥" style="width: 14px; height: 14px; margin-right: 4px;"> é€±æ—¥
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="manual-time">æ”¶å–æ™‚é–“ï¼š</label>
                            <input type="text" id="manual-time" placeholder="0" value="">
                        </div>
                        <div>
                            <label for="manual-floor">æ¨“å±¤ï¼š</label>
                            <input type="number" id="manual-floor" placeholder="0" min="-10" max="50" value="">
                        </div>
                        <div>
                            <label for="manual-fee">æœˆè²»(å…ƒ)ï¼š</label>
                            <input type="number" id="manual-fee" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-frequency">è¶Ÿæ•¸ï¼š</label>
                            <input type="number" id="manual-frequency" placeholder="0" min="1" max="7" value="">
                        </div>
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œï¼šåƒåœ¾åŒ…æ•¸åˆ°ç‰¹æ®Šéœ€æ±‚ï¼ˆä¸€è¡Œ7å€‹æ¬„ä½ï¼‰ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="manual-trash">åƒåœ¾åŒ…æ•¸ï¼š</label>
                            <input type="number" id="manual-trash" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-trash-volume">åƒåœ¾è¢‹å®¹é‡ï¼š</label>
                            <select id="manual-trash-volume">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="14å…¬å‡">14å…¬å‡</option>
                                <option value="25å…¬å‡">25å…¬å‡</option>
                                <option value="75å…¬å‡">75å…¬å‡</option>
                                <option value="76å…¬å‡">76å…¬å‡</option>
                            </select>
                        </div>
                        <div>
                            <label for="manual-recycle">è³‡æºåŒ…æ•¸ï¼š</label>
                            <input type="number" id="manual-recycle" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-recycle-volume">è³‡æºè¢‹å®¹é‡ï¼š</label>
                            <select id="manual-recycle-volume">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="14å…¬å‡">14å…¬å‡</option>
                                <option value="25å…¬å‡">25å…¬å‡</option>
                                <option value="75å…¬å‡">75å…¬å‡</option>
                                <option value="76å…¬å‡">76å…¬å‡</option>
                            </select>
                        </div>
                        <div>
                            <label for="manual-trash-max" style="color: #ff4444;">æœ€å¤šåƒåœ¾è¢‹æ•¸ï¼š</label>
                            <input type="number" id="manual-trash-max" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-recycle-max" style="color: #ff4444;">æœ€å¤šè³‡æºè¢‹æ•¸ï¼š</label>
                            <input type="number" id="manual-recycle-max" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-special-notes" style="color: #ffdd44;">ç‰¹æ®Šéœ€æ±‚ï¼š</label>
                            <input type="text" id="manual-special-notes" placeholder="ç‰¹æ®Šéœ€æ±‚" value="">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>ğŸ“Š è³‡æ–™åµæ¸¬è¨­å®š</h4>
                    <div class="form-row">
                        <div>
                            <label for="update-mode">æ›´æ–°æ¨¡å¼ï¼š</label>
                            <select id="update-mode" onchange="toggleCustomRowInput()">
                                <option value="latest">æœ€æ–°ä¸€åˆ—</option>
                                <option value="all">æ‰€æœ‰è³‡æ–™</option>
                                <option value="last-5">æœ€å¾Œ5åˆ—</option>
                                <option value="last-10">æœ€å¾Œ10åˆ—</option>
                                <option value="last-20">æœ€å¾Œ20åˆ—</option>
                            </select>
                        </div>
                        <div>
                            <label for="sheet-name">å·¥ä½œè¡¨åç¨±ï¼š</label>
                            <input type="text" id="sheet-name" placeholder="ä¾‹ï¼šå ±åƒ¹è³‡æ–™" value="å·¥ä½œè¡¨1">
                        </div>
                        <div>
                            <label for="data-columns">è³‡æ–™æ¬„ä½ï¼š</label>
                            <select id="data-columns">
                                <option value="auto">è‡ªå‹•åµæ¸¬</option>
                                <option value="A-H">Aåˆ°Hæ¬„</option>
                                <option value="A-J">Aåˆ°Jæ¬„</option>
                                <option value="A-L">Aåˆ°Læ¬„</option>
                            </select>
                        </div>
                    </div>
                    

                </div>
                
                <div style="display: flex; justify-content: center; margin: 25px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; width: 100%; max-width: 600px;">
                        <div></div>
                        <button onclick="fetchGoogleSheetsData()" style="background: white; color: #333; border: 2px solid #ddd; width: 60px; height: 60px; font-size: 24px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease; font-weight: bold; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-left: 4px;" title="è®€å–è³‡æ–™">
                            â‡„
                        </button>
                        <div></div>
                    </div>
                </div>
                
                <div id="auto-sheets-status" class="status" style="display: none;"></div>
                
                <div class="form-group" id="auto-detected-data" style="display: none;">
                    <h4>ğŸ“‹ åµæ¸¬è³‡æ–™</h4>
                    <div id="detected-data-preview" class="output-area" style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; max-height: 300px; overflow-y: auto;"></div>
                </div>
                
                <div class="form-group" id="auto-quote-controls" style="display: none;">
                    <h4>âš¡ è‡ªå‹•ç”Ÿæˆ</h4>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; width: 100%; max-width: 600px;">
                            <div></div>
                            <button class="btn quote" onclick="generateAutoQuote()">âˆ</button>
                            <div></div>
                        </div>
                    </div>
                </div>
                
                <!-- ç«¶çˆ­å» å•†æ¯”è¼ƒå€å¡Š -->
                <div class="output-section" id="vendor-comparison" style="display: none; margin-bottom: 20px;">
                    <h4>ğŸ“Š ç«¶çˆ­å» å•†æ¯”è¼ƒ</h4>
                    <div id="vendor-comparison-table" class="vendor-comparison-container"></div>
                </div>

                <div class="output-section" id="auto-quote-output" style="display: none;">
                    <h4>ğŸ“„ è‡ªå‹•ç”Ÿæˆçš„å ±åƒ¹å–®</h4>
                    <div class="output-area" id="auto-quote-result-display"></div>
                    <button class="copy-btn" onclick="copyAutoQuote()">â§‰</button>
                    <div class="status" id="auto-quote-copy-status"></div>
                </div>
                
                <div id="auto-quote-final-status" class="status" style="display: none;"></div>
            </div>
        </div>

        <!-- å®¢æˆ¶å–®â®•å ±åƒ¹å–® -->
        <div id="quote" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">åŒ…æœˆæ‰‹å‹•å ±åƒ¹</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearQuoteForm()" title="æ¸…ç©ºè¡¨å–®">Ã—</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>âš™ï¸ è³‡æ–™è¼¸å…¥</h4>
                    <!-- ç¬¬ä¸€è¡Œï¼šæ”¶å–æ˜ŸæœŸã€æ”¶å–æ™‚é–“ã€æ¨“å±¤ã€æœˆè²»ã€è¶Ÿæ•¸ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="service-days">æ”¶å–æ˜ŸæœŸï¼š</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±ä¸€" style="width: 14px; height: 14px; margin-right: 4px;"> é€±ä¸€
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±äºŒ" checked style="width: 14px; height: 14px; margin-right: 4px;"> é€±äºŒ
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±ä¸‰" style="width: 14px; height: 14px; margin-right: 4px;"> é€±ä¸‰
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±å››" style="width: 14px; height: 14px; margin-right: 4px;"> é€±å››
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±äº”" checked style="width: 14px; height: 14px; margin-right: 4px;"> é€±äº”
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±å…­" style="width: 14px; height: 14px; margin-right: 4px;"> é€±å…­
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="é€±æ—¥" style="width: 14px; height: 14px; margin-right: 4px;"> é€±æ—¥
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="service-time">æ”¶å–æ™‚é–“ï¼š</label>
                            <input type="text" id="service-time" placeholder="0" value="">
                        </div>
                        <div>
                            <label for="floor-level">æ¨“å±¤ï¼š</label>
                            <input type="number" id="floor-level" placeholder="0" min="-10" max="50" value="">
                        </div>
                        <div>
                            <label for="monthly-fee">æœˆè²»(å…ƒ)ï¼š</label>
                            <input type="number" id="monthly-fee" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="frequency">è¶Ÿæ•¸ï¼š</label>
                            <input type="number" id="frequency" placeholder="0" min="1" max="7" value="">
                        </div>
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œï¼šåƒåœ¾åŒ…æ•¸åˆ°ç‰¹æ®Šéœ€æ±‚ï¼ˆä¸€è¡Œ7å€‹æ¬„ä½ï¼‰ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="trash-bags">åƒåœ¾åŒ…æ•¸ï¼š</label>
                            <input type="number" id="trash-bags" min="0" placeholder="0">
                        </div>
                        <div>
                            <label for="trash-volume">åƒåœ¾è¢‹å®¹é‡ï¼š</label>
                            <select id="trash-volume">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="14å…¬å‡">14å…¬å‡</option>
                                <option value="25å…¬å‡">25å…¬å‡</option>
                                <option value="75å…¬å‡">75å…¬å‡</option>
                                <option value="76å…¬å‡">76å…¬å‡</option>
                            </select>
                        </div>
                        <div>
                            <label for="recycle-bags">è³‡æºåŒ…æ•¸ï¼š</label>
                            <input type="number" id="recycle-bags" min="0" placeholder="0">
                        </div>
                        <div>
                            <label for="recycle-volume">è³‡æºè¢‹å®¹é‡ï¼š</label>
                            <select id="recycle-volume">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="14å…¬å‡">14å…¬å‡</option>
                                <option value="25å…¬å‡">25å…¬å‡</option>
                                <option value="75å…¬å‡">75å…¬å‡</option>
                                <option value="76å…¬å‡">76å…¬å‡</option>
                            </select>
                        </div>
                        <div>
                            <label for="trash-max" style="color: #ff4444;">æœ€å¤šåƒåœ¾è¢‹æ•¸ï¼š</label>
                            <input type="number" id="trash-max" min="0" placeholder="0">
                        </div>
                        <div>
                            <label for="recycle-max" style="color: #ff4444;">æœ€å¤šè³‡æºè¢‹æ•¸ï¼š</label>
                            <input type="number" id="recycle-max" min="0" placeholder="0">
                        </div>
                        <div>
                            <label for="special-notes" style="color: #ffdd44;">ç‰¹æ®Šéœ€æ±‚ï¼š</label>
                            <input type="text" id="special-notes" placeholder="ç‰¹æ®Šéœ€æ±‚">
                        </div>
                    </div>
                    
                    <button class="btn quote" onclick="generateQuote()">âˆ</button>
                </div>
                
                <!-- ç«¶çˆ­å» å•†æ¯”è¼ƒå€å¡Š -->
                <div class="output-section" id="quote-vendor-comparison" style="display: none; margin-bottom: 20px;">
                    <h4>ğŸ“Š ç«¶çˆ­å» å•†æ¯”è¼ƒ</h4>
                    <div id="quote-vendor-comparison-table" class="vendor-comparison-container"></div>
                </div>

                <div class="output-section" id="quote-output" style="display: none;">
                    <h4>ğŸ“‹ ç”Ÿæˆçš„å ±åƒ¹å–®</h4>
                    <div class="output-area" id="quote-result"></div>
                    <button class="copy-btn" onclick="copyToClipboard('quote-result')">â§‰</button>
                    <div class="status" id="quote-status"></div>
                </div>
            </div>
        </div>

        <!-- å®¢æˆ¶å–®â®•å–®è¶Ÿå ±åƒ¹å–® -->
        <div id="single-quote" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">å–®è¶Ÿè‡ªå‹•å ±åƒ¹</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearSingleQuoteForm()" title="æ¸…ç©ºè¡¨å–®">Ã—</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>ğŸ”— Googleè©¦ç®—è¡¨é€£çµ</h4>
                    <div class="form-row" style="grid-template-columns: 2fr 1fr;">
                        <div>
                            <label for="single-quote-sheets-url">è©¦ç®—è¡¨ç¶²å€ï¼š<small style="color: #888;">ğŸ’¡ è¨­å®šç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…ã€</small></label>
                            <input type="text" id="single-quote-sheets-url" placeholder="è«‹è²¼ä¸ŠGoogleè©¦ç®—è¡¨çš„å…±äº«é€£çµ" style="width: 100%;" onchange="saveSingleQuoteUrlToHistory()">
                        </div>
                        <div>
                            <label for="single-quote-saved-urls">æ­·å²ç¶²å€ï¼š</label>
                            <select id="single-quote-saved-urls" onchange="loadSingleQuoteSavedUrl()" style="width: 100%;">
                                <option value="">é¸æ“‡æ­·å²ç¶²å€</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- æ­·å²ç¶²å€ç®¡ç† -->
                    <div style="margin-top: 15px; text-align: center;">
                        <button id="single-quote-manage-urls-btn" onclick="toggleSingleQuoteUrlManager()" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-right: 10px;">æ­·å²ç¶²å€</button>
                        <button onclick="clearAllSingleQuoteUrls()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px;">æ¸…ç©ºå…¨éƒ¨</button>
                    </div>
                    
                    <div id="single-quote-url-manager" style="display: none; margin-top: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #404040;">
                        <h5 style="color: #fff; margin-bottom: 15px; text-align: center;">ğŸ“ æ­·å²ç¶²å€ç®¡ç†</h5>
                        <!-- ç¶²å€åˆ—è¡¨å°‡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- ç…§ç‰‡é¡¯ç¤ºå€ -->
                <div class="form-group" id="single-quote-photos-section" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="margin: 0;">ğŸ“· è©¦ç®—è¡¨ç…§ç‰‡</h4>
                        <button id="download-all-photos-btn" onclick="downloadAllPhotos()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;">
                            <span>ğŸ“¥</span>
                            <span>ä¸€éµä¸‹è¼‰å…¨éƒ¨</span>
                        </button>
                    </div>
                    <div id="single-quote-photos-container" style="display: flex; flex-wrap: wrap; gap: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #404040; min-height: 100px; justify-content: flex-start;">
                        <!-- ç…§ç‰‡å°‡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="form-group">
                    <h4>âš™ï¸ å–®è¶Ÿåƒåœ¾ä»£æ”¶è¨­å®š</h4>
                    
                    <!-- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸã€æ™‚é–“ã€æœ‰ç„¡ä¸Šæ¨“ã€ä¸€æ¨“è²»ç”¨ã€ä¸Šæ¨“è²»ç”¨ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="single-quote-date">åŸ·è¡Œæ—¥æœŸï¼š</label>
                            <input type="date" id="single-quote-date">
                        </div>
                        <div>
                            <label for="single-quote-time">åŸ·è¡Œæ™‚é–“ï¼š</label>
                            <input type="text" id="single-quote-time" placeholder="ä¾‹å¦‚ï¼š1200-1600å‰å®Œæˆ" value="">
                        </div>
                        <div>
                            <label for="single-quote-upstairs-option">ä¸Šæ¨“ï¼š</label>
                            <select id="single-quote-upstairs-option">
                                <option value="" selected>è«‹é¸æ“‡</option>
                                <option value="éœ€ä¸Šæ¨“">éœ€ä¸Šæ¨“</option>
                                <option value="ä¸ç”¨ä¸Šæ¨“">ä¸ç”¨ä¸Šæ¨“</option>
                                <option value="é›»æ¢¯">é›»æ¢¯</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-quote-ground-fee">ä¸€æ¨“ä»£æ”¶è²»ç”¨ï¼š</label>
                            <input type="number" id="single-quote-ground-fee" min="0" step="50" placeholder="ä¾‹å¦‚ï¼š300" value="">
                        </div>
                        <div>
                            <label for="single-quote-upstairs-fee">ä¸Šæ¨“ä»£æ”¶è²»ç”¨ï¼š</label>
                            <input type="number" id="single-quote-upstairs-fee" min="0" step="50" placeholder="ä¾‹å¦‚ï¼š500" value="">
                        </div>
                    </div>

                    
                    <!-- å‹•æ…‹ç…§ç‰‡æè¿°å€åŸŸ -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">ğŸ—‘ï¸ ç…§ç‰‡æè¿°ï¼ˆæœ€å¤š15å€‹ï¼‰</h4>
                            <button id="add-description-btn" onclick="addPhotoDescription()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                â• å¢åŠ æè¿°
                            </button>
                        </div>
                        <div id="photo-descriptions-container">
                            <!-- æè¿°1ï¼ˆé è¨­ï¼‰ -->
                            <div class="photo-description-item" id="photo-desc-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>ğŸ—‘ï¸æè¿°1ï¼š</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="single-quote-photo1" placeholder="ä¾‹å¦‚ï¼šå®¢å»³åƒåœ¾è¢‹" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h4>ğŸ“Š è³‡æ–™åµæ¸¬è¨­å®š</h4>
                    <div class="form-row">
                        <div>
                            <label for="single-quote-update-mode">æ›´æ–°æ¨¡å¼ï¼š</label>
                            <select id="single-quote-update-mode">
                                <option value="latest">æœ€æ–°ä¸€åˆ—</option>
                                <option value="all">æ‰€æœ‰è³‡æ–™</option>
                                <option value="last-5">æœ€å¾Œ5åˆ—</option>
                                <option value="last-10">æœ€å¾Œ10åˆ—</option>
                                <option value="last-20">æœ€å¾Œ20åˆ—</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-quote-sheet-name">å·¥ä½œè¡¨åç¨±ï¼š</label>
                            <input type="text" id="single-quote-sheet-name" placeholder="ä¾‹ï¼šå ±åƒ¹è³‡æ–™" value="å·¥ä½œè¡¨1">
                        </div>
                        <div>
                            <label for="single-quote-data-columns">è³‡æ–™æ¬„ä½ï¼š</label>
                            <select id="single-quote-data-columns">
                                <option value="auto">è‡ªå‹•åµæ¸¬</option>
                                <option value="A-H">Aåˆ°Hæ¬„</option>
                                <option value="A-J">Aåˆ°Jæ¬„</option>
                                <option value="A-L">Aåˆ°Læ¬„</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: center; margin: 25px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; width: 100%; max-width: 600px;">
                        <div></div>
                        <button onclick="fetchSingleQuoteGoogleSheetsData()" style="background: white; color: #333; border: 2px solid #ddd; width: 60px; height: 60px; font-size: 24px; border-radius: 50%; cursor: pointer; transition: all 0.3s ease; font-weight: bold; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-left: 4px;" title="è®€å–è©¦ç®—è¡¨è³‡æ–™">
                            â‡„
                        </button>
                        <div></div>
                    </div>
                </div>
                
                <div id="single-quote-sheets-status" class="status" style="display: none;"></div>
                
                <div class="form-group" id="single-quote-detected-data" style="display: none;">
                    <h4>ğŸ“‹ åµæ¸¬è³‡æ–™</h4>
                    <div id="single-quote-detected-data-preview" class="output-area" style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; max-height: 300px; overflow-y: auto;"></div>
                </div>
                
                <div class="form-group" id="single-quote-controls" style="display: none;">
                    <h4>âš¡ è‡ªå‹•ç”Ÿæˆ</h4>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; width: 100%; max-width: 600px;">
                            <div></div>
                            <button class="btn quote" onclick="generateSingleQuote()">âˆ</button>
                            <div></div>
                        </div>
                    </div>
                </div>
                
                <div class="output-section" id="single-quote-output" style="display: none;">
                    <h4>ğŸ“„ å–®è¶Ÿåƒåœ¾ä»£æ”¶å ±åƒ¹å–®</h4>
                    <div class="output-area" id="single-quote-result-display"></div>
                    <button class="copy-btn" onclick="copySingleQuote()">â§‰</button>
                    <div class="status" id="single-quote-copy-status"></div>
                </div>
                
                <div id="single-quote-final-status" class="status" style="display: none;"></div>
            </div>
        </div>

        <!-- å ±åƒ¹å–®â®•åŒ…æœˆä»»å‹™å–® -->
        <div id="monthly" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">åŒ…æœˆä»»å‹™</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearMonthlyForm()" title="æ¸…ç©ºè¡¨å–®">Ã—</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>âš™ï¸ è³‡æ–™è¼¸å…¥</h4>
                    
                    <!-- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸã€æ™‚é–“ã€åƒ¹æ ¼ã€ä¸Šæ¨“ã€åœ°å€ã€é›»è©±ã€å§“åã€é‘°åŒ™ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="monthly-date">æ—¥æœŸï¼š</label>
                            <input type="date" id="monthly-date">
                        </div>
                        <div>
                            <label for="monthly-time">æ™‚é–“ï¼š</label>
                            <input type="text" id="monthly-time" placeholder="ä¾‹å¦‚ï¼š0800å¾Œ" value="">
                        </div>
                        <div>
                            <label for="monthly-fixed-price">åƒ¹æ ¼ï¼š</label>
                            <input type="number" id="monthly-fixed-price" min="0" step="50" placeholder="ä¾‹å¦‚ï¼š300">
                        </div>
                        <div>
                            <label for="monthly-upstairs">ä¸Šæ¨“ï¼š</label>
                            <select id="monthly-upstairs">
                                <option value="" selected>è«‹é¸æ“‡</option>
                                <option value="éœ€ä¸Šæ¨“">éœ€ä¸Šæ¨“</option>
                                <option value="ä¸ç”¨ä¸Šæ¨“">ä¸ç”¨ä¸Šæ¨“</option>
                                <option value="é›»æ¢¯">é›»æ¢¯</option>
                            </select>
                        </div>
                        <div>
                            <label for="monthly-address">åœ°å€ï¼š</label>
                            <input type="text" id="monthly-address" placeholder="è«‹è¼¸å…¥å®Œæ•´åœ°å€" value="">
                        </div>
                        <div>
                            <label for="monthly-phone">é›»è©±ï¼š</label>
                            <input type="text" id="monthly-phone" placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±" value="">
                        </div>
                        <div>
                            <label for="monthly-name">å§“åï¼š</label>
                            <input type="text" id="monthly-name" placeholder="è«‹è¼¸å…¥å®¢æˆ¶å§“å" value="">
                        </div>
                        <div>
                            <label for="monthly-key">é‘°åŒ™ï¼š</label>
                            <select id="monthly-key">
                                <option value="" selected>è«‹é¸æ“‡</option>
                                <option value="ç„¡">ç„¡</option>
                                <option value="æœ‰">æœ‰</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œï¼šåƒåœ¾ã€è³‡æºã€å°ˆç”¨è¢‹ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div>
                            <label for="monthly-trash-pickup">åƒåœ¾ï¼š</label>
                            <input type="number" id="monthly-trash-pickup" min="1" max="100" value="" placeholder="åƒåœ¾ä¸€æ¬¡æ”¶å–åŒ…æ•¸">
                        </div>
                        <div>
                            <label for="monthly-recycle-pickup">è³‡æºï¼š</label>
                            <input type="number" id="monthly-recycle-pickup" min="1" max="100" value="" placeholder="è³‡æºä¸€æ¬¡æ”¶å–åŒ…æ•¸">
                        </div>
                        <div>
                            <label for="monthly-bag">å°ˆç”¨è¢‹ï¼š</label>
                            <select id="monthly-bag">
                                <option value="" selected>è«‹é¸æ“‡</option>
                                <option value="æœ‰">æœ‰</option>
                                <option value="ç„¡">ç„¡</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4>ğŸ“ è¼¸å…¥è³‡æ–™</h4>
                    <label for="monthly-quote-data">è²¼ä¸Šå ±åƒ¹è³‡æ–™ï¼š</label>
                    <textarea id="monthly-quote-data" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šå®Œæ•´çš„å ±åƒ¹è³‡æ–™..." style="height: 200px;"></textarea>
                    
                    <button class="btn monthly" onclick="generateMonthlyTask()">âˆ</button>
                </div>
                
                <div class="output-section" id="monthly-output" style="display: none;">
                    <h4>ğŸ“‹ åŒ…æœˆä»»å‹™å–®</h4>
                    <div class="copy-buttons">
                        <div>
                            <h5>ä¸€èˆ¬ç‰ˆä»»å‹™å–®</h5>
                            <div class="output-area" id="monthly-general"></div>
                            <button class="copy-btn" onclick="copyToClipboard('monthly-general')">â§‰</button>
                        </div>
                        <div>
                            <h5>é™åˆ¶ç‰ˆä»»å‹™å–®</h5>
                            <div class="output-area" id="monthly-limited"></div>
                            <button class="copy-btn" onclick="copyToClipboard('monthly-limited')">â§‰</button>
                        </div>
                    </div>
                    <div class="status" id="monthly-status"></div>
                </div>
            </div>
        </div>

        <!-- å ±åƒ¹å–®â®•å–®è¶Ÿä»»å‹™å–® -->
        <div id="single" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">å–®è¶Ÿä»»å‹™</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearSingleForm()" title="æ¸…ç©ºè¡¨å–®">Ã—</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>âš™ï¸ è³‡æ–™è¼¸å…¥</h4>
                    
                    <!-- ç¬¬ä¸€è¡Œï¼šæ—¥æœŸåˆ°è²»ç”¨æ‰€æœ‰æ¬„ä½ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="single-date">æ—¥æœŸï¼š</label>
                            <input type="date" id="single-date">
                        </div>
                        <div>
                            <label for="single-time">æ™‚é–“ï¼š</label>
                            <input type="text" id="single-time" placeholder="ä¾‹ï¼š14:30">
                        </div>
                        <div>
                            <label for="single-phone">é›»è©±ï¼š</label>
                            <input type="text" id="single-phone" placeholder="ä¾‹ï¼š0912345678">
                        </div>
                        <div>
                            <label for="single-name">å§“æ°ï¼š</label>
                            <input type="text" id="single-name" placeholder="ä¾‹ï¼šé™³">
                        </div>
                        <div>
                            <label for="single-address">åœ°å€ï¼š</label>
                            <input type="text" id="single-address" placeholder="ä¾‹ï¼šå°åŒ—å¸‚ä¸­å±±å€æ°‘ç”Ÿæ±è·¯">
                        </div>
                        <div>
                            <label for="single-upstairs">ä¸Šæ¨“ï¼š</label>
                            <select id="single-upstairs">
                                <option value="" selected>è«‹é¸æ“‡</option>
                                <option value="éœ€ä¸Šæ¨“">éœ€ä¸Šæ¨“</option>
                                <option value="ä¸ç”¨ä¸Šæ¨“">ä¸ç”¨ä¸Šæ¨“</option>
                                <option value="é›»æ¢¯">é›»æ¢¯</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-customer-bag">å°ˆç”¨è¢‹ï¼š</label>
                            <select id="single-customer-bag">
                                <option value="ç„¡" selected>ç„¡</option>
                                <option value="æœ‰">æœ‰</option>
                                <option value="éƒ¨åˆ†æœ‰">éƒ¨åˆ†æœ‰</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-waste-type">åƒåœ¾è³‡æºé‡ï¼š</label>
                            <select id="single-waste-type" onchange="toggleSingleWasteInput()">
                                <option value="å¦‚åœ–" selected>å¦‚åœ–</option>
                                <option value="æ‰‹å‹•å¡«å¯«">æ‰‹å‹•å¡«å¯«</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-fee">è²»ç”¨ï¼š</label>
                            <input type="text" id="single-fee" placeholder="ä¾‹ï¼š500">
                        </div>
                    </div>
                    
                    <!-- æ‰‹å‹•å¡«å¯«åƒåœ¾è³‡æºé‡ï¼ˆæ¢ä»¶é¡¯ç¤ºï¼‰ -->
                    <div id="single-waste-manual-div" style="display: none; margin-top: 15px;">
                        <label for="single-waste-manual">æ‰‹å‹•å¡«å¯«åƒåœ¾è³‡æºé‡ï¼š</label>
                        <input type="text" id="single-waste-manual" placeholder="è«‹è©³ç´°æè¿°åƒåœ¾è³‡æºé‡" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                    
                    <!-- å‹•æ…‹å…¶ä»–èªªæ˜å€åŸŸ -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">ğŸ“ å…¶ä»–èªªæ˜</h4>
                            <button id="add-single-note-btn" onclick="addSingleNote()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                â• å¢åŠ èªªæ˜
                            </button>
                        </div>
                        <div id="single-notes-container">
                            <!-- èªªæ˜1ï¼ˆé è¨­ï¼‰ -->
                            <div class="single-note-item" id="single-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>ğŸ“èªªæ˜1ï¼š</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="single-other1" placeholder="ä¾‹ï¼šå›å ±è·¯æ®µ" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h4>ğŸ“· ç¾æ³ç…§ç‰‡ä¸Šå‚³</h4>
                    
                    <!-- ç…§ç‰‡åŠŸèƒ½ä¸€è¡Œå¼å¸ƒå±€ -->
                    <div class="photo-upload-row" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: stretch; margin-bottom: 15px; min-height: 110px;">
                        <!-- æ‹–æ›³ä¸Šå‚³å€åŸŸ -->
                        <div id="single-drop-zone" class="drop-zone-inline" style="flex: 0 0 280px; border: 2px dashed #666; border-radius: 8px; padding: 15px; text-align: center; background: #2a2a2a; transition: all 0.3s ease; position: relative; height: 110px; display: flex; align-items: center; justify-content: center;">
                            <div class="drop-zone-content">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ“</div>
                                <div style="color: #ccc; font-size: 14px;">æ‹–æ›³ç…§ç‰‡æˆ–é»æ“Šé¸æ“‡</div>
                                <input type="file" id="single-images" multiple accept="image/png,image/jpg,image/jpeg" style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
                            </div>
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰éˆ•å€åŸŸ -->
                        <div id="single-merge-controls" style="display: none; flex: 0 0 auto; height: 110px; flex-direction: column; justify-content: center; gap: 8px;">
                            <button type="button" class="btn-merge" onclick="mergeSingleImages()">â‰«</button>
                            <button type="button" class="btn-clear" onclick="clearSingleImages()">Ã—</button>
                        </div>
                        
                        <!-- ç…§ç‰‡é è¦½å€åŸŸ -->
                        <div id="single-image-preview" style="flex: 1; min-width: 180px; min-height: 110px; display: flex; flex-direction: column; justify-content: flex-start;"></div>
                    </div>
                    
                    <!-- åˆä½µç…§ç‰‡é¡¯ç¤ºå€åŸŸ - ç§»åˆ°ä¸‹æ–¹ -->
                    <div id="single-merged-preview" style="width: 100%; margin-bottom: 15px; display: flex; justify-content: center;"></div>
                    
                    <button class="btn single" onclick="generateSingleTask()">âˆ</button>
                </div>
                
                <div class="output-section" id="single-output" style="display: none;">
                    <h4>ğŸ“‹ å–®è¶Ÿä»»å‹™å–®</h4>
                    <div class="output-area" id="single-result"></div>
                    <button class="copy-btn" onclick="copyToClipboard('single-result')">â§‰</button>
                    <div class="status" id="single-status"></div>
                </div>
            </div>
        </div>

        <!-- å ±åƒ¹å–®â®•å–®æ¬¡æ¸…æ½”ä»»å‹™å–® -->
        <div id="clean" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">å–®æ¬¡æ¸…æ½”</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearCleanForm()" title="æ¸…ç©ºè¡¨å–®">Ã—</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>âš™ï¸ è³‡æ–™è¼¸å…¥</h4>
                    
                    <!-- ç¬¬ä¸€è¡Œåƒæ•¸ï¼šæ—¥æœŸåˆ°è²»ç”¨ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="clean-date">æ—¥æœŸï¼š</label>
                            <input type="date" id="clean-date">
                        </div>
                        <div>
                            <label for="clean-time">æ™‚é–“ï¼š</label>
                            <input type="text" id="clean-time" placeholder="ä¾‹ï¼š14:30">
                        </div>
                        <div>
                            <label for="clean-phone">é›»è©±ï¼š</label>
                            <input type="text" id="clean-phone" placeholder="ä¾‹ï¼š0912345678">
                        </div>
                        <div>
                            <label for="clean-name">å§“æ°ï¼š</label>
                            <input type="text" id="clean-name" placeholder="ä¾‹ï¼šé™³">
                        </div>
                        <div>
                            <label for="clean-address">åœ°å€ï¼š</label>
                            <input type="text" id="clean-address" placeholder="ä¾‹ï¼šå°åŒ—å¸‚ä¸­å±±å€æ°‘ç”Ÿæ±è·¯">
                        </div>
                        <div>
                            <label for="clean-upstairs">ä¸Šæ¨“ï¼š</label>
                            <select id="clean-upstairs">
                                <option value="" selected>è«‹é¸æ“‡</option>
                                <option value="éœ€ä¸Šæ¨“">éœ€ä¸Šæ¨“</option>
                                <option value="ä¸ç”¨ä¸Šæ¨“">ä¸ç”¨ä¸Šæ¨“</option>
                                <option value="é›»æ¢¯">é›»æ¢¯</option>
                            </select>
                        </div>
                        <div>
                            <label for="clean-fee">è²»ç”¨ï¼š</label>
                            <input type="text" id="clean-fee" placeholder="ä¾‹ï¼š800">
                        </div>
                    </div>
                    
                    <!-- å‹•æ…‹å…¶ä»–èªªæ˜å€åŸŸ -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">ğŸ“ å…¶ä»–èªªæ˜</h4>
                            <button id="add-clean-note-btn" onclick="addCleanNote()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                â• å¢åŠ èªªæ˜
                            </button>
                        </div>
                        <div id="clean-notes-container">
                            <!-- èªªæ˜1ï¼ˆé è¨­ï¼‰ -->
                            <div class="clean-note-item" id="clean-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>ğŸ“èªªæ˜1ï¼š</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="clean-other1" placeholder="ä¾‹ï¼šç‰¹æ®Šæ¸…æ½”éœ€æ±‚" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å‹•æ…‹æ¸…æ½”ç¯„åœå€åŸŸ -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">ğŸ§¹ æ¸…æ½”ç¯„åœ</h4>
                            <button id="add-clean-scope-btn" onclick="addCleanScope()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                â• å¢åŠ é …ç›®
                            </button>
                        </div>
                        <div id="clean-scope-container">
                            <!-- é …ç›®1ï¼ˆé è¨­ï¼‰ -->
                            <div class="clean-scope-item" id="clean-scope-item-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>ğŸ§¹é …ç›®1ï¼š</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="clean-scope-1" placeholder="æ¸…æ½”é …ç›® 1" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h4>ğŸ“· ç¾æ³ç…§ç‰‡ä¸Šå‚³</h4>
                    
                    <!-- ç…§ç‰‡åŠŸèƒ½ä¸€è¡Œå¼å¸ƒå±€ -->
                    <div class="photo-upload-row" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: stretch; margin-bottom: 15px; min-height: 110px;">
                        <!-- æ‹–æ›³ä¸Šå‚³å€åŸŸ -->
                        <div id="clean-drop-zone" class="drop-zone-inline" style="flex: 0 0 280px; border: 2px dashed #666; border-radius: 8px; padding: 15px; text-align: center; background: #2a2a2a; transition: all 0.3s ease; position: relative; height: 110px; display: flex; align-items: center; justify-content: center;">
                            <div class="drop-zone-content">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ“</div>
                                <div style="color: #ccc; font-size: 14px;">æ‹–æ›³ç…§ç‰‡æˆ–é»æ“Šé¸æ“‡</div>
                                <input type="file" id="clean-images" multiple accept="image/png,image/jpg,image/jpeg" style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
                            </div>
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰éˆ•å€åŸŸ -->
                        <div id="clean-merge-controls" style="display: none; flex: 0 0 auto; height: 110px; flex-direction: column; justify-content: center; gap: 8px;">
                            <button type="button" class="btn-merge" onclick="mergeCleanImages()">â‰«</button>
                            <button type="button" class="btn-clear" onclick="clearCleanImages()">Ã—</button>
                        </div>
                        
                        <!-- ç…§ç‰‡é è¦½å€åŸŸ -->
                        <div id="clean-image-preview" style="flex: 1; min-width: 180px; min-height: 110px; display: flex; flex-direction: column; justify-content: flex-start;"></div>
                    </div>
                    
                    <!-- åˆä½µç…§ç‰‡é¡¯ç¤ºå€åŸŸ - ç§»åˆ°ä¸‹æ–¹ -->
                    <div id="clean-merged-preview" style="width: 100%; margin-bottom: 15px; display: flex; justify-content: center;"></div>
                    
                    <button class="btn clean" onclick="generateCleanTask()">âˆ</button>
                </div>
                
                <div class="output-section" id="clean-output" style="display: none;">
                    <h4>ğŸ“‹ æ¸…æ½”ä»»å‹™å–®</h4>
                    <div class="output-area" id="clean-result"></div>
                    <button class="copy-btn" onclick="copyToClipboard('clean-result')">â§‰</button>
                    <div class="status" id="clean-status"></div>
                </div>
            </div>
        </div>

        <!-- å¤–éƒ¨åƒ¹æ ¼é é¢ -->
        <div id="vendor-pricing" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; text-align: center;">å¤–éƒ¨åƒ¹æ ¼ç®¡ç†</h3>
                </div>
                
                <!-- æ§åˆ¶æŒ‰éˆ• -->
                <div class="vendor-controls">
                    <button class="add-btn" onclick="addVendorRow()">â• æ–°å¢å» å•†</button>
                    <button class="save-btn" onclick="saveVendorData()">ğŸ’¾ å„²å­˜è³‡æ–™</button>
                    <button class="export-btn" onclick="exportVendorData()">ğŸ“¤ åŒ¯å‡ºExcel</button>
                    <button class="import-btn" onclick="document.getElementById('import-file').click()">ğŸ“¥ åŒ¯å…¥Excel</button>
                    <input type="file" id="import-file" class="file-input" accept=".xlsx,.xls" onchange="importVendorData(event)">
                </div>
                
                <!-- è³‡æ–™è¡¨æ ¼ -->
                <div class="table-container">
                    <table class="vendor-table" id="vendor-table">
                        <thead>
                            <tr>
                                <th>å» å•†åç¨±</th>
                                <th>æ–¹æ¡ˆåç¨±</th>
                                <th>ä¸€é€±æ¬¡æ•¸</th>
                                <th>å» å•†ç¸½é‡</th>
                                <th>æ›ç®—14å…¬å‡</th>
                                <th>æ›ç®—25å…¬å‡</th>
                                <th>åŸåƒ¹</th>
                                <th>1æœˆå„ª</th>
                                <th>3æœˆå„ª</th>
                                <th>6æœˆå„ª</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="vendor-table-body">
                            <!-- è³‡æ–™å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="status" id="vendor-status" style="margin-top: 20px;"></div>
            </div>
        </div>

    <script>

        // åˆ‡æ›å–®è¶Ÿä»»å‹™åƒåœ¾è³‡æºé‡è¼¸å…¥æ–¹å¼
        function toggleSingleWasteInput() {
            const wasteType = document.getElementById('single-waste-type').value;
            const manualDiv = document.getElementById('single-waste-manual-div');
            
            if (wasteType === 'æ‰‹å‹•å¡«å¯«') {
                manualDiv.style.display = 'block';
            } else {
                manualDiv.style.display = 'none';
                document.getElementById('single-waste-manual').value = '';
            }
        }

        // Quote generation function
        function generateQuote() {
            // ç²å–æ‰€æœ‰è¡¨å–®æ•¸æ“š
            const serviceDaysCheckboxes = document.querySelectorAll('input[name="service-days"]:checked');
            const serviceDays = Array.from(serviceDaysCheckboxes).map(checkbox => checkbox.value);
            const serviceTime = document.getElementById('service-time').value;
            const floorLevel = parseInt(document.getElementById('floor-level').value);
            const trashBags = document.getElementById('trash-bags').value;
            const trashVolume = document.getElementById('trash-volume').value;
            const recycleBags = document.getElementById('recycle-bags').value;
            const recycleVolume = document.getElementById('recycle-volume').value;
            const trashMax = document.getElementById('trash-max').value;
            const recycleMax = document.getElementById('recycle-max').value;
            const monthlyFee = document.getElementById('monthly-fee').value;
            const frequency = document.getElementById('frequency').value;
            const specialNotes = document.getElementById('special-notes').value;
            
            // æ ¼å¼åŒ–æœå‹™æ—¥æœŸ
            const daysText = serviceDays.length > 0 ? serviceDays.join('ã€') : 'å¾…ç¢ºå®š';
            
            // æ ¼å¼åŒ–æ™‚é–“
            let formattedTime = serviceTime;
            if (serviceTime) {
                const timeMatch = serviceTime.match(/(\d{4})/);
                if (timeMatch) {
                    const timeStr = timeMatch[1];
                    const hour = parseInt(timeStr.substring(0, 2));
                    const minute = timeStr.substring(2);
                    if (hour < 12) {
                        formattedTime = `ä¸Šåˆ ${hour.toString().padStart(2, '0')}ï¼š${minute}`;
                    } else if (hour < 18) {
                        formattedTime = `ä¸‹åˆ ${hour.toString().padStart(2, '0')}ï¼š${minute}`;
                    } else {
                        formattedTime = `æ™šé–“ ${hour.toString().padStart(2, '0')}ï¼š${minute}`;
                    }
                }
            }
            
            // è¨ˆç®—é€±è¶Ÿæ•¸å’Œæ ¼å¼åŒ–æ—¥æœŸ - å„ªå…ˆä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„è¶Ÿæ•¸
            const weeklyTrips = frequency ? parseInt(frequency) : (serviceDays.length || 2);
            const dayMapping = {"é€±ä¸€": "é€±1", "é€±äºŒ": "é€±2", "é€±ä¸‰": "é€±3", "é€±å››": "é€±4", "é€±äº”": "é€±5", "é€±å…­": "é€±6", "é€±æ—¥": "é€±7"};
            const formattedDays = serviceDays.map(day => dayMapping[day] || day).join('+');
            const tripsAndDays = serviceDays.length > 0 ? `${weeklyTrips}è¶Ÿ-${formattedDays}` : `${weeklyTrips}è¶Ÿ`;
            
            // æ ¼å¼åŒ–æ¨“å±¤
            const floorNumber = floorLevel < 0 ? `åœ°ä¸‹${Math.abs(floorLevel)}æ¨“` : `${floorLevel}F`;
            
            // æ”¶å–æ™‚é–“æè¿°
            let collectionTimeDesc = '';
            if (formattedTime.includes('ä¸Šåˆ')) {
                collectionTimeDesc = 'ä¸­åˆå‰';
            } else if (formattedTime.includes('ä¸‹åˆ')) {
                collectionTimeDesc = 'ä¸‹åˆçµæŸå‰';
            } else if (formattedTime.includes('æ™šé–“')) {
                collectionTimeDesc = 'åŠå¤œå‰';
            } else {
                collectionTimeDesc = 'ä¸­åˆ/ä¸‹åˆ/åŠå¤œ/';
            }
            
            // é‘°åŒ™æç¤º
            const keyNote = floorLevel > 1 ? 'ï¼ˆä¸Šæ¨“ä»£æ”¶éœ€æä¾›1æ¨“å¤§é–€é‘°åŒ™ï¼‰' : 
                           floorLevel < 0 ? 'ï¼ˆåœ°ä¸‹å®¤ä»£æ”¶éœ€æä¾›åœ°ä¸‹å®¤é‘°åŒ™ï¼‰' : '';
            
            const quote = `â›”å ±åƒ¹è³‡æ–™â›”

ä¸€é€±è¶Ÿæ•¸ï¼š${tripsAndDays}
   ç½®æ”¾æ™‚é–“ï¼š${formattedTime || 'ï¼ˆæº–æ™‚ç½®æ”¾ï¼‰'}
   ç½®æ”¾æ¨“å±¤ï¼š${floorNumber}

ï¼ˆâš ï¸åƒåœ¾ç•¶æ—¥:${collectionTimeDesc} ä»£æ”¶å®Œç•¢ï¼‰
ï¼ˆâš ï¸éç¨‹ä¸­åš´ç¦å‚¬ä¿ƒï¼‰
ï¼ˆâš ï¸è«‹æº–æ™‚ç½®æ”¾ä»¥å…å¤šæœ‰ç³¾ç´›ï¼‰

 1é€±åƒåœ¾ï¼š${trashBags}åŒ…æ•¸ï¼ˆ${trashVolume}ï¼‰
ï¼ˆ1æ¬¡æœ€å¤šæ”¶å–${trashMax}è¢‹--è¶…é‡æ‹’æ”¶ï¼‰
ï¼ˆåƒåœ¾è«‹ç¶ç·Šã€å‹¿å¤–éœ²ï¼‰
ï¼ˆåƒåœ¾è¢‹å¤–éƒ¨å‹¿æµæ¹¯æ±ï¼‰
ï¼ˆä¸€æ¬¡æ€§ç´™/å¡‘è† å®¹å™¨å‡åƒåœ¾ï¼‰


 1é€±è³‡æº:${recycleBags}åŒ…æ•¸ï¼ˆ${recycleVolume}ï¼‰-ç”¨ä¸€èˆ¬å¡‘è† è¢‹
ï¼ˆ1æ¬¡æœ€å¤šæ”¶å–${recycleMax}è¢‹--è¶…é‡æ‹’æ”¶ï¼‰
ï¼ˆè‹¥æœªè£è¢‹ä¸€å¾‹æ‹’æ”¶ï¼‰
ï¼ˆè«‹å‹¿ç”¨é»‘è‰²è¢‹å­è£è³‡æºï¼‰
ï¼ˆåƒ…æ”¶å¯¶ç‰¹ç»ç’ƒéµé‹ç½ï¼‰
ï¼ˆåƒ…æ”¶ä¸­å°ç´™æ¿ç®±å£“æ‰æŠ˜å¥½ï¼‰
ï¼ˆåƒ…æ”¶æ›¸æœ¬/ä¹¾æ·¨ç´™å¼µï¼‰

âš ï¸ä¸‹åˆ—ç‰©å“è¦–ç‚ºåƒåœ¾
ï¼ˆä¾¿ç•¶ç›’/å¡‘è† è¢‹/å¸ç®¡â¡ï¸åƒåœ¾ï¼‰
ï¼ˆè»Ÿå¡‘è† è“‹/å¸ç®¡â¡ï¸åƒåœ¾ï¼‰
ï¼ˆæ—©é¤ç›’/å¿«é£²æ¯â¡ï¸åƒåœ¾ï¼‰
ï¼ˆæ³¡æ£‰/é›è›‹è»Ÿå¡‘è† ç›’â¡ï¸åƒåœ¾ï¼‰
ï¼ˆè›‹ç³•ç›’/ç·©è¡ææ–™â¡ï¸åƒåœ¾ï¼‰

ä¸€å€‹æœˆè²»ç”¨ï¼š${monthlyFee}å…ƒ
ï¼ˆä¸Šæ¨“ä»£æ”¶éœ€æä¾›1æ¨“å¤§é–€é‘°åŒ™ï¼‰
${keyNote}

-
ğŸ“‘é…åˆäº‹é …ğŸ“‘
â–ªåƒåœ¾å‹™å¿…æ‰“åŒ…ç¶å¥½æ”¾ç½®é–€å£
â–ªå¦‚å› æ”¿ç­–è®Šå‹•éœ€æ”¹æ™‚é–“
â¬‡ï¸å°‡æå‰å‘ŠçŸ¥ç…©è«‹é…åˆ
â–ªè‡ªå‚™é›™åŒ—å¸‚æ”¿åºœå°ˆç”¨åƒåœ¾è¢‹
â–ªæ”¶æ¬¾å¾Œä¸é€€æ¬¾å…§å®¹ä¸æ›´æ”¹
â–ªæœ‰è¶…é‡ä¸€å¾‹æ‹’æ”¶

    â‡©

ğŸš¨ å…¶ä»–å•é¡Œ ğŸš¨
ğŸ“„è«‹å…ˆå®Œæ•´é–±è®€å ±åƒ¹å…§å®¹æå‡º
ğŸ’¬å®¢æœè§£æ±ºä»»ä½•å•é¡Œ

    â‡©

â­•è§£æ±ºå•é¡Œâ­•
âœ”ï¸.ä¸Šè¿°å•é¡Œå‡è§£æ±º
âœ”ï¸.ä¸Šè¿°å…§å®¹èƒ½é…åˆ
å›è¦†å‘ŠçŸ¥æˆ‘å€‘ï¼šåŒæ„âœ…+é–‹å§‹æ—¥

    â‡©

æ”¶åˆ°_åŒæ„âœ…_å¾Œ
ğŸ’§å®¢æœâ¡ï¸æä¾›ç¹³è²»å–®
ğŸ’§å®¢æˆ¶â¡ï¸å®Œæˆç¹³è²»
ğŸ’§å®¢æœâ¡ï¸é–‹å§‹ä»£æ”¶

âš ï¸ æ³¨æ„äº‹é … âš ï¸
ğŸ”´1åˆ†éŒ¢1åˆ†æœå‹™ä½åƒ¹ç„¡å®‰å…¨ä¿éšœ
ğŸŸ è¿‘æœŸå¤šèµ·æ¡ˆä¾‹è«‹å‹™å¿…ç•™æ„
ğŸŸ¡å¹´è¼•å°ˆæ¥­åœ˜éšŠ-æµç¨‹çš†æœ‰ SOP
ğŸŸ¢æˆå“¡å¹³å‡ 30-35 æ­²çš†å…·è‰¯æ°‘è­‰
ğŸ”µéå¹´åŠå¤©ç½äººç¦åœæ­¢ä»£æ”¶ç„¡é€€æ¬¾
â¡ï¸å»¶è‡³ä¸‹ä¸€æ¬¡å¯ä»£æ”¶å·¥ä½œæ—¥



ğŸŒè§£æ±ºåƒåœ¾ä¸¦ä¸åªæ˜¯æ”¶èµ°
âš¡æˆ‘å€‘æ”¹è®Šçš„æ˜¯åŸå¸‚çš„é‹è½‰é€Ÿåº¦

${specialNotes ? `ç‰¹æ®Šéœ€æ±‚ï¼š${specialNotes}` : ''}`;

            // ç”Ÿæˆç«¶çˆ­å» å•†æ¯”è¼ƒ
            const fieldMapping = {
                weeklyFrequency: weeklyTrips + 'è¶Ÿ',
                frequency: weeklyTrips
            };
            generateQuoteVendorComparison(fieldMapping);

            document.getElementById('quote-result').textContent = quote;
            document.getElementById('quote-output').style.display = 'block';
            showStatus('quote-status', 'âœ… å ±åƒ¹å–®ç”Ÿæˆå®Œæˆï¼', 'success');
        }

        // Monthly task generation function
        function generateMonthlyTask() {
            const quoteData = document.getElementById('monthly-quote-data').value;
            const date = document.getElementById('monthly-date').value;
            
            // ç²å–æ‰€æœ‰æ‰‹å‹•è¼¸å…¥æ¬„ä½
            const fixedPrice = document.getElementById('monthly-fixed-price').value;
            const upstairs = document.getElementById('monthly-upstairs').value;
            const address = document.getElementById('monthly-address').value;
            const phone = document.getElementById('monthly-phone').value;
            const name = document.getElementById('monthly-name').value;
            const trashPickup = document.getElementById('monthly-trash-pickup').value;
            const recyclePickup = document.getElementById('monthly-recycle-pickup').value;
            const key = document.getElementById('monthly-key').value;
            const manualTime = document.getElementById('monthly-time').value;
            const bag = document.getElementById('monthly-bag').value;
            
            if (!quoteData || !date) {
                showStatus('monthly-status', 'è«‹å¡«å¯«å ±åƒ¹è³‡æ–™å’ŒåŸ·è¡Œæ—¥æœŸ', 'error');
                return;
            }
            
            // è§£æå ±åƒ¹è³‡æ–™
            let extractedAddress = address, extractedName = name, extractedPhone = phone;
            let fee = 0, weekDays = 'æœªå¡«', time = 'ä¸Šåˆ';
            let trashAmount = 'æœªå¡«', recycleAmount = 'æœªå¡«';
            
            // å¦‚æœæ‰‹å‹•æ¬„ä½ç‚ºç©ºï¼Œå‰‡å¾å ±åƒ¹è³‡æ–™ä¸­æå–
            if (!address || !name || !phone) {
                const lines = quoteData.split('\n');
                for (const line of lines) {
                    if (line.includes('åœ°å€') && !extractedAddress) {
                        extractedAddress = line.split(/[ï¼š:]/)[1]?.trim() || '';
                    }
                    if (line.includes('å§“å') && !extractedName) {
                        extractedName = line.split(/[ï¼š:]/)[1]?.trim() || '';
                    }
                    if (line.includes('é›»è©±') && !extractedPhone) {
                        extractedPhone = line.split(/[ï¼š:]/)[1]?.trim() || '';
                    }
                }
            }
            
            // ä½¿ç”¨å›ºå®šåƒ¹æ ¼
            if (fixedPrice) {
                fee = parseInt(fixedPrice);
            } else {
                // å¦‚æœæ²’æœ‰æ‰‹å‹•è¼¸å…¥åƒ¹æ ¼ï¼Œå¾å ±åƒ¹è³‡æ–™ä¸­æå–
                const feeMatch = quoteData.match(/ä¸€å€‹æœˆè²»ç”¨ï¼š(\d+)/);
                if (feeMatch) {
                    fee = parseInt(feeMatch[1]);
                }
            }
            
            // æå–é€±è¶Ÿæ•¸å’Œæ—¥æœŸ
            const weekMatch = quoteData.match(/ä¸€é€±è¶Ÿæ•¸ï¼š.*?(\d+è¶Ÿ)-(é€±.*?)\n/);
            weekDays = weekMatch ? weekMatch[2] : 'æœªå¡«';
            
            // å°‡é€±1+é€±4æ ¼å¼è½‰æ›ç‚ºæ˜ŸæœŸæ ¼å¼
            function convertWeekdayFormat(weekStr) {
                if (!weekStr || weekStr === 'æœªå¡«') return 'æœªå¡«';
                
                const weekMap = {
                    'é€±1': 'é€±ä¸€', 'é€±2': 'é€±äºŒ', 'é€±3': 'é€±ä¸‰', 
                    'é€±4': 'é€±å››', 'é€±5': 'é€±äº”', 'é€±6': 'é€±å…­', 'é€±æ—¥': 'é€±æ—¥'
                };
                
                // è™•ç†é€±1+é€±4é€™ç¨®æ ¼å¼
                return weekStr.replace(/é€±(\d)/g, (match, num) => {
                    return weekMap[match] || match;
                });
            }
            
            weekDays = convertWeekdayFormat(weekDays);
            
            // æ™‚é–“æ ¼å¼åŒ–å‡½æ•¸
            function formatTimeToChinnese(timeStr) {
                timeStr = timeStr.replace(/[ï¼š:å¾Œ]/g, '').trim();
                if (timeStr.length === 4 && !isNaN(timeStr)) {
                    const hour = parseInt(timeStr.substring(0, 2));
                    const minute = timeStr.substring(2);
                    let period;
                    if (hour < 12) {
                        period = 'ä¸Šåˆ';
                    } else if (hour < 18) {
                        period = 'ä¸‹åˆ';
                    } else {
                        period = 'æ™šé–“';
                    }
                    return `${period} ${hour.toString().padStart(2, '0')}ï¼š${minute} å¾Œ`;
                }
                if (timeStr.includes('ä¸Šåˆ') || timeStr.includes('ä¸‹åˆ') || timeStr.includes('æ™šé–“')) {
                    return timeStr + (timeStr.endsWith('å¾Œ') ? '' : ' å¾Œ');
                }
                return timeStr + (timeStr && !timeStr.endsWith('å¾Œ') ? 'å¾Œ' : '');
            }
            
            // ä½¿ç”¨æ‰‹å‹•æ™‚é–“æˆ–å¾æ–‡å­—ä¸­æå–
            if (manualTime.trim()) {
                time = formatTimeToChinnese(manualTime);
            } else {
                const timeMatch = quoteData.match(/ç½®æ”¾æ™‚é–“ï¼š(\d{2}ï¼š\d{2})/);
                if (timeMatch) {
                    const timeStr = timeMatch[1].replace('ï¼š', '');
                    time = formatTimeToChinnese(timeStr);
                } else {
                    time = 'ä¸Šåˆ';
                }
            }
            
            // æå–åƒåœ¾é‡ - å¢å¼·ç‰ˆåµæ¸¬
            let trashMatchFound = false;
            const trashPatterns = [
                /1é€±åƒåœ¾ï¼š(\d+)åŒ…æ•¸.*?\((\d+å…¬å‡)\)/,
                /åƒåœ¾.*?(\d+)åŒ….*?(\d+å…¬å‡)/,
                /1é€±åƒåœ¾.*?(\d+).*?(\d+å…¬å‡)/,
                /é€±åƒåœ¾ï¼š(\d+)åŒ…æ•¸.*?\((\d+å…¬å‡)\)/,
                /åƒåœ¾åŒ…æ•¸ï¼š(\d+).*?(\d+å…¬å‡)/
            ];
            
            for (const pattern of trashPatterns) {
                const match = quoteData.match(pattern);
                if (match) {
                    const volume = match[2].replace('å…¬å‡', '');
                    trashAmount = `${match[1]}åŒ…ï¼ˆ${volume}å…¬å‡ï¼‰`;
                    trashMatchFound = true;
                    break;
                }
            }
            
            // æå–è³‡æºé‡ - å¢å¼·ç‰ˆåµæ¸¬
            let recycleMatchFound = false;
            const recyclePatterns = [
                /1é€±è³‡æº:(\d+)åŒ…æ•¸.*?\((\d+å…¬å‡)\)/,
                /1é€±è³‡æºï¼š(\d+)åŒ…æ•¸.*?\((\d+å…¬å‡)\)/,
                /è³‡æº.*?(\d+)åŒ….*?(\d+å…¬å‡)/,
                /1é€±è³‡æº.*?(\d+).*?(\d+å…¬å‡)/,
                /é€±è³‡æºï¼š(\d+)åŒ…æ•¸.*?\((\d+å…¬å‡)\)/,
                /è³‡æºåŒ…æ•¸ï¼š(\d+).*?(\d+å…¬å‡)/
            ];
            
            for (const pattern of recyclePatterns) {
                const match = quoteData.match(pattern);
                if (match) {
                    const volume = match[2].replace('å…¬å‡', '');
                    recycleAmount = `${match[1]}åŒ…ï¼ˆ${volume}å…¬å‡ï¼‰`;
                    recycleMatchFound = true;
                    break;
                }
            }
            
            // å¦‚æœæ²’æœ‰æ‰¾åˆ°å®Œæ•´çš„åŒ…æ•¸å’Œå®¹é‡ï¼Œå˜—è©¦åªæ‰¾åŒ…æ•¸
            if (!trashMatchFound) {
                const trashSimplePatterns = [
                    /åƒåœ¾.*?(\d+)åŒ…/,
                    /1é€±åƒåœ¾.*?(\d+)/,
                    /åƒåœ¾åŒ…æ•¸ï¼š(\d+)/
                ];
                for (const pattern of trashSimplePatterns) {
                    const match = quoteData.match(pattern);
                    if (match) {
                        trashAmount = `${match[1]}åŒ…`;
                        break;
                    }
                }
            }
            
            if (!recycleMatchFound) {
                const recycleSimplePatterns = [
                    /è³‡æº.*?(\d+)åŒ…/,
                    /1é€±è³‡æº.*?(\d+)/,
                    /è³‡æºåŒ…æ•¸ï¼š(\d+)/
                ];
                for (const pattern of recycleSimplePatterns) {
                    const match = quoteData.match(pattern);
                    if (match) {
                        recycleAmount = `${match[1]}åŒ…`;
                        break;
                    }
                }
            }
            
            const dateObj = new Date(date);
            const weekDaysArray = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const weekDay = weekDaysArray[dateObj.getDay()];
            const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dateWithWeekday = `${formattedDate} é€±${weekDay}`;
            
            const generalTask = `ğŸ§‘â€ğŸš€åŒ…æœˆä»»å‹™ğŸ§‘â€ğŸš€

â¡ï¸æ—¥æœŸï¼š${dateWithWeekday}
â¡ï¸æ˜ŸæœŸï¼š${weekDays}
â¡ï¸æ™‚é–“ï¼š${time}
â¡ï¸åœ°å€ï¼š${extractedAddress}
â¡ï¸ä¸Šæ¨“ï¼š${upstairs === 'éœ€ä¸Šæ¨“' ? 'æ˜¯' : 'å¦'}
â¡ï¸é‘°åŒ™ï¼š${key}
â¡ï¸è²»ç”¨ï¼š${fee}
â¡ï¸å®¢æˆ¶è‡ªå‚™å°ˆç”¨è¢‹ï¼š${bag}
â¡ï¸1é€±åƒåœ¾é‡ï¼š${trashAmount}
ï¼ˆ1-${trashPickup}ï¼‰
â¡ï¸1é€±è³‡æºé‡ï¼š${recycleAmount}
ï¼ˆ1-${recyclePickup}ï¼‰
â¡ï¸å§“åï¼š${extractedName}
â¡ï¸é›»è©±ï¼š${extractedPhone}
â¡ï¸å…¶ä»–ï¼š
1.è‹¥æœ‰é‘°åŒ™ç´¢å–è«‹å›å ±
2.7å¤©å…§è¤‡è£½æ­¸é‚„åŸé‘°
3.å¦æœ‰è¦å®šæ™‚é–“è€…é™¤å¤–
4.é‘°åŒ™é€šå¸¸ç²˜ç½®ä¿¡ç®±

ğŸ“›å·²æ–°å¢æ—¥æ›†ğŸ“›
ğŸ“›å‹™å¿…è«‹éç›®ğŸ“›
ğŸ“›æœ‰å•é¡Œæå‡ºğŸ“›`;

            const limitedTask = `ğŸ§‘â€ğŸš€åŒ…æœˆä»»å‹™ğŸ§‘â€ğŸš€

â¡ï¸æ—¥æœŸï¼š${dateWithWeekday}
â¡ï¸æ˜ŸæœŸï¼š${weekDays}
â¡ï¸æ™‚é–“ï¼š${time}
â¡ï¸åœ°å€ï¼š${extractedAddress}
â¡ï¸ä¸Šæ¨“ï¼š${upstairs === 'éœ€ä¸Šæ¨“' ? 'æ˜¯' : 'å¦'}
â¡ï¸é‘°åŒ™ï¼š${key}
â¡ï¸è²»ç”¨ï¼š${fee}
â¡ï¸å®¢æˆ¶è‡ªå‚™å°ˆç”¨è¢‹ï¼š${bag}
â¡ï¸1é€±åƒåœ¾é‡ï¼š${trashAmount}
ï¼ˆ1-${trashPickup}ï¼‰
â¡ï¸1é€±è³‡æºé‡ï¼š${recycleAmount}
ï¼ˆ1-${recyclePickup}ï¼‰
â¡ï¸å§“åï¼š${extractedName}
â¡ï¸é›»è©±ï¼š${extractedPhone}
â¡ï¸åŸºæœ¬æœå‹™ï¼š
1.è¶…é‡ä¸€å¾‹æ”¶èµ°
2.ç¾å ´æ¸…ç©º
3.æ­£ç¢ºå›å ±

â¡ï¸å…¶ä»–ï¼š
1.è‹¥æœ‰é‘°åŒ™ç´¢å–è«‹å›å ±
2.7å¤©å…§è¤‡è£½æ­¸é‚„åŸé‘°
3.å¦æœ‰è¦å®šæ™‚é–“è€…é™¤å¤–
4.é‘°åŒ™é€šå¸¸ç²˜ç½®ä¿¡ç®±

ğŸ“›å·²æ–°å¢æ—¥æ›†ğŸ“›
ğŸ“›å‹™å¿…è«‹éç›®ğŸ“›
ğŸ“›æœ‰å•é¡Œæå‡ºğŸ“›`;

            document.getElementById('monthly-general').textContent = generalTask;
            document.getElementById('monthly-limited').textContent = limitedTask;
            document.getElementById('monthly-output').style.display = 'block';
            showStatus('monthly-status', 'âœ… åŒ…æœˆä»»å‹™å–®è½‰æ›å®Œæˆï¼', 'success');
        }



        // Single task generation function
        function generateSingleTask() {
            const date = document.getElementById('single-date').value;
            const time = document.getElementById('single-time').value;
            const phone = document.getElementById('single-phone').value;
            const name = document.getElementById('single-name').value;
            const address = document.getElementById('single-address').value;
            const upstairs = document.getElementById('single-upstairs').value;
            const wasteType = document.getElementById('single-waste-type').value;

            const fee = document.getElementById('single-fee').value;
            const customerBag = document.getElementById('single-customer-bag').value;
            
            // å‹•æ…‹æ”¶é›†æ‰€æœ‰å…¶ä»–èªªæ˜
            const otherNotes = [];
            const container = document.getElementById('single-notes-container');
            const allInputs = container.querySelectorAll('input[id^="single-other"]');
            allInputs.forEach(input => {
                const content = input.value;
                if (content && content.trim() !== '') {
                    otherNotes.push(content.trim());
                }
            });
            
            if (!date) {
                showStatus('single-status', 'è«‹å¡«å¯«åŸ·è¡Œæ—¥æœŸ', 'error');
                return;
            }
            
            const dateObj = new Date(date);
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const weekDay = weekDays[dateObj.getDay()];
            const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dateWithWeekday = `${formattedDate} é€±${weekDay}`;
            
            // æ ¼å¼åŒ–æ™‚é–“ - æ”¯æ´æ™‚é–“å€é–“
            let formattedTime = time || 'ä¸Šåˆ';
            if (time) {
                // æª¢æŸ¥æ˜¯å¦ç‚ºæ™‚é–“å€é–“æ ¼å¼ (å¦‚ 1500-1630)
                const timeRangeMatch = time.match(/(\d{4})-(\d{4})/);
                if (timeRangeMatch) {
                    const startTime = timeRangeMatch[1];
                    const endTime = timeRangeMatch[2];
                    
                    // æ ¼å¼åŒ–é–‹å§‹æ™‚é–“
                    const startHour = parseInt(startTime.substring(0, 2));
                    const startMinute = startTime.substring(2);
                    let startPeriod = startHour < 12 ? 'ä¸Šåˆ' : (startHour < 18 ? 'ä¸‹åˆ' : 'æ™šé–“');
                    
                    // æ ¼å¼åŒ–çµæŸæ™‚é–“
                    const endHour = parseInt(endTime.substring(0, 2));
                    const endMinute = endTime.substring(2);
                    
                    formattedTime = `${startPeriod} ${startHour.toString().padStart(2, '0')}ï¼š${startMinute}-${endHour.toString().padStart(2, '0')}ï¼š${endMinute}`;
                } else if (time.match(/^\d{4}$/)) {
                    // è™•ç†å››ä½æ•¸æ™‚é–“æ ¼å¼ (å¦‚ 1300)
                    const hour = parseInt(time.substring(0, 2));
                    const minute = time.substring(2);
                    let period = hour < 12 ? 'ä¸Šåˆ' : (hour < 18 ? 'ä¸‹åˆ' : 'æ™šé–“');
                    formattedTime = `${period} ${hour.toString().padStart(2, '0')}ï¼š${minute}`;
                } else if (time.includes(':')) {
                    // åŸæœ‰çš„å–®ä¸€æ™‚é–“æ ¼å¼è™•ç†
                    const [hour, minute] = time.split(':');
                    const hourInt = parseInt(hour);
                    if (hourInt < 12) {
                        formattedTime = `ä¸Šåˆ ${hour}ï¼š${minute}`;
                    } else if (hourInt < 18) {
                        formattedTime = `ä¸‹åˆ ${hour}ï¼š${minute}`;
                    } else {
                        formattedTime = `æ™šé–“ ${hour}ï¼š${minute}`;
                    }
                } else {
                    // å…¶ä»–æ ¼å¼ç›´æ¥é¡¯ç¤º
                    formattedTime = time;
                }
            }
            
            // æ±ºå®šåƒåœ¾è³‡æºé‡æ–‡å­—
            const wasteAmount = wasteType === 'æ‰‹å‹•å¡«å¯«' ? 
                (document.getElementById('single-waste-manual').value || 'å¦‚åœ–') : 'å¦‚åœ–';
            
            // æ§‹å»ºå…¶ä»–èªªæ˜å…§å®¹
            let otherDetails = '';
            let itemNumber = 4;
            otherNotes.forEach((note, index) => {
                otherDetails += `${itemNumber}.${note}`;
                if (index < otherNotes.length - 1) {
                    otherDetails += '\n';
                }
                itemNumber++;
            });

            const singleTask = `ğŸ§‘â€ğŸš€å–®è¶Ÿä»»å‹™ğŸ§‘â€ğŸš€

â¡ï¸æ—¥æœŸï¼š${dateWithWeekday}
â¡ï¸æ™‚é–“ï¼š${formattedTime}
â¡ï¸é›»è©±ï¼š${phone}
â¡ï¸å§“åï¼š${name}
â¡ï¸åœ°å€ï¼š${address}
â¡ï¸ä¸Šæ¨“ï¼š${upstairs || 'ç„¡'}
â¡ï¸å®¢æˆ¶è‡ªå‚™å°ˆç”¨è¢‹ï¼š${customerBag}
â¡ï¸è²»ç”¨ï¼š${fee}
â¡ï¸åƒåœ¾è³‡æºé‡ï¼š${wasteAmount}
â¡ï¸ç¾æ³ç…§ç‰‡ï¼š
â¡ï¸å…¶ä»–ï¼š
1.å›å ±ï¼š
ï¼ˆ1ï¼‰å–®è¶Ÿï¼šXX+è·¯æ®µ/è¡—
2.å°‘é‡è¶…é‡ä¸€å¾‹æ¸…èµ°
3.ç…§ç‰‡æ‹å®Œå–„
${otherDetails}

ğŸ”¥å·²æ–°å¢æ—¥æ›†ğŸ”¥
ğŸ”¥å‹™å¿…è«‹éç›®ğŸ”¥
ğŸ”¥æœ‰å•é¡Œæå‡ºğŸ”¥`;

            document.getElementById('single-result').textContent = singleTask;
            document.getElementById('single-output').style.display = 'block';
            showStatus('single-status', 'âœ… å–®è¶Ÿä»»å‹™å–®è½‰æ›å®Œæˆï¼', 'success');
        }



        // Clean task generation function
        function generateCleanTask() {
            const date = document.getElementById('clean-date').value;
            const time = document.getElementById('clean-time').value;
            const phone = document.getElementById('clean-phone').value;
            const name = document.getElementById('clean-name').value;
            const address = document.getElementById('clean-address').value;
            const upstairs = document.getElementById('clean-upstairs').value;
            const fee = document.getElementById('clean-fee').value;
            
            // å‹•æ…‹æ”¶é›†æ‰€æœ‰å…¶ä»–èªªæ˜
            const otherNotes = [];
            const notesContainer = document.getElementById('clean-notes-container');
            const allNoteInputs = notesContainer.querySelectorAll('input[id^="clean-other"]');
            allNoteInputs.forEach(input => {
                const content = input.value;
                if (content && content.trim() !== '') {
                    otherNotes.push(content.trim());
                }
            });
            
            // å‹•æ…‹æ”¶é›†æ‰€æœ‰æ¸…æ½”ç¯„åœ
            const cleaningScope = [];
            const scopeContainer = document.getElementById('clean-scope-container');
            const allScopeInputs = scopeContainer.querySelectorAll('input[id^="clean-scope-"]');
            let scopeIndex = 1;
            allScopeInputs.forEach(input => {
                const content = input.value;
                if (content && content.trim() !== '') {
                    cleaningScope.push(`${scopeIndex}.${content.trim()}`);
                    scopeIndex++;
                }
            });
            
            if (!date) {
                showStatus('clean-status', 'è«‹å¡«å¯«æ¸…æ½”æ—¥æœŸ', 'error');
                return;
            }
            
            const dateObj = new Date(date);
            const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            const weekDay = weekDays[dateObj.getDay()];
            const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dateWithWeekday = `${formattedDate} é€±${weekDay}`;
            
            // æ ¼å¼åŒ–æ™‚é–“
            let formattedTime = time || 'ä¸Šåˆ';
            if (time && time.includes(':')) {
                const [hour, minute] = time.split(':');
                const hourInt = parseInt(hour);
                if (hourInt < 12) {
                    formattedTime = `ä¸Šåˆ ${hour}ï¼š${minute}`;
                } else if (hourInt < 18) {
                    formattedTime = `ä¸‹åˆ ${hour}ï¼š${minute}`;
                } else {
                    formattedTime = `æ™šé–“ ${hour}ï¼š${minute}`;
                }
            }
            
            // ç”Ÿæˆæ¸…æ½”ç¯„åœæ–‡å­—
            const scopeText = cleaningScope.length > 0 ? cleaningScope.join('\n') : 'å¾…ç¾å ´ç¢ºèª';
            
            // æ§‹å»ºå…¶ä»–èªªæ˜å…§å®¹
            let otherDetails = '';
            let itemNumber = 5;
            otherNotes.forEach((note, index) => {
                otherDetails += `${itemNumber}.${note}`;
                if (index < otherNotes.length - 1) {
                    otherDetails += '\n';
                }
                itemNumber++;
            });
            
            const cleanTask = `ğŸ§‘â€ğŸš€æ¸…æ½”ä»»å‹™ğŸ§‘â€ğŸš€

â¡ï¸æ—¥æœŸï¼š${dateWithWeekday}
â¡ï¸é›»è©±ï¼š${phone}
â¡ï¸å§“åï¼š${name}
â¡ï¸åœ°å€ï¼š${address}
â¡ï¸ä¸Šæ¨“ï¼š${upstairs || 'ç„¡'}
â¡ï¸è²»ç”¨ï¼š${fee}
â¡ï¸æ¸…æ½”ç¯„åœï¼š
${scopeText}
â¡ï¸å…¶ä»–ï¼š
1.å›å ±ï¼š
ï¼ˆ1ï¼‰å–®è¶Ÿï¼šXX+è·¯æ®µ/è¡—
2.ç¾å ´æ¸…æ½”å¾ŒåŠå°‘é‡åƒåœ¾
   ä¸€å¾‹å¸¶èµ°æ¸…ç©º
3.ç…§ç‰‡æ‹å®Œå–„
4.æ¸…æ½”ç…§ç‰‡åƒ…æ‹å®Œæˆå¾Œç…§ç‰‡å³å¯
${otherDetails}

ğŸ”¥å·²æ–°å¢æ—¥æ›†ğŸ”¥
ğŸ”¥å‹™å¿…è«‹éç›®ğŸ”¥
ğŸ”¥æœ‰å•é¡Œæå‡ºğŸ”¥`;

            document.getElementById('clean-result').textContent = cleanTask;
            document.getElementById('clean-output').style.display = 'block';
            showStatus('clean-status', 'âœ… æ¸…æ½”ä»»å‹™å–®è½‰æ›å®Œæˆï¼', 'success');
        }

        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function() {
                    const statusId = elementId.includes('quote') ? 'quote-status' : 
                                   elementId.includes('monthly') ? 'monthly-status' :
                                   elementId.includes('single') ? 'single-status' : 'clean-status';
                    showStatus(statusId, 'âœ… å…§å®¹å·²æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
                }, function(err) {
                    showStatus(statusId, 'âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½', 'error');
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const statusId = elementId.includes('quote') ? 'quote-status' : 
                                   elementId.includes('monthly') ? 'monthly-status' :
                                   elementId.includes('single') ? 'single-status' : 'clean-status';
                    showStatus(statusId, 'âœ… å…§å®¹å·²æˆåŠŸè¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
                } catch (err) {
                    showStatus(statusId, 'âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // Show status message
        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            
            setTimeout(() => {
                statusElement.textContent = '';
                statusElement.className = 'status';
            }, 4000);
        }

        // Clear form functions
        function clearQuoteForm() {
            // Reset form fields to default values
            document.getElementById('service-time').value = '';
            document.getElementById('floor-level').value = '';
            document.getElementById('monthly-fee').value = '';
            document.getElementById('frequency').value = '';
            document.getElementById('trash-bags').value = '';
            document.getElementById('trash-volume').value = '';
            document.getElementById('recycle-bags').value = '';
            document.getElementById('recycle-volume').value = '';
            document.getElementById('trash-max').value = '';
            document.getElementById('recycle-max').value = '';
            document.getElementById('special-notes').value = '';
            
            // Clear and reset checkboxes to default (é€±äºŒ and é€±äº”)
            const checkboxes = document.querySelectorAll('input[name="service-days"]');
            checkboxes.forEach(cb => cb.checked = false);
            document.querySelector('input[name="service-days"][value="é€±äºŒ"]').checked = true;
            document.querySelector('input[name="service-days"][value="é€±äº”"]').checked = true;
            
            // Hide output
            document.getElementById('quote-output').style.display = 'none';
            document.getElementById('quote-status').textContent = '';
            
            // Show confirmation message
            showStatus('quote-status', 'âœ… è¡¨å–®å·²æ¸…ç©ºé‡ç½®ï¼', 'success');
        }

        function clearMonthlyForm() {
            document.getElementById('monthly-quote-data').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('monthly-date').value = today;
            document.getElementById('monthly-time').value = '';
            document.getElementById('monthly-fixed-price').value = '';
            document.getElementById('monthly-upstairs').value = '';
            document.getElementById('monthly-address').value = '';
            document.getElementById('monthly-phone').value = '';
            document.getElementById('monthly-name').value = '';
            document.getElementById('monthly-trash-pickup').value = '';
            document.getElementById('monthly-recycle-pickup').value = '';
            document.getElementById('monthly-key').value = '';
            document.getElementById('monthly-bag').value = '';
            
            // Hide output
            document.getElementById('monthly-output').style.display = 'none';
            document.getElementById('monthly-status').textContent = '';
            
            // Show confirmation message
            showStatus('monthly-status', 'âœ… è¡¨å–®å·²æ¸…ç©ºé‡ç½®ï¼', 'success');
        }

        function clearSingleForm() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('single-date').value = today;
            document.getElementById('single-time').value = '';
            document.getElementById('single-phone').value = '';
            document.getElementById('single-name').value = '';
            document.getElementById('single-address').value = '';
            document.getElementById('single-upstairs').value = '';
            document.getElementById('single-customer-bag').value = 'ç„¡';
            document.getElementById('single-waste-type').value = 'å¦‚åœ–';
            document.getElementById('single-waste-manual').value = '';
            document.getElementById('single-waste-manual-div').style.display = 'none';
            document.getElementById('single-fee').value = '';
            
            // é‡ç½®å‹•æ…‹å…¶ä»–èªªæ˜å€åŸŸ - åªä¿ç•™ç¬¬ä¸€å€‹
            const container = document.getElementById('single-notes-container');
            container.innerHTML = `
                <div class="single-note-item" id="single-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div style="flex: 0 0 100px;">
                        <label>ğŸ“èªªæ˜1ï¼š</label>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" id="single-other1" placeholder="ä¾‹ï¼šå›å ±è·¯æ®µ" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                </div>
            `;
            singleNoteNextId = 1; // é‡ç½®IDè¨ˆæ•¸å™¨
            updateSingleNoteButtonState(); // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            
            // Clear images using the new clear function
            clearSingleImages();
            
            // Hide output
            document.getElementById('single-output').style.display = 'none';
            document.getElementById('single-status').textContent = '';
            
            // Show confirmation message
            showStatus('single-status', 'âœ… è¡¨å–®å·²æ¸…ç©ºé‡ç½®ï¼', 'success');
        }

        function clearCleanForm() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('clean-date').value = today;
            document.getElementById('clean-time').value = '';
            document.getElementById('clean-phone').value = '';
            document.getElementById('clean-name').value = '';
            document.getElementById('clean-address').value = '';
            document.getElementById('clean-upstairs').value = '';
            document.getElementById('clean-fee').value = '';
            
            // é‡ç½®å‹•æ…‹å…¶ä»–èªªæ˜å€åŸŸ - åªä¿ç•™ç¬¬ä¸€å€‹
            const notesContainer = document.getElementById('clean-notes-container');
            notesContainer.innerHTML = `
                <div class="clean-note-item" id="clean-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div style="flex: 0 0 100px;">
                        <label>ğŸ“èªªæ˜1ï¼š</label>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" id="clean-other1" placeholder="ä¾‹ï¼šç‰¹æ®Šæ¸…æ½”éœ€æ±‚" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                </div>
            `;
            cleanNoteNextId = 1; // é‡ç½®IDè¨ˆæ•¸å™¨
            updateCleanNoteButtonState(); // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            
            // é‡ç½®å‹•æ…‹æ¸…æ½”ç¯„åœå€åŸŸ - åªä¿ç•™ç¬¬ä¸€å€‹
            const scopeContainer = document.getElementById('clean-scope-container');
            scopeContainer.innerHTML = `
                <div class="clean-scope-item" id="clean-scope-item-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div style="flex: 0 0 100px;">
                        <label>ğŸ§¹é …ç›®1ï¼š</label>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" id="clean-scope-1" placeholder="æ¸…æ½”é …ç›® 1" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                </div>
            `;
            cleanScopeNextId = 1; // é‡ç½®IDè¨ˆæ•¸å™¨
            updateCleanScopeButtonState(); // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            
            // Clear images using the new clear function
            clearCleanImages();
            
            // Hide output
            document.getElementById('clean-output').style.display = 'none';
            document.getElementById('clean-status').textContent = '';
            
            // Show confirmation message
            showStatus('clean-status', 'âœ… è¡¨å–®å·²æ¸…ç©ºé‡ç½®ï¼', 'success');
        }

        // Set today's date as default for date inputs
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('monthly-date').value = today;
            document.getElementById('single-date').value = today;
            document.getElementById('clean-date').value = today;
            
            // Initialize drag and drop for single trip and clean photos
            initializeSingleImageUpload();
            initializeCleanImageUpload();
        });

        // Single trip image upload functions
        let singleImages = [];

        function initializeSingleImageUpload() {
            const dropZone = document.getElementById('single-drop-zone');
            const fileInput = document.getElementById('single-images');

            if (!dropZone || !fileInput) return;

            // Drag and drop events
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', (e) => {
                // Only remove dragover if we're actually leaving the drop zone
                if (!dropZone.contains(e.relatedTarget)) {
                    dropZone.classList.remove('dragover');
                }
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleSingleImageFiles(files);
            });

            // File input change event
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleSingleImageFiles(files);
            });
        }

        function handleSingleImageFiles(files) {
            // Filter for image files only
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showStatus('single-status', 'âŒ è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–ç‰‡æª”æ¡ˆ (PNG, JPG, JPEG)', 'error');
                return;
            }

            // Add new images to collection
            imageFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = {
                        file: file,
                        dataUrl: e.target.result,
                        id: Date.now() + Math.random()
                    };
                    singleImages.push(imageData);
                    updateSingleImagePreview();
                };
                reader.readAsDataURL(file);
            });

            showStatus('single-status', `âœ… å·²æ·»åŠ  ${imageFiles.length} å¼µç…§ç‰‡`, 'success');
        }

        function updateSingleImagePreview() {
            const previewContainer = document.getElementById('single-image-preview');
            const mergeControls = document.getElementById('single-merge-controls');
            
            if (singleImages.length === 0) {
                previewContainer.innerHTML = '';
                mergeControls.style.display = 'none';
                return;
            }

            // Show merge controls
            mergeControls.style.display = 'flex';
            
            // Create compact preview HTML for inline layout
            let previewHTML = '<div style="margin-bottom: 8px; font-size: 14px; color: #ccc;"><strong>å·²ä¸Šå‚³ (' + singleImages.length + 'å¼µ)</strong></div>';
            previewHTML += '<div style="display: flex; flex-wrap: wrap; gap: 5px;">';
            
            // Show only first 6 images in preview, indicate more if needed
            const displayCount = Math.min(6, singleImages.length);
            
            for (let i = 0; i < displayCount; i++) {
                const image = singleImages[i];
                previewHTML += `
                    <div class="photo-preview-inline" style="position: relative; display: inline-block;">
                        <img src="${image.dataUrl}" alt="Photo ${i + 1}" style="width: 60px; height: 45px; object-fit: cover; border-radius: 3px; border: 1px solid #444;">
                        <button class="photo-remove-inline" onclick="removeSingleImage(${image.id})" title="åˆªé™¤ç…§ç‰‡" style="position: absolute; top: -5px; right: -5px; background: rgba(231, 76, 60, 0.9); color: white; border: none; border-radius: 50%; width: 16px; height: 16px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center;">Ã—</button>
                    </div>
                `;
            }
            
            if (singleImages.length > 6) {
                previewHTML += `<div style="color: #888; font-size: 12px; align-self: center;">+${singleImages.length - 6}å¼µ</div>`;
            }
            
            previewHTML += '</div>';
            previewContainer.innerHTML = previewHTML;
        }

        function removeSingleImage(imageId) {
            singleImages = singleImages.filter(img => img.id !== imageId);
            updateSingleImagePreview();
            
            if (singleImages.length === 0) {
                document.getElementById('single-merged-preview').innerHTML = '';
                showStatus('single-status', 'âœ… æ‰€æœ‰ç…§ç‰‡å·²æ¸…é™¤', 'success');
            }
        }

        function clearSingleImages() {
            singleImages = [];
            document.getElementById('single-images').value = '';
            document.getElementById('single-image-preview').innerHTML = '';
            document.getElementById('single-merged-preview').innerHTML = '';
            document.getElementById('single-merge-controls').style.display = 'none';
            showStatus('single-status', 'âœ… æ‰€æœ‰ç…§ç‰‡å·²æ¸…é™¤', 'success');
        }

        function mergeSingleImages() {
            if (singleImages.length === 0) {
                showStatus('single-status', 'âŒ è«‹å…ˆä¸Šå‚³ç…§ç‰‡', 'error');
                return;
            }

            showStatus('single-status', 'ğŸ”„ æ­£åœ¨åˆä½µç…§ç‰‡...', 'success');

            // Create canvas for merging
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Load all images and merge
            Promise.all(singleImages.map(imageData => {
                return new Promise(resolve => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = imageData.dataUrl;
                });
            })).then(images => {
                // Smart grid layout based on image count
                let imagesPerRow, rows;
                if (images.length === 1) {
                    imagesPerRow = 1;
                    rows = 1;
                } else if (images.length === 2) {
                    imagesPerRow = 2;
                    rows = 1;
                } else if (images.length === 3) {
                    imagesPerRow = 3;
                    rows = 1;
                } else if (images.length === 4) {
                    imagesPerRow = 2;
                    rows = 2;
                } else if (images.length <= 6) {
                    imagesPerRow = 3;
                    rows = 2;
                } else if (images.length <= 9) {
                    imagesPerRow = 3;
                    rows = 3;
                } else {
                    imagesPerRow = 4;
                    rows = Math.ceil(images.length / 4);
                }
                
                const imageSize = Math.floor(600 / Math.max(imagesPerRow, rows));
                const totalWidth = imagesPerRow * imageSize;
                const totalHeight = rows * imageSize;
                
                // Optimize canvas size to reduce white space
                const actualWidth = Math.max(totalWidth, totalHeight);
                const actualHeight = Math.max(totalWidth, totalHeight);
                canvas.width = actualWidth;
                canvas.height = actualHeight;
                const finalMarginX = (actualWidth - totalWidth) / 2;
                const finalMarginY = (actualHeight - totalHeight) / 2;
                
                
                // Draw images in smart grid
                images.forEach((img, index) => {
                    const col = index % imagesPerRow;
                    const row = Math.floor(index / imagesPerRow);
                    const x = finalMarginX + col * imageSize;
                    const y = finalMarginY + row * imageSize;
                    
                    // Draw image as square (crop to fit)
                    const aspectRatio = img.width / img.height;
                    let sourceX = 0, sourceY = 0, sourceSize;
                    
                    if (aspectRatio > 1) {
                        // å¯¬åœ–ç‰‡ï¼Œè£åˆ‡å·¦å³
                        sourceSize = img.height;
                        sourceX = (img.width - sourceSize) / 2;
                    } else {
                        // é«˜åœ–ç‰‡ï¼Œè£åˆ‡ä¸Šä¸‹
                        sourceSize = img.width;
                        sourceY = (img.height - sourceSize) / 2;
                    }
                    
                    ctx.drawImage(img, sourceX, sourceY, sourceSize, sourceSize, x, y, imageSize, imageSize);
                    
                    // Draw red grid lines
                    ctx.strokeStyle = '#FF0000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, imageSize, imageSize);
                });
                
                
                // Display merged image
                const mergedDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                const mergedPreview = document.getElementById('single-merged-preview');
                mergedPreview.innerHTML = `
                    <div class="merged-photo">
                        <div class="merged-photo-content">
                            <div><strong>åˆä½µç…§ç‰‡ï¼š</strong></div>
                            <img src="${mergedDataUrl}" alt="åˆä½µç…§ç‰‡">
                        </div>
                        <div class="merged-photo-controls">
                            <button class="btn-download" onclick="downloadMergedImage('${mergedDataUrl}', 'single')">â†“</button>
                        </div>
                    </div>
                `;
                
                showStatus('single-status', `âœ… å·²æˆåŠŸåˆä½µ ${images.length} å¼µç…§ç‰‡ï¼`, 'success');
            });
        }

        function downloadMergedImage(dataUrl, type) {
            const link = document.createElement('a');
            link.download = `åˆä½µç…§ç‰‡_${type}_${new Date().toISOString().slice(0,10)}.jpg`;
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Clean task image upload functions
        let cleanImages = [];

        function initializeCleanImageUpload() {
            const dropZone = document.getElementById('clean-drop-zone');
            const fileInput = document.getElementById('clean-images');

            if (!dropZone || !fileInput) return;

            // Drag and drop events
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', (e) => {
                if (!dropZone.contains(e.relatedTarget)) {
                    dropZone.classList.remove('dragover');
                }
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleCleanImageFiles(files);
            });

            // File input change event
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleCleanImageFiles(files);
            });
        }

        function handleCleanImageFiles(files) {
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showStatus('clean-status', 'âŒ è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–ç‰‡æª”æ¡ˆ (PNG, JPG, JPEG)', 'error');
                return;
            }

            imageFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = {
                        file: file,
                        dataUrl: e.target.result,
                        id: Date.now() + Math.random()
                    };
                    cleanImages.push(imageData);
                    updateCleanImagePreview();
                };
                reader.readAsDataURL(file);
            });

            showStatus('clean-status', `âœ… å·²æ·»åŠ  ${imageFiles.length} å¼µç…§ç‰‡`, 'success');
        }

        function updateCleanImagePreview() {
            const previewContainer = document.getElementById('clean-image-preview');
            const mergeControls = document.getElementById('clean-merge-controls');
            
            if (cleanImages.length === 0) {
                previewContainer.innerHTML = '';
                mergeControls.style.display = 'none';
                return;
            }

            // Show merge controls
            mergeControls.style.display = 'flex';
            
            // Create compact preview HTML for inline layout
            let previewHTML = '<div style="margin-bottom: 8px; font-size: 14px; color: #ccc;"><strong>å·²ä¸Šå‚³ (' + cleanImages.length + 'å¼µ)</strong></div>';
            previewHTML += '<div style="display: flex; flex-wrap: wrap; gap: 5px;">';
            
            const displayCount = Math.min(6, cleanImages.length);
            
            for (let i = 0; i < displayCount; i++) {
                const image = cleanImages[i];
                previewHTML += `
                    <div class="photo-preview-inline" style="position: relative; display: inline-block;">
                        <img src="${image.dataUrl}" alt="Photo ${i + 1}" style="width: 60px; height: 45px; object-fit: cover; border-radius: 3px; border: 1px solid #444;">
                        <button class="photo-remove-inline" onclick="removeCleanImage(${image.id})" title="åˆªé™¤ç…§ç‰‡" style="position: absolute; top: -5px; right: -5px; background: rgba(231, 76, 60, 0.9); color: white; border: none; border-radius: 50%; width: 16px; height: 16px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center;">Ã—</button>
                    </div>
                `;
            }
            
            if (cleanImages.length > 6) {
                previewHTML += `<div style="color: #888; font-size: 12px; align-self: center;">+${cleanImages.length - 6}å¼µ</div>`;
            }
            
            previewHTML += '</div>';
            previewContainer.innerHTML = previewHTML;
        }

        function removeCleanImage(imageId) {
            cleanImages = cleanImages.filter(img => img.id !== imageId);
            updateCleanImagePreview();
            
            if (cleanImages.length === 0) {
                document.getElementById('clean-merged-preview').innerHTML = '';
                showStatus('clean-status', 'âœ… æ‰€æœ‰ç…§ç‰‡å·²æ¸…é™¤', 'success');
            }
        }

        function clearCleanImages() {
            cleanImages = [];
            document.getElementById('clean-images').value = '';
            document.getElementById('clean-image-preview').innerHTML = '';
            document.getElementById('clean-merged-preview').innerHTML = '';
            document.getElementById('clean-merge-controls').style.display = 'none';
            showStatus('clean-status', 'âœ… æ‰€æœ‰ç…§ç‰‡å·²æ¸…é™¤', 'success');
        }

        function mergeCleanImages() {
            if (cleanImages.length === 0) {
                showStatus('clean-status', 'âŒ è«‹å…ˆä¸Šå‚³ç…§ç‰‡', 'error');
                return;
            }

            showStatus('clean-status', 'ğŸ”„ æ­£åœ¨åˆä½µç…§ç‰‡...', 'success');

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            Promise.all(cleanImages.map(imageData => {
                return new Promise(resolve => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = imageData.dataUrl;
                });
            })).then(images => {
                // Smart grid layout based on image count
                let imagesPerRow, rows;
                if (images.length === 1) {
                    imagesPerRow = 1;
                    rows = 1;
                } else if (images.length === 2) {
                    imagesPerRow = 2;
                    rows = 1;
                } else if (images.length === 3) {
                    imagesPerRow = 3;
                    rows = 1;
                } else if (images.length === 4) {
                    imagesPerRow = 2;
                    rows = 2;
                } else if (images.length <= 6) {
                    imagesPerRow = 3;
                    rows = 2;
                } else if (images.length <= 9) {
                    imagesPerRow = 3;
                    rows = 3;
                } else {
                    imagesPerRow = 4;
                    rows = Math.ceil(images.length / 4);
                }
                
                const imageSize = Math.floor(600 / Math.max(imagesPerRow, rows));
                const totalWidth = imagesPerRow * imageSize;
                const totalHeight = rows * imageSize;
                
                // Optimize canvas size to reduce white space
                const actualWidth = Math.max(totalWidth, totalHeight);
                const actualHeight = Math.max(totalWidth, totalHeight);
                canvas.width = actualWidth;
                canvas.height = actualHeight;
                const finalMarginX = (actualWidth - totalWidth) / 2;
                const finalMarginY = (actualHeight - totalHeight) / 2;
                
                
                // Draw images in smart grid
                images.forEach((img, index) => {
                    const col = index % imagesPerRow;
                    const row = Math.floor(index / imagesPerRow);
                    const x = finalMarginX + col * imageSize;
                    const y = finalMarginY + row * imageSize;
                    
                    // Draw image as square (crop to fit)
                    const aspectRatio = img.width / img.height;
                    let sourceX = 0, sourceY = 0, sourceSize;
                    
                    if (aspectRatio > 1) {
                        // å¯¬åœ–ç‰‡ï¼Œè£åˆ‡å·¦å³
                        sourceSize = img.height;
                        sourceX = (img.width - sourceSize) / 2;
                    } else {
                        // é«˜åœ–ç‰‡ï¼Œè£åˆ‡ä¸Šä¸‹
                        sourceSize = img.width;
                        sourceY = (img.height - sourceSize) / 2;
                    }
                    
                    ctx.drawImage(img, sourceX, sourceY, sourceSize, sourceSize, x, y, imageSize, imageSize);
                    
                    // Draw red grid lines
                    ctx.strokeStyle = '#FF0000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, imageSize, imageSize);
                });
                
                
                const mergedDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                const mergedPreview = document.getElementById('clean-merged-preview');
                mergedPreview.innerHTML = `
                    <div class="merged-photo">
                        <div class="merged-photo-content">
                            <div><strong>åˆä½µç…§ç‰‡ï¼š</strong></div>
                            <img src="${mergedDataUrl}" alt="åˆä½µç…§ç‰‡">
                        </div>
                        <div class="merged-photo-controls">
                            <button class="btn-download" onclick="downloadMergedImage('${mergedDataUrl}', 'clean')">â†“</button>
                        </div>
                    </div>
                `;
                
                showStatus('clean-status', `âœ… å·²æˆåŠŸåˆä½µ ${images.length} å¼µç…§ç‰‡ï¼`, 'success');
            });
        }

        // è‡ªå‹•å ±åƒ¹å–®ç›¸é—œå‡½æ•¸
        let autoQuoteData = null;
        
        // å­˜å„²ç”¨æˆ¶é¸ä¸­çš„è³‡æ–™è¡Œ
        let selectedAutoQuoteData = null;
        let selectedAutoQuoteRowIndex = -1;

        function clearAutoQuoteForm() {
            // æ¸…ç©ºGoogleè©¦ç®—è¡¨ç¶²å€
            document.getElementById('sheets-url').value = '';
            document.getElementById('saved-urls').value = '';
            
            // æ¸…ç©ºæ‰‹å‹•è¼¸å…¥æ¬„ä½
            document.getElementById('manual-fee').value = '';
            document.getElementById('manual-time').value = '';
            document.getElementById('manual-floor').value = '';
            document.getElementById('manual-frequency').value = '';
            document.getElementById('manual-trash').value = '';
            document.getElementById('manual-recycle').value = '';
            document.getElementById('manual-trash-volume').value = '';
            document.getElementById('manual-recycle-volume').value = '';
            document.getElementById('manual-trash-max').value = '';
            document.getElementById('manual-recycle-max').value = '';
            document.getElementById('manual-special-notes').value = '';
            
            // æ¸…ç©ºè¤‡é¸æ¡†
            document.querySelectorAll('input[name="manual-days"]').forEach(cb => cb.checked = false);
            
            // éš±è—è¼¸å‡ºå€åŸŸ
            document.getElementById('auto-detected-data').style.display = 'none';
            document.getElementById('auto-quote-controls').style.display = 'none';
            document.getElementById('auto-quote-output').style.display = 'none';
            document.getElementById('auto-sheets-status').style.display = 'none';
            document.getElementById('auto-quote-final-status').style.display = 'none';
            
            // æ¸…ç©ºæ•¸æ“š
            autoQuoteData = null;
            selectedAutoQuoteData = null;
            selectedAutoQuoteRowIndex = -1;
        }

        async function fetchGoogleSheetsData() {
            const sheetsUrl = document.getElementById('sheets-url').value.trim();
            
            if (!sheetsUrl) {
                showStatus('auto-sheets-status', 'âŒ è«‹è¼¸å…¥Googleè©¦ç®—è¡¨ç¶²å€', 'error');
                return;
            }

            if (!sheetsUrl.includes('docs.google.com/spreadsheets')) {
                showStatus('auto-sheets-status', 'âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„Googleè©¦ç®—è¡¨é€£çµ', 'error');
                return;
            }

            showStatus('auto-sheets-status', 'ğŸ”„ æ­£åœ¨è¼‰å…¥è©¦ç®—è¡¨è³‡æ–™...', 'success');

            try {
                // å¾URLä¸­æå–è©¦ç®—è¡¨ID
                let spreadsheetId = '';
                const urlMatch = sheetsUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (urlMatch) {
                    spreadsheetId = urlMatch[1];
                } else {
                    throw new Error('ç„¡æ³•è§£æè©¦ç®—è¡¨IDï¼Œè«‹ç¢ºèªURLæ ¼å¼æ­£ç¢º');
                }

                // æ§‹å»ºCSVå°å‡ºURL - æ›´ç©©å®šçš„æ–¹å¼
                const csvUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv`;
                
                console.log('æ­£åœ¨å˜—è©¦è¼‰å…¥:', csvUrl);

                // ä½¿ç”¨ä»£ç†æ–¹å¼é¿å…CORSå•é¡Œ
                const proxyUrl = `https://cors-anywhere.herokuapp.com/${csvUrl}`;
                let response;
                
                try {
                    // é¦–å…ˆå˜—è©¦ç›´æ¥è¨ªå•
                    response = await fetch(csvUrl, {
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/csv,text/plain'
                        }
                    });
                } catch (corsError) {
                    console.log('ç›´æ¥è¨ªå•å¤±æ•—ï¼Œå˜—è©¦ä»£ç†æ–¹å¼:', corsError);
                    // å¦‚æœCORSå¤±æ•—ï¼Œé¡¯ç¤ºèªªæ˜
                    throw new Error('ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œç„¡æ³•ç›´æ¥è®€å–Googleè©¦ç®—è¡¨ã€‚è«‹ç¢ºèªï¼š\n1. è©¦ç®—è¡¨å·²è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…ã€å¯æª¢è¦–\n2. æˆ–æ‰‹å‹•è¤‡è£½è²¼ä¸Šè³‡æ–™åˆ°ä¸‹æ–¹');
                }

                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ç„¡æ³•å­˜å–è©¦ç®—è¡¨ï¼Œè«‹ç¢ºèªåˆ†äº«è¨­å®šç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…ã€å¯æª¢è¦–');
                    } else if (response.status === 404) {
                        throw new Error('æ‰¾ä¸åˆ°è©¦ç®—è¡¨ï¼Œè«‹ç¢ºèªç¶²å€æ­£ç¢º');
                    } else {
                        throw new Error(`è¼‰å…¥å¤±æ•— (éŒ¯èª¤ä»£ç¢¼: ${response.status})`);
                    }
                }

                const csvText = await response.text();
                console.log('CSVè³‡æ–™:', csvText.substring(0, 200) + '...');
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('è©¦ç®—è¡¨è³‡æ–™ç‚ºç©ºï¼Œè«‹ç¢ºèªè¡¨æ ¼ä¸­æœ‰è³‡æ–™');
                }

                // æ”¹é€²çš„CSVè§£æ
                const rows = parseCSV(csvText);
                const filteredRows = rows.filter(row => row.some(cell => cell && cell.length > 0));
                
                if (filteredRows.length === 0) {
                    throw new Error('è©¦ç®—è¡¨ä¸­æ²’æœ‰æ‰¾åˆ°ä»»ä½•æœ‰æ•ˆè³‡æ–™');
                }

                const startRow = 1; // å›ºå®šå¾ç¬¬2åˆ—é–‹å§‹ï¼ˆè·³éè¡¨é ­ï¼‰
                const updateMode = document.getElementById('update-mode').value;
                
                // å–å¾—è¡¨é ­å’Œè³‡æ–™è¡Œ
                const headers = filteredRows[0] || [];
                const allDataRows = filteredRows.slice(1); // ç§»é™¤è¡¨é ­è¡Œ
                
                let dataRows;
                if (updateMode === 'latest') {
                    dataRows = allDataRows.slice(-1);
                } else if (updateMode === 'last-5') {
                    dataRows = allDataRows.slice(-5);
                } else if (updateMode === 'last-10') {
                    dataRows = allDataRows.slice(-10);
                } else if (updateMode === 'last-20') {
                    dataRows = allDataRows.slice(-20);
                } else {
                    dataRows = allDataRows; // æ‰€æœ‰è³‡æ–™æ¨¡å¼
                }

                autoQuoteData = {
                    headers: headers,
                    rows: dataRows
                };

                displayDetectedData(autoQuoteData);
                showStatus('auto-sheets-status', `âœ… æˆåŠŸè¼‰å…¥ ${dataRows.length} ç­†è³‡æ–™`, 'success');

            } catch (error) {
                console.error('è¼‰å…¥è©¦ç®—è¡¨å¤±æ•—:', error);
                showStatus('auto-sheets-status', `âŒ ${error.message}`, 'error');
                
                // é¡¯ç¤ºæ‰‹å‹•è¼¸å…¥é¸é …
                showManualDataInput();
            }
        }

        // æ”¹é€²çš„CSVè§£æå‡½æ•¸ - ä¿®å¾©å¤šè¡Œæ¨™é¡Œå•é¡Œ
        function parseCSV(csvText) {
            const rows = [];
            
            console.log('CSVç¸½è¡Œæ•¸:', csvText.split('\n').length);
            console.log('CSVå‰500å­—ç¬¦:', csvText.substring(0, 500));
            
            // æ›´å¼·å¥çš„CSVè§£æ - è™•ç†åµŒå…¥å¼æ›è¡Œç¬¦
            let current = '';
            let inQuotes = false;
            let currentRow = [];
            let i = 0;
            
            while (i < csvText.length) {
                const char = csvText[i];
                
                if (char === '"') {
                    if (inQuotes && i + 1 < csvText.length && csvText[i + 1] === '"') {
                        // è™•ç†é›™å¼•è™Ÿè½‰ç¾©
                        current += '"';
                        i += 2;
                        continue;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    // åªæœ‰åœ¨ä¸åœ¨å¼•è™Ÿå…§æ™‚æ‰è¦–ç‚ºè¡ŒçµæŸ
                    if (current.trim() || currentRow.length > 0) {
                        currentRow.push(current.trim().replace(/^"|"$/g, ''));
                        if (currentRow.some(cell => cell.length > 0)) {
                            rows.push(currentRow);
                        }
                        currentRow = [];
                        current = '';
                    }
                } else if (char !== '\r') {
                    // åœ¨å¼•è™Ÿå…§æ™‚ï¼Œä¿ç•™æ›è¡Œç¬¦
                    current += char;
                }
                
                i++;
            }
            
            // è™•ç†æœ€å¾Œä¸€è¡Œ
            if (current.trim() || currentRow.length > 0) {
                currentRow.push(current.trim().replace(/^"|"$/g, ''));
                if (currentRow.some(cell => cell.length > 0)) {
                    rows.push(currentRow);
                }
            }
            
            // åµéŒ¯ç¬¬ä¸€è¡Œçš„è§£æçµæœ
            if (rows.length > 0) {
                console.log('æ¨™é¡Œè¡Œè§£æçµæœ:', rows[0]);
                console.log('æ¨™é¡Œè¡Œæ¬„ä½æ•¸é‡:', rows[0].length);
                console.log('å‰5å€‹æ¨™é¡Œ:', rows[0].slice(0, 5));
            }
            
            return rows;
        }

        // é¡¯ç¤ºæ‰‹å‹•è³‡æ–™è¼¸å…¥é¸é …
        function showManualDataInput() {
            const detectedDataDiv = document.getElementById('auto-detected-data');
            detectedDataDiv.style.display = 'block';
            
            const preview = document.getElementById('detected-data-preview');
            preview.innerHTML = `
                <div style="text-align: center; padding: 20px; background: #333; border-radius: 8px;">
                    <h4 style="color: #ffd700; margin-bottom: 15px;">ğŸ“‹ æ‰‹å‹•è³‡æ–™è¼¸å…¥</h4>
                    <p style="color: #e0e0e0; margin-bottom: 15px;">ç”±æ–¼è‡ªå‹•è®€å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥å®¢æˆ¶è³‡æ–™ï¼š</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="manual-name" placeholder="å®¢æˆ¶å§“å" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-address" placeholder="æœå‹™åœ°å€" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-phone" placeholder="è¯çµ¡é›»è©±" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-fee" placeholder="æœˆè²»" value="1200" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-days" placeholder="æœå‹™æ˜ŸæœŸ" value="é€±äºŒã€é€±äº”" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-time" placeholder="æœå‹™æ™‚é–“" value="0800" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-floor" placeholder="æ¨“å±¤" value="1" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-trash" placeholder="åƒåœ¾è¢‹æ•¸" value="6" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-recycle" placeholder="è³‡æºè¢‹æ•¸" value="3" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                    </div>
                    <button onclick="useManualData()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold;">
                        âœ… ä½¿ç”¨æ‰‹å‹•è³‡æ–™ç”Ÿæˆå ±åƒ¹å–®
                    </button>
                </div>
            `;
            
            document.getElementById('auto-quote-controls').style.display = 'none';
        }

        // ä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„è³‡æ–™
        function useManualData() {
            showStatus('auto-sheets-status', 'ğŸ”„ æ­£åœ¨ä½¿ç”¨æ‰‹å‹•è³‡æ–™ç”Ÿæˆå ±åƒ¹å–®...', 'success');
            
            const selectedDays = Array.from(document.querySelectorAll('input[name="manual-days"]:checked')).map(cb => cb.value);
            const manualData = {
                lineName: '',
                address: '',
                housingType: '',
                monthlyFee: document.getElementById('manual-fee').value || '',
                serviceDays: selectedDays.join('ã€') || '',
                serviceTime: document.getElementById('manual-time').value || '',
                floor: document.getElementById('manual-floor').value || '',
                trashBags: document.getElementById('manual-trash').value || '',
                recycleBags: document.getElementById('manual-recycle').value || '',
                trashVolume: document.getElementById('manual-trash-volume').value || '',
                recycleVolume: document.getElementById('manual-recycle-volume').value || '',
                trashMax: document.getElementById('manual-trash-max').value || '',
                recycleMax: document.getElementById('manual-recycle-max').value || '',
                specialNotes: document.getElementById('manual-special-notes').value || ''
            };

            try {
                const quote = generateQuoteFromData(manualData);
                document.getElementById('auto-quote-result-display').textContent = quote;
                document.getElementById('auto-quote-output').style.display = 'block';
                
                // é¡¯ç¤ºä½¿ç”¨çš„è³‡æ–™é è¦½
                const preview = document.getElementById('detected-data-preview');
                preview.innerHTML = `
                    <div style="background: #2a2a2a; padding: 15px; border-radius: 8px; color: #e0e0e0;">
                        <h4 style="color: #28a745; margin-bottom: 10px;">âœ… ä½¿ç”¨çš„æ‰‹å‹•è³‡æ–™ï¼š</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div><strong>æœˆè²»ï¼š</strong> ${manualData.monthlyFee}å…ƒ</div>
                            <div><strong>æ”¶å–æ˜ŸæœŸï¼š</strong> ${manualData.serviceDays}</div>
                            <div><strong>æœå‹™æ™‚é–“ï¼š</strong> ${manualData.serviceTime}</div>
                            <div><strong>æ¨“å±¤ï¼š</strong> ${manualData.floor}æ¨“</div>
                            <div><strong>åƒåœ¾è¢‹æ•¸ï¼š</strong> ${manualData.trashBags}åŒ…</div>
                            <div><strong>è³‡æºè¢‹æ•¸ï¼š</strong> ${manualData.recycleBags}åŒ…</div>
                            <div><strong>åƒåœ¾è¢‹å®¹é‡ï¼š</strong> ${manualData.trashVolume}</div>
                            <div><strong>è³‡æºè¢‹å®¹é‡ï¼š</strong> ${manualData.recycleVolume}</div>
                            <div><strong>æœ€å¤šåƒåœ¾è¢‹æ•¸ï¼š</strong> ${manualData.trashMax}è¢‹</div>
                            <div><strong>æœ€å¤šè³‡æºè¢‹æ•¸ï¼š</strong> ${manualData.recycleMax}è¢‹</div>
                            ${manualData.specialNotes ? `<div><strong>ç‰¹æ®Šéœ€æ±‚ï¼š</strong> ${manualData.specialNotes}</div>` : ''}
                        </div>
                    </div>
                `;
                
                document.getElementById('auto-detected-data').style.display = 'block';
                showStatus('auto-quote-final-status', 'âœ… æ‰‹å‹•è³‡æ–™å ±åƒ¹å–®ç”Ÿæˆå®Œæˆï¼', 'success');
                
            } catch (error) {
                showStatus('auto-quote-final-status', `âŒ ç”Ÿæˆå¤±æ•—: ${error.message}`, 'error');
            }
        }

        function displayDetectedData(data) {
            const preview = document.getElementById('detected-data-preview');
            let html = '<table style="width: 100%; border-collapse: collapse; color: #e0e0e0;">';
            
            if (data.headers.length > 0) {
                html += '<tr style="background: #404040;">';
                data.headers.forEach(header => {
                    // ç°¡åŒ–è¡¨é ­é¡¯ç¤ºï¼šç§»é™¤è¡¨æƒ…ç¬¦è™Ÿï¼Œæå–é—œéµå­—
                    let simplifiedHeader = header;
                    
                    // ç§»é™¤æ‰€æœ‰è¡¨æƒ…ç¬¦è™Ÿ
                    simplifiedHeader = simplifiedHeader.replace(/[\u{1F000}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
                    
                    // åˆ¤æ–·æ¬„ä½é¡å‹
                    const isResourceField = header.toLowerCase().includes('è³‡æº');
                    const isTrashField = header.toLowerCase().includes('åƒåœ¾');
                    
                    // æå–é—œéµå­—ï¼ˆæ–¹æ‹¬è™Ÿå…§çš„å…§å®¹æˆ–æœ€å¾Œçš„é‡è¦è©å½™ï¼‰
                    const bracketMatch = simplifiedHeader.match(/\[([^\]]+)\]/);
                    if (bracketMatch) {
                        simplifiedHeader = bracketMatch[1];
                    } else {
                        // å¦‚æœæ²’æœ‰æ–¹æ‹¬è™Ÿï¼Œæå–æœ€å¾Œçš„é—œéµè©
                        if (simplifiedHeader.includes('åœ°å€')) {
                            simplifiedHeader = 'åœ°å€';
                        } else {
                            simplifiedHeader = simplifiedHeader.trim()
                                .replace(/.*åƒåœ¾.*/, 'åƒåœ¾é‡')
                                .replace(/.*è³‡æº.*/, 'è³‡æºé‡')
                                .replace(/.*æœˆè²».*|.*è²»ç”¨.*/, 'æœˆè²»')
                                .replace(/.*æ˜ŸæœŸ.*|.*æ”¶å–.*/, 'æ¬¡æ•¸')
                                .replace(/.*æ™‚é–“.*/, 'æ™‚é–“')
                                .replace(/.*æ¨“å±¤.*/, 'æ¨“å±¤')
                                .replace(/.*line.*|.*æš±ç¨±.*/, 'LINEæš±ç¨±')
                                .replace(/.*ä½å®….*|.*æ€§è³ª.*/, 'ä½å®…æ€§è³ª');
                        }
                    }
                    
                    // æ¸…ç†å¤šé¤˜çš„ç©ºæ ¼å’Œç¬¦è™Ÿ
                    simplifiedHeader = simplifiedHeader.replace(/["""'']/g, '').trim();
                    
                    // è¨­å®šæ¨£å¼ï¼šåƒåœ¾æ¬„ä½ç”¨ç´…è‰²ï¼Œè³‡æºæ¬„ä½ç”¨ç¶ è‰²
                    let backgroundColor = '#404040';
                    let textColor = '#e0e0e0';
                    
                    if (isTrashField) {
                        backgroundColor = '#dc3545'; // ç´…è‰²
                        textColor = '#ffffff';
                    } else if (isResourceField) {
                        backgroundColor = '#28a745'; // ç¶ è‰²
                        textColor = '#ffffff';
                    }
                    
                    html += `<th style="border: 1px solid #666; padding: 8px; text-align: left; background-color: ${backgroundColor}; color: ${textColor};">${simplifiedHeader}</th>`;
                });
                html += '</tr>';
            }

            data.rows.forEach((row, index) => {
                html += `<tr onclick="selectAutoQuoteRowForQuote(${index})" style="cursor: pointer; background: ${index % 2 === 0 ? '#2a2a2a' : '#333333'};" class="auto-data-row" title="é»æ“Šé¸æ“‡æ­¤è³‡æ–™ä½œç‚ºå ±åƒ¹å–®ä¾†æº" onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='${index % 2 === 0 ? '#2a2a2a' : '#333333'}'">`;
                row.forEach(cell => {
                    html += `<td style="border: 1px solid #666; padding: 8px;">${cell}</td>`;
                });
                html += '</tr>';
            });

            html += '</table>';
            preview.innerHTML = html;
            
            document.getElementById('auto-detected-data').style.display = 'block';
            document.getElementById('auto-quote-controls').style.display = 'none'; // å…ˆéš±è—ç”ŸæˆæŒ‰éˆ•ï¼Œéœ€è¦é¸æ“‡è³‡æ–™å¾Œæ‰é¡¯ç¤º
        }
        
        // é¸æ“‡åŒ…æœˆè‡ªå‹•å ±åƒ¹è³‡æ–™è¡Œ
        function selectAutoQuoteRowForQuote(rowIndex) {
            console.log('selectAutoQuoteRowForQuote called with index:', rowIndex);
            
            if (!autoQuoteData || !autoQuoteData.rows || rowIndex >= autoQuoteData.rows.length) {
                console.error('Invalid row index or data not available');
                return;
            }
            
            const headers = autoQuoteData.headers;
            const selectedRowData = autoQuoteData.rows[rowIndex];
            
            console.log('Available headers:', headers);
            console.log('Selected row data:', selectedRowData);
            
            // æ›´æ–°é¸ä¸­è¡Œçš„è¦–è¦ºæ•ˆæœ
            const allRows = document.querySelectorAll('.auto-data-row');
            allRows.forEach((row, index) => {
                if (index === rowIndex) {
                    row.style.border = '3px solid #FFD700';
                    row.style.background = '#4a4a00';
                } else {
                    row.style.border = '';
                    row.style.background = index % 2 === 0 ? '#2a2a2a' : '#333333';
                }
            });
            
            // å„²å­˜é¸ä¸­çš„è³‡æ–™
            selectedAutoQuoteData = selectedRowData;
            selectedAutoQuoteRowIndex = rowIndex;
            
            // é¡¯ç¤ºç”ŸæˆæŒ‰éˆ•
            document.getElementById('auto-quote-controls').style.display = 'block';
            
            // åµæ¸¬ä¸¦é è¦½é¸ä¸­è³‡æ–™çš„é—œéµè³‡è¨Š
            const previewData = {};
            headers.forEach((header, index) => {
                const cellValue = selectedRowData[index];
                const lowerHeader = header.toLowerCase();
                
                if (lowerHeader.includes('line') || lowerHeader.includes('æš±ç¨±')) {
                    previewData.lineName = cellValue;
                } else if (header.includes('åœ°å€') || header.includes('å€åŸŸ')) {
                    previewData.address = cellValue;
                } else if (lowerHeader.includes('æœˆè²»') || lowerHeader.includes('è²»ç”¨')) {
                    previewData.monthlyFee = cellValue;
                } else if (header.includes('ä½å®…') || header.includes('æ€§è³ª')) {
                    previewData.housingType = cellValue;
                }
            });
            
            // é¡¯ç¤ºé¸æ“‡ç‹€æ…‹
            let statusMsg = `âœ… å·²é¸æ“‡ç¬¬ ${rowIndex + 1} è¡Œè³‡æ–™`;
            if (previewData.lineName) {
                statusMsg += ` | å®¢æˆ¶: ${previewData.lineName}`;
            }
            if (previewData.address) {
                statusMsg += ` | åœ°å€: ${previewData.address.substring(0, 15)}...`;
            }
            if (previewData.monthlyFee) {
                statusMsg += ` | æœˆè²»: ${previewData.monthlyFee}å…ƒ`;
            }
            
            showStatus('auto-sheets-status', statusMsg, 'success');
        }

        function generateAutoQuote() {
            if (!autoQuoteData || !autoQuoteData.rows || autoQuoteData.rows.length === 0) {
                showStatus('auto-quote-final-status', 'âŒ è«‹å…ˆè¼‰å…¥è©¦ç®—è¡¨è³‡æ–™', 'error');
                return;
            }
            
            if (selectedAutoQuoteData === null || selectedAutoQuoteRowIndex === -1) {
                showStatus('auto-quote-final-status', 'âŒ è«‹å…ˆé»æ“Šé¸æ“‡è¦ç”¨æ–¼ç”Ÿæˆå ±åƒ¹å–®çš„è³‡æ–™è¡Œ', 'error');
                return;
            }

            showStatus('auto-quote-final-status', 'ğŸ”„ æ­£åœ¨ç”Ÿæˆè‡ªå‹•å ±åƒ¹å–®...', 'success');

            try {
                const selectedRow = selectedAutoQuoteData;
                const headers = autoQuoteData.headers;
                
                // å…ˆç²å–æ‰‹å‹•è¼¸å…¥çš„è³‡æ–™
                const selectedDays = Array.from(document.querySelectorAll('input[name="manual-days"]:checked')).map(cb => cb.value);
                const manualData = {
                    lineName: '',
                    address: '',
                    housingType: '',
                    monthlyFee: document.getElementById('manual-fee').value || '',
                    serviceDays: selectedDays.join('ã€') || '',
                    serviceTime: document.getElementById('manual-time').value || '',
                    floor: document.getElementById('manual-floor').value || '',
                    frequency: document.getElementById('manual-frequency').value || '',
                    trashBags: document.getElementById('manual-trash').value || '',
                    recycleBags: document.getElementById('manual-recycle').value || '',
                    trashVolume: document.getElementById('manual-trash-volume').value || '',
                    recycleVolume: document.getElementById('manual-recycle-volume').value || '',
                    trashMax: document.getElementById('manual-trash-max').value || '',
                    recycleMax: document.getElementById('manual-recycle-max').value || '',
                    specialNotes: document.getElementById('manual-special-notes').value || ''
                };
                
                console.log('Manual data collected:', manualData);

                const fieldMapping = {};
                console.log('Headers:', headers);
                console.log('Headers length:', headers.length);
                console.log('Selected row:', selectedRow);
                console.log('Selected row length:', selectedRow.length);
                
                // æ”¶é›†åƒåœ¾å’Œè³‡æºçš„åŒ…æ•¸èˆ‡å®¹é‡æ•¸æ“š
                let trashData = { bags: '', volume: '' };
                let recycleData = { bags: '', volume: '' };
                
                headers.forEach((header, index) => {
                    const lowerHeader = header.toLowerCase();
                    const cellValue = selectedRow[index];
                    console.log(`Processing header: "${header}" (${lowerHeader}) with value: "${cellValue}"`);
                    
                    // æ›´ç²¾ç¢ºçš„æ¬„ä½åµæ¸¬é‚è¼¯
                    if (lowerHeader.includes('line') || lowerHeader.includes('æš±ç¨±')) {
                        fieldMapping.lineName = cellValue;
                        console.log(`Detected LINE name: ${cellValue}`);
                    } else if (header.includes('åœ°å€') || header.includes('å€åŸŸ') || (header.includes('æ”¶å–') && (header.includes('åœ°å€') || header.includes('å€åŸŸ')))) {
                        fieldMapping.address = cellValue;
                        console.log(`Detected address from header "${header}": ${cellValue}`);
                        
                        // è‡ªå‹•åµæ¸¬åœ°å€ä¸­çš„æ¨“å±¤æ•¸å­—ä¸¦å¡«å…¥æ¨“å±¤æ¬„ä½ï¼ˆåªåœ¨æ‰‹å‹•æ¬„ä½ç‚ºç©ºæ™‚ï¼‰
                        if (cellValue && (!manualData.floor || manualData.floor.trim() === '')) {
                            const floorMatch = cellValue.match(/(\d+)[æ¨“F]/);
                            if (floorMatch) {
                                fieldMapping.floor = floorMatch[1];
                                // åªåœ¨æ‰‹å‹•æ¬„ä½ç‚ºç©ºæ™‚è‡ªå‹•å¡«å…¥
                                document.getElementById('manual-floor').value = floorMatch[1];
                                console.log(`Auto-detected floor: ${floorMatch[1]} from address: ${cellValue}`);
                            } else {
                                console.log(`No floor detected in address: ${cellValue}, keeping manual input`);
                            }
                        }
                    } else if (header.includes('ä½å®…') || header.includes('æ€§è³ª')) {
                        fieldMapping.housingType = cellValue;
                        console.log(`Detected housing type from header "${header}": ${cellValue}`);
                    } else if (lowerHeader.includes('æœˆè²»') || lowerHeader.includes('è²»ç”¨')) {
                        // å„ªå…ˆä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„æœˆè²»ï¼Œå…¶æ¬¡æ˜¯è©¦ç®—è¡¨æ•¸æ“š
                        fieldMapping.monthlyFee = (manualData.monthlyFee && manualData.monthlyFee.trim() !== '') ? manualData.monthlyFee : cellValue;
                    } else if (lowerHeader.includes('æ˜ŸæœŸ') || lowerHeader.includes('æ”¶å–')) {
                        // è™•ç†æ¬¡æ•¸æ¬„ä½ï¼Œç”Ÿæˆã€Œä¸€é€±è¶Ÿæ•¸ï¼šXè¶Ÿã€æ ¼å¼
                        if (cellValue && cellValue.trim() !== '') {
                            const frequencyMatch = cellValue.match(/(\d+)/);
                            if (frequencyMatch) {
                                fieldMapping.weeklyFrequency = `ä¸€é€±è¶Ÿæ•¸ï¼š${frequencyMatch[1]}è¶Ÿ`;
                            } else {
                                fieldMapping.weeklyFrequency = `ä¸€é€±è¶Ÿæ•¸ï¼š${cellValue}è¶Ÿ`;
                            }
                        }
                        // ä¿æŒåŸæœ‰çš„æœå‹™æ—¥é‚è¼¯ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹å‹•é¸æ“‡çš„æ˜ŸæœŸ
                        fieldMapping.serviceDays = manualData.serviceDays;
                    } else if (lowerHeader.includes('æ™‚é–“')) {
                        // å„ªå…ˆä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„æ™‚é–“ï¼Œå…¶æ¬¡æ˜¯è©¦ç®—è¡¨æ•¸æ“š
                        fieldMapping.serviceTime = (manualData.serviceTime && manualData.serviceTime.trim() !== '') ? manualData.serviceTime : cellValue;
                    } else if (lowerHeader.includes('æ¨“å±¤')) {
                        // å„ªå…ˆä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„æ¨“å±¤è³‡æ–™ï¼Œå…¶æ¬¡æ˜¯è©¦ç®—è¡¨ä¸­çš„æ¨“å±¤è³‡æ–™ï¼Œæœ€å¾Œé è¨­ç‚º0
                        fieldMapping.floor = (manualData.floor && manualData.floor.trim() !== '') ? manualData.floor : ((cellValue && cellValue.trim() !== '') ? cellValue : '0');
                    } else if (lowerHeader.includes('åƒåœ¾')) {
                        console.log(`Found trash header: "${header}" with value: "${cellValue}"`);
                        // å¦‚æœè©²æ¬„ä½æœ‰æ•¸æ“šï¼ŒåŒæ™‚è¨˜éŒ„åŒ…æ•¸å’Œå®¹é‡
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)åŒ…/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?å…¬å‡)/);
                            
                            if (bagMatch) {
                                trashData.bags = bagMatch[1];
                                // åŒæ™‚è¨˜éŒ„è©²æ¬„ä½å°æ‡‰çš„å®¹é‡
                                if (headerVolumeMatch) {
                                    trashData.volume = headerVolumeMatch[1];
                                }
                                console.log(`Trash data found: ${trashData.bags}åŒ… in ${header} (volume: ${trashData.volume})`);
                            }
                        }
                    } else if (lowerHeader.includes('è³‡æº')) {
                        console.log(`Found recycle header: "${header}" with value: "${cellValue}"`);
                        // å¦‚æœè©²æ¬„ä½æœ‰æ•¸æ“šï¼ŒåŒæ™‚è¨˜éŒ„åŒ…æ•¸å’Œå®¹é‡
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)åŒ…/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?å…¬å‡)/);
                            
                            if (bagMatch) {
                                recycleData.bags = bagMatch[1];
                                // åŒæ™‚è¨˜éŒ„è©²æ¬„ä½å°æ‡‰çš„å®¹é‡
                                if (headerVolumeMatch) {
                                    recycleData.volume = headerVolumeMatch[1];
                                }
                                console.log(`Recycle data found: ${recycleData.bags}åŒ… in ${header} (volume: ${recycleData.volume})`);
                            }
                        }
                    }
                });
                
                // çµ„åˆåƒåœ¾è¢‹æ•¸æ“š
                if (manualData.trashBags || manualData.trashVolume) {
                    if (manualData.trashBags && manualData.trashVolume) {
                        fieldMapping.trashBags = `${manualData.trashBags}åŒ…æ•¸ï¼ˆ${manualData.trashVolume}ï¼‰`;
                    } else if (manualData.trashBags) {
                        fieldMapping.trashBags = `${manualData.trashBags}åŒ…æ•¸ï¼ˆ14å…¬å‡ï¼‰`;
                    } else {
                        fieldMapping.trashBags = `6åŒ…æ•¸ï¼ˆ${manualData.trashVolume}ï¼‰`;
                    }
                } else if (trashData.bags && trashData.volume) {
                    fieldMapping.trashBags = `${trashData.bags}åŒ…ï¼ˆ${trashData.volume}ï¼‰`;
                } else if (trashData.bags) {
                    fieldMapping.trashBags = `${trashData.bags}åŒ…ï¼ˆ14å…¬å‡ï¼‰`;
                } else {
                    fieldMapping.trashBags = '6åŒ…ï¼ˆ14å…¬å‡ï¼‰';
                }
                
                // çµ„åˆè³‡æºè¢‹æ•¸æ“š
                if (manualData.recycleBags || manualData.recycleVolume) {
                    if (manualData.recycleBags && manualData.recycleVolume) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}åŒ…æ•¸ï¼ˆ${manualData.recycleVolume}ï¼‰`;
                    } else if (manualData.recycleBags) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}åŒ…æ•¸ï¼ˆ14å…¬å‡ï¼‰`;
                    } else {
                        fieldMapping.recycleBags = `3åŒ…æ•¸ï¼ˆ${manualData.recycleVolume}ï¼‰`;
                    }
                } else if (recycleData.bags && recycleData.volume) {
                    fieldMapping.recycleBags = `${recycleData.bags}åŒ…ï¼ˆ${recycleData.volume}ï¼‰`;
                } else if (recycleData.bags) {
                    fieldMapping.recycleBags = `${recycleData.bags}åŒ…ï¼ˆ14å…¬å‡ï¼‰`;
                } else {
                    fieldMapping.recycleBags = '3åŒ…ï¼ˆ14å…¬å‡ï¼‰';
                }
                
                console.log(`Final trash data: bags="${trashData.bags}", volume="${trashData.volume}", result="${fieldMapping.trashBags}"`);
                console.log(`Final recycle data: bags="${recycleData.bags}", volume="${recycleData.volume}", result="${fieldMapping.recycleBags}"`);
                
                console.log('Final field mapping:', fieldMapping);
                
                // åŠ å…¥æ‰‹å‹•è¼¸å…¥çš„å…¶ä»–æ•¸æ“š
                if (manualData.trashMax) {
                    fieldMapping.trashMax = manualData.trashMax;
                }
                if (manualData.recycleMax) {
                    fieldMapping.recycleMax = manualData.recycleMax;
                }
                if (manualData.specialNotes) {
                    fieldMapping.specialNotes = manualData.specialNotes;
                }
                // ç¢ºä¿æ‰‹å‹•è¼¸å…¥çš„é‡è¦æ¬„ä½æ­£ç¢ºå‚³éï¼ˆè¦†è“‹ä¹‹å‰çš„è¨­å®šï¼‰
                if (manualData.frequency) {
                    fieldMapping.frequency = manualData.frequency;
                }
                // ç¢ºä¿æ‰‹å‹•è¼¸å…¥çš„æ”¶å–æ˜ŸæœŸä¸€å®šå„ªå…ˆä½¿ç”¨
                if (manualData.serviceDays && manualData.serviceDays.trim() !== '') {
                    fieldMapping.serviceDays = manualData.serviceDays;
                }
                // ç¢ºä¿æ‰‹å‹•è¼¸å…¥çš„æ¨“å±¤ä¸€å®šå„ªå…ˆä½¿ç”¨
                if (manualData.floor && manualData.floor.trim() !== '') {
                    fieldMapping.floor = manualData.floor;
                }
                // ç¢ºä¿æ‰‹å‹•è¼¸å…¥çš„æœˆè²»ä¸€å®šå„ªå…ˆä½¿ç”¨
                if (manualData.monthlyFee && manualData.monthlyFee.trim() !== '') {
                    fieldMapping.monthlyFee = manualData.monthlyFee;
                }
                // ç¢ºä¿æ‰‹å‹•è¼¸å…¥çš„æ™‚é–“ä¸€å®šå„ªå…ˆä½¿ç”¨
                if (manualData.serviceTime && manualData.serviceTime.trim() !== '') {
                    fieldMapping.serviceTime = manualData.serviceTime;
                }
                
                console.log('Final fieldMapping with manual overrides:', fieldMapping);

                // ç”Ÿæˆç«¶çˆ­å» å•†æ¯”è¼ƒ
                generateVendorComparison(fieldMapping);

                const quote = generateQuoteFromData(fieldMapping);
                
                document.getElementById('auto-quote-result-display').textContent = quote;
                document.getElementById('auto-quote-output').style.display = 'block';
                showStatus('auto-quote-final-status', 'âœ… è‡ªå‹•å ±åƒ¹å–®ç”Ÿæˆå®Œæˆï¼', 'success');

            } catch (error) {
                console.error('ç”Ÿæˆå ±åƒ¹å–®å¤±æ•—:', error);
                showStatus('auto-quote-final-status', `âŒ ç”Ÿæˆå¤±æ•—: ${error.message}`, 'error');
            }
        }

        function generateQuoteFromData(data) {
            const lineName = data.lineName || '';
            const address = data.address || '';
            const housingType = data.housingType || '';
            const monthlyFee = (data.monthlyFee && data.monthlyFee.trim() !== '') ? data.monthlyFee : '0';
            const serviceDays = data.serviceDays || 'é€±äºŒã€é€±äº”';
            const serviceTime = (data.serviceTime && data.serviceTime.trim() !== '') ? data.serviceTime : '0';
            const floor = (data.floor && data.floor.trim() !== '') ? data.floor : '0';
            const trashBags = data.trashBags || '6';
            const recycleBags = data.recycleBags || '3';

            // æ¨“å±¤é¡¯ç¤º
            let floorDisplay;
            const floorNum = parseInt(floor);
            if (floorNum < 0) {
                floorDisplay = `åœ°ä¸‹${Math.abs(floorNum)}æ¨“`;
            } else {
                floorDisplay = `${floorNum}F`;
            }

            // æ™‚é–“æ ¼å¼åŒ– - æ ¹æ“šæ™‚é–“è‡ªå‹•åˆ¤æ–·ä¸Šåˆ/ä¸‹åˆ/æ™šä¸Š
            let timeDisplay = serviceTime;
            if (serviceTime && serviceTime.length === 4 && /^\d{4}$/.test(serviceTime)) {
                const hour = parseInt(serviceTime.substring(0, 2));
                const minute = serviceTime.substring(2);
                
                let period;
                if (hour >= 6 && hour < 12) {
                    period = 'ä¸Šåˆ';
                } else if (hour >= 12 && hour < 18) {
                    period = 'ä¸‹åˆ';
                } else {
                    period = 'æ™šé–“';
                }
                
                timeDisplay = `${period} ${hour.toString().padStart(2, '0')}ï¼š${minute}`;
            } else if (serviceTime && serviceTime.includes(':')) {
                // å¦‚æœå·²ç¶“æ˜¯æ™‚é–“æ ¼å¼ï¼Œæª¢æŸ¥æ˜¯å¦éœ€è¦åŠ ä¸Šæ™‚æ®µ
                const timeMatch = serviceTime.match(/(\d{1,2}):(\d{2})/);
                if (timeMatch) {
                    const hour = parseInt(timeMatch[1]);
                    const minute = timeMatch[2];
                    
                    let period;
                    if (hour >= 6 && hour < 12) {
                        period = 'ä¸Šåˆ';
                    } else if (hour >= 12 && hour < 18) {
                        period = 'ä¸‹åˆ';
                    } else {
                        period = 'æ™šé–“';
                    }
                    
                    timeDisplay = `${period} ${hour.toString().padStart(2, '0')}ï¼š${minute}`;
                } else {
                    timeDisplay = serviceTime;
                }
            } else if (!serviceTime || serviceTime.trim() === '' || serviceTime === '0') {
                // å¦‚æœæ²’æœ‰è¼¸å…¥æ™‚é–“æˆ–æ™‚é–“ç‚º0ï¼Œé¡¯ç¤º0
                timeDisplay = '0';
            }

            // æ”¶å–æ™‚é–“æè¿° - æ ¹æ“šæ™‚é–“æ®µå‹•æ…‹ç”Ÿæˆ
            let collectionTimeDesc = '';
            if (timeDisplay.includes('ä¸Šåˆ')) {
                collectionTimeDesc = 'ä¸­åˆå‰';
            } else if (timeDisplay.includes('ä¸‹åˆ')) {
                collectionTimeDesc = 'ä¸‹åˆå‰';
            } else if (timeDisplay.includes('æ™šé–“')) {
                collectionTimeDesc = 'åŠå¤œå‰';
            } else {
                collectionTimeDesc = 'ä¸­åˆå‰';
            }

            // æœå‹™æ˜ŸæœŸæ ¼å¼åŒ–
            let daysDisplay = serviceDays;
            if (serviceDays.includes('é€±')) {
                daysDisplay = serviceDays.replace(/é€±/g, 'é€±').replace(/ã€/g, '+');
            }

            // è™•ç†åƒåœ¾è¢‹é¡¯ç¤ºæ ¼å¼
            let trashDisplay;
            if (typeof trashBags === 'string' && (trashBags.includes('å…¬å‡') || trashBags.includes('åŒ…'))) {
                // å¦‚æœå·²ç¶“åŒ…å«å®Œæ•´æ ¼å¼ï¼ˆå¦‚ï¼š3åŒ… 75/76å…¬å‡ï¼‰ï¼Œéœ€è¦è½‰æ›ç‚ºæ¨™æº–æ ¼å¼
                if (trashBags.includes('åŒ…') && trashBags.includes('å…¬å‡')) {
                    // æå–åŒ…æ•¸å’Œå®¹é‡
                    const bagMatch = trashBags.match(/(\d+)åŒ…/);
                    const volumeMatch = trashBags.match(/(\d+(?:\/\d+)?å…¬å‡)/);
                    if (bagMatch && volumeMatch) {
                        trashDisplay = `${bagMatch[1]}åŒ…æ•¸ï¼ˆ${volumeMatch[1]}ï¼‰`;
                    } else {
                        trashDisplay = trashBags;
                    }
                } else {
                    trashDisplay = trashBags;
                }
            } else {
                // å¦å‰‡å¾æ•¸å­—å»ºç«‹æ ¼å¼
                const trashNum = parseInt(trashBags) || 6;
                trashDisplay = `${trashNum}åŒ…æ•¸ï¼ˆ14å…¬å‡ï¼‰`;
            }

            // è™•ç†è³‡æºè¢‹é¡¯ç¤ºæ ¼å¼
            let recycleDisplay;
            if (typeof recycleBags === 'string' && (recycleBags.includes('å…¬å‡') || recycleBags.includes('åŒ…'))) {
                // å¦‚æœå·²ç¶“åŒ…å«å®Œæ•´æ ¼å¼ï¼ˆå¦‚ï¼š3åŒ… 14å…¬å‡ï¼‰ï¼Œéœ€è¦è½‰æ›ç‚ºæ¨™æº–æ ¼å¼
                if (recycleBags.includes('åŒ…') && recycleBags.includes('å…¬å‡')) {
                    // æå–åŒ…æ•¸å’Œå®¹é‡
                    const bagMatch = recycleBags.match(/(\d+)åŒ…/);
                    const volumeMatch = recycleBags.match(/(\d+(?:\/\d+)?å…¬å‡)/);
                    if (bagMatch && volumeMatch) {
                        recycleDisplay = `${bagMatch[1]}åŒ…æ•¸ï¼ˆ${volumeMatch[1]}ï¼‰`;
                    } else {
                        recycleDisplay = recycleBags;
                    }
                } else {
                    recycleDisplay = recycleBags;
                }
            } else {
                // å¦å‰‡å¾æ•¸å­—å»ºç«‹æ ¼å¼
                const recycleNum = parseInt(recycleBags) || 3;
                recycleDisplay = `${recycleNum}åŒ…æ•¸ï¼ˆ14å…¬å‡ï¼‰`;
            }

            // è¨ˆç®—æ¯æ¬¡æœ€å¤šæ”¶å–è¢‹æ•¸ï¼ˆå¾é¡¯ç¤ºæ–‡å­—ä¸­æå–æ•¸å­—ï¼‰
            const trashNum = parseInt(trashDisplay.match(/(\d+)åŒ…/)?.[1]) || 6;
            const recycleNum = parseInt(recycleDisplay.match(/(\d+)åŒ…/)?.[1]) || 3;
            
            // å¦‚æœæ‰‹å‹•è¼¸å…¥äº†æœ€å¤§è¢‹æ•¸ï¼Œä½¿ç”¨æ‰‹å‹•æ•¸æ“šï¼Œå¦å‰‡è¨ˆç®—
            let trashMax, recycleMax;
            if (data.trashMax) {
                trashMax = parseInt(data.trashMax);
            } else {
                trashMax = Math.floor(trashNum / 2) || 3;
            }
            
            if (data.recycleMax) {
                recycleMax = parseInt(data.recycleMax);
            } else {
                recycleMax = Math.floor(recycleNum / 2) || 3;
            }

            // é¡¯ç¤ºå®¢æˆ¶è³‡è¨Šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            let customerInfo = '';
            if (lineName) customerInfo += `LINEæš±ç¨±ï¼š${lineName}\n`;
            if (address) customerInfo += `åœ°å€ï¼š${address}\n`;
            if (housingType) customerInfo += `ä½å®…æ€§è³ªï¼š${housingType}\n`;
            if (customerInfo) customerInfo += '\n------------------------------------\n\n';

            // å„ªå…ˆä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„è¶Ÿæ•¸ï¼Œå…¶æ¬¡æ˜¯è‡ªå‹•åµæ¸¬ï¼Œæœ€å¾Œæ˜¯é è¨­å€¼
            let weeklyFrequency;
            if (data.frequency) {
                weeklyFrequency = `ä¸€é€±è¶Ÿæ•¸ï¼š${data.frequency}è¶Ÿ`;
            } else if (data.weeklyFrequency) {
                weeklyFrequency = data.weeklyFrequency;
            } else {
                weeklyFrequency = 'ä¸€é€±è¶Ÿæ•¸ï¼š2è¶Ÿ';
            }
            
            // å¦‚æœæ²’æœ‰é¸æ“‡æœå‹™æ˜ŸæœŸï¼Œä½¿ç”¨é è¨­å€¼
            let finalDaysDisplay = daysDisplay;
            if (!serviceDays || serviceDays.trim() === '') {
                finalDaysDisplay = 'é€±äºŒã€é€±äº”';
            }
            
            // æœ€çµ‚æ ¼å¼ï¼šè¶Ÿæ•¸-æ˜ŸæœŸ
            const serviceSchedule = `${weeklyFrequency}-${finalDaysDisplay}`;
            
            const quote = `${customerInfo}â›”å ±åƒ¹è³‡æ–™â›”

${serviceSchedule}
   ç½®æ”¾æ™‚é–“ï¼š${timeDisplay}
   ç½®æ”¾æ¨“å±¤ï¼š${floorDisplay}

ï¼ˆâš ï¸åƒåœ¾ç•¶æ—¥:${collectionTimeDesc} ä»£æ”¶å®Œç•¢ï¼‰
ï¼ˆâš ï¸éç¨‹ä¸­åš´ç¦å‚¬ä¿ƒï¼‰
ï¼ˆâš ï¸è«‹æº–æ™‚ç½®æ”¾ä»¥å…å¤šæœ‰ç³¾ç´›ï¼‰

 1é€±åƒåœ¾ï¼š${trashDisplay}
ï¼ˆ1æ¬¡æœ€å¤šæ”¶å–${trashMax}è¢‹--è¶…é‡æ‹’æ”¶ï¼‰
ï¼ˆåƒåœ¾è«‹ç¶ç·Šã€å‹¿å¤–éœ²ï¼‰
ï¼ˆåƒåœ¾è¢‹å¤–éƒ¨å‹¿æµæ¹¯æ±ï¼‰
ï¼ˆä¸€æ¬¡æ€§ç´™/å¡‘è† å®¹å™¨å‡åƒåœ¾ï¼‰


 1é€±è³‡æº:${recycleDisplay}-ç”¨ä¸€èˆ¬å¡‘è† è¢‹
ï¼ˆ1æ¬¡æœ€å¤šæ”¶å–${recycleMax}è¢‹--è¶…é‡æ‹’æ”¶ï¼‰
ï¼ˆè‹¥æœªè£è¢‹ä¸€å¾‹æ‹’æ”¶ï¼‰
ï¼ˆè«‹å‹¿ç”¨é»‘è‰²è¢‹å­è£è³‡æºï¼‰
ï¼ˆåƒ…æ”¶å¯¶ç‰¹ç»ç’ƒéµé‹ç½ï¼‰
ï¼ˆåƒ…æ”¶ä¸­å°ç´™æ¿ç®±å£“æ‰æŠ˜å¥½ï¼‰
ï¼ˆåƒ…æ”¶æ›¸æœ¬/ä¹¾æ·¨ç´™å¼µï¼‰

âš ï¸ä¸‹åˆ—ç‰©å“è¦–ç‚ºåƒåœ¾
ï¼ˆä¾¿ç•¶ç›’/å¡‘è† è¢‹/å¸ç®¡â¡ï¸åƒåœ¾ï¼‰
ï¼ˆè»Ÿå¡‘è† è“‹/å¸ç®¡â¡ï¸åƒåœ¾ï¼‰
ï¼ˆæ—©é¤ç›’/å¿«é£²æ¯â¡ï¸åƒåœ¾ï¼‰
ï¼ˆæ³¡æ£‰/é›è›‹è»Ÿå¡‘è† ç›’â¡ï¸åƒåœ¾ï¼‰
ï¼ˆè›‹ç³•ç›’/ç·©è¡ææ–™â¡ï¸åƒåœ¾ï¼‰

ä¸€å€‹æœˆè²»ç”¨ï¼š${monthlyFee}å…ƒ
ï¼ˆä¸Šæ¨“ä»£æ”¶éœ€æä¾›1æ¨“å¤§é–€é‘°åŒ™ï¼‰

-
ğŸ“‘é…åˆäº‹é …ğŸ“‘
â–ªåƒåœ¾å‹™å¿…æ‰“åŒ…ç¶å¥½æ”¾ç½®é–€å£
â–ªå¦‚å› æ”¿ç­–è®Šå‹•éœ€æ”¹æ™‚é–“
â¬‡ï¸å°‡æå‰å‘ŠçŸ¥ç…©è«‹é…åˆ
â–ªè‡ªå‚™é›™åŒ—å¸‚æ”¿åºœå°ˆç”¨åƒåœ¾è¢‹
â–ªæ”¶æ¬¾å¾Œä¸é€€æ¬¾å…§å®¹ä¸æ›´æ”¹
â–ªæœ‰è¶…é‡ä¸€å¾‹æ‹’æ”¶

    â‡©

ğŸš¨ å…¶ä»–å•é¡Œ ğŸš¨
ğŸ“„è«‹å…ˆå®Œæ•´é–±è®€å ±åƒ¹å…§å®¹æå‡º
ğŸ’¬å®¢æœè§£æ±ºä»»ä½•å•é¡Œ

    â‡©

â­•è§£æ±ºå•é¡Œâ­•
âœ”ï¸.ä¸Šè¿°å•é¡Œå‡è§£æ±º
âœ”ï¸.ä¸Šè¿°å…§å®¹èƒ½é…åˆ
å›è¦†å‘ŠçŸ¥æˆ‘å€‘ï¼šåŒæ„âœ…+é–‹å§‹æ—¥

    â‡©

æ”¶åˆ°_åŒæ„âœ…_å¾Œ
ğŸ’§å®¢æœâ¡ï¸æä¾›ç¹³è²»å–®
ğŸ’§å®¢æˆ¶â¡ï¸å®Œæˆç¹³è²»
ğŸ’§å®¢æœâ¡ï¸é–‹å§‹ä»£æ”¶

âš ï¸ æ³¨æ„äº‹é … âš ï¸
ğŸ”´1åˆ†éŒ¢1åˆ†æœå‹™ä½åƒ¹ç„¡å®‰å…¨ä¿éšœ
ğŸŸ è¿‘æœŸå¤šèµ·æ¡ˆä¾‹è«‹å‹™å¿…ç•™æ„
ğŸŸ¡å¹´è¼•å°ˆæ¥­åœ˜éšŠ-æµç¨‹çš†æœ‰ SOP
ğŸŸ¢æˆå“¡å¹³å‡ 30-35 æ­²çš†å…·è‰¯æ°‘è­‰
ğŸ”µéå¹´åŠå¤©ç½äººç¦åœæ­¢ä»£æ”¶ç„¡é€€æ¬¾
â¡ï¸å»¶è‡³ä¸‹ä¸€æ¬¡å¯ä»£æ”¶å·¥ä½œæ—¥



ğŸŒè§£æ±ºåƒåœ¾ä¸¦ä¸åªæ˜¯æ”¶èµ°
âš¡æˆ‘å€‘æ”¹è®Šçš„æ˜¯åŸå¸‚çš„é‹è½‰é€Ÿåº¦`;

            return quote;
        }

        function copyAutoQuote() {
            const quoteText = document.getElementById('auto-quote-result-display').textContent;
            
            if (!quoteText) {
                showStatus('auto-quote-copy-status', 'âŒ æ²’æœ‰å ±åƒ¹å–®å¯è¤‡è£½', 'error');
                return;
            }

            navigator.clipboard.writeText(quoteText).then(() => {
                showStatus('auto-quote-copy-status', 'âœ… è‡ªå‹•å ±åƒ¹å–®å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿', 'success');
            }).catch(() => {
                showStatus('auto-quote-copy-status', 'âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡è¤‡è£½', 'error');
            });
        }

        // å–®è¶Ÿå ±åƒ¹Googleè©¦ç®—è¡¨è®€å–åŠŸèƒ½
        async function fetchSingleQuoteGoogleSheetsData() {
            const sheetsUrl = document.getElementById('single-quote-sheets-url').value.trim();
            
            if (!sheetsUrl) {
                showStatus('single-quote-sheets-status', 'âŒ è«‹è¼¸å…¥Googleè©¦ç®—è¡¨ç¶²å€', 'error');
                return;
            }

            if (!sheetsUrl.includes('docs.google.com/spreadsheets')) {
                showStatus('single-quote-sheets-status', 'âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„Googleè©¦ç®—è¡¨é€£çµ', 'error');
                return;
            }

            showStatus('single-quote-sheets-status', 'ğŸ”„ æ­£åœ¨è¼‰å…¥è©¦ç®—è¡¨è³‡æ–™...', 'success');

            try {
                // å¾URLä¸­æå–è©¦ç®—è¡¨ID
                let spreadsheetId = '';
                const urlMatch = sheetsUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (urlMatch) {
                    spreadsheetId = urlMatch[1];
                } else {
                    throw new Error('ç„¡æ³•è§£æè©¦ç®—è¡¨IDï¼Œè«‹ç¢ºèªURLæ ¼å¼æ­£ç¢º');
                }

                // æ§‹å»ºCSVå°å‡ºURL
                const csvUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv`;
                
                let response;
                try {
                    response = await fetch(csvUrl, {
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/csv,text/plain'
                        }
                    });
                } catch (corsError) {
                    throw new Error('ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œç„¡æ³•ç›´æ¥è®€å–Googleè©¦ç®—è¡¨ã€‚è«‹ç¢ºèªï¼š\n1. è©¦ç®—è¡¨å·²è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…ã€å¯æª¢è¦–\n2. æˆ–æ‰‹å‹•è¤‡è£½è²¼ä¸Šè³‡æ–™');
                }

                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ç„¡æ³•å­˜å–è©¦ç®—è¡¨ï¼Œè«‹ç¢ºèªåˆ†äº«è¨­å®šç‚ºã€ŒçŸ¥é“é€£çµçš„ä½¿ç”¨è€…ã€å¯æª¢è¦–');
                    } else if (response.status === 404) {
                        throw new Error('æ‰¾ä¸åˆ°è©¦ç®—è¡¨ï¼Œè«‹ç¢ºèªç¶²å€æ­£ç¢º');
                    } else {
                        throw new Error(`è¼‰å…¥å¤±æ•— (éŒ¯èª¤ä»£ç¢¼: ${response.status})`);
                    }
                }

                const csvText = await response.text();
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('è©¦ç®—è¡¨è³‡æ–™ç‚ºç©ºï¼Œè«‹ç¢ºèªè¡¨æ ¼ä¸­æœ‰è³‡æ–™');
                }

                // CSVè§£æ
                const rows = parseCSV(csvText);
                const filteredRows = rows.filter(row => row.some(cell => cell && cell.length > 0));
                
                if (filteredRows.length === 0) {
                    throw new Error('è©¦ç®—è¡¨ä¸­æ²’æœ‰æ‰¾åˆ°ä»»ä½•æœ‰æ•ˆè³‡æ–™');
                }

                const updateMode = document.getElementById('single-quote-update-mode').value;
                
                // å–å¾—è¡¨é ­å’Œè³‡æ–™è¡Œ
                const headers = filteredRows[0] || [];
                const allDataRows = filteredRows.slice(1);
                
                let dataRows;
                if (updateMode === 'latest') {
                    dataRows = allDataRows.slice(-1);
                } else if (updateMode === 'last-5') {
                    dataRows = allDataRows.slice(-5);
                } else if (updateMode === 'last-10') {
                    dataRows = allDataRows.slice(-10);
                } else if (updateMode === 'last-20') {
                    dataRows = allDataRows.slice(-20);
                } else {
                    dataRows = allDataRows;
                }

                if (dataRows.length === 0) {
                    throw new Error('æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è³‡æ–™è¡Œ');
                }

                // é¡¯ç¤ºè³‡æ–™é è¦½
                displaySingleQuoteData(headers, dataRows);
                showStatus('single-quote-sheets-status', `âœ… æˆåŠŸè¼‰å…¥ ${dataRows.length} è¡Œè³‡æ–™`, 'success');

            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™å¤±æ•—:', error);
                showStatus('single-quote-sheets-status', `âŒ ${error.message}`, 'error');
            }
        }

        // å­˜å„²è©¦ç®—è¡¨è³‡æ–™ä¾›é¸æ“‡ä½¿ç”¨
        let singleQuoteTableData = {
            headers: [],
            rows: []
        };

        function displaySingleQuoteData(headers, rows) {
            // å„²å­˜è³‡æ–™ä¾›å¾ŒçºŒä½¿ç”¨
            singleQuoteTableData.headers = headers;
            singleQuoteTableData.rows = rows;
            
            const container = document.getElementById('single-quote-detected-data-preview');
            
            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
            
            // è¡¨é ­
            html += '<tr style="background: #404040;">';
            headers.forEach(header => {
                html += `<th style="border: 1px solid #666; padding: 8px; text-align: left; color: #fff;">${header}</th>`;
            });
            html += '</tr>';
            
            // è³‡æ–™è¡Œ
            rows.forEach((row, index) => {
                const bgColor = index % 2 === 0 ? '#333333' : '#2a2a2a';
                html += `<tr onclick="selectSingleQuoteRowForQuote(${index})" style="cursor: pointer; background: ${bgColor};" class="single-data-row" title="é»æ“Šé¸æ“‡æ­¤è³‡æ–™ä½œç‚ºå ±åƒ¹å–®ä¾†æº" onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='${bgColor}'">`;
                row.forEach(cell => {
                    html += `<td style="border: 1px solid #666; padding: 8px; color: #e0e0e0;">${cell || ''}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</table>';
            container.innerHTML = html;
            
            document.getElementById('single-quote-detected-data').style.display = 'block';
            document.getElementById('single-quote-controls').style.display = 'block';
        }

        let singleQuoteSelectedData = null;
        let singleQuoteSelectedRowIndex = -1;

        function selectSingleQuoteRowForQuote(rowIndex) {
            console.log('selectSingleQuoteRow called with index:', rowIndex);
            
            // ä½¿ç”¨å­˜å„²çš„è³‡æ–™è€Œä¸æ˜¯DOMæŸ¥è©¢
            const headers = singleQuoteTableData.headers;
            const rows = singleQuoteTableData.rows;
            const selectedRowData = rows[rowIndex];
            
            console.log('Available headers:', headers);
            console.log('Selected row data:', selectedRowData);
            
            // åŒæ™‚æ›´æ–°DOMé«˜äº®
            const container = document.getElementById('single-quote-detected-data-preview');
            const table = container.querySelector('table');
            const dataRows = Array.from(table.querySelectorAll('tr')).slice(1);
            const selectedRow = dataRows[rowIndex];
            
            if (selectedRow) {
                // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡é«˜äº®
                dataRows.forEach(row => {
                    row.style.border = '';
                });
                
                // é«˜äº®é¸ä¸­çš„è¡Œ
                selectedRow.style.border = '3px solid #FFD700';
            }
            
            // è§£æé¸ä¸­è¡Œçš„è³‡æ–™
            const fieldMapping = {};
            headers.forEach((header, index) => {
                fieldMapping[header] = selectedRowData[index] || '';
            });
            
            // æ™ºèƒ½æ¬„ä½åµæ¸¬
            const detectedData = {
                address: '',
                lineName: '',
                serviceTime: '',
                weeklyFrequency: '',
                serviceDays: '',
                housingType: '',
                trashBags: '',
                recycleBags: ''
            };
            
            // åµæ¸¬åœ°å€ - æ“´å±•åµæ¸¬æ¢ä»¶
            for (const [header, value] of Object.entries(fieldMapping)) {
                if (header.includes('åœ°å€') || 
                    (header.includes('æ”¶å–') && header.includes('åœ°å€')) || 
                    header.includes('å€åŸŸ+åœ°å€') || 
                    header.includes('æ”¶å–å€åŸŸ') ||
                    header.includes('æ­£ç¢ºæ”¶å–åœ°å€') ||
                    header.includes('æ”¶å–ä½ç½®') ||
                    header.includes('æœå‹™åœ°å€')) {
                    detectedData.address = value;
                    break;
                }
            }
            
            // åµæ¸¬LINEæš±ç¨± - æ“´å±•åµæ¸¬æ¢ä»¶
            for (const [header, value] of Object.entries(fieldMapping)) {
                if (header.includes('æš±ç¨±') || 
                    header.includes('Line') || 
                    header.includes('LINE') || 
                    (header.includes('é¡¯ç¤º') && header.includes('æš±ç¨±')) || 
                    header.includes('Lineé¡¯ç¤º') ||
                    header.includes('å®¢æˆ¶æš±ç¨±') ||
                    header.includes('ç”¨æˆ¶æš±ç¨±')) {
                    detectedData.lineName = value;
                    break;
                }
            }
            
            // å„²å­˜é¸ä¸­çš„è³‡æ–™
            singleQuoteSelectedData = detectedData;
            singleQuoteSelectedRowIndex = rowIndex;
            
            console.log('Selected row field mapping:', fieldMapping);
            console.log('Detected data:', detectedData);
            
            // æ›´æ–°æ‰€æœ‰è¡Œæ¨£å¼
            const allRows = document.querySelectorAll('.single-data-row');
            allRows.forEach((row, index) => {
                if (index === rowIndex) {
                    row.style.border = '3px solid #FFD700';
                    row.style.background = '#4a4a00';
                } else {
                    row.style.border = '';
                    row.style.background = index % 2 === 0 ? '#333333' : '#2a2a2a';
                }
            });
            
            // é¡¯ç¤ºåµæ¸¬çµæœç‹€æ…‹
            let statusMsg = `âœ… å·²é¸æ“‡ç¬¬ ${rowIndex + 1} è¡Œè³‡æ–™`;
            if (detectedData.address) {
                statusMsg += ` | åœ°å€: ${detectedData.address.substring(0, 20)}...`;
            }
            if (detectedData.lineName) {
                statusMsg += ` | æš±ç¨±: ${detectedData.lineName}`;
            }
            
            showStatus('single-quote-sheets-status', statusMsg, 'success');
            
            // è§£æä¸¦é¡¯ç¤ºç…§ç‰‡
            displaySingleQuotePhotos(fieldMapping);
        }

        // Google Drive URL è½‰æ›å‡½æ•¸
        function convertGoogleDriveUrl(url) {
            // å¾ Google Drive URL ä¸­æå– file ID
            // æ”¯æŒæ ¼å¼: https://drive.google.com/open?id=FILE_ID
            const idMatch = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
            if (idMatch) {
                const fileId = idMatch[1];
                return {
                    thumbnail: `https://drive.google.com/thumbnail?id=${fileId}&sz=w400`,
                    view: `https://drive.google.com/file/d/${fileId}/view`,
                    download: `https://drive.google.com/uc?export=download&id=${fileId}`
                };
            }
            return null;
        }

        // è§£æä¸¦é¡¯ç¤ºç…§ç‰‡
        function displaySingleQuotePhotos(fieldMapping) {
            const photosContainer = document.getElementById('single-quote-photos-container');
            const photosSection = document.getElementById('single-quote-photos-section');
            
            // æŸ¥æ‰¾ç…§ç‰‡æ¬„ä½ - æ”¯æŒå¤šç¨®å¯èƒ½çš„æ¬„ä½åç¨±
            let photoUrls = [];
            for (const [header, value] of Object.entries(fieldMapping)) {
                if (header.includes('ç…§ç‰‡') || 
                    header.includes('åœ–ç‰‡') || 
                    header.includes('photo') || 
                    header.includes('image') ||
                    header.includes('åƒåœ¾') && header.includes('ç…§ç‰‡')) {
                    
                    // è§£æå¤šå€‹ URLï¼ˆä»¥é€—è™Ÿåˆ†éš”ï¼‰
                    if (value && value.trim()) {
                        const urls = value.split(',').map(url => url.trim()).filter(url => url.length > 0);
                        photoUrls = urls;
                        break;
                    }
                }
            }
            
            // å¦‚æœæ²’æœ‰ç…§ç‰‡ï¼Œéš±è—ç…§ç‰‡å€åŸŸ
            if (photoUrls.length === 0) {
                photosSection.style.display = 'none';
                photoDownloadUrls = []; // æ¸…ç©ºä¸‹è¼‰ URLs
                return;
            }
            
            // é¡¯ç¤ºç…§ç‰‡å€åŸŸ
            photosSection.style.display = 'block';
            
            // æ¸…ç©ºç¾æœ‰å…§å®¹
            photosContainer.innerHTML = '';
            
            // æ¸…ç©ºä¸¦æº–å‚™æ–°çš„ä¸‹è¼‰ URLs
            photoDownloadUrls = [];
            
            // ç‚ºæ¯å¼µç…§ç‰‡å‰µå»ºå¡ç‰‡
            photoUrls.forEach((url, index) => {
                const converted = convertGoogleDriveUrl(url);
                if (!converted) return;
                
                // ä¿å­˜ä¸‹è¼‰ URL
                photoDownloadUrls.push(converted.download);
                
                const photoCard = document.createElement('div');
                photoCard.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 8px;
                    padding: 10px;
                    background: #333;
                    border-radius: 8px;
                    border: 2px solid #444;
                    transition: all 0.3s ease;
                    width: 200px;
                `;
                
                photoCard.onmouseover = function() {
                    this.style.borderColor = '#667eea';
                    this.style.transform = 'translateY(-3px)';
                };
                photoCard.onmouseout = function() {
                    this.style.borderColor = '#444';
                    this.style.transform = 'translateY(0)';
                };
                
                // åœ–ç‰‡å®¹å™¨
                const imgContainer = document.createElement('div');
                imgContainer.style.cssText = `
                    width: 180px;
                    height: 180px;
                    overflow: hidden;
                    border-radius: 6px;
                    background: #222;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                const img = document.createElement('img');
                img.src = converted.thumbnail;
                img.alt = `ç…§ç‰‡ ${index + 1}`;
                img.style.cssText = `
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    cursor: pointer;
                `;
                img.onclick = () => window.open(converted.view, '_blank');
                
                // è™•ç†åœ–ç‰‡è¼‰å…¥éŒ¯èª¤
                img.onerror = function() {
                    imgContainer.innerHTML = `
                        <div style="color: #999; text-align: center; padding: 10px;">
                            <div style="font-size: 40px;">ğŸ“·</div>
                            <div style="font-size: 12px; margin-top: 5px;">è¼‰å…¥å¤±æ•—</div>
                        </div>
                    `;
                };
                
                imgContainer.appendChild(img);
                
                // ç…§ç‰‡ç·¨è™Ÿ
                const label = document.createElement('div');
                label.textContent = `ç…§ç‰‡ ${index + 1}`;
                label.style.cssText = `
                    color: #e0e0e0;
                    font-size: 14px;
                    font-weight: 500;
                `;
                
                // æŒ‰éˆ•å®¹å™¨
                const btnContainer = document.createElement('div');
                btnContainer.style.cssText = `
                    display: flex;
                    gap: 8px;
                    width: 100%;
                `;
                
                // æŸ¥çœ‹æŒ‰éˆ•
                const viewBtn = document.createElement('button');
                viewBtn.textContent = 'ğŸ‘ï¸ æŸ¥çœ‹';
                viewBtn.style.cssText = `
                    flex: 1;
                    padding: 6px 12px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: 600;
                    transition: all 0.3s ease;
                `;
                viewBtn.onmouseover = function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.4)';
                };
                viewBtn.onmouseout = function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                };
                viewBtn.onclick = () => window.open(converted.view, '_blank');
                
                // ä¸‹è¼‰æŒ‰éˆ•
                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'ğŸ“¥ ä¸‹è¼‰';
                downloadBtn.style.cssText = `
                    flex: 1;
                    padding: 6px 12px;
                    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: 600;
                    transition: all 0.3s ease;
                `;
                downloadBtn.onmouseover = function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 4px 12px rgba(40, 167, 69, 0.4)';
                };
                downloadBtn.onmouseout = function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                };
                downloadBtn.onclick = () => window.open(converted.download, '_blank');
                
                btnContainer.appendChild(viewBtn);
                btnContainer.appendChild(downloadBtn);
                
                photoCard.appendChild(imgContainer);
                photoCard.appendChild(label);
                photoCard.appendChild(btnContainer);
                
                photosContainer.appendChild(photoCard);
            });
            
            console.log(`é¡¯ç¤ºäº† ${photoUrls.length} å¼µç…§ç‰‡`);
        }

        // å…¨å±€è®Šé‡å­˜å„²ç…§ç‰‡ä¸‹è¼‰ URLs
        let photoDownloadUrls = [];

        // ä¸€éµä¸‹è¼‰å…¨éƒ¨ç…§ç‰‡
        function downloadAllPhotos() {
            if (photoDownloadUrls.length === 0) {
                alert('ç›®å‰æ²’æœ‰å¯ä¸‹è¼‰çš„ç…§ç‰‡');
                return;
            }
            
            // è©¢å•ç”¨æˆ¶ç¢ºèª
            const confirmMsg = `å³å°‡ä¸‹è¼‰ ${photoDownloadUrls.length} å¼µç…§ç‰‡ï¼Œç¢ºå®šç¹¼çºŒå—ï¼Ÿ`;
            if (!confirm(confirmMsg)) {
                return;
            }
            
            // ä¾åºä¸‹è¼‰æ¯å¼µç…§ç‰‡ï¼Œè¨­å®šçŸ­æš«å»¶é²é¿å…ç€è¦½å™¨é˜»æ“‹
            photoDownloadUrls.forEach((url, index) => {
                setTimeout(() => {
                    window.open(url, '_blank');
                }, index * 300); // æ¯å¼µç…§ç‰‡é–“éš” 300ms
            });
            
            showStatus('single-quote-sheets-status', `âœ… å·²é–‹å§‹ä¸‹è¼‰ ${photoDownloadUrls.length} å¼µç…§ç‰‡`, 'success');
        }

        // æ—¥æœŸè½‰æ›ç‚ºåŒ…å«æ˜ŸæœŸå¹¾çš„æ ¼å¼
        function formatDateWithWeekday(dateString) {
            if (!dateString) return 'å¾…ç¢ºèª';
            
            const date = new Date(dateString);
            const weekdays = ['é€±æ—¥', 'é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­'];
            const weekday = weekdays[date.getDay()];
            
            // æ ¼å¼åŒ–ç‚º YYYY/MM/DD (æ˜ŸæœŸX)
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return `${year}/${month}/${day} (${weekday})`;
        }

        // æ™‚é–“æ ¼å¼è½‰æ›
        function formatTime(timeString) {
            if (!timeString || timeString.trim() === '') return 'å¾…ç¢ºèª';
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºæ•¸å­—æ ¼å¼çš„æ™‚é–“ (å¦‚ 1200-1300å®Œæˆ)
            const timePattern = /(\d{3,4})-(\d{3,4})(.*)$/;
            const match = timeString.match(timePattern);
            
            if (match) {
                const startTime = match[1];
                const endTime = match[2];
                const suffix = match[3] || '';
                
                // è½‰æ›æ™‚é–“æ ¼å¼
                const formatHour = (time, isStart = false) => {
                    const hour = parseInt(time.slice(0, -2));
                    const minute = time.slice(-2);
                    
                    if (hour >= 12) {
                        const displayHour = hour === 12 ? 12 : hour - 12;
                        const period = isStart ? 'ä¸‹åˆ ' : '';
                        return `${period}${displayHour}ï¼š${minute}`;
                    } else {
                        const displayHour = hour === 0 ? 12 : hour;
                        const period = isStart ? 'ä¸Šåˆ ' : '';
                        return `${period}${displayHour}ï¼š${minute}`;
                    }
                };
                
                const startHour = parseInt(startTime.slice(0, -2));
                const endHour = parseInt(endTime.slice(0, -2));
                
                // åˆ¤æ–·æ™‚é–“æ®µï¼Œåªåœ¨é–‹å§‹æ™‚é–“é¡¯ç¤ºä¸Šåˆ/ä¸‹åˆ
                if (startHour >= 12 && endHour >= 12) {
                    // éƒ½æ˜¯ä¸‹åˆ
                    return `ä¸‹åˆ ${formatHour(startTime, false)}-${formatHour(endTime, false)}${suffix}`;
                } else if (startHour < 12 && endHour < 12) {
                    // éƒ½æ˜¯ä¸Šåˆ
                    return `ä¸Šåˆ ${formatHour(startTime, false)}-${formatHour(endTime, false)}${suffix}`;
                } else {
                    // è·¨è¶Šä¸Šåˆä¸‹åˆ
                    return `${formatHour(startTime, true)}-${formatHour(endTime, true)}${suffix}`;
                }
            }
            
            // å¦‚æœä¸æ˜¯æ•¸å­—æ ¼å¼ï¼Œç›´æ¥è¿”å›åŸå§‹æ–‡å­—
            return timeString;
        }

        // å‹•æ…‹ç…§ç‰‡æè¿°ç®¡ç†
        let photoDescriptionNextId = 1; // è¿½è¹¤ä¸‹ä¸€å€‹IDï¼ˆä¿æŒå”¯ä¸€æ€§ï¼‰
        const maxDescriptions = 15; // æœ€å¤š15å€‹æè¿°

        // ç²å–ç•¶å‰æ´»èºçš„æè¿°æ•¸é‡
        function getActiveDescriptionCount() {
            const container = document.getElementById('photo-descriptions-container');
            return container.querySelectorAll('.photo-description-item').length;
        }

        // æ›´æ–°æ·»åŠ æŒ‰éˆ•ç‹€æ…‹
        function updateAddButtonState() {
            const activeCount = getActiveDescriptionCount();
            const addBtn = document.getElementById('add-description-btn');
            
            if (activeCount >= maxDescriptions) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        // å¢åŠ ç…§ç‰‡æè¿°
        function addPhotoDescription() {
            const activeCount = getActiveDescriptionCount();
            
            if (activeCount >= maxDescriptions) {
                alert(`æœ€å¤šåªèƒ½æ·»åŠ ${maxDescriptions}å€‹æè¿°`);
                return;
            }
            
            photoDescriptionNextId++;
            const container = document.getElementById('photo-descriptions-container');
            
            const descItem = document.createElement('div');
            descItem.className = 'photo-description-item';
            descItem.id = `photo-desc-${photoDescriptionNextId}`;
            descItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            descItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>ğŸ—‘ï¸æè¿°${activeCount + 1}ï¼š</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="single-quote-photo${photoDescriptionNextId}" placeholder="ä¾‹å¦‚ï¼šåƒåœ¾æè¿°" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removePhotoDescription(${photoDescriptionNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        âŒ åˆªé™¤
                    </button>
                </div>
            `;
            
            container.appendChild(descItem);
            updateAddButtonState();
        }

        // ç§»é™¤ç…§ç‰‡æè¿°
        function removePhotoDescription(id) {
            const descItem = document.getElementById(`photo-desc-${id}`);
            if (descItem) {
                descItem.remove();
                updateAddButtonState();
            }
        }

        // å‹•æ…‹å…¶ä»–èªªæ˜ç®¡ç†
        let singleNoteNextId = 1; // è¿½è¹¤ä¸‹ä¸€å€‹IDï¼ˆä¿æŒå”¯ä¸€æ€§ï¼‰
        const maxNotes = 10; // æœ€å¤š10å€‹èªªæ˜

        // ç²å–ç•¶å‰æ´»èºçš„å…¶ä»–èªªæ˜æ•¸é‡
        function getActiveSingleNoteCount() {
            const container = document.getElementById('single-notes-container');
            return container.querySelectorAll('.single-note-item').length;
        }

        // æ›´æ–°æ·»åŠ èªªæ˜æŒ‰éˆ•ç‹€æ…‹
        function updateSingleNoteButtonState() {
            const activeCount = getActiveSingleNoteCount();
            const addBtn = document.getElementById('add-single-note-btn');
            
            if (activeCount >= maxNotes) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        // å¢åŠ å…¶ä»–èªªæ˜
        function addSingleNote() {
            const activeCount = getActiveSingleNoteCount();
            
            if (activeCount >= maxNotes) {
                alert(`æœ€å¤šåªèƒ½æ·»åŠ ${maxNotes}å€‹èªªæ˜`);
                return;
            }
            
            singleNoteNextId++;
            const container = document.getElementById('single-notes-container');
            
            const noteItem = document.createElement('div');
            noteItem.className = 'single-note-item';
            noteItem.id = `single-note-${singleNoteNextId}`;
            noteItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            noteItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>ğŸ“èªªæ˜${activeCount + 1}ï¼š</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="single-other${singleNoteNextId}" placeholder="ä¾‹å¦‚ï¼šé¡å¤–å‚™è¨»" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removeSingleNote(${singleNoteNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        âŒ åˆªé™¤
                    </button>
                </div>
            `;
            
            container.appendChild(noteItem);
            updateSingleNoteButtonState();
        }

        // ç§»é™¤å…¶ä»–èªªæ˜
        function removeSingleNote(id) {
            const noteItem = document.getElementById(`single-note-${id}`);
            if (noteItem) {
                noteItem.remove();
                updateSingleNoteButtonState();
            }
        }

        // å‹•æ…‹æ¸…æ½”å…¶ä»–èªªæ˜ç®¡ç†
        let cleanNoteNextId = 1;
        const maxCleanNotes = 10;

        function getActiveCleanNoteCount() {
            const container = document.getElementById('clean-notes-container');
            return container.querySelectorAll('.clean-note-item').length;
        }

        function updateCleanNoteButtonState() {
            const activeCount = getActiveCleanNoteCount();
            const addBtn = document.getElementById('add-clean-note-btn');
            
            if (activeCount >= maxCleanNotes) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        function addCleanNote() {
            const activeCount = getActiveCleanNoteCount();
            
            if (activeCount >= maxCleanNotes) {
                alert(`æœ€å¤šåªèƒ½æ·»åŠ ${maxCleanNotes}å€‹èªªæ˜`);
                return;
            }
            
            cleanNoteNextId++;
            const container = document.getElementById('clean-notes-container');
            
            const noteItem = document.createElement('div');
            noteItem.className = 'clean-note-item';
            noteItem.id = `clean-note-${cleanNoteNextId}`;
            noteItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            noteItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>ğŸ“èªªæ˜${activeCount + 1}ï¼š</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="clean-other${cleanNoteNextId}" placeholder="ä¾‹ï¼šé¡å¤–å‚™è¨»" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removeCleanNote(${cleanNoteNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        âŒ åˆªé™¤
                    </button>
                </div>
            `;
            
            container.appendChild(noteItem);
            updateCleanNoteButtonState();
        }

        function removeCleanNote(id) {
            const noteItem = document.getElementById(`clean-note-${id}`);
            if (noteItem) {
                noteItem.remove();
                updateCleanNoteButtonState();
            }
        }

        // å‹•æ…‹æ¸…æ½”ç¯„åœç®¡ç†
        let cleanScopeNextId = 1;
        const maxCleanScopes = 20;

        function getActiveCleanScopeCount() {
            const container = document.getElementById('clean-scope-container');
            return container.querySelectorAll('.clean-scope-item').length;
        }

        function updateCleanScopeButtonState() {
            const activeCount = getActiveCleanScopeCount();
            const addBtn = document.getElementById('add-clean-scope-btn');
            
            if (activeCount >= maxCleanScopes) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        function addCleanScope() {
            const activeCount = getActiveCleanScopeCount();
            
            if (activeCount >= maxCleanScopes) {
                alert(`æœ€å¤šåªèƒ½æ·»åŠ ${maxCleanScopes}å€‹æ¸…æ½”é …ç›®`);
                return;
            }
            
            cleanScopeNextId++;
            const container = document.getElementById('clean-scope-container');
            
            const scopeItem = document.createElement('div');
            scopeItem.className = 'clean-scope-item';
            scopeItem.id = `clean-scope-item-${cleanScopeNextId}`;
            scopeItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            scopeItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>ğŸ§¹é …ç›®${activeCount + 1}ï¼š</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="clean-scope-${cleanScopeNextId}" placeholder="æ¸…æ½”é …ç›® ${activeCount + 1}" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removeCleanScope(${cleanScopeNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        âŒ åˆªé™¤
                    </button>
                </div>
            `;
            
            container.appendChild(scopeItem);
            updateCleanScopeButtonState();
        }

        function removeCleanScope(id) {
            const scopeItem = document.getElementById(`clean-scope-item-${id}`);
            if (scopeItem) {
                scopeItem.remove();
                updateCleanScopeButtonState();
            }
        }

        // ç”Ÿæˆå–®è¶Ÿåƒåœ¾ä»£æ”¶å ±åƒ¹å–®
        function generateSingleQuote() {
            try {
                // ç²å–è²»ç”¨è³‡æ–™ - ç›´æ¥è®€å–æ•¸å­—è¼¸å…¥æ¡†
                const groundFeeValue = document.getElementById('single-quote-ground-fee').value;
                const upstairsFeeValue = document.getElementById('single-quote-upstairs-fee').value;
                
                // åªæœ‰ç•¶è¼¸å…¥å€¼å­˜åœ¨ä¸”ä¸ç‚º0æ™‚æ‰ä½¿ç”¨
                const groundFee = groundFeeValue && parseFloat(groundFeeValue) > 0 ? groundFeeValue : null;
                const upstairsFee = upstairsFeeValue && parseFloat(upstairsFeeValue) > 0 ? upstairsFeeValue : null;
                
                const upstairsOption = document.getElementById('single-quote-upstairs-option').value || 'æœ‰/ç„¡/è‡ªé¸';
                const dateRaw = document.getElementById('single-quote-date').value;
                const timeRaw = document.getElementById('single-quote-time').value;
                
                // æ ¼å¼åŒ–æ—¥æœŸå’Œæ™‚é–“
                const date = formatDateWithWeekday(dateRaw);
                const time = formatTime(timeRaw);
                
                // ç²å–ç…§ç‰‡æè¿° - å¾å‹•æ…‹æ¬„ä½æ”¶é›†
                const photos = [];
                const container = document.getElementById('photo-descriptions-container');
                const allInputs = container.querySelectorAll('input[id^="single-quote-photo"]');
                allInputs.forEach(input => {
                    const content = input.value;
                    if (content && content.trim() !== '') {
                        photos.push(content.trim());
                    }
                });

                // å¾é¸ä¸­çš„è©¦ç®—è¡¨è³‡æ–™ä¸­ç²å–åœ°å€å’ŒLINEæš±ç¨±
                const address = singleQuoteSelectedData ? singleQuoteSelectedData.address : '';
                const lineName = singleQuoteSelectedData ? singleQuoteSelectedData.lineName : '';
                
                console.log('Generate quote - Address:', address);
                console.log('Generate quote - Line Name:', lineName);
                console.log('singleQuoteSelectedData:', singleQuoteSelectedData);

                // ç”Ÿæˆå ±åƒ¹å–®
                const quote = generateSingleQuoteTemplate({
                    groundFee,
                    upstairsFee,
                    upstairsOption,
                    date,
                    time,
                    photos,
                    address,
                    lineName
                });

                // é¡¯ç¤ºçµæœ
                document.getElementById('single-quote-result-display').textContent = quote;
                document.getElementById('single-quote-output').style.display = 'block';
                
                showStatus('single-quote-copy-status', 'âœ… å–®è¶Ÿåƒåœ¾ä»£æ”¶å ±åƒ¹å–®å·²ç”Ÿæˆ', 'success');

            } catch (error) {
                showStatus('single-quote-copy-status', `âŒ ç”Ÿæˆå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // å–®è¶Ÿåƒåœ¾ä»£æ”¶å ±åƒ¹å–®ç¯„æœ¬
        function generateSingleQuoteTemplate(data) {
            const {groundFee, upstairsFee, upstairsOption, date, time, photos, address, lineName} = data;
            
            console.log('Template generation - Address:', address);
            console.log('Template generation - Line Name:', lineName);
            console.log('Template generation - Full data:', data);
            
            let quote = ``;

            // å¦‚æœæœ‰LINEæš±ç¨±ï¼Œé¡¯ç¤ºåœ¨æœ€ä¸Šæ–¹
            if (lineName) {
                quote += `LINEæš±ç¨±ï¼š${lineName}\n`;
                console.log('Added line name to quote');
            }
            
            // å¦‚æœæœ‰åœ°å€ï¼Œé¡¯ç¤ºåœ¨æš±ç¨±ä¸‹æ–¹
            if (address) {
                quote += `åœ°å€ï¼š${address}\n`;
                console.log('Added address to quote');
            }
            
            // å¦‚æœæœ‰ä½å®…æ€§è³ªï¼Œå¾é¸ä¸­è³‡æ–™ä¸­å–å¾—
            if (singleQuoteSelectedData && singleQuoteSelectedData.housingType) {
                quote += `ä½å®…æ€§è³ªï¼š${singleQuoteSelectedData.housingType}\n`;
                console.log('Added housing type to quote');
            }
            
            // å¦‚æœæœ‰ä»»ä½•å®¢æˆ¶è³‡è¨Šï¼Œæ·»åŠ åˆ†éš”ç·šï¼Œç„¶å¾ŒåŠ ä¸Šæ¨™é¡Œ
            if (lineName || address || (singleQuoteSelectedData && singleQuoteSelectedData.housingType)) {
                quote += `\n------------------------------------\n\nğŸ”¥å–®è¶Ÿåƒåœ¾ä»£æ”¶ğŸ”¥

`;
                console.log('Added separator line and title');
            } else {
                quote += `ğŸ”¥å–®è¶Ÿåƒåœ¾ä»£æ”¶ğŸ”¥

`;
            }
            
            quote += `ğŸ—‘ï¸åƒåœ¾è³‡æºğŸ—‘ï¸ï¼š

`;

            // æ·»åŠ ç…§ç‰‡æè¿° - åªé¡¯ç¤ºæœ‰å…§å®¹çš„ç…§ç‰‡
            if (photos && photos.length > 0) {
                photos.forEach((photo, index) => {
                    quote += `${index + 1}.${photo}\n`;
                });
            }

            quote += `


âš ï¸ä»£æ”¶è¦ç¯„âš ï¸
ä¾ç…§ç‰‡ä¸»é«”ä»£æ”¶
ç¯„åœè«‹åŠƒç·šæ¨™ç¤º
äº‹æ¥­å»¢æ£„ç‰©æ‹’æ”¶
åƒ…æ”¶ä¸€èˆ¬ç”Ÿæ´»åƒåœ¾
è¶…é‡/è¶…æ•¸/è¶…è¶Ÿ=æ‹’æ”¶

â˜ï¸æ³¨æ„äº‹é …â˜ï¸
1åˆ†éŒ¢1åˆ†æœå‹™
åˆæ³•ä»£æ”¶æ–¹å¼
äº’åŠ©äº’åˆ©äº’ç›¸`;

            // åªé¡¯ç¤ºæœ‰è¨­å®šè²»ç”¨çš„æ–¹æ¡ˆ
            if (groundFee) {
                quote += `

æ–¹æ¡ˆ1
ä¸€æ¨“ä»£æ”¶è²»ç”¨ï¼š${groundFee}å…ƒ`;
            }
            
            if (upstairsFee) {
                quote += `
æ–¹æ¡ˆ2
ä¸Šæ¨“ä»£æ”¶è²»ç”¨ï¼š${upstairsFee}å…ƒ`;
            }

            quote += `

åŸ·è¡Œæ—¥æœŸï¼š${date}
åŸ·è¡Œæ™‚é–“ï¼š${time}

âœ…åŒæ„ä¸Šè¿°å…§å®¹å¾Œè«‹å›è¦†
âœ…å°‡é–‹ç«‹ç¹³è²»å–®
âœ…20 åˆ†å…§å®Œæˆç¹³è²»
âœ…æä¾›é›»è©±èˆ‡å§“å
âœ…å–®è¶Ÿé ç´„å³å®Œæˆ
âœ…æ”¶æ¬¾å¾Œè²»ç”¨ç„¡æ³•é€€æ¬¾
âœ…æ”¶æ¬¾å¾Œå…§å®¹ç„¡æ³•æ›´æ”¹

ğŸ“¸ç…§ç‰‡èˆ‡å›å ±è¦ç¯„
1ï¸âƒ£ç½®æ”¾1æ¨“è€…
ğŸ–¼æä¾›å®Œæ•´ç…§ç‰‡
ğŸ“©ä¸¦å›å‚³çµ¦å®¢æœ
2ï¸âƒ£ä¸Šæ¨“è€…ï¼šç„¡éœ€å›å‚³
3ï¸âƒ£ç½®æ”¾å®Œç•¢å³å¯é›¢é–‹
4ï¸âƒ£ä»£æ”¶å®Œæˆå¾Œæœƒå›å ±

ğŸŒè§£æ±ºåƒåœ¾ä¸¦ä¸åªæ˜¯æ”¶èµ°
âš¡æˆ‘å€‘æ”¹è®Šçš„æ˜¯åŸå¸‚çš„é‹è½‰é€Ÿåº¦`;

            return quote;
        }

        // è¤‡è£½å–®è¶Ÿå ±åƒ¹å–®
        function copySingleQuote() {
            const quoteText = document.getElementById('single-quote-result-display').textContent;
            
            if (!quoteText) {
                showStatus('single-quote-copy-status', 'âŒ æ²’æœ‰å ±åƒ¹å–®å¯è¤‡è£½', 'error');
                return;
            }

            navigator.clipboard.writeText(quoteText).then(() => {
                showStatus('single-quote-copy-status', 'âœ… å–®è¶Ÿåƒåœ¾ä»£æ”¶å ±åƒ¹å–®å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿', 'success');
            }).catch(() => {
                showStatus('single-quote-copy-status', 'âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡è¤‡è£½', 'error');
            });
        }

        // å–®è¶Ÿå ±åƒ¹æ­·å²ç¶²å€ç®¡ç†
        function saveSingleQuoteUrlToHistory() {
            const url = document.getElementById('single-quote-sheets-url').value.trim();
            if (!url) return;
            
            let savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            
            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç¶²å€
            const existingIndex = savedUrls.findIndex(item => (typeof item === 'string' ? item : item.url) === url);
            
            if (existingIndex === -1) {
                // æ–°å¢ç¶²å€ï¼Œè©¢å•è‡ªå®šç¾©åç¨±
                const customName = prompt('è«‹ç‚ºæ­¤ç¶²å€è¨­å®šä¸€å€‹è‡ªå®šç¾©åç¨±ï¼ˆå¯é¸ï¼Œç›´æ¥æŒ‰ç¢ºå®šä½¿ç”¨é è¨­åç¨±ï¼‰ï¼š', `å–®è¶Ÿè©¦ç®—è¡¨ ${savedUrls.length + 1}`);
                const urlData = {
                    url: url,
                    name: customName && customName.trim() !== '' ? customName.trim() : `å–®è¶Ÿè©¦ç®—è¡¨ ${savedUrls.length + 1}`,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
                
                // æ–°å¢åˆ°æœ€å‰é¢
                savedUrls.unshift(urlData);
                
                // ä¿ç•™æœ€å¤š10ç­†è¨˜éŒ„
                savedUrls = savedUrls.slice(0, 10);
                
                // å„²å­˜åˆ°localStorage
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                
                showStatus('single-quote-sheets-status', `âœ… ç¶²å€å·²å„²å­˜ç‚ºã€Œ${urlData.name}ã€`, 'success');
            } else {
                // ç¶²å€å·²å­˜åœ¨ï¼Œç§»åˆ°æœ€å‰é¢
                const existingItem = savedUrls.splice(existingIndex, 1)[0];
                savedUrls.unshift(existingItem);
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                
                const itemName = typeof existingItem === 'string' ? 'å–®è¶Ÿè©¦ç®—è¡¨' : existingItem.name;
                showStatus('single-quote-sheets-status', `âœ… ç¶²å€ã€Œ${itemName}ã€å·²ç§»è‡³æœ€ä¸Šæ–¹`, 'success');
            }
            
            // æ›´æ–°ä¸‹æ‹‰é¸å–®
            updateSingleQuoteSavedUrlsDropdown();
        }

        function loadSingleQuoteSavedUrl() {
            const select = document.getElementById('single-quote-saved-urls');
            const selectedValue = select.value;
            
            if (selectedValue) {
                document.getElementById('single-quote-sheets-url').value = selectedValue;
                select.value = ''; // æ¸…ç©ºé¸æ“‡
                
                // è‡ªå‹•è§¸ç™¼å„²å­˜åŠŸèƒ½ï¼Œå°‡é¸å–çš„ç¶²å€ç§»åˆ°æœ€å‰é¢
                saveSingleQuoteUrlToHistory();
            }
        }

        function updateSingleQuoteSavedUrlsDropdown() {
            const select = document.getElementById('single-quote-saved-urls');
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            
            // æ¸…ç©ºç¾æœ‰é¸é …ï¼ˆä¿ç•™ç¬¬ä¸€å€‹ç©ºé¸é …ï¼‰
            select.innerHTML = '<option value="">é¸æ“‡æ­·å²ç¶²å€</option>';
            
            // åŠ å…¥å„²å­˜çš„ç¶²å€
            savedUrls.forEach((item, index) => {
                const option = document.createElement('option');
                
                if (typeof item === 'string') {
                    // èˆŠæ ¼å¼ç›¸å®¹æ€§
                    option.value = item;
                    option.textContent = `${index + 1}. ${item.length > 45 ? item.substring(0, 45) + '...' : item}`;
                } else {
                    // æ–°æ ¼å¼ï¼Œé¡¯ç¤ºè‡ªå®šç¾©åç¨±å’Œæ—¥æœŸ
                    option.value = item.url;
                    option.textContent = `${index + 1}. ${item.name} (${item.dateAdded})`;
                }
                
                select.appendChild(option);
            });
            
            // æ›´æ–°ç®¡ç†åˆ—è¡¨
            updateSingleQuoteUrlManagerList();
        }

        function updateSingleQuoteUrlManagerList() {
            const container = document.getElementById('single-quote-url-manager');
            if (!container) return;
            
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            
            if (savedUrls.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">æš«ç„¡å„²å­˜çš„ç¶²å€</div>';
                return;
            }
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            savedUrls.forEach((item, index) => {
                let displayText, fullUrl;
                
                if (typeof item === 'string') {
                    // èˆŠæ ¼å¼ç›¸å®¹æ€§
                    displayText = `${index + 1}. ${item}`;
                    fullUrl = item;
                } else {
                    // æ–°æ ¼å¼ï¼Œé¡¯ç¤ºè‡ªå®šç¾©åç¨±å’Œå„²å­˜æ—¥æœŸ
                    displayText = `${index + 1}. ${item.name} (${item.dateAdded})`;
                    fullUrl = item.url;
                }
                
                html += `
                    <div style="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: #333; border-radius: 5px;">
                        <div style="flex: 1; margin-right: 10px;">
                            <div style="color: #fff; font-weight: bold; margin-bottom: 5px;">
                                ${displayText}
                            </div>
                            <div style="color: #aaa; font-size: 11px; word-break: break-all;">
                                ${fullUrl}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editSingleQuoteUrlName(${index})" style="background: #28a745; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">æ”¹å</button>
                            <button onclick="editSingleQuoteUrl(${index})" style="background: #007bff; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">ç·¨è¼¯</button>
                            <button onclick="deleteSingleQuoteUrl(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">åˆªé™¤</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        function editSingleQuoteUrlName(index) {
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            let currentName;
            
            if (typeof item === 'string') {
                currentName = `å–®è¶Ÿè©¦ç®—è¡¨ ${index + 1}`;
                // å‡ç´šèˆŠæ ¼å¼åˆ°æ–°æ ¼å¼
                savedUrls[index] = {
                    url: item,
                    name: currentName,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
            } else {
                currentName = item.name;
            }
            
            const newName = prompt('ç·¨è¼¯åç¨±ï¼š', currentName);
            
            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                savedUrls[index].name = newName.trim();
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', 'âœ… åç¨±å·²æ›´æ–°', 'success');
            }
        }

        function editSingleQuoteUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const oldUrl = typeof item === 'string' ? item : item.url;
            const newUrl = prompt('ç·¨è¼¯ç¶²å€ï¼š', oldUrl);
            
            if (newUrl && newUrl.trim() !== '' && newUrl.trim() !== oldUrl) {
                if (typeof item === 'string') {
                    // å‡ç´šèˆŠæ ¼å¼åˆ°æ–°æ ¼å¼
                    savedUrls[index] = {
                        url: newUrl.trim(),
                        name: `å–®è¶Ÿè©¦ç®—è¡¨ ${index + 1}`,
                        dateAdded: new Date().toLocaleDateString('zh-TW')
                    };
                } else {
                    savedUrls[index].url = newUrl.trim();
                }
                
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', 'âœ… ç¶²å€å·²æ›´æ–°', 'success');
            }
        }

        function deleteSingleQuoteUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const itemName = typeof item === 'string' ? 'å–®è¶Ÿè©¦ç®—è¡¨' : item.name;
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${itemName}ã€å—ï¼Ÿ`)) {
                savedUrls.splice(index, 1);
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', `âœ… ã€Œ${itemName}ã€å·²åˆªé™¤`, 'success');
            }
        }

        function clearAllSingleQuoteUrls() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ­·å²ç¶²å€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                localStorage.removeItem('singleQuoteSavedUrls');
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', 'âœ… æ‰€æœ‰æ­·å²ç¶²å€å·²æ¸…ç©º', 'success');
            }
        }

        function toggleSingleQuoteUrlManager() {
            const manager = document.getElementById('single-quote-url-manager');
            const button = document.getElementById('single-quote-manage-urls-btn');
            
            if (manager.style.display === 'none' || !manager.style.display) {
                manager.style.display = 'block';
                button.textContent = 'éš±è—æ­·å²ç¶²å€ç®¡ç†';
                updateSingleQuoteUrlManagerList();
            } else {
                manager.style.display = 'none';
                button.textContent = 'æ­·å²ç¶²å€';
            }
        }

        // æ¸…ç©ºå–®è¶Ÿå ±åƒ¹è¡¨å–®
        function clearSingleQuoteForm() {
            // æ¸…ç©ºGoogleè©¦ç®—è¡¨ç¶²å€
            document.getElementById('single-quote-sheets-url').value = '';
            document.getElementById('single-quote-saved-urls').value = '';
            
            // é‡ç½®è²»ç”¨è¨­å®š
            document.getElementById('single-quote-ground-fee').value = '';
            document.getElementById('single-quote-upstairs-fee').value = '';
            
            // æ¸…ç©ºåŸºæœ¬è¨­å®š
            document.getElementById('single-quote-upstairs-option').value = '';
            document.getElementById('single-quote-date').value = '';
            document.getElementById('single-quote-time').value = '';
            
            // é‡ç½®å‹•æ…‹ç…§ç‰‡æè¿°
            const container = document.getElementById('photo-descriptions-container');
            // ä¿ç•™æè¿°1ï¼Œæ¸…ç©ºå…¶å€¼
            const photo1 = document.getElementById('single-quote-photo1');
            if (photo1) {
                photo1.value = '';
            }
            // ç§»é™¤æ‰€æœ‰å…¶ä»–æè¿°ï¼ˆ2åŠä»¥ä¸Šï¼‰
            const allDescItems = container.querySelectorAll('.photo-description-item');
            allDescItems.forEach((item, index) => {
                if (index > 0) { // ä¿ç•™ç¬¬ä¸€å€‹ï¼ˆæè¿°1ï¼‰
                    item.remove();
                }
            });
            // é‡ç½®IDè¨ˆæ•¸å™¨
            photoDescriptionNextId = 1;
            // æ›´æ–°æ·»åŠ æŒ‰éˆ•ç‹€æ…‹
            updateAddButtonState();
            
            // éš±è—è¼¸å‡ºå€åŸŸ
            document.getElementById('single-quote-detected-data').style.display = 'none';
            document.getElementById('single-quote-controls').style.display = 'none';
            document.getElementById('single-quote-output').style.display = 'none';
            document.getElementById('single-quote-sheets-status').style.display = 'none';
            document.getElementById('single-quote-final-status').style.display = 'none';
            document.getElementById('single-quote-photos-section').style.display = 'none';
        }

        // Removed duplicate DOMContentLoaded - using unified one below

        // åŒ…æœˆè‡ªå‹•å ±åƒ¹æ­·å²ç¶²å€ç®¡ç†
        function saveUrlToHistory() {
            const url = document.getElementById('sheets-url').value.trim();
            if (!url) return;
            
            let savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            
            // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç¶²å€
            const existingIndex = savedUrls.findIndex(item => (typeof item === 'string' ? item : item.url) === url);
            
            if (existingIndex === -1) {
                // æ–°å¢ç¶²å€ï¼Œè©¢å•è‡ªå®šç¾©åç¨±
                const customName = prompt('è«‹ç‚ºæ­¤ç¶²å€è¨­å®šä¸€å€‹è‡ªå®šç¾©åç¨±ï¼ˆå¯é¸ï¼Œç›´æ¥æŒ‰ç¢ºå®šä½¿ç”¨é è¨­åç¨±ï¼‰ï¼š', `è©¦ç®—è¡¨ ${savedUrls.length + 1}`);
                const urlData = {
                    url: url,
                    name: customName && customName.trim() !== '' ? customName.trim() : `è©¦ç®—è¡¨ ${savedUrls.length + 1}`,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
                
                // æ–°å¢åˆ°æœ€å‰é¢
                savedUrls.unshift(urlData);
                
                // ä¿ç•™æœ€å¤š10ç­†è¨˜éŒ„
                savedUrls = savedUrls.slice(0, 10);
                
                // å„²å­˜åˆ°localStorage
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                
                showStatus('auto-sheets-status', `âœ… ç¶²å€å·²å„²å­˜ç‚ºã€Œ${urlData.name}ã€`, 'success');
            } else {
                // ç¶²å€å·²å­˜åœ¨ï¼Œç§»åˆ°æœ€å‰é¢
                const existingItem = savedUrls.splice(existingIndex, 1)[0];
                savedUrls.unshift(existingItem);
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                
                const itemName = typeof existingItem === 'string' ? 'è©¦ç®—è¡¨' : existingItem.name;
                showStatus('auto-sheets-status', `âœ… ç¶²å€ã€Œ${itemName}ã€å·²ç§»è‡³æœ€ä¸Šæ–¹`, 'success');
            }
            
            // æ›´æ–°ä¸‹æ‹‰é¸å–®
            updateSavedUrlsDropdown();
        }

        function loadSavedUrl() {
            const select = document.getElementById('saved-urls');
            const selectedValue = select.value;
            
            if (selectedValue) {
                document.getElementById('sheets-url').value = selectedValue;
                select.value = ''; // æ¸…ç©ºé¸æ“‡
                
                // è‡ªå‹•è§¸ç™¼å„²å­˜åŠŸèƒ½ï¼Œå°‡é¸å–çš„ç¶²å€ç§»åˆ°æœ€å‰é¢
                saveUrlToHistory();
            }
        }

        function updateSavedUrlsDropdown() {
            const select = document.getElementById('saved-urls');
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            
            // æ¸…ç©ºç¾æœ‰é¸é …ï¼ˆä¿ç•™ç¬¬ä¸€å€‹ç©ºé¸é …ï¼‰
            select.innerHTML = '<option value="">é¸æ“‡æ­·å²ç¶²å€</option>';
            
            // åŠ å…¥å„²å­˜çš„ç¶²å€
            savedUrls.forEach((item, index) => {
                const option = document.createElement('option');
                
                if (typeof item === 'string') {
                    // èˆŠæ ¼å¼ç›¸å®¹æ€§
                    option.value = item;
                    option.textContent = `${index + 1}. ${item.length > 45 ? item.substring(0, 45) + '...' : item}`;
                } else {
                    // æ–°æ ¼å¼ï¼ŒåŒ…å«è‡ªå®šç¾©åç¨±
                    option.value = item.url;
                    option.textContent = `${index + 1}. ${item.name} (${item.dateAdded})`;
                }
                
                select.appendChild(option);
            });
            
            // æ›´æ–°ç®¡ç†åˆ—è¡¨
            updateUrlManagerList();
        }

        function updateUrlManagerList() {
            const container = document.getElementById('url-manager');
            if (!container) return;
            
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            
            if (savedUrls.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">æš«ç„¡å„²å­˜çš„ç¶²å€</div>';
                return;
            }
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            savedUrls.forEach((item, index) => {
                let displayText, fullUrl;
                
                if (typeof item === 'string') {
                    // èˆŠæ ¼å¼ç›¸å®¹æ€§
                    displayText = `${index + 1}. ${item}`;
                    fullUrl = item;
                } else {
                    // æ–°æ ¼å¼ï¼Œé¡¯ç¤ºè‡ªå®šç¾©åç¨±å’Œå„²å­˜æ—¥æœŸ
                    displayText = `${index + 1}. ${item.name} (${item.dateAdded})`;
                    fullUrl = item.url;
                }
                
                html += `
                    <div style="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: #333; border-radius: 5px;">
                        <div style="flex: 1; margin-right: 10px;">
                            <div style="color: #fff; font-weight: bold; margin-bottom: 5px;">
                                ${displayText}
                            </div>
                            <div style="color: #aaa; font-size: 11px; word-break: break-all;">
                                ${fullUrl}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editUrlName(${index})" style="background: #28a745; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">æ”¹å</button>
                            <button onclick="editUrl(${index})" style="background: #007bff; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">ç·¨è¼¯</button>
                            <button onclick="deleteUrl(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">åˆªé™¤</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        function editUrlName(index) {
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            let currentName;
            
            if (typeof item === 'string') {
                currentName = `è©¦ç®—è¡¨ ${index + 1}`;
                // å‡ç´šèˆŠæ ¼å¼åˆ°æ–°æ ¼å¼
                savedUrls[index] = {
                    url: item,
                    name: currentName,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
            } else {
                currentName = item.name;
            }
            
            const newName = prompt('ç·¨è¼¯åç¨±ï¼š', currentName);
            
            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                savedUrls[index].name = newName.trim();
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', 'âœ… åç¨±å·²æ›´æ–°', 'success');
            }
        }

        function editUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const oldUrl = typeof item === 'string' ? item : item.url;
            const newUrl = prompt('ç·¨è¼¯ç¶²å€ï¼š', oldUrl);
            
            if (newUrl && newUrl.trim() !== '' && newUrl.trim() !== oldUrl) {
                if (typeof item === 'string') {
                    // å‡ç´šèˆŠæ ¼å¼åˆ°æ–°æ ¼å¼
                    savedUrls[index] = {
                        url: newUrl.trim(),
                        name: `è©¦ç®—è¡¨ ${index + 1}`,
                        dateAdded: new Date().toLocaleDateString('zh-TW')
                    };
                } else {
                    savedUrls[index].url = newUrl.trim();
                }
                
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', 'âœ… ç¶²å€å·²æ›´æ–°', 'success');
            }
        }

        function deleteUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const itemName = typeof item === 'string' ? 'è©¦ç®—è¡¨' : item.name;
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${itemName}ã€å—ï¼Ÿ`)) {
                savedUrls.splice(index, 1);
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', `âœ… ã€Œ${itemName}ã€å·²åˆªé™¤`, 'success');
            }
        }

        function clearAllUrls() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ­·å²ç¶²å€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                localStorage.removeItem('autoQuoteSavedUrls');
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', 'âœ… æ‰€æœ‰æ­·å²ç¶²å€å·²æ¸…ç©º', 'success');
            }
        }

        function toggleUrlManager() {
            const manager = document.getElementById('url-manager');
            const button = document.getElementById('manage-urls-btn');
            
            if (manager.style.display === 'none' || !manager.style.display) {
                manager.style.display = 'block';
                button.textContent = 'éš±è—æ­·å²ç¶²å€ç®¡ç†';
                updateUrlManagerList();
            } else {
                manager.style.display = 'none';
                button.textContent = 'æ­·å²ç¶²å€';
            }
        }

        // ç¶²å€è¨˜æ†¶åŠŸèƒ½ (èˆŠç‰ˆå·²è¢«æ–°ç‰ˆå–ä»£)




        // æ§åˆ¶æ›´æ–°æ¨¡å¼UIï¼ˆç›®å‰ç„¡éœ€é¡å¤–è¼¸å…¥æ¬„ä½ï¼‰
        function toggleCustomRowInput() {
            // æ‰€æœ‰æ¨¡å¼éƒ½ä¸éœ€è¦é¡å¤–è¼¸å…¥æ¬„ä½
        }

        // é¸æ“‡ç‰¹å®šè¡Œä½œç‚ºå ±åƒ¹å–®ä¾†æº
        function selectRowForQuote(rowIndex) {
            if (!autoQuoteData || !autoQuoteData.rows || rowIndex >= autoQuoteData.rows.length) {
                showStatus('auto-quote-final-status', 'âŒ ç„¡æ•ˆçš„è³‡æ–™è¡Œé¸æ“‡', 'error');
                return;
            }

            showStatus('auto-quote-final-status', `ğŸ”„ æ­£åœ¨ä½¿ç”¨ç¬¬${rowIndex + 1}è¡Œè³‡æ–™ç”Ÿæˆå ±åƒ¹å–®...`, 'success');

            try {
                // ç§»é™¤ä¹‹å‰é¸ä¸­è¡Œçš„é«˜äº®
                document.querySelectorAll('.data-row').forEach(row => {
                    row.style.border = '';
                    row.style.boxShadow = '';
                });

                // é«˜äº®é¸ä¸­çš„è¡Œ
                const selectedRow = document.querySelector(`tr[onclick="selectRowForQuote(${rowIndex})"]`);
                if (selectedRow) {
                    selectedRow.style.border = '2px solid #ffd700';
                    selectedRow.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.3)';
                }

                const selectedRowData = autoQuoteData.rows[rowIndex];
                const headers = autoQuoteData.headers;

                // ç²å–æ‰‹å‹•è¼¸å…¥çš„è³‡æ–™
                const selectedDays = Array.from(document.querySelectorAll('input[name="manual-days"]:checked')).map(cb => cb.value);
                const manualData = {
                    lineName: '',
                    address: '',
                    housingType: '',
                    monthlyFee: document.getElementById('manual-fee').value || '',
                    serviceDays: selectedDays.join('ã€') || '',
                    serviceTime: document.getElementById('manual-time').value || '',
                    floor: document.getElementById('manual-floor').value || '',
                    frequency: document.getElementById('manual-frequency').value || '',
                    trashBags: document.getElementById('manual-trash').value || '',
                    recycleBags: document.getElementById('manual-recycle').value || '',
                    trashVolume: document.getElementById('manual-trash-volume').value || '',
                    recycleVolume: document.getElementById('manual-recycle-volume').value || '',
                    trashMax: document.getElementById('manual-trash-max').value || '',
                    recycleMax: document.getElementById('manual-recycle-max').value || '',
                    specialNotes: document.getElementById('manual-special-notes').value || ''
                };

                const fieldMapping = {};
                let trashData = { bags: '', volume: '' };
                let recycleData = { bags: '', volume: '' };

                // è™•ç†é¸ä¸­è¡Œçš„è³‡æ–™ï¼ˆä½¿ç”¨èˆ‡generateAutoQuoteç›¸åŒçš„é‚è¼¯ï¼‰
                headers.forEach((header, index) => {
                    const lowerHeader = header.toLowerCase();
                    const cellValue = selectedRowData[index];

                    if (lowerHeader.includes('line') || lowerHeader.includes('æš±ç¨±')) {
                        fieldMapping.lineName = cellValue;
                    } else if (lowerHeader.includes('åœ°å€')) {
                        fieldMapping.address = cellValue;
                        if (cellValue && (!manualData.floor || manualData.floor.trim() === '')) {
                            const floorMatch = cellValue.match(/(\d+)[æ¨“F]/);
                            if (floorMatch) {
                                fieldMapping.floor = floorMatch[1];
                                document.getElementById('manual-floor').value = floorMatch[1];
                            }
                        }
                    } else if (lowerHeader.includes('ä½å®…') || lowerHeader.includes('æ€§è³ª')) {
                        fieldMapping.housingType = cellValue;
                    } else if (lowerHeader.includes('æœˆè²»') || lowerHeader.includes('è²»ç”¨')) {
                        fieldMapping.monthlyFee = (manualData.monthlyFee && manualData.monthlyFee.trim() !== '') ? manualData.monthlyFee : cellValue;
                    } else if (lowerHeader.includes('æ˜ŸæœŸ') || lowerHeader.includes('æ”¶å–')) {
                        if (cellValue && cellValue.trim() !== '') {
                            const frequencyMatch = cellValue.match(/(\d+)/);
                            if (frequencyMatch) {
                                fieldMapping.weeklyFrequency = `ä¸€é€±è¶Ÿæ•¸ï¼š${frequencyMatch[1]}è¶Ÿ`;
                            } else {
                                fieldMapping.weeklyFrequency = `ä¸€é€±è¶Ÿæ•¸ï¼š${cellValue}è¶Ÿ`;
                            }
                        }
                        fieldMapping.serviceDays = manualData.serviceDays;
                    } else if (lowerHeader.includes('æ™‚é–“')) {
                        fieldMapping.serviceTime = (manualData.serviceTime && manualData.serviceTime.trim() !== '') ? manualData.serviceTime : cellValue;
                    } else if (lowerHeader.includes('æ¨“å±¤')) {
                        fieldMapping.floor = (manualData.floor && manualData.floor.trim() !== '') ? manualData.floor : ((cellValue && cellValue.trim() !== '') ? cellValue : '0');
                    } else if (lowerHeader.includes('åƒåœ¾')) {
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)åŒ…/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?å…¬å‡)/);
                            if (bagMatch) {
                                trashData.bags = bagMatch[1];
                                if (headerVolumeMatch) {
                                    trashData.volume = headerVolumeMatch[1];
                                }
                            }
                        }
                    } else if (lowerHeader.includes('è³‡æº')) {
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)åŒ…/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?å…¬å‡)/);
                            if (bagMatch) {
                                recycleData.bags = bagMatch[1];
                                if (headerVolumeMatch) {
                                    recycleData.volume = headerVolumeMatch[1];
                                }
                            }
                        }
                    }
                });

                // çµ„åˆåƒåœ¾è¢‹å’Œè³‡æºè¢‹è³‡æ–™
                if (manualData.trashBags || manualData.trashVolume) {
                    if (manualData.trashBags && manualData.trashVolume) {
                        fieldMapping.trashBags = `${manualData.trashBags}åŒ…æ•¸ï¼ˆ${manualData.trashVolume}ï¼‰`;
                    } else if (manualData.trashBags) {
                        fieldMapping.trashBags = `${manualData.trashBags}åŒ…æ•¸ï¼ˆ14å…¬å‡ï¼‰`;
                    } else {
                        fieldMapping.trashBags = `6åŒ…æ•¸ï¼ˆ${manualData.trashVolume}ï¼‰`;
                    }
                } else if (trashData.bags && trashData.volume) {
                    fieldMapping.trashBags = `${trashData.bags}åŒ…ï¼ˆ${trashData.volume}ï¼‰`;
                } else if (trashData.bags) {
                    fieldMapping.trashBags = `${trashData.bags}åŒ…ï¼ˆ14å…¬å‡ï¼‰`;
                } else {
                    fieldMapping.trashBags = '6åŒ…ï¼ˆ14å…¬å‡ï¼‰';
                }

                if (manualData.recycleBags || manualData.recycleVolume) {
                    if (manualData.recycleBags && manualData.recycleVolume) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}åŒ…æ•¸ï¼ˆ${manualData.recycleVolume}ï¼‰`;
                    } else if (manualData.recycleBags) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}åŒ…æ•¸ï¼ˆ14å…¬å‡ï¼‰`;
                    } else {
                        fieldMapping.recycleBags = `3åŒ…æ•¸ï¼ˆ${manualData.recycleVolume}ï¼‰`;
                    }
                } else if (recycleData.bags && recycleData.volume) {
                    fieldMapping.recycleBags = `${recycleData.bags}åŒ…ï¼ˆ${recycleData.volume}ï¼‰`;
                } else if (recycleData.bags) {
                    fieldMapping.recycleBags = `${recycleData.bags}åŒ…ï¼ˆ14å…¬å‡ï¼‰`;
                } else {
                    fieldMapping.recycleBags = '3åŒ…ï¼ˆ14å…¬å‡ï¼‰';
                }

                console.log(`Selected row ${rowIndex + 1} field mapping:`, fieldMapping);

                const quote = generateQuoteFromData(fieldMapping);
                document.getElementById('auto-quote-result-display').textContent = quote;
                document.getElementById('auto-quote-output').style.display = 'block';

                showStatus('auto-quote-final-status', `âœ… å·²ä½¿ç”¨ç¬¬${rowIndex + 1}è¡Œè³‡æ–™ç”Ÿæˆå ±åƒ¹å–®ï¼`, 'success');

            } catch (error) {
                showStatus('auto-quote-final-status', `âŒ ç”Ÿæˆå¤±æ•—: ${error.message}`, 'error');
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–ç¶²å€ä¸‹æ‹‰é¸å–®
        document.addEventListener('DOMContentLoaded', function() {
            updateSingleQuoteSavedUrlsDropdown();
            updateSavedUrlsDropdown();
            showTab('auto-quote'); // Initialize first tab as active
            loadVendorData(); // è¼‰å…¥å¤–éƒ¨åƒ¹æ ¼è³‡æ–™
        });

        // ========== å¤–éƒ¨åƒ¹æ ¼ç®¡ç†åŠŸèƒ½ ==========
        
        // å¤–éƒ¨åƒ¹æ ¼è³‡æ–™
        const defaultVendorData = [
            // æˆ‘ä¾†ç§‘æŠ€
            {
                vendorName: "æˆ‘ä¾†ç§‘æŠ€",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "1",
                otherVolume: "22X2",
                ourConvert14: "25X1+25X1",
                ourConvert25: "14X2+14X2",
                originalPrice: "480",
                discount1m: "470",
                discount3m: "",
                discount6m: "",
                vendorUrl: "https://www.wecometechnology.com"
            },
            {
                vendorName: "æˆ‘ä¾†ç§‘æŠ€",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "2",
                otherVolume: "22X4",
                ourConvert14: "25X2+25X2",
                ourConvert25: "14X4+14X4",
                originalPrice: "980",
                discount1m: "960",
                discount3m: "",
                discount6m: "",
                vendorUrl: "https://www.wecometechnology.com"
            },
            {
                vendorName: "æˆ‘ä¾†ç§‘æŠ€",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "22X6",
                ourConvert14: "25X3+25X3",
                ourConvert25: "14X6+14X6",
                originalPrice: "1,480",
                discount1m: "1,450",
                discount3m: "",
                discount6m: "",
                vendorUrl: "https://www.wecometechnology.com"
            },
            // åƒå¯
            {
                vendorName: "åƒå¯",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "1",
                otherVolume: "30X1",
                ourConvert14: "14X1+14X1",
                ourConvert25: "25X1",
                originalPrice: "380",
                discount1m: "ç„¡",
                discount3m: "361",
                discount6m: "342",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "åƒå¯",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "2",
                otherVolume: "30X2",
                ourConvert14: "14X2+14X2",
                ourConvert25: "25X1+25X1",
                originalPrice: "760",
                discount1m: "ç„¡",
                discount3m: "722",
                discount6m: "684",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "åƒå¯",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "30X3",
                ourConvert14: "14X3+14X3",
                ourConvert25: "25X2+25X1",
                originalPrice: "1,140",
                discount1m: "ç„¡",
                discount3m: "1,083",
                discount6m: "1,026",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "åƒå¯",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "4",
                otherVolume: "30X4",
                ourConvert14: "14X4+14X4",
                ourConvert25: "25X2+25X2",
                originalPrice: "1,440",
                discount1m: "ç„¡",
                discount3m: "1,368",
                discount6m: "1,296",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "åƒå¯",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "5",
                otherVolume: "30X5",
                ourConvert14: "14X5+14X5",
                ourConvert25: "25X3+25X2",
                originalPrice: "1,800",
                discount1m: "ç„¡",
                discount3m: "1,710",
                discount6m: "1,620",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "åƒå¯",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "1",
                otherVolume: "60X1",
                ourConvert14: "14X2+14X2",
                ourConvert25: "25X1+25X1",
                originalPrice: "560",
                discount1m: "ç„¡",
                discount3m: "532",
                discount6m: "504"
            },
            {
                vendorName: "åƒå¯",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "2",
                otherVolume: "60X2",
                ourConvert14: "14X4+14X4",
                ourConvert25: "25X2+25X2",
                originalPrice: "1,120",
                discount1m: "ç„¡",
                discount3m: "1,064",
                discount6m: "1,008"
            },
            {
                vendorName: "åƒå¯",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "60X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X4+25X2",
                originalPrice: "1,680",
                discount1m: "ç„¡",
                discount3m: "1,596",
                discount6m: "1,512"
            },
            {
                vendorName: "åƒå¯",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "4",
                otherVolume: "60X4",
                ourConvert14: "14X8+14X8",
                ourConvert25: "25X4+25X4",
                originalPrice: "2,160",
                discount1m: "ç„¡",
                discount3m: "2,052",
                discount6m: "1,944"
            },
            {
                vendorName: "åƒå¯",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "5",
                otherVolume: "60X5",
                ourConvert14: "14X10+14X10",
                ourConvert25: "25X6+25X4",
                originalPrice: "2,700",
                discount1m: "ç„¡",
                discount3m: "2,565",
                discount6m: "2,430"
            },
            {
                vendorName: "åƒå¯",
                planName: "å•†å‹™æ–¹æ¡ˆ",
                weeklyFreq: "1",
                otherVolume: "76X1",
                ourConvert14: "33X1+33X1",
                ourConvert25: "25X2+25X1",
                originalPrice: "800",
                discount1m: "ç„¡",
                discount3m: "760",
                discount6m: "720"
            },
            {
                vendorName: "åƒå¯",
                planName: "å•†å‹™æ–¹æ¡ˆ",
                weeklyFreq: "2",
                otherVolume: "76X2",
                ourConvert14: "33X2+33X2",
                ourConvert25: "25X4+25X2",
                originalPrice: "1,600",
                discount1m: "ç„¡",
                discount3m: "1,520",
                discount6m: "1,440"
            },
            {
                vendorName: "åƒå¯",
                planName: "å•†å‹™æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "76X3",
                ourConvert14: "33X3+33X3",
                ourConvert25: "25X6+25X3",
                originalPrice: "2,400",
                discount1m: "ç„¡",
                discount3m: "2,280",
                discount6m: "2,160"
            },
            {
                vendorName: "åƒå¯",
                planName: "å•†å‹™æ–¹æ¡ˆ",
                weeklyFreq: "4",
                otherVolume: "76X4",
                ourConvert14: "33X4+33X4",
                ourConvert25: "25X8+25X4",
                originalPrice: "3,040",
                discount1m: "ç„¡",
                discount3m: "2,888",
                discount6m: "2,736"
            },
            {
                vendorName: "åƒå¯",
                planName: "å•†å‹™æ–¹æ¡ˆ",
                weeklyFreq: "5",
                otherVolume: "76X5",
                ourConvert14: "33X5+33X5",
                ourConvert25: "25X10+25X5",
                originalPrice: "3,800",
                discount1m: "ç„¡",
                discount3m: "3,610",
                discount6m: "3,420"
            },
            {
                vendorName: "åƒå¯",
                planName: "ä¼æ¥­æ–¹æ¡ˆ",
                weeklyFreq: "1",
                otherVolume: "152X1",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "1,080",
                discount1m: "ç„¡",
                discount3m: "1,026",
                discount6m: "972"
            },
            {
                vendorName: "åƒå¯",
                planName: "ä¼æ¥­æ–¹æ¡ˆ",
                weeklyFreq: "2",
                otherVolume: "152X2",
                ourConvert14: "14X12+14X12",
                ourConvert25: "25X6+25X6",
                originalPrice: "2,160",
                discount1m: "ç„¡",
                discount3m: "2,052",
                discount6m: "1,944"
            },
            {
                vendorName: "åƒå¯",
                planName: "ä¼æ¥­æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "152X3",
                ourConvert14: "14X18+14X18",
                ourConvert25: "25X9+25X9",
                originalPrice: "3,240",
                discount1m: "ç„¡",
                discount3m: "3,078",
                discount6m: "2,916"
            },
            {
                vendorName: "åƒå¯",
                planName: "ä¼æ¥­æ–¹æ¡ˆ",
                weeklyFreq: "4",
                otherVolume: "152X4",
                ourConvert14: "14X24+14X24",
                ourConvert25: "25X12+25X12",
                originalPrice: "4,160",
                discount1m: "ç„¡",
                discount3m: "3,952",
                discount6m: "3,744"
            },
            {
                vendorName: "åƒå¯",
                planName: "ä¼æ¥­æ–¹æ¡ˆ",
                weeklyFreq: "5",
                otherVolume: "152X5",
                ourConvert14: "14X30+14X30",
                ourConvert25: "25X15+25X15",
                originalPrice: "5,200",
                discount1m: "ç„¡",
                discount3m: "4,940",
                discount6m: "4,680"
            },
            // ä¿¡ç¾©åƒåœ¾
            {
                vendorName: "ä¿¡ç¾©åƒåœ¾",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "30X3",
                ourConvert14: "14X3+14X3",
                ourConvert25: "25X2+25X1",
                originalPrice: "361",
                discount1m: "ç„¡",
                discount3m: "1,083",
                discount6m: "ç„¡"
            },
            {
                vendorName: "ä¿¡ç¾©åƒåœ¾",
                planName: "å°è³‡æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "30X3",
                ourConvert14: "14X3+14X3",
                ourConvert25: "25X2+25X1",
                originalPrice: "342",
                discount1m: "ç„¡",
                discount3m: "ç„¡",
                discount6m: "2,052"
            },
            {
                vendorName: "ä¿¡ç¾©åƒåœ¾",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "60X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "532",
                discount1m: "ç„¡",
                discount3m: "1,596",
                discount6m: "ç„¡"
            },
            {
                vendorName: "ä¿¡ç¾©åƒåœ¾",
                planName: "å®¶åº­æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "60X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "504",
                discount1m: "ç„¡",
                discount3m: "ç„¡",
                discount6m: "3,024"
            },
            // å¤§å°åŒ—æ”¶åƒåœ¾
            {
                vendorName: "å¤§å°åŒ—æ”¶åƒåœ¾",
                planName: "1æ¬¡æ–¹æ¡ˆ",
                weeklyFreq: "1",
                otherVolume: "25X1+25X1",
                ourConvert14: "14X2+14X2",
                ourConvert25: "25X1+25X1",
                originalPrice: "600",
                discount1m: "ç„¡",
                discount3m: "ç„¡",
                discount6m: "ç„¡"
            },
            {
                vendorName: "å¤§å°åŒ—æ”¶åƒåœ¾",
                planName: "2æ¬¡æ–¹æ¡ˆ",
                weeklyFreq: "2",
                otherVolume: "25X2+25X2",
                ourConvert14: "14X4+14X4",
                ourConvert25: "25X2+25X2",
                originalPrice: "800",
                discount1m: "ç„¡",
                discount3m: "ç„¡",
                discount6m: "ç„¡"
            },
            {
                vendorName: "å¤§å°åŒ—æ”¶åƒåœ¾",
                planName: "3æ¬¡æ–¹æ¡ˆ",
                weeklyFreq: "3",
                otherVolume: "25X3+25X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "1100",
                discount1m: "ç„¡",
                discount3m: "ç„¡",
                discount6m: "ç„¡"
            }
        ];

        // è¼‰å…¥å» å•†è³‡æ–™
        function loadVendorData() {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            // ç¢ºä¿æ‰€æœ‰å» å•†è³‡æ–™éƒ½æœ‰ vendorUrl æ¬„ä½
            vendorData = vendorData.map(vendor => {
                if (!vendor.hasOwnProperty('vendorUrl')) {
                    // æ ¹æ“šå» å•†åç¨±è¨­å®šé è¨­ç¶²å€
                    let defaultUrl = '';
                    switch(vendor.vendorName) {
                        case 'æˆ‘ä¾†ç§‘æŠ€':
                            defaultUrl = 'https://www.wecometechnology.com';
                            break;
                        case 'åƒå¯':
                            defaultUrl = 'https://trashapp.com.tw';
                            break;
                        case 'ä¿¡ç¾©åƒåœ¾':
                            defaultUrl = 'https://xinyi-waste.com.tw';
                            break;
                        case 'å„ªåŠ›':
                            defaultUrl = 'https://youli-service.com';
                            break;
                        case 'å“ˆå›‰æ”¶':
                            defaultUrl = 'https://hellocollect.tw';
                            break;
                        case 'ä»£æ”¶å“¥':
                            defaultUrl = 'https://pickup-bro.com';
                            break;
                        default:
                            defaultUrl = '';
                    }
                    return { ...vendor, vendorUrl: defaultUrl };
                }
                return vendor;
            });
            
            // å„²å­˜æ›´æ–°å¾Œçš„è³‡æ–™
            localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            
            renderVendorTable(vendorData);
        }

        // æ¸²æŸ“å» å•†è¡¨æ ¼
        function renderVendorTable(data) {
            const tbody = document.getElementById('vendor-table-body');
            tbody.innerHTML = '';
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                // è™•ç†å» å•†åç¨±èˆ‡ç¶²å€åˆä½µé¡¯ç¤º
                let vendorNameDisplay = '';
                if (row.vendorUrl && row.vendorUrl.trim() !== '') {
                    vendorNameDisplay = `<a href="${row.vendorUrl}" target="_blank" class="vendor-name-link" onclick="event.stopPropagation();">${row.vendorName} ğŸ”—</a><br><small class="vendor-edit-hint" onclick="makeVendorEditable(this, ${index})">é»æ“Šç·¨è¼¯</small>`;
                } else {
                    vendorNameDisplay = `<span class="vendor-name-no-url">${row.vendorName}</span><br><small class="vendor-edit-hint" onclick="makeVendorEditable(this, ${index})">é»æ“Šæ–°å¢ç¶²å€</small>`;
                }
                
                tr.innerHTML = `
                    <td class="vendor-name-cell">${vendorNameDisplay}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'planName')">${row.planName}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'weeklyFreq')">${row.weeklyFreq}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'otherVolume')">${row.otherVolume}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'ourConvert14')">${row.ourConvert14}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'ourConvert25')">${row.ourConvert25}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'originalPrice')">${row.originalPrice}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'discount1m')">${row.discount1m}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'discount3m')">${row.discount3m}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'discount6m')">${row.discount6m}</td>
                    <td><button class="delete-row-btn" onclick="deleteVendorRow(${index})">ğŸ—‘ï¸ åˆªé™¤</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ä½¿å„²å­˜æ ¼å¯ç·¨è¼¯
        function makeEditable(cell, rowIndex, field) {
            if (cell.querySelector('input')) return; // å·²ç¶“åœ¨ç·¨è¼¯ä¸­
            
            const currentValue = cell.textContent;
            cell.classList.add('editing');
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.style.width = '100%';
            
            // ç•¶å¤±å»ç„¦é»æˆ–æŒ‰ä¸‹ Enter æ™‚ä¿å­˜
            input.onblur = () => saveCell(cell, input, rowIndex, field);
            input.onkeypress = (e) => {
                if (e.key === 'Enter') {
                    saveCell(cell, input, rowIndex, field);
                }
            };
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
        }

        // ä¿å­˜å„²å­˜æ ¼ç·¨è¼¯
        function saveCell(cell, input, rowIndex, field) {
            const newValue = input.value.trim();
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            if (rowIndex < vendorData.length) {
                vendorData[rowIndex][field] = newValue;
                localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            }
            
            cell.classList.remove('editing');
            cell.textContent = newValue;
            cell.onclick = () => makeEditable(cell, rowIndex, field);
            
            showVendorStatus('âœ… è³‡æ–™å·²æ›´æ–°', 'success');
        }

        // ç·¨è¼¯å» å•†åç¨±èˆ‡ç¶²å€
        function makeVendorEditable(element, index) {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            const row = vendorData[index];
            
            const cell = element.parentNode;
            const originalContent = cell.innerHTML;
            
            cell.innerHTML = `
                <div class="vendor-edit-form">
                    <input type="text" class="vendor-edit-input" id="vendorName_${index}" 
                           value="${row.vendorName}" placeholder="å» å•†åç¨±">
                    <input type="url" class="vendor-edit-input" id="vendorUrl_${index}" 
                           value="${row.vendorUrl || ''}" placeholder="å» å•†ç¶²å€ (é¸å¡«)">
                    <div class="vendor-edit-buttons">
                        <button class="vendor-save-btn" onclick="saveVendorEdit(${index})">å„²å­˜</button>
                        <button class="vendor-cancel-btn" onclick="cancelVendorEdit(${index})">å–æ¶ˆ</button>
                    </div>
                </div>
            `;
            
            // å„²å­˜åŸå§‹å…§å®¹ä¾›å–æ¶ˆæ™‚ä½¿ç”¨
            cell.dataset.originalContent = originalContent;
            document.getElementById(`vendorName_${index}`).focus();
        }
        
        // å„²å­˜å» å•†ç·¨è¼¯
        function saveVendorEdit(index) {
            const vendorNameInput = document.getElementById(`vendorName_${index}`);
            const vendorUrlInput = document.getElementById(`vendorUrl_${index}`);
            
            if (!vendorNameInput.value.trim()) {
                alert('è«‹è¼¸å…¥å» å•†åç¨±');
                return;
            }
            
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            vendorData[index].vendorName = vendorNameInput.value.trim();
            vendorData[index].vendorUrl = vendorUrlInput.value.trim();
            
            localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            renderVendorTable(vendorData);
            showVendorStatus('âœ… å» å•†è³‡æ–™å·²æ›´æ–°', 'success');
        }
        
        // å–æ¶ˆå» å•†ç·¨è¼¯
        function cancelVendorEdit(index) {
            const cell = document.querySelector(`#vendor-table-body tr:nth-child(${index + 1}) td:first-child`);
            if (cell && cell.dataset.originalContent) {
                cell.innerHTML = cell.dataset.originalContent;
            }
        }

        // æ–°å¢å» å•†è³‡æ–™åˆ—
        function addVendorRow() {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            const newRow = {
                vendorName: "æ–°å» å•†",
                planName: "æ–°æ–¹æ¡ˆ", 
                weeklyFreq: "1æ¬¡",
                otherVolume: "0L",
                ourConvert14: "0åŒ…",
                ourConvert25: "0åŒ…",
                originalPrice: "0",
                discount1m: "0",
                discount3m: "0", 
                discount6m: "0",
                vendorUrl: ""
            };
            
            vendorData.push(newRow);
            localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            renderVendorTable(vendorData);
            showVendorStatus('âœ… å·²æ–°å¢å» å•†è³‡æ–™', 'success');
        }

        // åˆªé™¤å» å•†è³‡æ–™åˆ—  
        function deleteVendorRow(index) {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            if (index >= 0 && index < vendorData.length) {
                const deletedVendor = vendorData[index].vendorName;
                vendorData.splice(index, 1);
                localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
                renderVendorTable(vendorData);
                showVendorStatus(`âœ… å·²åˆªé™¤ã€Œ${deletedVendor}ã€`, 'success');
            }
        }

        // å„²å­˜æ‰€æœ‰å» å•†è³‡æ–™åˆ° localStorage
        function saveVendorData() {
            const savedData = localStorage.getItem('vendorPricingData');
            if (savedData) {
                showVendorStatus('âœ… è³‡æ–™å·²å„²å­˜åˆ°ç€è¦½å™¨', 'success');
            } else {
                showVendorStatus('âŒ æ²’æœ‰è³‡æ–™éœ€è¦å„²å­˜', 'error');
            }
        }

        // åŒ¯å‡ºå» å•†è³‡æ–™ç‚º Excel æª”æ¡ˆ
        function exportVendorData() {
            const savedData = localStorage.getItem('vendorPricingData');
            const vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            // å‰µå»ºå·¥ä½œè¡¨è³‡æ–™
            const worksheetData = [
                // è¡¨é ­
                ['å» å•†åç¨±', 'æ–¹æ¡ˆåç¨±', 'ä¸€é€±æ¬¡æ•¸', 'å» å•†ç¸½é‡', 'æ›ç®—14å…¬å‡', 'æ›ç®—25å…¬å‡', 'åŸåƒ¹', '1æœˆå„ª', '3æœˆå„ª', '6æœˆå„ª', 'å» å•†ç¶²å€'],
                // è³‡æ–™è¡Œ
                ...vendorData.map(row => [
                    row.vendorName,
                    row.planName,
                    row.weeklyFreq,
                    row.otherVolume,
                    row.ourConvert14,
                    row.ourConvert25,
                    row.originalPrice,
                    row.discount1m,
                    row.discount3m,
                    row.discount6m,
                    row.vendorUrl || ''
                ])
            ];
            
            // å‰µå»ºå·¥ä½œç°¿å’Œå·¥ä½œè¡¨
            const workbook = XLSX.utils.book_new();
            const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
            
            // è¨­å®šæ¬„ä½å¯¬åº¦
            const colWidths = [
                { wch: 15 }, // å» å•†åç¨±
                { wch: 12 }, // æ–¹æ¡ˆåç¨±
                { wch: 8 },  // ä¸€é€±æ¬¡æ•¸
                { wch: 15 }, // å» å•†ç¸½é‡
                { wch: 18 }, // æ›ç®—14å…¬å‡
                { wch: 18 }, // æ›ç®—25å…¬å‡
                { wch: 10 }, // åŸåƒ¹
                { wch: 8 },  // 1æœˆå„ª
                { wch: 8 },  // 3æœˆå„ª
                { wch: 8 },  // 6æœˆå„ª
                { wch: 25 }  // å» å•†ç¶²å€
            ];
            worksheet['!cols'] = colWidths;
            
            // å°‡å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
            XLSX.utils.book_append_sheet(workbook, worksheet, 'å¤–éƒ¨åƒ¹æ ¼');
            
            // åŒ¯å‡ºExcelæª”æ¡ˆ
            const fileName = `å¤–éƒ¨åƒ¹æ ¼è³‡æ–™_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            showVendorStatus('âœ… è³‡æ–™å·²åŒ¯å‡ºç‚º Excel æª”æ¡ˆ', 'success');
        }

        // åŒ¯å…¥ Excel æª”æ¡ˆ
        function importVendorData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // è®€å–Excelæª”æ¡ˆ
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // å–å¾—ç¬¬ä¸€å€‹å·¥ä½œè¡¨
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // è½‰æ›ç‚ºJSONæ ¼å¼
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length < 2) {
                        showVendorStatus('âŒ Excel æª”æ¡ˆå…§å®¹ä¸è¶³', 'error');
                        return;
                    }
                    
                    // å–å¾—è¡¨é ­ (ç¬¬ä¸€è¡Œ)
                    const headers = jsonData[0];
                    const expectedHeaders = ['å» å•†åç¨±', 'æ–¹æ¡ˆåç¨±', 'ä¸€é€±æ¬¡æ•¸', 'å» å•†ç¸½é‡', 'æ›ç®—14å…¬å‡', 'æ›ç®—25å…¬å‡', 'åŸåƒ¹', '1æœˆå„ª', '3æœˆå„ª', '6æœˆå„ª'];
                    
                    // é©—è­‰è¡¨é ­æ ¼å¼
                    const headersMatch = expectedHeaders.every(header => headers.includes(header));
                    if (!headersMatch) {
                        showVendorStatus('âŒ Excel æª”æ¡ˆè¡¨é ­æ ¼å¼ä¸æ­£ç¢º', 'error');
                        return;
                    }
                    
                    // è½‰æ›è³‡æ–™æ ¼å¼
                    const importedData = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length >= 10 && row[0]) { // ç¢ºä¿æœ‰è¶³å¤ çš„æ¬„ä½ä¸”å» å•†åç¨±ä¸ç‚ºç©º
                            importedData.push({
                                vendorName: row[0] || '',
                                planName: row[1] || '',
                                weeklyFreq: row[2] || '',
                                otherVolume: row[3] || '',
                                ourConvert14: row[4] || '',
                                ourConvert25: row[5] || '',
                                originalPrice: row[6] || '',
                                discount1m: row[7] || '',
                                discount3m: row[8] || '',
                                discount6m: row[9] || '',
                                vendorUrl: row[10] || ''
                            });
                        }
                    }
                    
                    if (importedData.length > 0) {
                        localStorage.setItem('vendorPricingData', JSON.stringify(importedData));
                        renderVendorTable(importedData);
                        showVendorStatus(`âœ… æˆåŠŸåŒ¯å…¥ ${importedData.length} ç­†å» å•†è³‡æ–™`, 'success');
                    } else {
                        showVendorStatus('âŒ Excel æª”æ¡ˆç„¡æœ‰æ•ˆè³‡æ–™', 'error');
                    }
                    
                } catch (error) {
                    console.error('Excel import error:', error);
                    showVendorStatus('âŒ Excel æª”æ¡ˆè§£æå¤±æ•—', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            
            // æ¸…ç©º file input
            event.target.value = '';
        }

        // é¡¯ç¤ºå» å•†åŠŸèƒ½ç‹€æ…‹è¨Šæ¯
        function showVendorStatus(message, type) {
            const statusDiv = document.getElementById('vendor-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            
            // 3ç§’å¾Œæ¸…é™¤è¨Šæ¯
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = 'status';
            }, 3000);
        }

        // ========== ç«¶çˆ­å» å•†æ¯”è¼ƒåŠŸèƒ½ ==========
        
        // ç‚ºæ‰‹å‹•å ±åƒ¹ç”Ÿæˆç«¶çˆ­å» å•†æ¯”è¼ƒè¡¨æ ¼
        function generateQuoteVendorComparison(fieldMapping) {
            try {
                // å¾ localStorage ç²å–å» å•†è³‡æ–™ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é è¨­è³‡æ–™
                const savedData = localStorage.getItem('vendorPricingData');
                let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
                
                // å–å¾—å®¢æˆ¶çš„ä¸€é€±æ¬¡æ•¸
                let frequency = 0;
                
                // å¾ fieldMapping è§£æä¸€é€±æ¬¡æ•¸
                if (fieldMapping.weeklyFrequency) {
                    const match = fieldMapping.weeklyFrequency.match(/(\d+)è¶Ÿ/);
                    if (match) {
                        frequency = parseInt(match[1]);
                    }
                }
                
                // å¦‚æœé‚„æ˜¯æ²’æœ‰é »ç‡ï¼Œæ‰ä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„ frequency
                if (frequency === 0) {
                    frequency = parseInt(fieldMapping.frequency) || 0;
                }
                
                console.log('Quote Customer frequency:', frequency);
                
                if (frequency === 0) {
                    document.getElementById('quote-vendor-comparison-table').innerHTML = '<div class="no-comparison">ç„¡æ³•ç¢ºå®šä¸€é€±æ¬¡æ•¸ï¼Œç„¡æ³•é€²è¡Œå» å•†æ¯”è¼ƒ</div>';
                    document.getElementById('quote-vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ç¯©é¸ç›¸åŒä¸€é€±æ¬¡æ•¸çš„å» å•†æ–¹æ¡ˆ
                const matchingPlans = vendorData.filter(vendor => {
                    const vendorFreq = parseInt(vendor.weeklyFreq) || 0;
                    return vendorFreq === frequency;
                });
                
                console.log('Quote Matching plans by frequency:', matchingPlans);
                
                if (matchingPlans.length === 0) {
                    document.getElementById('quote-vendor-comparison-table').innerHTML = '<div class="no-comparison">æ²’æœ‰æ‰¾åˆ°ç›¸åŒä¸€é€±æ¬¡æ•¸çš„ç«¶çˆ­å» å•†æ–¹æ¡ˆ</div>';
                    document.getElementById('quote-vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ç”Ÿæˆæ¯”è¼ƒè¡¨æ ¼ HTML
                let tableHtml = `
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>å» å•†åç¨±</th>
                                <th>æ–¹æ¡ˆåç¨±</th>
                                <th>ä¸€é€±æ¬¡æ•¸</th>
                                <th>åƒåœ¾é‡</th>
                                <th>æ›ç®—14å…¬å‡</th>
                                <th>æ›ç®—25å…¬å‡</th>
                                <th>åŸåƒ¹</th>
                                <th>1æœˆå„ª</th>
                                <th>3æœˆå„ª</th>
                                <th>6æœˆå„ª</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                matchingPlans.forEach(vendor => {
                    tableHtml += `
                        <tr>
                            <td class="vendor-name">${vendor.vendorName}</td>
                            <td>${vendor.planName}</td>
                            <td>${vendor.weeklyFreq}æ¬¡</td>
                            <td>${vendor.otherVolume}</td>
                            <td class="price-cell">${vendor.ourConvert14}åŒ…</td>
                            <td class="price-cell">${vendor.ourConvert25}åŒ…</td>
                            <td class="price-cell">$${vendor.originalPrice}</td>
                            <td class="price-cell">${vendor.discount1m === 'ç„¡' ? 'ç„¡' : '$' + vendor.discount1m}</td>
                            <td class="price-cell">${vendor.discount3m === 'ç„¡' ? 'ç„¡' : '$' + vendor.discount3m}</td>
                            <td class="price-cell">${vendor.discount6m === 'ç„¡' ? 'ç„¡' : '$' + vendor.discount6m}</td>
                        </tr>
                    `;
                });
                
                tableHtml += `
                        </tbody>
                    </table>
                `;
                
                document.getElementById('quote-vendor-comparison-table').innerHTML = tableHtml;
                document.getElementById('quote-vendor-comparison').style.display = 'block';
                
                console.log('Quote vendor comparison generated successfully');
                
            } catch (error) {
                console.error('Error generating quote vendor comparison:', error);
                document.getElementById('quote-vendor-comparison-table').innerHTML = '<div class="no-comparison">è¼‰å…¥ç«¶çˆ­å» å•†è³‡æ–™å¤±æ•—</div>';
                document.getElementById('quote-vendor-comparison').style.display = 'block';
            }
        }
        
        // ç”Ÿæˆç«¶çˆ­å» å•†æ¯”è¼ƒè¡¨æ ¼
        function generateVendorComparison(fieldMapping) {
            try {
                // å¾localStorageç²å–å» å•†è³‡æ–™ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é è¨­è³‡æ–™
                const savedData = localStorage.getItem('vendorPricingData');
                let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
                
                // å–å¾—å®¢æˆ¶çš„ä¸€é€±æ¬¡æ•¸ - å„ªå…ˆä½¿ç”¨Googleè©¦ç®—è¡¨çš„weeklyFrequencyï¼Œå†ä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„frequency
                let frequency = 0;
                
                // å„ªå…ˆå¾weeklyFrequencyè§£æï¼ˆGoogleè©¦ç®—è¡¨è³‡æ–™æ›´æº–ç¢ºï¼‰
                if (fieldMapping.weeklyFrequency) {
                    const match = fieldMapping.weeklyFrequency.match(/(\d+)è¶Ÿ/);
                    if (match) {
                        frequency = parseInt(match[1]);
                    }
                }
                
                // å¦‚æœé‚„æ˜¯æ²’æœ‰é »ç‡ï¼Œæ‰ä½¿ç”¨æ‰‹å‹•è¼¸å…¥çš„frequency
                if (frequency === 0) {
                    frequency = parseInt(fieldMapping.frequency) || 0;
                }
                
                console.log('Customer frequency:', frequency);
                console.log('FieldMapping frequency:', fieldMapping.frequency);
                console.log('FieldMapping weeklyFrequency:', fieldMapping.weeklyFrequency);
                
                if (frequency === 0) {
                    document.getElementById('vendor-comparison-table').innerHTML = '<div class="no-comparison">ç„¡æ³•ç¢ºå®šä¸€é€±æ¬¡æ•¸ï¼Œç„¡æ³•é€²è¡Œå» å•†æ¯”è¼ƒ</div>';
                    document.getElementById('vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ç¯©é¸ç›¸åŒä¸€é€±æ¬¡æ•¸çš„å» å•†æ–¹æ¡ˆ
                const matchingPlans = vendorData.filter(vendor => {
                    const vendorFreq = parseInt(vendor.weeklyFreq) || 0;
                    return vendorFreq === frequency;
                });
                
                console.log('Matching plans by frequency:', matchingPlans);
                
                if (matchingPlans.length === 0) {
                    document.getElementById('vendor-comparison-table').innerHTML = '<div class="no-comparison">æ²’æœ‰æ‰¾åˆ°ç›¸åŒä¸€é€±æ¬¡æ•¸çš„ç«¶çˆ­å» å•†æ–¹æ¡ˆ</div>';
                    document.getElementById('vendor-comparison').style.display = 'block';
                    return;
                }
                
                // å–å¾—å®¢æˆ¶åƒåœ¾é‡è³‡è¨Šé€²è¡Œé€²ä¸€æ­¥ç¯©é¸ï¼ˆå¯é¸ï¼‰
                // é€™è£¡ç°¡åŒ–è™•ç†ï¼Œé¡¯ç¤ºæ‰€æœ‰ç›¸åŒä¸€é€±æ¬¡æ•¸çš„æ–¹æ¡ˆ
                
                // ç”Ÿæˆæ¯”è¼ƒè¡¨æ ¼HTML
                let tableHtml = `
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>å» å•†åç¨±</th>
                                <th>æ–¹æ¡ˆåç¨±</th>
                                <th>ä¸€é€±æ¬¡æ•¸</th>
                                <th>åƒåœ¾é‡</th>
                                <th>æ›ç®—14å…¬å‡</th>
                                <th>æ›ç®—25å…¬å‡</th>
                                <th>åŸåƒ¹</th>
                                <th>1æœˆå„ª</th>
                                <th>3æœˆå„ª</th>
                                <th>6æœˆå„ª</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                matchingPlans.forEach(vendor => {
                    tableHtml += `
                        <tr>
                            <td class="vendor-name">${vendor.vendorName}</td>
                            <td>${vendor.planName}</td>
                            <td>${vendor.weeklyFreq}æ¬¡</td>
                            <td>${vendor.otherVolume}</td>
                            <td class="price-cell">${vendor.ourConvert14}åŒ…</td>
                            <td class="price-cell">${vendor.ourConvert25}åŒ…</td>
                            <td class="price-cell">$${vendor.originalPrice}</td>
                            <td class="price-cell">${vendor.discount1m === 'ç„¡' ? 'ç„¡' : '$' + vendor.discount1m}</td>
                            <td class="price-cell">${vendor.discount3m === 'ç„¡' ? 'ç„¡' : '$' + vendor.discount3m}</td>
                            <td class="price-cell">${vendor.discount6m === 'ç„¡' ? 'ç„¡' : '$' + vendor.discount6m}</td>
                        </tr>
                    `;
                });
                
                tableHtml += `
                        </tbody>
                    </table>
                `;
                
                document.getElementById('vendor-comparison-table').innerHTML = tableHtml;
                document.getElementById('vendor-comparison').style.display = 'block';
                
                console.log('Vendor comparison generated successfully');
                
            } catch (error) {
                console.error('Error generating vendor comparison:', error);
                document.getElementById('vendor-comparison-table').innerHTML = '<div class="no-comparison">è¼‰å…¥ç«¶çˆ­å» å•†è³‡æ–™å¤±æ•—</div>';
                document.getElementById('vendor-comparison').style.display = 'block';
            }
        }

        // Tab switching functionality
        function showTab(tabId, clickedButton = null) {
            // Hide all tab contents
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const allTabButtons = document.querySelectorAll('.tab');
            allTabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button - use event.target if available
            if (!clickedButton && typeof event !== 'undefined' && event.target) {
                clickedButton = event.target;
            }
            if (!clickedButton) {
                clickedButton = document.querySelector(`button[onclick*="${tabId}"]`);
            }
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // ç•¶åˆ‡æ›åˆ°å¤–éƒ¨åƒ¹æ ¼ç®¡ç†é é¢æ™‚ï¼Œè‡ªå‹•è¼‰å…¥ä¸¦é¡¯ç¤ºè³‡æ–™
            if (tabId === 'vendor-pricing') {
                setTimeout(() => {
                    loadVendorData();
                }, 100); // çŸ­æš«å»¶é²ç¢ºä¿DOMå·²æ›´æ–°
            }
        }

        // ========== æœƒå“¡ç™»å…¥åŠŸèƒ½ ==========
        
        // é å®šçš„å¸³è™Ÿå¯†ç¢¼
        const validCredentials = {
            username: 'reco',
            password: '123456'
        };
        
        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            const loginTime = localStorage.getItem('loginTime');
            
            // æª¢æŸ¥æ˜¯å¦è¶…é24å°æ™‚ï¼ˆå¯é¸ï¼‰
            const currentTime = new Date().getTime();
            const loginTimeMs = parseInt(loginTime) || 0;
            const isSessionValid = (currentTime - loginTimeMs) < (24 * 60 * 60 * 1000); // 24å°æ™‚
            
            if (isLoggedIn && isSessionValid) {
                showMainContent();
            } else {
                showLoginForm();
                // æ¸…é™¤éæœŸçš„ç™»å…¥è³‡è¨Š
                if (!isSessionValid) {
                    localStorage.removeItem('userLoggedIn');
                    localStorage.removeItem('loginTime');
                }
            }
        }
        
        // é¡¯ç¤ºç™»å…¥è¡¨å–®
        function showLoginForm() {
            document.getElementById('login-overlay').style.display = 'flex';
            document.getElementById('logout-btn').style.display = 'none';
            // éš±è—ä¸»è¦å…§å®¹
            const container = document.querySelector('.container');
            if (container) container.style.display = 'none';
        }
        
        // é¡¯ç¤ºä¸»è¦å…§å®¹
        function showMainContent() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'block';
            // é¡¯ç¤ºä¸»è¦å…§å®¹
            const container = document.querySelector('.container');
            if (container) container.style.display = 'block';
        }
        
        // ç™»å…¥é©—è­‰
        function login(username, password) {
            if (username === validCredentials.username && password === validCredentials.password) {
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('loginTime', new Date().getTime().toString());
                showMainContent();
                return true;
            }
            return false;
        }
        
        // ç™»å‡º
        function logout() {
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('loginTime');
            showLoginForm();
        }
        
        // ç™»å…¥è¡¨å–®äº‹ä»¶ç›£è´
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æª¢æŸ¥ç™»å…¥ç‹€æ…‹
            checkLoginStatus();
            
            // ç™»å…¥è¡¨å–®æäº¤äº‹ä»¶
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    if (login(username, password)) {
                        document.getElementById('login-error').style.display = 'none';
                        // æ¸…é™¤è¡¨å–®
                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';
                    } else {
                        document.getElementById('login-error').style.display = 'block';
                        // æ¸…é™¤å¯†ç¢¼æ¬„ä½
                        document.getElementById('password').value = '';
                        document.getElementById('password').focus();
                    }
                });
            }
            
            // Enter éµå¿«é€Ÿç™»å…¥
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('login-overlay').style.display === 'flex') {
                    const loginForm = document.getElementById('login-form');
                    if (loginForm) {
                        loginForm.dispatchEvent(new Event('submit'));
                    }
                }
            });
        });
        
    </script>
</body>
</html>
