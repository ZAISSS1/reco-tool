<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÅØËÉΩÊ∞∏Á∫å-Â†±ÂÉπÊ®°ÁµÑ</title>
    <!-- ‰ΩøÁî®Ëá™ÂÆöÁæ©ÂúñÊ®ô - Âº∑Âà∂ÈáçÊñ∞ËºâÂÖ• -->
    <link rel="icon" href="favicon.png?v=6" type="image/png">
    <link rel="shortcut icon" href="favicon.png?v=6" type="image/png">
    <link rel="apple-touch-icon" href="favicon.png?v=6">
    <meta name="theme-color" content="#667eea">
    <!-- SheetJS library for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #2a2a2a;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #404040;
        }

        .header {
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            color: #ffffff;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header-logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        .tabs {
            display: flex;
            background: #1a1a1a;
            border-bottom: 2px solid #404040;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 6px;
            text-align: center;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #a0a0a0;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #2a2a2a;
            color: #ffffff;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover {
            background: #333333;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .info-box {
            background: #2a2a2a;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            color: #e0e0e0;
            border: 1px solid #404040;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #e0e0e0;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #555555;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #333333;
            color: #ffffff;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            width: 60px;
            height: 60px;
            margin: 20px auto;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            transform: translateY(-3px);
        }

        .btn.quote { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.quote:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .btn.monthly { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.monthly:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .btn.single { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.single:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .btn.clean { 
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
            color: #333;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .btn.clean:hover { 
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }



        .output-section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #404040;
        }

        .output-area {
            width: 100%;
            min-height: 300px;
            border: 2px solid #555555;
            border-radius: 8px;
            padding: 15px;
            background: #2a2a2a;
            color: #ffffff;
            font-family: monospace;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }

        .copy-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .copy-btn {
            width: 50px;
            height: 50px;
            margin: 15px auto;
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #333;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
        }

        .status {
            margin-top: 15px;
            text-align: center;
            min-height: 40px;
            padding: 10px;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 5px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #e0e0e0;
            cursor: pointer;
            margin-bottom: 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }

        h4 {
            color: #ffffff;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        small {
            color: #a0a0a0;
            font-size: 12px;
        }

        .mobile-text {
            display: none;
        }

        .desktop-text {
            display: inline;
        }

        .clear-btn-small {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(108, 117, 125, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-btn-small:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }

        /* ÊãñÊõ≥‰∏äÂÇ≥Ê®£Âºè */
        .drop-zone {
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #2a2a2a;
            transition: all 0.3s ease;
            position: relative;
            min-height: 120px;
        }

        .drop-zone:hover, .drop-zone.dragover,
        .drop-zone-inline:hover, .drop-zone-inline.dragover {
            border-color: #4CAF50 !important;
            background: #2f3f2f !important;
        }

        .drop-zone-content {
            pointer-events: none;
        }

        .drop-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .drop-text {
            color: #ccc;
            font-size: 16px;
        }

        /* ÁÖßÁâáÂêà‰ΩµÊåâÈàïÊ®£Âºè */
        .btn-merge {
            background: linear-gradient(135deg, #1565C0, #0D47A1);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(21, 101, 192, 0.3);
        }

        .btn-merge:hover {
            background: linear-gradient(135deg, #0D47A1, #0A3880);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(21, 101, 192, 0.4);
        }

        .btn-clear {
            background: linear-gradient(135deg, #9E9E9E, #757575);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(158, 158, 158, 0.3);
        }

        .btn-clear:hover {
            background: linear-gradient(135deg, #757575, #616161);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(158, 158, 158, 0.4);
        }

        .btn-download {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3);
        }

        .btn-download:hover {
            background: linear-gradient(135deg, #1B5E20, #0F4318);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }



        /* ÁÖßÁâáÈ†êË¶ΩÊ®£Âºè */
        .photo-preview {
            display: inline-block;
            margin: 5px;
            border: 2px solid #444;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .photo-preview img {
            width: 120px;
            height: 90px;
            object-fit: cover;
        }

        .photo-remove {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .merged-photo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .merged-photo-content {
            flex: 1;
            text-align: left;
        }

        .merged-photo-controls {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .merged-photo img {
            max-width: 100%;
            height: auto;
            border: 2px solid #4CAF50;
            border-radius: 8px;
        }

        /* ÁôªÂÖ•ÁïåÈù¢Ê®£Âºè */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-container {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.7);
            border: 1px solid #404040;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .login-title {
            font-size: 28px;
            color: #ffffff;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-input {
            padding: 15px;
            border: 2px solid #555555;
            border-radius: 10px;
            font-size: 16px;
            background: #333333;
            color: #ffffff;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .login-btn {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .login-error {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #e74c3c;
            margin-top: 10px;
            display: none;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        @media (max-width: 768px) {
            /* Êï¥‰ΩìÂ∏ÉÂ±Ä */
            body {
                padding: 5px;
            }
            
            .container {
                margin: 0;
                border-radius: 8px;
            }
            
            /* ÁôªÂΩïÁïåÈù¢ */
            .login-container {
                padding: 25px 15px;
            }
            
            .login-title {
                font-size: 22px;
            }
            
            .logout-btn {
                top: 8px;
                right: 8px;
                padding: 6px 10px;
                font-size: 12px;
            }
            
            /* Â§¥ÈÉ® */
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 18px;
                margin: 0;
            }
            
            /* Ê†áÁ≠æÂØºËà™ - ‰∏§Ë°åÊòæÁ§∫ÔºåÊØèË°å3-4‰∏™ */
            .tabs {
                flex-wrap: wrap;
                gap: 4px;
                padding: 6px;
                position: sticky;
                top: 0;
                z-index: 1001;
            }
            
            .tab {
                flex: 1 1 calc(33.333% - 6px);
                min-width: 90px;
                padding: 10px 6px;
                font-size: 12px;
                border: 1px solid #404040;
                border-radius: 6px;
                white-space: nowrap;
            }
            
            .tab.active {
                border-bottom: 2px solid #667eea;
            }
            
            /* ÂÜÖÂÆπÂå∫Âüü */
            .tab-content {
                padding: 12px;
            }
            
            .section {
                margin-bottom: 15px;
            }
            
            .section h3 {
                font-size: 16px;
                margin-bottom: 8px;
            }
            
            h4 {
                font-size: 15px;
                margin-bottom: 8px;
                padding-bottom: 4px;
            }
            
            .info-box {
                padding: 10px;
                margin-bottom: 12px;
                font-size: 13px;
            }
            
            /* Ë°®ÂçïÂÖÉÁ¥† */
            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-bottom: 12px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            label {
                font-size: 13px;
                margin-bottom: 4px;
            }
            
            input, textarea, select {
                font-size: 16px;
                padding: 10px;
                border-radius: 6px;
            }
            
            textarea {
                min-height: 100px;
            }
            
            /* ÊåâÈíÆ */
            .btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                margin: 12px auto;
            }
            
            .copy-btn {
                padding: 10px 15px;
                font-size: 14px;
                margin: 10px auto;
            }
            
            /* ËæìÂá∫Âå∫Âüü */
            .output-area {
                min-height: 150px;
                padding: 10px;
                font-size: 13px;
                line-height: 1.6;
            }
            
            .output-section {
                padding: 12px;
            }
            
            /* Â§çÈÄâÊ°ÜÁªÑ */
            .checkbox-group {
                gap: 6px;
                margin-top: 5px;
            }
            
            .checkbox-group label {
                font-size: 13px;
                margin-bottom: 4px;
            }
            
            /* Áä∂ÊÄÅ‰ø°ÊÅØ */
            .status {
                padding: 8px;
                margin-top: 8px;
                font-size: 13px;
            }
            
            /* ÊñáÊú¨ÊòæÁ§∫ÂàáÊç¢ */
            .desktop-text {
                display: none;
            }
            
            .mobile-text {
                display: inline;
            }
            
            /* ÁÖßÁâá‰∏ä‰º† */
            .photo-upload-row {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .photo-upload-row #single-drop-zone {
                flex: 1 !important;
                min-width: auto !important;
            }
            
            .photo-upload-row #single-merge-controls {
                flex-direction: row !important;
                justify-content: center;
                gap: 10px !important;
            }
            
            /* Ê∏ÖÈô§ÊåâÈíÆ */
            .clear-btn-small {
                width: 26px;
                height: 26px;
                font-size: 16px;
            }
            
            /* ÊãñÊãΩÂå∫Âüü */
            .drop-zone {
                padding: 15px;
                font-size: 13px;
            }
            
            /* ÁÖßÁâáÁΩëÊ†º */
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)) !important;
                gap: 8px !important;
            }
            
            .photo-item {
                height: 80px !important;
            }
            
            /* ÂêàÂπ∂ÂõæÁâáÂÆπÂô® */
            .merge-photo-container {
                max-width: 100% !important;
            }
            
            .merge-photo-container img {
                max-width: 100% !important;
            }
            
            /* Êï∞ÊçÆË°®Ê†º */
            .data-table {
                font-size: 12px !important;
            }
            
            .data-table th,
            .data-table td {
                padding: 6px 4px !important;
                font-size: 11px !important;
            }
        }

        /* Â§ñÈÉ®ÂÉπÊ†ºË°®Ê†ºÊ®£Âºè */
        .vendor-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #2a2a2a;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #404040;
        }
        
        .vendor-name-cell {
            text-align: left;
            vertical-align: middle;
        }
        
        .vendor-name-link {
            color: #28a745 !important;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-block;
        }
        
        .vendor-name-link:hover {
            color: #20c997 !important;
            text-decoration: underline;
            transform: translateY(-1px);
        }
        
        .vendor-name-no-url {
            color: #ffffff;
            font-weight: 600;
        }
        
        .vendor-edit-hint {
            color: #6c757d;
            font-size: 11px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .vendor-edit-hint:hover {
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }
        
        .vendor-edit-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .vendor-edit-input {
            padding: 6px 8px;
            border: 2px solid #28a745;
            border-radius: 4px;
            background: #333;
            color: #ffffff;
            font-size: 13px;
        }
        
        .vendor-edit-input:focus {
            outline: none;
            border-color: #20c997;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
        }
        
        .vendor-edit-buttons {
            display: flex;
            gap: 5px;
        }
        
        .vendor-save-btn, .vendor-cancel-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .vendor-save-btn {
            background: #28a745;
            color: white;
        }
        
        .vendor-save-btn:hover {
            background: #20c997;
        }
        
        .vendor-cancel-btn {
            background: #6c757d;
            color: white;
        }
        
        .vendor-cancel-btn:hover {
            background: #5a6268;
        }

        .vendor-table th {
            background: linear-gradient(135deg, #333333 0%, #1a1a1a 100%);
            color: #ffffff;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #404040;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .vendor-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #404040;
            background: #2a2a2a;
            color: #e0e0e0;
            position: relative;
        }

        .vendor-table tr:hover td {
            background: #333333;
        }

        .vendor-table td.editable {
            cursor: text;
            transition: all 0.3s ease;
        }

        .vendor-table td.editable:hover {
            background: #404040 !important;
            color: #ffffff;
        }

        .vendor-table td.editing {
            background: #667eea !important;
            color: #ffffff;
        }

        .vendor-table td input {
            width: 100%;
            background: transparent;
            border: none;
            color: #ffffff;
            text-align: center;
            padding: 5px;
            font-size: inherit;
        }

        .vendor-table td input:focus {
            outline: 2px solid #667eea;
            border-radius: 4px;
        }

        .delete-row-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-row-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }

        .vendor-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .vendor-controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: white;
        }

        .vendor-controls .add-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .vendor-controls .add-btn:hover {
            background: linear-gradient(135deg, #218838 0%, #1c7a6b 100%);
            transform: translateY(-2px);
        }

        .vendor-controls .save-btn {
            background: linear-gradient(135deg, #007bff 0%, #667eea 100%);
        }

        .vendor-controls .save-btn:hover {
            background: linear-gradient(135deg, #0056b3 0%, #5a67d8 100%);
            transform: translateY(-2px);
        }

        .vendor-controls .export-btn {
            background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);
        }

        .vendor-controls .export-btn:hover {
            background: linear-gradient(135deg, #5a359a 0%, #d91a72 100%);
            transform: translateY(-2px);
        }

        .vendor-controls .import-btn {
            background: linear-gradient(135deg, #fd7e14 0%, #ffc107 100%);
        }

        .vendor-controls .import-btn:hover {
            background: linear-gradient(135deg, #dc6502 0%, #d39e00 100%);
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #404040;
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .vendor-table {
                font-size: 12px;
            }
            
            .vendor-table th, .vendor-table td {
                padding: 8px 5px;
            }
            
            .vendor-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .vendor-controls button {
                margin-bottom: 10px;
            }
        }

        /* Á´∂Áà≠Âª†ÂïÜÊØîËºÉÊ®£Âºè */
        .vendor-comparison-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #404040;
            margin-top: 10px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: #2a2a2a;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border-bottom: 2px solid #404040;
            font-size: 14px;
        }

        .comparison-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #404040;
            background: #2a2a2a;
            color: #e0e0e0;
            font-size: 13px;
        }

        .comparison-table tr:hover td {
            background: #333333;
        }

        .comparison-table .vendor-name {
            font-weight: 600;
            color: #667eea;
        }

        .comparison-table .price-cell {
            font-weight: 600;
        }

        .no-comparison {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .comparison-table {
                font-size: 11px;
            }
            
            .comparison-table th, .comparison-table td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- ÁôªÂÖ•ÁïåÈù¢ -->
    <div id="login-overlay" class="login-overlay">
        <div class="login-container">
            <div class="login-title" style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                <img src="favicon.png" alt="Logo" style="width: 100px; height: 100px; object-fit: contain;">
                <span>ËÅØËÉΩÊ∞∏Á∫å-Â†±ÂÉπÊ®°ÁµÑ</span>
            </div>
            <form id="login-form" class="login-form">
                <input type="text" id="username" class="login-input" placeholder="Ë´ãËº∏ÂÖ•Â∏≥Ëôü" required>
                <input type="password" id="password" class="login-input" placeholder="Ë´ãËº∏ÂÖ•ÂØÜÁ¢º" required>
                <button type="submit" class="login-btn">ÁôªÂÖ•Á≥ªÁµ±</button>
                <div id="login-error" class="login-error">Â∏≥ËôüÊàñÂØÜÁ¢ºÈåØË™§ÔºåË´ãÂÜçË©¶‰∏ÄÊ¨°</div>
            </form>
        </div>
    </div>
    
    <!-- ÁôªÂá∫ÊåâÈàï -->
    <button id="logout-btn" class="logout-btn" onclick="logout()" style="display: none;">ÁôªÂá∫</button>
    <div class="container">
        <div class="header">
            <h1>
                <img src="favicon.png" alt="Logo" class="header-logo">
                ËÅØËÉΩÊ∞∏Á∫å-Â†±ÂÉπÊ®°ÁµÑ
            </h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('auto-quote')"><span class="desktop-text">ÂåÖÊúàËá™ÂãïÂ†±ÂÉπ</span><span class="mobile-text">Ëá™ÂãïÂ†±ÂÉπ</span></button>
            <button class="tab" onclick="showTab('single-quote')"><span class="desktop-text">ÂñÆË∂üËá™ÂãïÂ†±ÂÉπ</span><span class="mobile-text">ÂñÆË∂üÂ†±ÂÉπ</span></button>
            <button class="tab" onclick="showTab('quote')"><span class="desktop-text">ÂåÖÊúàÊâãÂãïÂ†±ÂÉπ</span><span class="mobile-text">ÂÆ¢Êà∂Â†±ÂÉπ</span></button>
            <button class="tab" onclick="showTab('monthly')"><span class="desktop-text">ÂåÖÊúà‰ªªÂãô</span><span class="mobile-text">ÂåÖÊúà‰ªªÂãô</span></button>
            <button class="tab" onclick="showTab('single')"><span class="desktop-text">ÂñÆË∂ü‰ªªÂãô</span><span class="mobile-text">ÂñÆË∂ü‰ªªÂãô</span></button>
            <button class="tab" onclick="showTab('clean')"><span class="desktop-text">ÂñÆÊ¨°Ê∏ÖÊΩî</span><span class="mobile-text">Ê∏ÖÊΩî‰ªªÂãô</span></button>
            <button class="tab" onclick="showTab('vendor-pricing')"><span class="desktop-text">Â§ñÈÉ®ÂÉπÊ†º</span><span class="mobile-text">Â§ñÈÉ®ÂÉπÊ†º</span></button>
        </div>

        <!-- ÂÆ¢Êà∂ÂñÆ‚ÆïËá™ÂãïÂ†±ÂÉπÂñÆ -->
        <div id="auto-quote" class="tab-content active">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">ÂåÖÊúàËá™ÂãïÂ†±ÂÉπ</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearAutoQuoteForm()" title="Ê∏ÖÁ©∫Ë°®ÂñÆ">√ó</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>üîó GoogleË©¶ÁÆóË°®ÈÄ£Áµê</h4>
                    <div style="display: flex; align-items: flex-end; gap: 10px; margin-bottom: 10px;">
                        <div style="flex: 2;">
                            <label for="sheets-url"></label>
                            <input type="text" id="sheets-url" placeholder="Ë´ãË≤º‰∏äGoogleË©¶ÁÆóË°®ÁöÑÂÖ±‰∫´ÈÄ£Áµê" style="width: 100%;" onchange="saveUrlToHistory()">
                        </div>
                        <div style="flex: 1;">
                            <label for="saved-urls"></label>
                            <select id="saved-urls" onchange="loadSavedUrl()" style="width: 100%;">
                                <option value="">ÈÅ∏ÊìáÊ≠∑Âè≤Á∂≤ÂùÄ</option>
                            </select>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button id="manage-urls-btn" onclick="toggleUrlManager()" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">Ê≠∑Âè≤Á∂≤ÂùÄ</button>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button onclick="clearAllUrls()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">Ê∏ÖÁ©∫ÂÖ®ÈÉ®</button>
                        </div>
                    </div>
                    
                    <div id="url-manager" style="display: none; margin-top: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #404040;">
                        <h5 style="color: #fff; margin-bottom: 15px; text-align: center;">üìù Ê≠∑Âè≤Á∂≤ÂùÄÁÆ°ÁêÜ</h5>
                        <!-- Á∂≤ÂùÄÂàóË°®Â∞áÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>‚öôÔ∏è Ë≥áÊñôËº∏ÂÖ•</h4>
                    <!-- Á¨¨‰∏ÄË°åÔºöÊî∂ÂèñÊòüÊúü„ÄÅÊî∂ÂèñÊôÇÈñì„ÄÅÊ®ìÂ±§„ÄÅÊúàË≤ª„ÄÅË∂üÊï∏ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="manual-days">Êî∂ÂèñÊòüÊúüÔºö</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±‰∏Ä" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∏Ä
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±‰∫å" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∫å
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±‰∏â" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∏â
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±Âõõ" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±Âõõ
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±‰∫î" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∫î
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±ÂÖ≠" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±ÂÖ≠
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="manual-days" value="ÈÄ±Êó•" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±Êó•
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="manual-time">Êî∂ÂèñÊôÇÈñìÔºö</label>
                            <input type="text" id="manual-time" placeholder="0" value="">
                        </div>
                        <div>
                            <label for="manual-floor">Ê®ìÂ±§Ôºö</label>
                            <input type="number" id="manual-floor" placeholder="0" min="-10" max="50" value="">
                        </div>
                        <div>
                            <label for="manual-fee">ÊúàË≤ª(ÂÖÉ)Ôºö</label>
                            <input type="number" id="manual-fee" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-frequency">Ë∂üÊï∏Ôºö</label>
                            <input type="number" id="manual-frequency" placeholder="0" min="1" max="7" value="">
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∫åË°åÔºöÂûÉÂúæÂåÖÊï∏Âà∞ÁâπÊÆäÈúÄÊ±ÇÔºà‰∏ÄË°å7ÂÄãÊ¨Ñ‰ΩçÔºâ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="manual-trash">ÂûÉÂúæÊï∏Ôºö</label>
                            <input type="number" id="manual-trash" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label style="color: #ff4444;">ÂûÉÂúæË¢ãÂÆπÈáèÔºö</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-trash-volume" value="0ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 0ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-trash-volume" value="14ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 14ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-trash-volume" value="25ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 25ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-trash-volume" value="75ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 75ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-trash-volume" value="76ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 76ÂÖ¨Âçá
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="manual-recycle">Ë≥áÊ∫êÊï∏Ôºö</label>
                            <input type="number" id="manual-recycle" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label style="color: #4488ff;">Ë≥áÊ∫êË¢ãÂÆπÈáèÔºö</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-recycle-volume" value="0ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 0ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-recycle-volume" value="14ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 14ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-recycle-volume" value="25ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 25ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-recycle-volume" value="75ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 75ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="manual-recycle-volume" value="76ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 76ÂÖ¨Âçá
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="manual-trash-max" style="color: #ff4444;">ÂñÆÊ¨°Ë¢ãÊï∏Ôºö</label>
                            <input type="number" id="manual-trash-max" placeholder="ÂûÉÂúæ" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-recycle-max" style="color: #4488ff;">ÂñÆÊ¨°Ë¢ãÊï∏Ôºö</label>
                            <input type="number" id="manual-recycle-max" placeholder="Ë≥áÊ∫ê" min="0" value="">
                        </div>
                        <div>
                            <label for="manual-special-notes" style="color: #ffdd44;">ÂÖ∂‰ªñÔºö</label>
                            <input type="text" id="manual-special-notes" placeholder="ÂÖ∂‰ªñ" value="">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>üìä Ë≥áÊñôÂÅµÊ∏¨Ë®≠ÂÆö</h4>
                    <div class="form-row">
                        <div>
                            <label for="update-mode">Êõ¥Êñ∞Ê®°ÂºèÔºö</label>
                            <select id="update-mode" onchange="toggleCustomRowInput()">
                                <option value="latest">ÊúÄÊñ∞‰∏ÄÂàó</option>
                                <option value="all">ÊâÄÊúâË≥áÊñô</option>
                                <option value="last-5">ÊúÄÂæå5Âàó</option>
                                <option value="last-10">ÊúÄÂæå10Âàó</option>
                                <option value="last-20">ÊúÄÂæå20Âàó</option>
                            </select>
                        </div>
                        <div>
                            <label for="sheet-name">Â∑•‰ΩúË°®ÂêçÁ®±Ôºö</label>
                            <input type="text" id="sheet-name" placeholder="‰æãÔºöÂ†±ÂÉπË≥áÊñô" value="Â∑•‰ΩúË°®1">
                        </div>
                        <div>
                            <label for="data-columns">Ë≥áÊñôÊ¨Ñ‰ΩçÔºö</label>
                            <select id="data-columns">
                                <option value="auto">Ëá™ÂãïÂÅµÊ∏¨</option>
                                <option value="A-H">AÂà∞HÊ¨Ñ</option>
                                <option value="A-J">AÂà∞JÊ¨Ñ</option>
                                <option value="A-L">AÂà∞LÊ¨Ñ</option>
                            </select>
                        </div>
                    </div>
                    

                </div>
                
                <div style="display: flex; justify-content: center; margin: 25px 0;">
                    <button onclick="fetchGoogleSheetsData()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" title="ËÆÄÂèñË≥áÊñô">
                        ËÆÄÂèñË≥áÊñô
                    </button>
                </div>
                
                <div id="auto-sheets-status" class="status" style="display: none;"></div>
                
                <div class="form-group" id="auto-detected-data" style="display: none;">
                    <h4>üìã ÁõÆÂâçË≥áÊñô</h4>
                    <div id="detected-data-preview" class="output-area" style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; max-height: 300px; overflow-y: auto;"></div>
                </div>
                
                <div class="form-group" id="auto-quote-controls" style="display: none;">
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="generateAutoQuote()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            Ëá™ÂãïÁîüÊàê
                        </button>
                    </div>
                </div>
                
                <!-- Á´∂Áà≠Âª†ÂïÜÊØîËºÉÂçÄÂ°ä -->
                <div class="output-section" id="vendor-comparison" style="display: none; margin-bottom: 20px;">
                    <h4>üìä Á´∂Áà≠Âª†ÂïÜÊØîËºÉ</h4>
                    <div id="vendor-comparison-table" class="vendor-comparison-container"></div>
                </div>

                <div class="output-section" id="auto-quote-output" style="display: none;">
                    <h4>üìÑ Ëá™ÂãïÁîüÊàêÁöÑÂ†±ÂÉπÂñÆ</h4>
                    <div class="output-area" id="auto-quote-result-display"></div>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="copyAutoQuote()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ‰∏ÄÈçµË§áË£Ω
                        </button>
                    </div>
                    <div class="status" id="auto-quote-copy-status"></div>
                </div>
                
                <div id="auto-quote-final-status" class="status" style="display: none;"></div>
            </div>
        </div>

        <!-- ÂÆ¢Êà∂ÂñÆ‚ÆïÂ†±ÂÉπÂñÆ -->
        <div id="quote" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">ÂåÖÊúàÊâãÂãïÂ†±ÂÉπ</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearQuoteForm()" title="Ê∏ÖÁ©∫Ë°®ÂñÆ">√ó</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>‚öôÔ∏è Ë≥áÊñôËº∏ÂÖ•</h4>
                    <!-- Á¨¨‰∏ÄË°åÔºöÊî∂ÂèñÊòüÊúü„ÄÅÊî∂ÂèñÊôÇÈñì„ÄÅÊ®ìÂ±§„ÄÅÊúàË≤ª„ÄÅË∂üÊï∏ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="service-days">Êî∂ÂèñÊòüÊúüÔºö</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±‰∏Ä" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∏Ä
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±‰∫å" checked style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∫å
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±‰∏â" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∏â
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±Âõõ" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±Âõõ
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±‰∫î" checked style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±‰∫î
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±ÂÖ≠" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±ÂÖ≠
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="checkbox" name="service-days" value="ÈÄ±Êó•" style="width: 14px; height: 14px; margin-right: 4px;"> ÈÄ±Êó•
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="service-time">Êî∂ÂèñÊôÇÈñìÔºö</label>
                            <input type="text" id="service-time" placeholder="0" value="">
                        </div>
                        <div>
                            <label for="floor-level">Ê®ìÂ±§Ôºö</label>
                            <input type="number" id="floor-level" placeholder="0" min="-10" max="50" value="">
                        </div>
                        <div>
                            <label for="monthly-fee">ÊúàË≤ª(ÂÖÉ)Ôºö</label>
                            <input type="number" id="monthly-fee" placeholder="0" min="0" value="">
                        </div>
                        <div>
                            <label for="frequency">Ë∂üÊï∏Ôºö</label>
                            <input type="number" id="frequency" placeholder="0" min="1" max="7" value="">
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∫åË°åÔºöÂûÉÂúæÂåÖÊï∏Âà∞ÁâπÊÆäÈúÄÊ±ÇÔºà‰∏ÄË°å7ÂÄãÊ¨Ñ‰ΩçÔºâ -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="trash-bags">ÂûÉÂúæÊï∏Ôºö</label>
                            <input type="number" id="trash-bags" min="0" placeholder="0">
                        </div>
                        <div>
                            <label style="color: #ff4444;">ÂûÉÂúæË¢ãÂÆπÈáèÔºö</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="trash-volume" value="0ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 0ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="trash-volume" value="14ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 14ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="trash-volume" value="25ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 25ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="trash-volume" value="75ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 75ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="trash-volume" value="76ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 76ÂÖ¨Âçá
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="recycle-bags">Ë≥áÊ∫êÊï∏Ôºö</label>
                            <input type="number" id="recycle-bags" min="0" placeholder="0">
                        </div>
                        <div>
                            <label style="color: #4488ff;">Ë≥áÊ∫êË¢ãÂÆπÈáèÔºö</label>
                            <div style="margin-top: 8px; display: flex; gap: 6px; flex-wrap: nowrap;">
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="recycle-volume" value="0ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 0ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="recycle-volume" value="14ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 14ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="recycle-volume" value="25ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 25ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="recycle-volume" value="75ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 75ÂÖ¨Âçá
                                </label>
                                <label style="display: flex; align-items: center; font-size: 13px; color: #e0e0e0; cursor: pointer; margin-bottom: 0; white-space: nowrap;">
                                    <input type="radio" name="recycle-volume" value="76ÂÖ¨Âçá" style="width: 14px; height: 14px; margin-right: 4px;"> 76ÂÖ¨Âçá
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="trash-max" style="color: #ff4444;">ÂñÆÊ¨°Ë¢ãÊï∏Ôºö</label>
                            <input type="number" id="trash-max" min="0" placeholder="ÂûÉÂúæ">
                        </div>
                        <div>
                            <label for="recycle-max" style="color: #4488ff;">ÂñÆÊ¨°Ë¢ãÊï∏Ôºö</label>
                            <input type="number" id="recycle-max" min="0" placeholder="Ë≥áÊ∫ê">
                        </div>
                        <div>
                            <label for="special-notes" style="color: #ffdd44;">ÂÖ∂‰ªñÔºö</label>
                            <input type="text" id="special-notes" placeholder="ÂÖ∂‰ªñ">
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: center; margin: 25px 0;">
                        <button onclick="generateQuote()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ÁîüÊàêÂ†±ÂÉπ
                        </button>
                    </div>
                </div>
                
                <!-- Á´∂Áà≠Âª†ÂïÜÊØîËºÉÂçÄÂ°ä -->
                <div class="output-section" id="quote-vendor-comparison" style="display: none; margin-bottom: 20px;">
                    <h4>üìä Á´∂Áà≠Âª†ÂïÜÊØîËºÉ</h4>
                    <div id="quote-vendor-comparison-table" class="vendor-comparison-container"></div>
                </div>

                <div class="output-section" id="quote-output" style="display: none;">
                    <h4>üìã ÁîüÊàêÁöÑÂ†±ÂÉπÂñÆ</h4>
                    <div class="output-area" id="quote-result"></div>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="copyToClipboard('quote-result')" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ‰∏ÄÈçµË§áË£Ω
                        </button>
                    </div>
                    <div class="status" id="quote-status"></div>
                </div>
            </div>
        </div>

        <!-- ÂÆ¢Êà∂ÂñÆ‚ÆïÂñÆË∂üÂ†±ÂÉπÂñÆ -->
        <div id="single-quote" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">ÂñÆË∂üËá™ÂãïÂ†±ÂÉπ</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearSingleQuoteForm()" title="Ê∏ÖÁ©∫Ë°®ÂñÆ">√ó</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>üîó GoogleË©¶ÁÆóË°®ÈÄ£Áµê</h4>
                    <div style="display: flex; align-items: flex-end; gap: 10px; margin-bottom: 10px;">
                        <div style="flex: 2;">
                            <label for="single-quote-sheets-url"></label>
                            <input type="text" id="single-quote-sheets-url" placeholder="Ë´ãË≤º‰∏äGoogleË©¶ÁÆóË°®ÁöÑÂÖ±‰∫´ÈÄ£Áµê" style="width: 100%;" onchange="saveSingleQuoteUrlToHistory()">
                        </div>
                        <div style="flex: 1;">
                            <label for="single-quote-saved-urls"></label>
                            <select id="single-quote-saved-urls" onchange="loadSingleQuoteSavedUrl()" style="width: 100%;">
                                <option value="">ÈÅ∏ÊìáÊ≠∑Âè≤Á∂≤ÂùÄ</option>
                            </select>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button id="single-quote-manage-urls-btn" onclick="toggleSingleQuoteUrlManager()" style="background: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">Ê≠∑Âè≤Á∂≤ÂùÄ</button>
                        </div>
                        <div style="flex: 0 0 auto;">
                            <button onclick="clearAllSingleQuoteUrls()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">Ê∏ÖÁ©∫ÂÖ®ÈÉ®</button>
                        </div>
                    </div>
                    
                    <div id="single-quote-url-manager" style="display: none; margin-top: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #404040;">
                        <h5 style="color: #fff; margin-bottom: 15px; text-align: center;">üìù Ê≠∑Âè≤Á∂≤ÂùÄÁÆ°ÁêÜ</h5>
                        <!-- Á∂≤ÂùÄÂàóË°®Â∞áÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>

                <!-- ÁÖßÁâáÈ°ØÁ§∫ÂçÄ -->
                <div class="form-group" id="single-quote-photos-section" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="margin: 0;">üì∑ Ë©¶ÁÆóË°®ÁÖßÁâá</h4>
                        <button id="download-all-photos-btn" onclick="downloadAllPhotos()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px; transition: all 0.3s ease;">
                            <span>üì•</span>
                            <span>‰∏ÄÈçµ‰∏ãËºâÂÖ®ÈÉ®</span>
                        </button>
                    </div>
                    <div id="single-quote-photos-container" style="display: flex; flex-wrap: wrap; gap: 15px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 1px solid #404040; min-height: 100px; justify-content: flex-start;">
                        <!-- ÁÖßÁâáÂ∞áÂãïÊÖãÁîüÊàê -->
                    </div>
                </div>

                <div class="form-group">
                    <h4>‚öôÔ∏è Ë≥áÊñôËº∏ÂÖ•</h4>
                    
                    <!-- Á¨¨‰∏ÄË°åÔºöÊó•Êúü„ÄÅÊôÇÈñì„ÄÅÊúâÁÑ°‰∏äÊ®ì„ÄÅ‰∏ÄÊ®ìË≤ªÁî®„ÄÅ‰∏äÊ®ìË≤ªÁî® -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="single-quote-date">Âü∑Ë°åÊó•ÊúüÔºö</label>
                            <input type="date" id="single-quote-date">
                        </div>
                        <div>
                            <label for="single-quote-time">Âü∑Ë°åÊôÇÈñìÔºö</label>
                            <input type="text" id="single-quote-time" placeholder="‰æãÂ¶ÇÔºö1200-1600ÂâçÂÆåÊàê" value="">
                        </div>
                        <div>
                            <label for="single-quote-upstairs-option">‰∏äÊ®ìÔºö</label>
                            <select id="single-quote-upstairs-option">
                                <option value="" selected>Ë´ãÈÅ∏Êìá</option>
                                <option value="ÈúÄ‰∏äÊ®ì">ÈúÄ‰∏äÊ®ì</option>
                                <option value="‰∏çÁî®‰∏äÊ®ì">‰∏çÁî®‰∏äÊ®ì</option>
                                <option value="ÈõªÊ¢Ø">ÈõªÊ¢Ø</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-quote-ground-fee">‰∏ÄÊ®ì‰ª£Êî∂Ë≤ªÁî®Ôºö</label>
                            <input type="number" id="single-quote-ground-fee" min="0" step="50" placeholder="‰æãÂ¶ÇÔºö300" value="">
                        </div>
                        <div>
                            <label for="single-quote-upstairs-fee">‰∏äÊ®ì‰ª£Êî∂Ë≤ªÁî®Ôºö</label>
                            <input type="number" id="single-quote-upstairs-fee" min="0" step="50" placeholder="‰æãÂ¶ÇÔºö500" value="">
                        </div>
                    </div>

                    
                    <!-- ÂãïÊÖãÁÖßÁâáÊèèËø∞ÂçÄÂüü -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">üóëÔ∏è ÁÖßÁâáÊèèËø∞ÔºàÊúÄÂ§ö15ÂÄãÔºâ</h4>
                            <button id="add-description-btn" onclick="addPhotoDescription()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                ‚ûï Â¢ûÂä†ÊèèËø∞
                            </button>
                        </div>
                        <div id="photo-descriptions-container">
                            <!-- ÊèèËø∞1ÔºàÈ†êË®≠Ôºâ -->
                            <div class="photo-description-item" id="photo-desc-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>üóëÔ∏èÊèèËø∞1Ôºö</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="single-quote-photo1" placeholder="‰æãÂ¶ÇÔºöÂÆ¢Âª≥ÂûÉÂúæË¢ã" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <h4>üìä Ë≥áÊñôÂÅµÊ∏¨Ë®≠ÂÆö</h4>
                    <div class="form-row">
                        <div>
                            <label for="single-quote-update-mode">Êõ¥Êñ∞Ê®°ÂºèÔºö</label>
                            <select id="single-quote-update-mode">
                                <option value="latest">ÊúÄÊñ∞‰∏ÄÂàó</option>
                                <option value="all">ÊâÄÊúâË≥áÊñô</option>
                                <option value="last-5">ÊúÄÂæå5Âàó</option>
                                <option value="last-10">ÊúÄÂæå10Âàó</option>
                                <option value="last-20">ÊúÄÂæå20Âàó</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-quote-sheet-name">Â∑•‰ΩúË°®ÂêçÁ®±Ôºö</label>
                            <input type="text" id="single-quote-sheet-name" placeholder="‰æãÔºöÂ†±ÂÉπË≥áÊñô" value="Â∑•‰ΩúË°®1">
                        </div>
                        <div>
                            <label for="single-quote-data-columns">Ë≥áÊñôÊ¨Ñ‰ΩçÔºö</label>
                            <select id="single-quote-data-columns">
                                <option value="auto">Ëá™ÂãïÂÅµÊ∏¨</option>
                                <option value="A-H">AÂà∞HÊ¨Ñ</option>
                                <option value="A-J">AÂà∞JÊ¨Ñ</option>
                                <option value="A-L">AÂà∞LÊ¨Ñ</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: center; margin: 25px 0;">
                    <button onclick="fetchSingleQuoteGoogleSheetsData()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" title="ËÆÄÂèñË≥áÊñô">
                        ËÆÄÂèñË≥áÊñô
                    </button>
                </div>
                
                <div id="single-quote-sheets-status" class="status" style="display: none;"></div>
                
                <div class="form-group" id="single-quote-detected-data" style="display: none;">
                    <h4>üìã ÁõÆÂâçË≥áÊñô</h4>
                    <div id="single-quote-detected-data-preview" class="output-area" style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; max-height: 300px; overflow-y: auto;"></div>
                </div>
                
                <div class="form-group" id="single-quote-controls" style="display: none;">
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="generateSingleQuote()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            Ëá™ÂãïÁîüÊàê
                        </button>
                    </div>
                </div>
                
                <div class="output-section" id="single-quote-output" style="display: none;">
                    <h4>üìÑ ÂñÆË∂üÂûÉÂúæ‰ª£Êî∂Â†±ÂÉπÂñÆ</h4>
                    <div class="output-area" id="single-quote-result-display"></div>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="copySingleQuote()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ‰∏ÄÈçµË§áË£Ω
                        </button>
                    </div>
                    <div class="status" id="single-quote-copy-status"></div>
                </div>
                
                <div id="single-quote-final-status" class="status" style="display: none;"></div>
            </div>
        </div>

        <!-- Â†±ÂÉπÂñÆ‚ÆïÂåÖÊúà‰ªªÂãôÂñÆ -->
        <div id="monthly" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">ÂåÖÊúà‰ªªÂãô</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearMonthlyForm()" title="Ê∏ÖÁ©∫Ë°®ÂñÆ">√ó</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>‚öôÔ∏è Ë≥áÊñôËº∏ÂÖ•</h4>
                    
                    <!-- Êô∫ËÉΩËº∏ÂÖ•ÂçÄ -->
                    <div style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="margin: 0; color: #fff;">üéØ Êô∫ËÉΩËº∏ÂÖ•ÔºàËá™ÂãïÂàÜÈ°ûÂú∞ÂùÄ/ÈõªË©±/ÂßìÂêçÔºâ</h5>
                        </div>
                        <textarea id="smart-input" style="width: 100%; height: 80px; padding: 10px; border: 1px solid #555; border-radius: 4px; background: #1a1a1a; color: #e0e0e0; font-size: 14px; resize: vertical; margin-bottom: 10px;"></textarea>
                        <div style="display: flex; justify-content: center;">
                            <button onclick="parseSmartInput()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                üîç Ëá™ÂãïÂàÜÈ°û
                            </button>
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∏ÄË°åÔºöÊó•Êúü„ÄÅÊôÇÈñì„ÄÅÂÉπÊ†º„ÄÅ‰∏äÊ®ì„ÄÅÂú∞ÂùÄ„ÄÅÈõªË©±„ÄÅÂßìÂêç„ÄÅÈë∞Âåô -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="monthly-date">Êó•ÊúüÔºö</label>
                            <input type="date" id="monthly-date">
                        </div>
                        <div>
                            <label for="monthly-time">ÊôÇÈñìÔºö</label>
                            <input type="text" id="monthly-time" placeholder="‰æãÂ¶ÇÔºö0800Âæå" value="">
                        </div>
                        <div>
                            <label for="monthly-fixed-price">ÂÉπÊ†ºÔºö</label>
                            <input type="number" id="monthly-fixed-price" min="0" step="50" placeholder="‰æãÂ¶ÇÔºö300">
                        </div>
                        <div>
                            <label for="monthly-upstairs">‰∏äÊ®ìÔºö</label>
                            <select id="monthly-upstairs">
                                <option value="" selected>Ë´ãÈÅ∏Êìá</option>
                                <option value="ÈúÄ‰∏äÊ®ì">ÈúÄ‰∏äÊ®ì</option>
                                <option value="‰∏çÁî®‰∏äÊ®ì">‰∏çÁî®‰∏äÊ®ì</option>
                                <option value="ÈõªÊ¢Ø">ÈõªÊ¢Ø</option>
                            </select>
                        </div>
                        <div>
                            <label for="monthly-address">Âú∞ÂùÄÔºö</label>
                            <input type="text" id="monthly-address" placeholder="Ë´ãËº∏ÂÖ•ÂÆåÊï¥Âú∞ÂùÄ" value="">
                        </div>
                        <div>
                            <label for="monthly-phone">ÈõªË©±Ôºö</label>
                            <input type="text" id="monthly-phone" placeholder="Ë´ãËº∏ÂÖ•ËÅØÁµ°ÈõªË©±" value="">
                        </div>
                        <div>
                            <label for="monthly-name">ÂßìÂêçÔºö</label>
                            <input type="text" id="monthly-name" placeholder="Ë´ãËº∏ÂÖ•ÂÆ¢Êà∂ÂßìÂêç" value="">
                        </div>
                        <div>
                            <label for="monthly-key">Èë∞ÂåôÔºö</label>
                            <select id="monthly-key">
                                <option value="" selected>Ë´ãÈÅ∏Êìá</option>
                                <option value="ÁÑ°">ÁÑ°</option>
                                <option value="Êúâ">Êúâ</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∫åË°åÔºöÂûÉÂúæ„ÄÅË≥áÊ∫ê„ÄÅÂ∞àÁî®Ë¢ã -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div>
                            <label for="monthly-trash-pickup">ÂûÉÂúæÔºö</label>
                            <input type="number" id="monthly-trash-pickup" min="1" max="100" value="" placeholder="ÂûÉÂúæ‰∏ÄÊ¨°Êî∂ÂèñÂåÖÊï∏">
                        </div>
                        <div>
                            <label for="monthly-recycle-pickup">Ë≥áÊ∫êÔºö</label>
                            <input type="number" id="monthly-recycle-pickup" min="1" max="100" value="" placeholder="Ë≥áÊ∫ê‰∏ÄÊ¨°Êî∂ÂèñÂåÖÊï∏">
                        </div>
                        <div>
                            <label for="monthly-bag">Â∞àÁî®Ë¢ãÔºö</label>
                            <select id="monthly-bag">
                                <option value="" selected>Ë´ãÈÅ∏Êìá</option>
                                <option value="Êúâ">Êúâ</option>
                                <option value="ÁÑ°">ÁÑ°</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4>üìù Ëº∏ÂÖ•Ë≥áÊñô</h4>
                    <label for="monthly-quote-data">Ë≤º‰∏äÂ†±ÂÉπË≥áÊñôÔºö</label>
                    <textarea id="monthly-quote-data" placeholder="Ë´ãÂú®Ê≠§Ë≤º‰∏äÂÆåÊï¥ÁöÑÂ†±ÂÉπË≥áÊñô..." style="height: 200px;"></textarea>
                    
                    <div style="display: flex; justify-content: center; margin: 25px 0;">
                        <button onclick="generateMonthlyTask()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ÁîüÊàê‰ªªÂãô
                        </button>
                    </div>
                </div>
                
                <div class="output-section" id="monthly-output" style="display: none;">
                    <h4>üìã ÂåÖÊúà‰ªªÂãôÂñÆ</h4>
                    <div class="copy-buttons">
                        <div>
                            <h5>‰∏ÄËà¨Áâà‰ªªÂãôÂñÆ</h5>
                            <div class="output-area" id="monthly-general"></div>
                            <div style="display: flex; justify-content: center; margin: 20px 0;">
                                <button onclick="copyToClipboard('monthly-general')" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                    ‰∏ÄÈçµË§áË£Ω
                                </button>
                            </div>
                        </div>
                        <div>
                            <h5>ÈôêÂà∂Áâà‰ªªÂãôÂñÆ</h5>
                            <div class="output-area" id="monthly-limited"></div>
                            <div style="display: flex; justify-content: center; margin: 20px 0;">
                                <button onclick="copyToClipboard('monthly-limited')" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                    ‰∏ÄÈçµË§áË£Ω
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="status" id="monthly-status"></div>
                </div>
            </div>
        </div>

        <!-- Â†±ÂÉπÂñÆ‚ÆïÂñÆË∂ü‰ªªÂãôÂñÆ -->
        <div id="single" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">ÂñÆË∂ü‰ªªÂãô</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearSingleForm()" title="Ê∏ÖÁ©∫Ë°®ÂñÆ">√ó</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>‚öôÔ∏è Ë≥áÊñôËº∏ÂÖ•</h4>
                    
                    <!-- Êô∫ËÉΩËº∏ÂÖ•ÂçÄ -->
                    <div style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="margin: 0; color: #fff;">üéØ Êô∫ËÉΩËº∏ÂÖ•ÔºàËá™ÂãïÂàÜÈ°ûÂú∞ÂùÄ/ÈõªË©±/ÂßìÂêçÔºâ</h5>
                        </div>
                        <textarea id="smart-input-single" style="width: 100%; height: 80px; padding: 10px; border: 1px solid #555; border-radius: 4px; background: #1a1a1a; color: #e0e0e0; font-size: 14px; resize: vertical; margin-bottom: 10px;"></textarea>
                        <div style="display: flex; justify-content: center;">
                            <button onclick="parseSmartInputSingle()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                üîç Ëá™ÂãïÂàÜÈ°û
                            </button>
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∏ÄË°åÔºöÊó•ÊúüÂà∞Ë≤ªÁî®ÊâÄÊúâÊ¨Ñ‰Ωç -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="single-date">Êó•ÊúüÔºö</label>
                            <input type="date" id="single-date">
                        </div>
                        <div>
                            <label for="single-time">ÊôÇÈñìÔºö</label>
                            <input type="text" id="single-time" placeholder="‰æãÔºö14:30">
                        </div>
                        <div>
                            <label for="single-phone">ÈõªË©±Ôºö</label>
                            <input type="text" id="single-phone" placeholder="‰æãÔºö0912345678">
                        </div>
                        <div>
                            <label for="single-name">ÂßìÊ∞èÔºö</label>
                            <input type="text" id="single-name" placeholder="‰æãÔºöÈô≥">
                        </div>
                        <div>
                            <label for="single-address">Âú∞ÂùÄÔºö</label>
                            <input type="text" id="single-address" placeholder="‰æãÔºöÂè∞ÂåóÂ∏Ç‰∏≠Â±±ÂçÄÊ∞ëÁîüÊù±Ë∑Ø">
                        </div>
                        <div>
                            <label for="single-upstairs">‰∏äÊ®ìÔºö</label>
                            <select id="single-upstairs">
                                <option value="" selected>Ë´ãÈÅ∏Êìá</option>
                                <option value="ÈúÄ‰∏äÊ®ì">ÈúÄ‰∏äÊ®ì</option>
                                <option value="‰∏çÁî®‰∏äÊ®ì">‰∏çÁî®‰∏äÊ®ì</option>
                                <option value="ÈõªÊ¢Ø">ÈõªÊ¢Ø</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-customer-bag">Â∞àÁî®Ë¢ãÔºö</label>
                            <select id="single-customer-bag">
                                <option value="ÁÑ°" selected>ÁÑ°</option>
                                <option value="Êúâ">Êúâ</option>
                                <option value="ÈÉ®ÂàÜÊúâ">ÈÉ®ÂàÜÊúâ</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-waste-type">ÂûÉÂúæË≥áÊ∫êÈáèÔºö</label>
                            <select id="single-waste-type" onchange="toggleSingleWasteInput()">
                                <option value="Â¶ÇÂúñ" selected>Â¶ÇÂúñ</option>
                                <option value="ÊâãÂãïÂ°´ÂØ´">ÊâãÂãïÂ°´ÂØ´</option>
                            </select>
                        </div>
                        <div>
                            <label for="single-fee">Ë≤ªÁî®Ôºö</label>
                            <input type="text" id="single-fee" placeholder="‰æãÔºö500">
                        </div>
                    </div>
                    
                    <!-- ÊâãÂãïÂ°´ÂØ´ÂûÉÂúæË≥áÊ∫êÈáèÔºàÊ¢ù‰ª∂È°ØÁ§∫Ôºâ -->
                    <div id="single-waste-manual-div" style="display: none; margin-top: 15px;">
                        <label for="single-waste-manual">ÊâãÂãïÂ°´ÂØ´ÂûÉÂúæË≥áÊ∫êÈáèÔºö</label>
                        <input type="text" id="single-waste-manual" placeholder="Ë´ãË©≥Á¥∞ÊèèËø∞ÂûÉÂúæË≥áÊ∫êÈáè" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                    
                    <!-- ÂãïÊÖãÂÖ∂‰ªñË™™ÊòéÂçÄÂüü -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">üìù ÂÖ∂‰ªñË™™Êòé</h4>
                            <button id="add-single-note-btn" onclick="addSingleNote()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                ‚ûï Â¢ûÂä†Ë™™Êòé
                            </button>
                        </div>
                        <div id="single-notes-container">
                            <!-- Ë™™Êòé1ÔºàÈ†êË®≠Ôºâ -->
                            <div class="single-note-item" id="single-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>Ë™™Êòé1Ôºö</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="single-other1" placeholder="‰æãÔºöÂõûÂ†±Ë∑ØÊÆµ" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h4>üì∑ ÁÖßÁâá‰∏äÂÇ≥</h4>
                    
                    <!-- ÁÖßÁâáÂäüËÉΩ‰∏ÄË°åÂºèÂ∏ÉÂ±Ä -->
                    <div class="photo-upload-row" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: stretch; margin-bottom: 15px; min-height: 110px;">
                        <!-- ÊãñÊõ≥‰∏äÂÇ≥ÂçÄÂüü -->
                        <div id="single-drop-zone" class="drop-zone-inline" style="flex: 0 0 280px; border: 2px dashed #666; border-radius: 8px; padding: 15px; text-align: center; background: #2a2a2a; transition: all 0.3s ease; position: relative; height: 110px; display: flex; align-items: center; justify-content: center;">
                            <div class="drop-zone-content">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">üìÅ</div>
                                <div style="color: #ccc; font-size: 14px;">ÊãñÊõ≥ÁÖßÁâáÊàñÈªûÊìäÈÅ∏Êìá</div>
                                <input type="file" id="single-images" multiple accept="image/png,image/jpg,image/jpeg" style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
                            </div>
                        </div>
                        
                        <!-- ÊéßÂà∂ÊåâÈàïÂçÄÂüü -->
                        <div id="single-merge-controls" style="display: none; flex: 0 0 auto; height: 110px; flex-direction: column; justify-content: center; gap: 8px;">
                            <button type="button" class="btn-merge" onclick="mergeSingleImages()">‚â´</button>
                            <button type="button" class="btn-clear" onclick="clearSingleImages()">√ó</button>
                        </div>
                        
                        <!-- ÁÖßÁâáÈ†êË¶ΩÂçÄÂüü -->
                        <div id="single-image-preview" style="flex: 1; min-width: 180px; min-height: 110px; display: flex; flex-direction: column; justify-content: flex-start;"></div>
                    </div>
                    
                    <!-- Âêà‰ΩµÁÖßÁâáÈ°ØÁ§∫ÂçÄÂüü - ÁßªÂà∞‰∏ãÊñπ -->
                    <div id="single-merged-preview" style="width: 100%; margin-bottom: 15px; display: flex; justify-content: center;"></div>
                    
                    <div style="display: flex; justify-content: center; margin: 25px 0;">
                        <button onclick="generateSingleTask()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ÁîüÊàê‰ªªÂãô
                        </button>
                    </div>
                </div>
                
                <div class="output-section" id="single-output" style="display: none;">
                    <h4>üìã ÂñÆË∂ü‰ªªÂãôÂñÆ</h4>
                    <div class="output-area" id="single-result"></div>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="copyToClipboard('single-result')" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ‰∏ÄÈçµË§áË£Ω
                        </button>
                    </div>
                    <div class="status" id="single-status"></div>
                </div>
            </div>
        </div>

        <!-- Â†±ÂÉπÂñÆ‚ÆïÂñÆÊ¨°Ê∏ÖÊΩî‰ªªÂãôÂñÆ -->
        <div id="clean" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="flex: 1;"></div>
                    <h3 style="margin: 0; text-align: center;">ÂñÆÊ¨°Ê∏ÖÊΩî</h3>
                    <div style="flex: 1; display: flex; justify-content: flex-end;">
                        <button class="clear-btn-small" onclick="clearCleanForm()" title="Ê∏ÖÁ©∫Ë°®ÂñÆ">√ó</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>‚öôÔ∏è Ë≥áÊñôËº∏ÂÖ•</h4>
                    
                    <!-- Êô∫ËÉΩËº∏ÂÖ•ÂçÄ -->
                    <div style="background: #2a2a2a; border: 1px solid #404040; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h5 style="margin: 0; color: #fff;">üéØ Êô∫ËÉΩËº∏ÂÖ•ÔºàËá™ÂãïÂàÜÈ°ûÂú∞ÂùÄ/ÈõªË©±/ÂßìÂêçÔºâ</h5>
                        </div>
                        <textarea id="smart-input-clean" style="width: 100%; height: 80px; padding: 10px; border: 1px solid #555; border-radius: 4px; background: #1a1a1a; color: #e0e0e0; font-size: 14px; resize: vertical; margin-bottom: 10px;"></textarea>
                        <div style="display: flex; justify-content: center;">
                            <button onclick="parseSmartInputClean()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                üîç Ëá™ÂãïÂàÜÈ°û
                            </button>
                        </div>
                    </div>
                    
                    <!-- Á¨¨‰∏ÄË°åÂèÉÊï∏ÔºöÊó•ÊúüÂà∞Ë≤ªÁî® -->
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
                        <div>
                            <label for="clean-date">Êó•ÊúüÔºö</label>
                            <input type="date" id="clean-date">
                        </div>
                        <div>
                            <label for="clean-time">ÊôÇÈñìÔºö</label>
                            <input type="text" id="clean-time" placeholder="‰æãÔºö14:30">
                        </div>
                        <div>
                            <label for="clean-phone">ÈõªË©±Ôºö</label>
                            <input type="text" id="clean-phone" placeholder="‰æãÔºö0912345678">
                        </div>
                        <div>
                            <label for="clean-name">ÂßìÊ∞èÔºö</label>
                            <input type="text" id="clean-name" placeholder="‰æãÔºöÈô≥">
                        </div>
                        <div>
                            <label for="clean-address">Âú∞ÂùÄÔºö</label>
                            <input type="text" id="clean-address" placeholder="‰æãÔºöÂè∞ÂåóÂ∏Ç‰∏≠Â±±ÂçÄÊ∞ëÁîüÊù±Ë∑Ø">
                        </div>
                        <div>
                            <label for="clean-upstairs">‰∏äÊ®ìÔºö</label>
                            <select id="clean-upstairs">
                                <option value="" selected>Ë´ãÈÅ∏Êìá</option>
                                <option value="ÈúÄ‰∏äÊ®ì">ÈúÄ‰∏äÊ®ì</option>
                                <option value="‰∏çÁî®‰∏äÊ®ì">‰∏çÁî®‰∏äÊ®ì</option>
                                <option value="ÈõªÊ¢Ø">ÈõªÊ¢Ø</option>
                            </select>
                        </div>
                        <div>
                            <label for="clean-fee">Ë≤ªÁî®Ôºö</label>
                            <input type="text" id="clean-fee" placeholder="‰æãÔºö800">
                        </div>
                    </div>
                    
                    <!-- ÂãïÊÖãÊ∏ÖÊΩîÁØÑÂúçÂçÄÂüü -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">üßπ Ê∏ÖÊΩîÁØÑÂúç</h4>
                            <button id="add-clean-scope-btn" onclick="addCleanScope()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                ‚ûï Â¢ûÂä†È†ÖÁõÆ
                            </button>
                        </div>
                        <div id="clean-scope-container">
                            <!-- È†ÖÁõÆ1ÔºàÈ†êË®≠Ôºâ -->
                            <div class="clean-scope-item" id="clean-scope-item-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>È†ÖÁõÆ1Ôºö</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="clean-scope-1" placeholder="Ê∏ÖÊΩîÈ†ÖÁõÆ 1" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÂãïÊÖãÂÖ∂‰ªñË™™ÊòéÂçÄÂüü -->
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0;">üìù ÂÖ∂‰ªñË™™Êòé</h4>
                            <button id="add-clean-note-btn" onclick="addCleanNote()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                                ‚ûï Â¢ûÂä†Ë™™Êòé
                            </button>
                        </div>
                        <div id="clean-notes-container">
                            <!-- Ë™™Êòé1ÔºàÈ†êË®≠Ôºâ -->
                            <div class="clean-note-item" id="clean-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                                <div style="flex: 0 0 100px;">
                                    <label>Ë™™Êòé1Ôºö</label>
                                </div>
                                <div style="flex: 1;">
                                    <input type="text" id="clean-other1" placeholder="‰æãÔºöÁâπÊÆäÊ∏ÖÊΩîÈúÄÊ±Ç" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h4>üì∑ ÁÖßÁâá‰∏äÂÇ≥</h4>
                    
                    <!-- ÁÖßÁâáÂäüËÉΩ‰∏ÄË°åÂºèÂ∏ÉÂ±Ä -->
                    <div class="photo-upload-row" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: stretch; margin-bottom: 15px; min-height: 110px;">
                        <!-- ÊãñÊõ≥‰∏äÂÇ≥ÂçÄÂüü -->
                        <div id="clean-drop-zone" class="drop-zone-inline" style="flex: 0 0 280px; border: 2px dashed #666; border-radius: 8px; padding: 15px; text-align: center; background: #2a2a2a; transition: all 0.3s ease; position: relative; height: 110px; display: flex; align-items: center; justify-content: center;">
                            <div class="drop-zone-content">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">üìÅ</div>
                                <div style="color: #ccc; font-size: 14px;">ÊãñÊõ≥ÁÖßÁâáÊàñÈªûÊìäÈÅ∏Êìá</div>
                                <input type="file" id="clean-images" multiple accept="image/png,image/jpg,image/jpeg" style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
                            </div>
                        </div>
                        
                        <!-- ÊéßÂà∂ÊåâÈàïÂçÄÂüü -->
                        <div id="clean-merge-controls" style="display: none; flex: 0 0 auto; height: 110px; flex-direction: column; justify-content: center; gap: 8px;">
                            <button type="button" class="btn-merge" onclick="mergeCleanImages()">‚â´</button>
                            <button type="button" class="btn-clear" onclick="clearCleanImages()">√ó</button>
                        </div>
                        
                        <!-- ÁÖßÁâáÈ†êË¶ΩÂçÄÂüü -->
                        <div id="clean-image-preview" style="flex: 1; min-width: 180px; min-height: 110px; display: flex; flex-direction: column; justify-content: flex-start;"></div>
                    </div>
                    
                    <!-- Âêà‰ΩµÁÖßÁâáÈ°ØÁ§∫ÂçÄÂüü - ÁßªÂà∞‰∏ãÊñπ -->
                    <div id="clean-merged-preview" style="width: 100%; margin-bottom: 15px; display: flex; justify-content: center;"></div>
                    
                    <div style="display: flex; justify-content: center; margin: 25px 0;">
                        <button onclick="generateCleanTask()" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ÁîüÊàê‰ªªÂãô
                        </button>
                    </div>
                </div>
                
                <div class="output-section" id="clean-output" style="display: none;">
                    <h4>üìã Ê∏ÖÊΩî‰ªªÂãôÂñÆ</h4>
                    <div class="output-area" id="clean-result"></div>
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <button onclick="copyToClipboard('clean-result')" style="background: white; color: #000; border: none; padding: 12px 30px; font-size: 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            ‰∏ÄÈçµË§áË£Ω
                        </button>
                    </div>
                    <div class="status" id="clean-status"></div>
                </div>
            </div>
        </div>

        <!-- Â§ñÈÉ®ÂÉπÊ†ºÈ†ÅÈù¢ -->
        <div id="vendor-pricing" class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; text-align: center;">Â§ñÈÉ®ÂÉπÊ†ºÁÆ°ÁêÜ</h3>
                </div>
                
                <!-- ÊéßÂà∂ÊåâÈàï -->
                <div class="vendor-controls">
                    <button class="add-btn" onclick="addVendorRow()">‚ûï Êñ∞Â¢ûÂª†ÂïÜ</button>
                    <button class="save-btn" onclick="saveVendorData()">üíæ ÂÑ≤Â≠òË≥áÊñô</button>
                    <button class="export-btn" onclick="exportVendorData()">üì§ ÂåØÂá∫Excel</button>
                    <button class="import-btn" onclick="document.getElementById('import-file').click()">üì• ÂåØÂÖ•Excel</button>
                    <input type="file" id="import-file" class="file-input" accept=".xlsx,.xls" onchange="importVendorData(event)">
                </div>
                
                <!-- Ë≥áÊñôË°®Ê†º -->
                <div class="table-container">
                    <table class="vendor-table" id="vendor-table">
                        <thead>
                            <tr>
                                <th>Âª†ÂïÜÂêçÁ®±</th>
                                <th>ÊñπÊ°àÂêçÁ®±</th>
                                <th>‰∏ÄÈÄ±Ê¨°Êï∏</th>
                                <th>Âª†ÂïÜÁ∏ΩÈáè</th>
                                <th>ÊèõÁÆó14ÂÖ¨Âçá</th>
                                <th>ÊèõÁÆó25ÂÖ¨Âçá</th>
                                <th>ÂéüÂÉπ</th>
                                <th>1ÊúàÂÑ™</th>
                                <th>3ÊúàÂÑ™</th>
                                <th>6ÊúàÂÑ™</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody id="vendor-table-body">
                            <!-- Ë≥áÊñôÂ∞áÈÄöÈÅéJavaScriptÂãïÊÖãÁîüÊàê -->
                        </tbody>
                    </table>
                </div>
                
                <div class="status" id="vendor-status" style="margin-top: 20px;"></div>
            </div>
        </div>

    <script>

        // ÂàáÊèõÂñÆË∂ü‰ªªÂãôÂûÉÂúæË≥áÊ∫êÈáèËº∏ÂÖ•ÊñπÂºè
        function toggleSingleWasteInput() {
            const wasteType = document.getElementById('single-waste-type').value;
            const manualDiv = document.getElementById('single-waste-manual-div');
            
            if (wasteType === 'ÊâãÂãïÂ°´ÂØ´') {
                manualDiv.style.display = 'block';
            } else {
                manualDiv.style.display = 'none';
                document.getElementById('single-waste-manual').value = '';
            }
        }

        // Quote generation function
        function generateQuote() {
            // Áç≤ÂèñÊâÄÊúâË°®ÂñÆÊï∏Êìö
            const serviceDaysCheckboxes = document.querySelectorAll('input[name="service-days"]:checked');
            const serviceDays = Array.from(serviceDaysCheckboxes).map(checkbox => checkbox.value);
            const serviceTime = document.getElementById('service-time').value;
            const floorLevel = parseInt(document.getElementById('floor-level').value);
            const trashBags = document.getElementById('trash-bags').value;
            
            // Áç≤ÂèñÂûÉÂúæË¢ãÂÆπÈáèÔºàÂñÆÈÅ∏Ôºâ
            const trashVolumeRadio = document.querySelector('input[name="trash-volume"]:checked');
            const trashVolume = trashVolumeRadio ? trashVolumeRadio.value : '';
            
            const recycleBags = document.getElementById('recycle-bags').value;
            
            // Áç≤ÂèñË≥áÊ∫êË¢ãÂÆπÈáèÔºàÂñÆÈÅ∏Ôºâ
            const recycleVolumeRadio = document.querySelector('input[name="recycle-volume"]:checked');
            const recycleVolume = recycleVolumeRadio ? recycleVolumeRadio.value : '';
            
            const trashMax = document.getElementById('trash-max').value;
            const recycleMax = document.getElementById('recycle-max').value;
            const monthlyFee = document.getElementById('monthly-fee').value;
            const frequency = document.getElementById('frequency').value;
            const specialNotes = document.getElementById('special-notes').value;
            
            // Ê†ºÂºèÂåñÊúçÂãôÊó•Êúü
            const daysText = serviceDays.length > 0 ? serviceDays.join('„ÄÅ') : 'ÂæÖÁ¢∫ÂÆö';
            
            // Ê†ºÂºèÂåñÊôÇÈñì
            let formattedTime = serviceTime;
            if (serviceTime) {
                const timeMatch = serviceTime.match(/(\d{4})/);
                if (timeMatch) {
                    const timeStr = timeMatch[1];
                    const hour = parseInt(timeStr.substring(0, 2));
                    const minute = timeStr.substring(2);
                    if (hour < 12) {
                        formattedTime = `‰∏äÂçà ${hour.toString().padStart(2, '0')}Ôºö${minute}`;
                    } else if (hour < 18) {
                        formattedTime = `‰∏ãÂçà ${hour.toString().padStart(2, '0')}Ôºö${minute}`;
                    } else {
                        formattedTime = `ÊôöÈñì ${hour.toString().padStart(2, '0')}Ôºö${minute}`;
                    }
                }
            }
            
            // Ë®àÁÆóÈÄ±Ë∂üÊï∏ÂíåÊ†ºÂºèÂåñÊó•Êúü - ÂÑ™ÂÖà‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑË∂üÊï∏
            const weeklyTrips = frequency ? parseInt(frequency) : (serviceDays.length || 2);
            const dayMapping = {"ÈÄ±‰∏Ä": "ÈÄ±1", "ÈÄ±‰∫å": "ÈÄ±2", "ÈÄ±‰∏â": "ÈÄ±3", "ÈÄ±Âõõ": "ÈÄ±4", "ÈÄ±‰∫î": "ÈÄ±5", "ÈÄ±ÂÖ≠": "ÈÄ±6", "ÈÄ±Êó•": "ÈÄ±7"};
            const formattedDays = serviceDays.map(day => dayMapping[day] || day).join('+');
            const tripsAndDays = serviceDays.length > 0 ? `${weeklyTrips}Ë∂ü-${formattedDays}` : `${weeklyTrips}Ë∂ü`;
            
            // Ê†ºÂºèÂåñÊ®ìÂ±§
            const floorNumber = floorLevel < 0 ? `Âú∞‰∏ã${Math.abs(floorLevel)}Ê®ì` : `${floorLevel}F`;
            
            // Êî∂ÂèñÊôÇÈñìÊèèËø∞
            let collectionTimeDesc = '';
            if (formattedTime.includes('‰∏äÂçà')) {
                collectionTimeDesc = '‰∏≠ÂçàÂâç';
            } else if (formattedTime.includes('‰∏ãÂçà')) {
                collectionTimeDesc = '‰∏ãÂçàÁµêÊùüÂâç';
            } else if (formattedTime.includes('ÊôöÈñì')) {
                collectionTimeDesc = 'ÂçäÂ§úÂâç';
            } else {
                collectionTimeDesc = '‰∏≠Âçà/‰∏ãÂçà/ÂçäÂ§ú/';
            }
            
            // Èë∞ÂåôÊèêÁ§∫
            const keyNote = floorLevel > 1 ? 'Ôºà‰∏äÊ®ì‰ª£Êî∂ÈúÄÊèê‰æõ1Ê®ìÂ§ßÈñÄÈë∞ÂåôÔºâ' : 
                           floorLevel < 0 ? 'ÔºàÂú∞‰∏ãÂÆ§‰ª£Êî∂ÈúÄÊèê‰æõÂú∞‰∏ãÂÆ§Èë∞ÂåôÔºâ' : '';
            
            const quote = `‚õîÂ†±ÂÉπË≥áÊñô‚õî

‰∏ÄÈÄ±Ë∂üÊï∏Ôºö${tripsAndDays}
   ÁΩÆÊîæÊôÇÈñìÔºö${formattedTime || 'ÔºàÊ∫ñÊôÇÁΩÆÊîæÔºâ'}
   ÁΩÆÊîæÊ®ìÂ±§Ôºö${floorNumber}

Ôºà‚ö†Ô∏èÂûÉÂúæÁï∂Êó•:${collectionTimeDesc} ‰ª£Êî∂ÂÆåÁï¢Ôºâ
Ôºà‚ö†Ô∏èÈÅéÁ®ã‰∏≠Âö¥Á¶ÅÂÇ¨‰øÉÔºâ
Ôºà‚ö†Ô∏èË´ãÊ∫ñÊôÇÁΩÆÊîæ‰ª•ÂÖçÂ§öÊúâÁ≥æÁ¥õÔºâ

 1ÈÄ±ÂûÉÂúæÔºö${trashBags}ÂåÖÊï∏Ôºà${trashVolume}Ôºâ
Ôºà1Ê¨°ÊúÄÂ§öÊî∂Âèñ${trashMax}Ë¢ã--Ë∂ÖÈáèÊãíÊî∂Ôºâ
ÔºàÂûÉÂúæË´ãÁ∂ÅÁ∑ä„ÄÅÂãøÂ§ñÈú≤Ôºâ
ÔºàÂûÉÂúæË¢ãÂ§ñÈÉ®ÂãøÊµÅÊπØÊ±ÅÔºâ
Ôºà‰∏ÄÊ¨°ÊÄßÁ¥ô/Â°ëËÜ†ÂÆπÂô®ÂùáÂûÉÂúæÔºâ


 1ÈÄ±Ë≥áÊ∫ê:${recycleBags}ÂåÖÊï∏Ôºà${recycleVolume}Ôºâ-Áî®‰∏ÄËà¨Â°ëËÜ†Ë¢ã
Ôºà1Ê¨°ÊúÄÂ§öÊî∂Âèñ${recycleMax}Ë¢ã--Ë∂ÖÈáèÊãíÊî∂Ôºâ
ÔºàËã•Êú™Ë£ùË¢ã‰∏ÄÂæãÊãíÊî∂Ôºâ
ÔºàË´ãÂãøÁî®ÈªëËâ≤Ë¢ãÂ≠êË£ùË≥áÊ∫êÔºâ
ÔºàÂÉÖÊî∂ÂØ∂ÁâπÁéªÁíÉÈêµÈãÅÁΩêÔºâ
ÔºàÂÉÖÊî∂‰∏≠Â∞èÁ¥ôÊùøÁÆ±Â£ìÊâÅÊäòÂ•ΩÔºâ
ÔºàÂÉÖÊî∂Êõ∏Êú¨/‰πæÊ∑®Á¥ôÂºµÔºâ

‚ö†Ô∏è‰∏ãÂàóÁâ©ÂìÅË¶ñÁÇ∫ÂûÉÂúæ
Ôºà‰æøÁï∂Áõí/Â°ëËÜ†Ë¢ã/Âê∏ÁÆ°‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàËªüÂ°ëËÜ†Ëìã/Âê∏ÁÆ°‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàÊó©È§êÁõí/Âø´È£≤ÊùØ‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàÊ≥°Ê£â/ÈõûËõãËªüÂ°ëËÜ†Áõí‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàËõãÁ≥ïÁõí/Á∑©Ë°ùÊùêÊñô‚û°Ô∏èÂûÉÂúæÔºâ

‰∏ÄÂÄãÊúàË≤ªÁî®Ôºö${monthlyFee}ÂÖÉ
${keyNote}

-
üìëÈÖçÂêà‰∫ãÈ†Öüìë
‚ñ™ÂûÉÂúæÂãôÂøÖÊâìÂåÖÁ∂ÅÂ•ΩÊîæÁΩÆÈñÄÂè£
‚ñ™Â¶ÇÂõ†ÊîøÁ≠ñËÆäÂãïÈúÄÊîπÊôÇÈñì
‚¨áÔ∏èÂ∞áÊèêÂâçÂëäÁü•ÁÖ©Ë´ãÈÖçÂêà
‚ñ™Ëá™ÂÇôÈõôÂåóÂ∏ÇÊîøÂ∫úÂ∞àÁî®ÂûÉÂúæË¢ã
‚ñ™Êî∂Ê¨æÂæå‰∏çÈÄÄÊ¨æÂÖßÂÆπ‰∏çÊõ¥Êîπ
‚ñ™ÊúâË∂ÖÈáè‰∏ÄÂæãÊãíÊî∂

    ‚á©

üö® ÂÖ∂‰ªñÂïèÈ°å üö®
üìÑË´ãÂÖàÂÆåÊï¥Èñ±ËÆÄÂ†±ÂÉπÂÖßÂÆπÊèêÂá∫
üí¨ÂÆ¢ÊúçËß£Ê±∫‰ªª‰ΩïÂïèÈ°å

    ‚á©

‚≠ïËß£Ê±∫ÂïèÈ°å‚≠ï
‚úîÔ∏è.‰∏äËø∞ÂïèÈ°åÂùáËß£Ê±∫
‚úîÔ∏è.‰∏äËø∞ÂÖßÂÆπËÉΩÈÖçÂêà
ÂõûË¶ÜÂëäÁü•ÊàëÂÄëÔºöÂêåÊÑè‚úÖ+ÈñãÂßãÊó•

    ‚á©

Êî∂Âà∞_ÂêåÊÑè‚úÖ_Âæå
üíßÂÆ¢Êúç‚û°Ô∏èÊèê‰æõÁπ≥Ë≤ªÂñÆ
üíßÂÆ¢Êà∂‚û°Ô∏èÂÆåÊàêÁπ≥Ë≤ª
üíßÂÆ¢Êúç‚û°Ô∏èÈñãÂßã‰ª£Êî∂

‚ö†Ô∏è Ê≥®ÊÑè‰∫ãÈ†Ö ‚ö†Ô∏è
üî¥1ÂàÜÈå¢1ÂàÜÊúçÂãô‰ΩéÂÉπÁÑ°ÂÆâÂÖ®‰øùÈöú
üü†ËøëÊúüÂ§öËµ∑Ê°à‰æãË´ãÂãôÂøÖÁïôÊÑè
üü°Âπ¥ËºïÂ∞àÊ•≠ÂúòÈöä-ÊµÅÁ®ãÁöÜÊúâ SOP
üü¢ÊàêÂì°Âπ≥Âùá 30-35 Ê≠≤ÁöÜÂÖ∑ËâØÊ∞ëË≠â
üîµÈÅéÂπ¥ÂèäÂ§©ÁÅΩ‰∫∫Á¶çÂÅúÊ≠¢‰ª£Êî∂ÁÑ°ÈÄÄÊ¨æ
‚û°Ô∏èÂª∂Ëá≥‰∏ã‰∏ÄÊ¨°ÂèØ‰ª£Êî∂Â∑•‰ΩúÊó•



üåçËß£Ê±∫ÂûÉÂúæ‰∏¶‰∏çÂè™ÊòØÊî∂Ëµ∞
‚ö°ÊàëÂÄëÊîπËÆäÁöÑÊòØÂüéÂ∏ÇÁöÑÈÅãËΩâÈÄüÂ∫¶

${specialNotes ? `ÁâπÊÆäÈúÄÊ±ÇÔºö${specialNotes}` : ''}`;

            // ÁîüÊàêÁ´∂Áà≠Âª†ÂïÜÊØîËºÉ
            const fieldMapping = {
                weeklyFrequency: weeklyTrips + 'Ë∂ü',
                frequency: weeklyTrips
            };
            generateQuoteVendorComparison(fieldMapping);

            document.getElementById('quote-result').textContent = quote;
            document.getElementById('quote-output').style.display = 'block';
            showStatus('quote-status', '‚úÖ Â†±ÂÉπÂñÆÁîüÊàêÂÆåÊàêÔºÅ', 'success');
        }

        // Smart input parsing function for monthly task
        function parseSmartInput() {
            const input = document.getElementById('smart-input').value.trim();
            
            if (!input) {
                alert('Ë´ãËº∏ÂÖ•Ë≥áÊñô');
                return;
            }
            
            let address = '';
            let phone = '';
            let name = '';
            let remainingText = input;
            
            // ÂÖàÂ§ÑÁêÜÂ∏¶Ê†áÁ≠æÁöÑÊ†ºÂºèÔºàÂú∞ÂùÄÔºöxxx ÈõªË©±Ôºöxxx Á≠âÔºâ
            const lines = input.split('\n');
            const processedLines = [];
            
            for (const line of lines) {
                const trimmedLine = line.trim();
                if (!trimmedLine) continue;
                
                // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Ê†áÁ≠æ
                if (trimmedLine.includes('Ôºö') || trimmedLine.includes(':')) {
                    const parts = trimmedLine.split(/[Ôºö:]/);
                    if (parts.length >= 2) {
                        const label = parts[0].trim();
                        const value = parts.slice(1).join(':').trim();
                        
                        if (label.includes('Âú∞ÂùÄ')) {
                            address = value;
                            continue; // Â∑≤Â§ÑÁêÜÔºåË∑≥Ëøá
                        } else if (label.includes('ÈõªË©±') || label.includes('ÁîµËØù')) {
                            phone = value;
                            continue; // Â∑≤Â§ÑÁêÜÔºåË∑≥Ëøá
                        } else if (label.includes('ËÅØÁµ°‰∫∫') || label.includes('ËÅîÁªú‰∫∫') || label.includes('ÂßìÂêç') || label.includes('ÂÆ¢Êà∂')) {
                            name = value;
                            continue; // Â∑≤Â§ÑÁêÜÔºåË∑≥Ëøá
                        }
                    }
                }
                
                // Êú™Â§ÑÁêÜÁöÑË°åÊ∑ªÂä†Âà∞ÂæÖÂ§ÑÁêÜÊñáÊú¨
                processedLines.push(trimmedLine);
            }
            
            // Â¶ÇÊûúËøòÊúâÊú™Â§ÑÁêÜÁöÑÊñáÊú¨ÔºàÁîµËØùÂíåÂßìÂêçÂèØËÉΩÂú®Âêå‰∏ÄË°åÔºâ
            if (processedLines.length > 0) {
                const text = processedLines.join(' ').replace(/\s+/g, ' ').trim();
                
                // 1. ÊèêÂèñÈõªË©±ËôüÁ¢ºÔºàÂ¶ÇÊûúËøòÊ≤°ÊúâÔºâ
                if (!phone) {
                    const phonePatterns = [
                        /09\d{2}[-\s]?\d{3}[-\s]?\d{3}/,  // 09XX-XXX-XXX Êàñ 09XXXXXXXX
                        /09\d{8}/,                        // 09XXXXXXXX
                        /\d{2,4}[-\s]?\d{6,8}/,          // Âõ∫ÂÆöÁîµËØù
                        /\d{10}/                          // 10‰ΩçÊï∞Â≠ó
                    ];
                    
                    for (const pattern of phonePatterns) {
                        const phoneMatch = text.match(pattern);
                        if (phoneMatch) {
                            phone = phoneMatch[0].replace(/\s/g, '');  // ÂéªÈô§Á©∫Ê†º
                            break;
                        }
                    }
                }
                
                // 2. ÊèêÂèñÂßìÂêçÔºàÂ¶ÇÊûúËøòÊ≤°ÊúâÔºå‰ºòÂÖàËØÜÂà´Â∏¶Áß∞Ë∞ìÂíå‰∏â‰∏™Â≠óÁöÑ‰∏≠ÊñáÂßìÂêçÔºâ
                if (!name) {
                    const namePatterns = [
                        { pattern: /([^\d\s]{1,4}(?:ÂÖàÁîü|Â∞èÂßê|Â•≥Â£´))/, withTitle: true },  // Â∏¶Áß∞Ë∞ìÁöÑÂßìÂêçÔºàXÂÖàÁîü„ÄÅXÂ∞èÂßêÔºâ
                        { pattern: /([^\d\s]{3})\s/, withTitle: false },                    // ‰∏â‰∏™Â≠óÁöÑÂßìÂêçÔºàÂêéÈù¢ÊúâÁ©∫Ê†ºÔºâ
                        { pattern: /\s([^\d\s]{3})\s/, withTitle: false },                  // ‰∏â‰∏™Â≠óÁöÑÂßìÂêçÔºàÂâçÂêéÈÉΩÊúâÁ©∫Ê†ºÔºâ
                        { pattern: /([^\d\s]{3})$/, withTitle: false },                     // ‰∏â‰∏™Â≠óÁöÑÂßìÂêçÔºàÂú®Êú´Â∞æÔºâ
                        { pattern: /\s([^\d\s]{2,4})\s*$/, withTitle: false },             // 2-4‰∏™Â≠óÁöÑÂßìÂêçÔºàÂú®Êú´Â∞æÔºâ
                        { pattern: /([^\d\s]{2,4})\s*$/, withTitle: false }                // 2-4‰∏™Â≠óÁöÑÂßìÂêç
                    ];
                    
                    for (const item of namePatterns) {
                        const nameMatch = text.match(item.pattern);
                        if (nameMatch) {
                            name = nameMatch[1].trim();
                            // Â∏¶Áß∞Ë∞ìÁöÑÁõ¥Êé•Êé•ÂèóÔºå‰∏çÂ∏¶Áß∞Ë∞ìÁöÑÈúÄË¶ÅÊ£ÄÊü•ÊòØÂê¶‰∏∫‰∏≠Êñá
                            if (item.withTitle || /^[\u4e00-\u9fa5]{2,4}$/.test(name)) {
                                break;
                            }
                        }
                    }
                }
                
                // 3. ÊèêÂèñÂú∞ÂùÄÔºàÂ¶ÇÊûúËøòÊ≤°ÊúâÔºâ
                if (!address) {
                    let remainingText = text;
                    if (phone) {
                        remainingText = remainingText.replace(phone, '');
                    }
                    if (name) {
                        remainingText = remainingText.replace(name, '');
                    }
                    
                    address = remainingText.replace(/\//g, '').replace(/\s+/g, '').trim();
                    
                    const addressKeywords = ['ÂçÄ', 'Ë∑Ø', 'Ë°ó', 'Â∑∑', 'ÂºÑ', 'Ëôü', 'Ê®ì', 'ÂÆ§', 'Â∏Ç', 'Á∏£', 'ÈÑâ', 'ÈéÆ', 'Êùë'];
                    if (!addressKeywords.some(keyword => address.includes(keyword))) {
                        address = remainingText.trim();
                    }
                }
            }
            
            // Â°´ÂÖÖÂà∞Â∞çÊáâÊ¨Ñ‰Ωç
            if (address) {
                document.getElementById('monthly-address').value = address;
            }
            if (phone) {
                document.getElementById('monthly-phone').value = phone;
            }
            if (name) {
                document.getElementById('monthly-name').value = name;
            }
            
            // 4. Ëá™ÂãïÂà§Êñ∑‰∏äÊ®ìÈÅ∏È†ÖÂíåÈë∞ÂåôÈÅ∏È†Ö
            let upstairsOption = '';
            let keyOption = '';
            if (address) {
                // ÊèêÂèñÊ•ºÂ±ÇÊï∞Â≠ó
                const floorMatch = address.match(/(\d+)Ê®ì|(\d+)F|(\d+)Â±Ç|(\d+)Â±§/);
                
                if (address.includes('ÈõªÊ¢Ø') || address.includes('ÁîµÊ¢Ø')) {
                    upstairsOption = 'ÈõªÊ¢Ø';
                } else if (floorMatch) {
                    const floorNumber = parseInt(floorMatch[1] || floorMatch[2] || floorMatch[3] || floorMatch[4]);
                    
                    // 1Ê•ºÈÄâÊã©"‰∏çÁî®‰∏äÊ®ì"Âíå"ÁÑ°"Èí•ÂåôÔºå2Ê•º‰ª•‰∏äÈÄâÊã©"ÈúÄ‰∏äÊ®ì"Âíå"Êúâ"Èí•Âåô
                    if (floorNumber === 1) {
                        upstairsOption = '‰∏çÁî®‰∏äÊ®ì';
                        keyOption = 'ÁÑ°';
                        document.getElementById('monthly-key').value = 'ÁÑ°';
                    } else if (floorNumber >= 2) {
                        upstairsOption = 'ÈúÄ‰∏äÊ®ì';
                        keyOption = 'Êúâ';
                        document.getElementById('monthly-key').value = 'Êúâ';
                    }
                } else if (address.match(/Âú∞‰∏ã.*Ê®ì/)) {
                    upstairsOption = 'ÈúÄ‰∏äÊ®ì';
                } else {
                    // Ê≤°ÊúâÊ•ºÂ±Ç‰ø°ÊÅØ
                    upstairsOption = '‰∏çÁî®‰∏äÊ®ì';
                    keyOption = 'ÁÑ°';
                    document.getElementById('monthly-key').value = 'ÁÑ°';
                }
                
                document.getElementById('monthly-upstairs').value = upstairsOption;
            }
            
            // È°ØÁ§∫ÁµêÊûúÊèêÁ§∫
            let resultMsg = '‚úÖ Ëá™ÂãïÂàÜÈ°ûÂÆåÊàêÔºö\n';
            if (address) resultMsg += `Âú∞ÂùÄÔºö${address}\n`;
            if (phone) resultMsg += `ÈõªË©±Ôºö${phone}\n`;
            if (name) resultMsg += `ÂßìÂêçÔºö${name}\n`;
            if (upstairsOption) resultMsg += `‰∏äÊ®ìÔºö${upstairsOption}\n`;
            if (keyOption) resultMsg += `Èë∞ÂåôÔºö${keyOption}`;
            
            if (!address && !phone && !name) {
                alert('‚ùå ÁÑ°Ê≥ïË≠òÂà•Ë≥áÊñôÔºåË´ãÊ™¢Êü•Ê†ºÂºè');
            } else {
                alert(resultMsg);
            }
            
            // Ê∏ÖÁ©∫Êô∫ËÉΩËº∏ÂÖ•Ê°Ü
            document.getElementById('smart-input').value = '';
        }

        // Smart input parsing function for single task
        function parseSmartInputSingle() {
            const input = document.getElementById('smart-input-single').value.trim();
            
            if (!input) {
                alert('Ë´ãËº∏ÂÖ•Ë≥áÊñô');
                return;
            }
            
            let address = '';
            let phone = '';
            let name = '';
            
            // ÂÖàÂ§ÑÁêÜÂ∏¶Ê†áÁ≠æÁöÑÊ†ºÂºè
            const lines = input.split('\n');
            const processedLines = [];
            
            for (const line of lines) {
                const trimmedLine = line.trim();
                if (!trimmedLine) continue;
                
                if (trimmedLine.includes('Ôºö') || trimmedLine.includes(':')) {
                    const parts = trimmedLine.split(/[Ôºö:]/);
                    if (parts.length >= 2) {
                        const label = parts[0].trim();
                        const value = parts.slice(1).join(':').trim();
                        
                        if (label.includes('Âú∞ÂùÄ')) {
                            address = value;
                            continue;
                        } else if (label.includes('ÈõªË©±') || label.includes('ÁîµËØù')) {
                            phone = value;
                            continue;
                        } else if (label.includes('ËÅØÁµ°‰∫∫') || label.includes('ËÅîÁªú‰∫∫') || label.includes('ÂßìÂêç') || label.includes('ÂÆ¢Êà∂')) {
                            name = value;
                            continue;
                        }
                    }
                }
                
                processedLines.push(trimmedLine);
            }
            
            // Â§ÑÁêÜÊú™Ê†áËÆ∞ÁöÑÊñáÊú¨
            if (processedLines.length > 0) {
                const text = processedLines.join(' ').replace(/\s+/g, ' ').trim();
                
                if (!phone) {
                    const phonePatterns = [
                        /09\d{2}[-\s]?\d{3}[-\s]?\d{3}/,
                        /09\d{8}/,
                        /\d{2,4}[-\s]?\d{6,8}/,
                        /\d{10}/
                    ];
                    for (const pattern of phonePatterns) {
                        const phoneMatch = text.match(pattern);
                        if (phoneMatch) {
                            phone = phoneMatch[0].replace(/\s/g, '');
                            break;
                        }
                    }
                }
                
                if (!name) {
                    const namePatterns = [
                        { pattern: /([^\d\s]{1,4}(?:ÂÖàÁîü|Â∞èÂßê|Â•≥Â£´))/, withTitle: true },
                        { pattern: /([^\d\s]{3})\s/, withTitle: false },
                        { pattern: /\s([^\d\s]{3})\s/, withTitle: false },
                        { pattern: /([^\d\s]{3})$/, withTitle: false },
                        { pattern: /\s([^\d\s]{2,4})\s*$/, withTitle: false },
                        { pattern: /([^\d\s]{2,4})\s*$/, withTitle: false }
                    ];
                    for (const item of namePatterns) {
                        const nameMatch = text.match(item.pattern);
                        if (nameMatch) {
                            name = nameMatch[1].trim();
                            if (item.withTitle || /^[\u4e00-\u9fa5]{2,4}$/.test(name)) {
                                break;
                            }
                        }
                    }
                }
                
                if (!address) {
                    let remainingText = text;
                    if (phone) remainingText = remainingText.replace(phone, '');
                    if (name) remainingText = remainingText.replace(name, '');
                    address = remainingText.replace(/\//g, '').replace(/\s+/g, '').trim();
                    
                    const addressKeywords = ['ÂçÄ', 'Ë∑Ø', 'Ë°ó', 'Â∑∑', 'ÂºÑ', 'Ëôü', 'Ê®ì', 'ÂÆ§', 'Â∏Ç', 'Á∏£', 'ÈÑâ', 'ÈéÆ', 'Êùë'];
                    if (!addressKeywords.some(keyword => address.includes(keyword))) {
                        address = remainingText.trim();
                    }
                }
            }
            
            // Â°´ÂÖÖÊ¨Ñ‰Ωç
            if (address) document.getElementById('single-address').value = address;
            if (phone) document.getElementById('single-phone').value = phone;
            if (name) document.getElementById('single-name').value = name;
            
            // Ëá™ÂãïÂà§Êñ∑‰∏äÊ®ìÂíåÈë∞Âåô
            let upstairsOption = '';
            let keyOption = '';
            if (address) {
                const floorMatch = address.match(/(\d+)Ê®ì|(\d+)F|(\d+)Â±Ç|(\d+)Â±§/);
                
                if (address.includes('ÈõªÊ¢Ø') || address.includes('ÁîµÊ¢Ø')) {
                    upstairsOption = 'ÈõªÊ¢Ø';
                } else if (floorMatch) {
                    const floorNumber = parseInt(floorMatch[1] || floorMatch[2] || floorMatch[3] || floorMatch[4]);
                    if (floorNumber === 1) {
                        upstairsOption = '‰∏çÁî®‰∏äÊ®ì';
                        keyOption = 'ÁÑ°';
                        document.getElementById('single-key').value = 'ÁÑ°';
                    } else if (floorNumber >= 2) {
                        upstairsOption = 'ÈúÄ‰∏äÊ®ì';
                        keyOption = 'Êúâ';
                        document.getElementById('single-key').value = 'Êúâ';
                    }
                } else if (address.match(/Âú∞‰∏ã.*Ê®ì/)) {
                    upstairsOption = 'ÈúÄ‰∏äÊ®ì';
                } else {
                    upstairsOption = '‰∏çÁî®‰∏äÊ®ì';
                }
                document.getElementById('single-upstairs').value = upstairsOption;
            }
            
            // È°ØÁ§∫ÁµêÊûú
            let resultMsg = '‚úÖ Ëá™ÂãïÂàÜÈ°ûÂÆåÊàêÔºö\n';
            if (address) resultMsg += `Âú∞ÂùÄÔºö${address}\n`;
            if (phone) resultMsg += `ÈõªË©±Ôºö${phone}\n`;
            if (name) resultMsg += `ÂßìÂêçÔºö${name}\n`;
            if (upstairsOption) resultMsg += `‰∏äÊ®ìÔºö${upstairsOption}\n`;
            if (keyOption) resultMsg += `Èë∞ÂåôÔºö${keyOption}`;
            
            if (!address && !phone && !name) {
                alert('‚ùå ÁÑ°Ê≥ïË≠òÂà•Ë≥áÊñôÔºåË´ãÊ™¢Êü•Ê†ºÂºè');
            } else {
                alert(resultMsg);
            }
            
            document.getElementById('smart-input-single').value = '';
        }

        // Smart input parsing function for clean task
        function parseSmartInputClean() {
            const input = document.getElementById('smart-input-clean').value.trim();
            
            if (!input) {
                alert('Ë´ãËº∏ÂÖ•Ë≥áÊñô');
                return;
            }
            
            let address = '';
            let phone = '';
            let name = '';
            
            // ÂÖàÂ§ÑÁêÜÂ∏¶Ê†áÁ≠æÁöÑÊ†ºÂºè
            const lines = input.split('\n');
            const processedLines = [];
            
            for (const line of lines) {
                const trimmedLine = line.trim();
                if (!trimmedLine) continue;
                
                if (trimmedLine.includes('Ôºö') || trimmedLine.includes(':')) {
                    const parts = trimmedLine.split(/[Ôºö:]/);
                    if (parts.length >= 2) {
                        const label = parts[0].trim();
                        const value = parts.slice(1).join(':').trim();
                        
                        if (label.includes('Âú∞ÂùÄ')) {
                            address = value;
                            continue;
                        } else if (label.includes('ÈõªË©±') || label.includes('ÁîµËØù')) {
                            phone = value;
                            continue;
                        } else if (label.includes('ËÅØÁµ°‰∫∫') || label.includes('ËÅîÁªú‰∫∫') || label.includes('ÂßìÂêç') || label.includes('ÂÆ¢Êà∂')) {
                            name = value;
                            continue;
                        }
                    }
                }
                
                processedLines.push(trimmedLine);
            }
            
            // Â§ÑÁêÜÊú™Ê†áËÆ∞ÁöÑÊñáÊú¨
            if (processedLines.length > 0) {
                const text = processedLines.join(' ').replace(/\s+/g, ' ').trim();
                
                if (!phone) {
                    const phonePatterns = [
                        /09\d{2}[-\s]?\d{3}[-\s]?\d{3}/,
                        /09\d{8}/,
                        /\d{2,4}[-\s]?\d{6,8}/,
                        /\d{10}/
                    ];
                    for (const pattern of phonePatterns) {
                        const phoneMatch = text.match(pattern);
                        if (phoneMatch) {
                            phone = phoneMatch[0].replace(/\s/g, '');
                            break;
                        }
                    }
                }
                
                if (!name) {
                    const namePatterns = [
                        { pattern: /([^\d\s]{1,4}(?:ÂÖàÁîü|Â∞èÂßê|Â•≥Â£´))/, withTitle: true },
                        { pattern: /([^\d\s]{3})\s/, withTitle: false },
                        { pattern: /\s([^\d\s]{3})\s/, withTitle: false },
                        { pattern: /([^\d\s]{3})$/, withTitle: false },
                        { pattern: /\s([^\d\s]{2,4})\s*$/, withTitle: false },
                        { pattern: /([^\d\s]{2,4})\s*$/, withTitle: false }
                    ];
                    for (const item of namePatterns) {
                        const nameMatch = text.match(item.pattern);
                        if (nameMatch) {
                            name = nameMatch[1].trim();
                            if (item.withTitle || /^[\u4e00-\u9fa5]{2,4}$/.test(name)) {
                                break;
                            }
                        }
                    }
                }
                
                if (!address) {
                    let remainingText = text;
                    if (phone) remainingText = remainingText.replace(phone, '');
                    if (name) remainingText = remainingText.replace(name, '');
                    address = remainingText.replace(/\//g, '').replace(/\s+/g, '').trim();
                    
                    const addressKeywords = ['ÂçÄ', 'Ë∑Ø', 'Ë°ó', 'Â∑∑', 'ÂºÑ', 'Ëôü', 'Ê®ì', 'ÂÆ§', 'Â∏Ç', 'Á∏£', 'ÈÑâ', 'ÈéÆ', 'Êùë'];
                    if (!addressKeywords.some(keyword => address.includes(keyword))) {
                        address = remainingText.trim();
                    }
                }
            }
            
            // Â°´ÂÖÖÊ¨Ñ‰Ωç
            if (address) document.getElementById('clean-address').value = address;
            if (phone) document.getElementById('clean-phone').value = phone;
            if (name) document.getElementById('clean-name').value = name;
            
            // Ëá™ÂãïÂà§Êñ∑‰∏äÊ®ìÂíåÈë∞Âåô
            let upstairsOption = '';
            let keyOption = '';
            if (address) {
                const floorMatch = address.match(/(\d+)Ê®ì|(\d+)F|(\d+)Â±Ç|(\d+)Â±§/);
                
                if (address.includes('ÈõªÊ¢Ø') || address.includes('ÁîµÊ¢Ø')) {
                    upstairsOption = 'ÈõªÊ¢Ø';
                } else if (floorMatch) {
                    const floorNumber = parseInt(floorMatch[1] || floorMatch[2] || floorMatch[3] || floorMatch[4]);
                    if (floorNumber === 1) {
                        upstairsOption = '‰∏çÁî®‰∏äÊ®ì';
                        keyOption = 'ÁÑ°';
                        document.getElementById('clean-key').value = 'ÁÑ°';
                    } else if (floorNumber >= 2) {
                        upstairsOption = 'ÈúÄ‰∏äÊ®ì';
                        keyOption = 'Êúâ';
                        document.getElementById('clean-key').value = 'Êúâ';
                    }
                } else if (address.match(/Âú∞‰∏ã.*Ê®ì/)) {
                    upstairsOption = 'ÈúÄ‰∏äÊ®ì';
                } else {
                    upstairsOption = '‰∏çÁî®‰∏äÊ®ì';
                }
                document.getElementById('clean-upstairs').value = upstairsOption;
            }
            
            // È°ØÁ§∫ÁµêÊûú
            let resultMsg = '‚úÖ Ëá™ÂãïÂàÜÈ°ûÂÆåÊàêÔºö\n';
            if (address) resultMsg += `Âú∞ÂùÄÔºö${address}\n`;
            if (phone) resultMsg += `ÈõªË©±Ôºö${phone}\n`;
            if (name) resultMsg += `ÂßìÂêçÔºö${name}\n`;
            if (upstairsOption) resultMsg += `‰∏äÊ®ìÔºö${upstairsOption}\n`;
            if (keyOption) resultMsg += `Èë∞ÂåôÔºö${keyOption}`;
            
            if (!address && !phone && !name) {
                alert('‚ùå ÁÑ°Ê≥ïË≠òÂà•Ë≥áÊñôÔºåË´ãÊ™¢Êü•Ê†ºÂºè');
            } else {
                alert(resultMsg);
            }
            
            document.getElementById('smart-input-clean').value = '';
        }

        // Monthly task generation function
        function generateMonthlyTask() {
            const quoteData = document.getElementById('monthly-quote-data').value;
            const date = document.getElementById('monthly-date').value;
            
            // Áç≤ÂèñÊâÄÊúâÊâãÂãïËº∏ÂÖ•Ê¨Ñ‰Ωç
            const fixedPrice = document.getElementById('monthly-fixed-price').value;
            const upstairs = document.getElementById('monthly-upstairs').value;
            const address = document.getElementById('monthly-address').value;
            const phone = document.getElementById('monthly-phone').value;
            const name = document.getElementById('monthly-name').value;
            const trashPickup = document.getElementById('monthly-trash-pickup').value;
            const recyclePickup = document.getElementById('monthly-recycle-pickup').value;
            const key = document.getElementById('monthly-key').value;
            const manualTime = document.getElementById('monthly-time').value;
            const bag = document.getElementById('monthly-bag').value;
            
            if (!quoteData || !date) {
                showStatus('monthly-status', 'Ë´ãÂ°´ÂØ´Â†±ÂÉπË≥áÊñôÂíåÂü∑Ë°åÊó•Êúü', 'error');
                return;
            }
            
            // Ëß£ÊûêÂ†±ÂÉπË≥áÊñô
            let extractedAddress = address, extractedName = name, extractedPhone = phone;
            let fee = 0, weekDays = 'Êú™Â°´', time = '‰∏äÂçà';
            let trashAmount = 'Êú™Â°´', recycleAmount = 'Êú™Â°´';
            
            // Â¶ÇÊûúÊâãÂãïÊ¨Ñ‰ΩçÁÇ∫Á©∫ÔºåÂâáÂæûÂ†±ÂÉπË≥áÊñô‰∏≠ÊèêÂèñ
            if (!address || !name || !phone) {
                const lines = quoteData.split('\n');
                for (const line of lines) {
                    if (line.includes('Âú∞ÂùÄ') && !extractedAddress) {
                        extractedAddress = line.split(/[Ôºö:]/)[1]?.trim() || '';
                    }
                    if (line.includes('ÂßìÂêç') && !extractedName) {
                        extractedName = line.split(/[Ôºö:]/)[1]?.trim() || '';
                    }
                    if (line.includes('ÈõªË©±') && !extractedPhone) {
                        extractedPhone = line.split(/[Ôºö:]/)[1]?.trim() || '';
                    }
                }
            }
            
            // ‰ΩøÁî®Âõ∫ÂÆöÂÉπÊ†º
            if (fixedPrice) {
                fee = parseInt(fixedPrice);
            } else {
                // Â¶ÇÊûúÊ≤íÊúâÊâãÂãïËº∏ÂÖ•ÂÉπÊ†ºÔºåÂæûÂ†±ÂÉπË≥áÊñô‰∏≠ÊèêÂèñ
                const feeMatch = quoteData.match(/‰∏ÄÂÄãÊúàË≤ªÁî®Ôºö(\d+)/);
                if (feeMatch) {
                    fee = parseInt(feeMatch[1]);
                }
            }
            
            // ÊèêÂèñÈÄ±Ë∂üÊï∏ÂíåÊó•Êúü
            const weekMatch = quoteData.match(/‰∏ÄÈÄ±Ë∂üÊï∏Ôºö.*?(\d+Ë∂ü)-(ÈÄ±.*?)\n/);
            weekDays = weekMatch ? weekMatch[2] : 'Êú™Â°´';
            
            // Â∞áÈÄ±1+ÈÄ±4Ê†ºÂºèËΩâÊèõÁÇ∫ÊòüÊúüÊ†ºÂºè
            function convertWeekdayFormat(weekStr) {
                if (!weekStr || weekStr === 'Êú™Â°´') return 'Êú™Â°´';
                
                const weekMap = {
                    'ÈÄ±1': 'ÈÄ±‰∏Ä', 'ÈÄ±2': 'ÈÄ±‰∫å', 'ÈÄ±3': 'ÈÄ±‰∏â', 
                    'ÈÄ±4': 'ÈÄ±Âõõ', 'ÈÄ±5': 'ÈÄ±‰∫î', 'ÈÄ±6': 'ÈÄ±ÂÖ≠', 'ÈÄ±Êó•': 'ÈÄ±Êó•'
                };
                
                // ËôïÁêÜÈÄ±1+ÈÄ±4ÈÄôÁ®ÆÊ†ºÂºè
                return weekStr.replace(/ÈÄ±(\d)/g, (match, num) => {
                    return weekMap[match] || match;
                });
            }
            
            weekDays = convertWeekdayFormat(weekDays);
            
            // ÊôÇÈñìÊ†ºÂºèÂåñÂáΩÊï∏
            function formatTimeToChinnese(timeStr) {
                timeStr = timeStr.replace(/[Ôºö:Âæå]/g, '').trim();
                if (timeStr.length === 4 && !isNaN(timeStr)) {
                    const hour = parseInt(timeStr.substring(0, 2));
                    const minute = timeStr.substring(2);
                    let period;
                    if (hour < 12) {
                        period = '‰∏äÂçà';
                    } else if (hour < 18) {
                        period = '‰∏ãÂçà';
                    } else {
                        period = 'ÊôöÈñì';
                    }
                    return `${period} ${hour.toString().padStart(2, '0')}Ôºö${minute} Âæå`;
                }
                if (timeStr.includes('‰∏äÂçà') || timeStr.includes('‰∏ãÂçà') || timeStr.includes('ÊôöÈñì')) {
                    return timeStr + (timeStr.endsWith('Âæå') ? '' : ' Âæå');
                }
                return timeStr + (timeStr && !timeStr.endsWith('Âæå') ? 'Âæå' : '');
            }
            
            // ‰ΩøÁî®ÊâãÂãïÊôÇÈñìÊàñÂæûÊñáÂ≠ó‰∏≠ÊèêÂèñ
            if (manualTime.trim()) {
                time = formatTimeToChinnese(manualTime);
            } else {
                const timeMatch = quoteData.match(/ÁΩÆÊîæÊôÇÈñìÔºö(\d{2}Ôºö\d{2})/);
                if (timeMatch) {
                    const timeStr = timeMatch[1].replace('Ôºö', '');
                    time = formatTimeToChinnese(timeStr);
                } else {
                    time = '‰∏äÂçà';
                }
            }
            
            // ÊèêÂèñÂûÉÂúæÈáè - Â¢ûÂº∑ÁâàÂÅµÊ∏¨
            let trashMatchFound = false;
            const trashPatterns = [
                /1ÈÄ±ÂûÉÂúæÔºö(\d+)ÂåÖÊï∏.*?\((\d+ÂÖ¨Âçá)\)/,
                /ÂûÉÂúæ.*?(\d+)ÂåÖ.*?(\d+ÂÖ¨Âçá)/,
                /1ÈÄ±ÂûÉÂúæ.*?(\d+).*?(\d+ÂÖ¨Âçá)/,
                /ÈÄ±ÂûÉÂúæÔºö(\d+)ÂåÖÊï∏.*?\((\d+ÂÖ¨Âçá)\)/,
                /ÂûÉÂúæÂåÖÊï∏Ôºö(\d+).*?(\d+ÂÖ¨Âçá)/
            ];
            
            for (const pattern of trashPatterns) {
                const match = quoteData.match(pattern);
                if (match) {
                    const volume = match[2].replace('ÂÖ¨Âçá', '');
                    trashAmount = `${match[1]}ÂåÖÔºà${volume}ÂÖ¨ÂçáÔºâ`;
                    trashMatchFound = true;
                    break;
                }
            }
            
            // ÊèêÂèñË≥áÊ∫êÈáè - Â¢ûÂº∑ÁâàÂÅµÊ∏¨
            let recycleMatchFound = false;
            const recyclePatterns = [
                /1ÈÄ±Ë≥áÊ∫ê:(\d+)ÂåÖÊï∏.*?\((\d+ÂÖ¨Âçá)\)/,
                /1ÈÄ±Ë≥áÊ∫êÔºö(\d+)ÂåÖÊï∏.*?\((\d+ÂÖ¨Âçá)\)/,
                /Ë≥áÊ∫ê.*?(\d+)ÂåÖ.*?(\d+ÂÖ¨Âçá)/,
                /1ÈÄ±Ë≥áÊ∫ê.*?(\d+).*?(\d+ÂÖ¨Âçá)/,
                /ÈÄ±Ë≥áÊ∫êÔºö(\d+)ÂåÖÊï∏.*?\((\d+ÂÖ¨Âçá)\)/,
                /Ë≥áÊ∫êÂåÖÊï∏Ôºö(\d+).*?(\d+ÂÖ¨Âçá)/
            ];
            
            for (const pattern of recyclePatterns) {
                const match = quoteData.match(pattern);
                if (match) {
                    const volume = match[2].replace('ÂÖ¨Âçá', '');
                    recycleAmount = `${match[1]}ÂåÖÔºà${volume}ÂÖ¨ÂçáÔºâ`;
                    recycleMatchFound = true;
                    break;
                }
            }
            
            // Â¶ÇÊûúÊ≤íÊúâÊâæÂà∞ÂÆåÊï¥ÁöÑÂåÖÊï∏ÂíåÂÆπÈáèÔºåÂòóË©¶Âè™ÊâæÂåÖÊï∏
            if (!trashMatchFound) {
                const trashSimplePatterns = [
                    /ÂûÉÂúæ.*?(\d+)ÂåÖ/,
                    /1ÈÄ±ÂûÉÂúæ.*?(\d+)/,
                    /ÂûÉÂúæÂåÖÊï∏Ôºö(\d+)/
                ];
                for (const pattern of trashSimplePatterns) {
                    const match = quoteData.match(pattern);
                    if (match) {
                        trashAmount = `${match[1]}ÂåÖ`;
                        break;
                    }
                }
            }
            
            if (!recycleMatchFound) {
                const recycleSimplePatterns = [
                    /Ë≥áÊ∫ê.*?(\d+)ÂåÖ/,
                    /1ÈÄ±Ë≥áÊ∫ê.*?(\d+)/,
                    /Ë≥áÊ∫êÂåÖÊï∏Ôºö(\d+)/
                ];
                for (const pattern of recycleSimplePatterns) {
                    const match = quoteData.match(pattern);
                    if (match) {
                        recycleAmount = `${match[1]}ÂåÖ`;
                        break;
                    }
                }
            }
            
            const dateObj = new Date(date);
            const weekDaysArray = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            const weekDay = weekDaysArray[dateObj.getDay()];
            const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dateWithWeekday = `${formattedDate} ÈÄ±${weekDay}`;
            
            const generalTask = `üßë‚ÄçüöÄÂåÖÊúà‰ªªÂãôüßë‚ÄçüöÄ

‚û°Ô∏èÊó•ÊúüÔºö${dateWithWeekday}
‚û°Ô∏èÊòüÊúüÔºö${weekDays}
‚û°Ô∏èÊôÇÈñìÔºö${time}
‚û°Ô∏èÂú∞ÂùÄÔºö${extractedAddress}
‚û°Ô∏è‰∏äÊ®ìÔºö${upstairs === 'ÈúÄ‰∏äÊ®ì' ? 'ÊòØ' : 'Âê¶'}
‚û°Ô∏èÈë∞ÂåôÔºö${key}
‚û°Ô∏èË≤ªÁî®Ôºö${fee}
‚û°Ô∏èÂÆ¢Êà∂Ëá™ÂÇôÂ∞àÁî®Ë¢ãÔºö${bag}
‚û°Ô∏è1ÈÄ±ÂûÉÂúæÈáèÔºö${trashAmount}
Ôºà1-${trashPickup}Ôºâ
‚û°Ô∏è1ÈÄ±Ë≥áÊ∫êÈáèÔºö${recycleAmount}
Ôºà1-${recyclePickup}Ôºâ
‚û°Ô∏èÂßìÂêçÔºö${extractedName}
‚û°Ô∏èÈõªË©±Ôºö${extractedPhone}
‚û°Ô∏èÂÖ∂‰ªñÔºö
1.Ëã•ÊúâÈë∞ÂåôÁ¥¢ÂèñË´ãÂõûÂ†±
2.7Â§©ÂÖßË§áË£ΩÊ≠∏ÈÇÑÂéüÈë∞
3.Âè¶ÊúâË¶èÂÆöÊôÇÈñìËÄÖÈô§Â§ñ
4.Èë∞ÂåôÈÄöÂ∏∏Á≤òÁΩÆ‰ø°ÁÆ±

üìõÂ∑≤Êñ∞Â¢ûÊó•ÊõÜüìõ
üìõÂãôÂøÖË´ãÈÅéÁõÆüìõ
üìõÊúâÂïèÈ°åÊèêÂá∫üìõ`;

            const limitedTask = `üßë‚ÄçüöÄÂåÖÊúà‰ªªÂãôüßë‚ÄçüöÄ

‚û°Ô∏èÊó•ÊúüÔºö${dateWithWeekday}
‚û°Ô∏èÊòüÊúüÔºö${weekDays}
‚û°Ô∏èÊôÇÈñìÔºö${time}
‚û°Ô∏èÂú∞ÂùÄÔºö${extractedAddress}
‚û°Ô∏è‰∏äÊ®ìÔºö${upstairs === 'ÈúÄ‰∏äÊ®ì' ? 'ÊòØ' : 'Âê¶'}
‚û°Ô∏èÈë∞ÂåôÔºö${key}
‚û°Ô∏èË≤ªÁî®Ôºö${fee}
‚û°Ô∏èÂÆ¢Êà∂Ëá™ÂÇôÂ∞àÁî®Ë¢ãÔºö${bag}
‚û°Ô∏è1ÈÄ±ÂûÉÂúæÈáèÔºö${trashAmount}
Ôºà1-${trashPickup}Ôºâ
‚û°Ô∏è1ÈÄ±Ë≥áÊ∫êÈáèÔºö${recycleAmount}
Ôºà1-${recyclePickup}Ôºâ
‚û°Ô∏èÂßìÂêçÔºö${extractedName}
‚û°Ô∏èÈõªË©±Ôºö${extractedPhone}
‚û°Ô∏èÂü∫Êú¨ÊúçÂãôÔºö
1.Ë∂ÖÈáè‰∏ÄÂæãÊî∂Ëµ∞
2.ÁèæÂ†¥Ê∏ÖÁ©∫
3.Ê≠£Á¢∫ÂõûÂ†±

‚û°Ô∏èÂÖ∂‰ªñÔºö
1.Ëã•ÊúâÈë∞ÂåôÁ¥¢ÂèñË´ãÂõûÂ†±
2.7Â§©ÂÖßË§áË£ΩÊ≠∏ÈÇÑÂéüÈë∞
3.Âè¶ÊúâË¶èÂÆöÊôÇÈñìËÄÖÈô§Â§ñ
4.Èë∞ÂåôÈÄöÂ∏∏Á≤òÁΩÆ‰ø°ÁÆ±

üìõÂ∑≤Êñ∞Â¢ûÊó•ÊõÜüìõ
üìõÂãôÂøÖË´ãÈÅéÁõÆüìõ
üìõÊúâÂïèÈ°åÊèêÂá∫üìõ`;

            document.getElementById('monthly-general').textContent = generalTask;
            document.getElementById('monthly-limited').textContent = limitedTask;
            document.getElementById('monthly-output').style.display = 'block';
            showStatus('monthly-status', '‚úÖ ÂåÖÊúà‰ªªÂãôÂñÆËΩâÊèõÂÆåÊàêÔºÅ', 'success');
        }



        // Single task generation function
        function generateSingleTask() {
            const date = document.getElementById('single-date').value;
            const time = document.getElementById('single-time').value;
            const phone = document.getElementById('single-phone').value;
            const name = document.getElementById('single-name').value;
            const address = document.getElementById('single-address').value;
            const upstairs = document.getElementById('single-upstairs').value;
            const wasteType = document.getElementById('single-waste-type').value;

            const fee = document.getElementById('single-fee').value;
            const customerBag = document.getElementById('single-customer-bag').value;
            
            // ÂãïÊÖãÊî∂ÈõÜÊâÄÊúâÂÖ∂‰ªñË™™Êòé
            const otherNotes = [];
            const container = document.getElementById('single-notes-container');
            const allInputs = container.querySelectorAll('input[id^="single-other"]');
            allInputs.forEach(input => {
                const content = input.value;
                if (content && content.trim() !== '') {
                    otherNotes.push(content.trim());
                }
            });
            
            if (!date) {
                showStatus('single-status', 'Ë´ãÂ°´ÂØ´Âü∑Ë°åÊó•Êúü', 'error');
                return;
            }
            
            const dateObj = new Date(date);
            const weekDays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            const weekDay = weekDays[dateObj.getDay()];
            const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dateWithWeekday = `${formattedDate} ÈÄ±${weekDay}`;
            
            // Ê†ºÂºèÂåñÊôÇÈñì - ÊîØÊè¥ÊôÇÈñìÂçÄÈñì
            let formattedTime = time || '‰∏äÂçà';
            if (time) {
                // Ê™¢Êü•ÊòØÂê¶ÁÇ∫ÊôÇÈñìÂçÄÈñìÊ†ºÂºè (Â¶Ç 1500-1630)
                const timeRangeMatch = time.match(/(\d{4})-(\d{4})/);
                if (timeRangeMatch) {
                    const startTime = timeRangeMatch[1];
                    const endTime = timeRangeMatch[2];
                    
                    // Ê†ºÂºèÂåñÈñãÂßãÊôÇÈñì
                    const startHour = parseInt(startTime.substring(0, 2));
                    const startMinute = startTime.substring(2);
                    let startPeriod = startHour < 12 ? '‰∏äÂçà' : (startHour < 18 ? '‰∏ãÂçà' : 'ÊôöÈñì');
                    
                    // Ê†ºÂºèÂåñÁµêÊùüÊôÇÈñì
                    const endHour = parseInt(endTime.substring(0, 2));
                    const endMinute = endTime.substring(2);
                    
                    formattedTime = `${startPeriod} ${startHour.toString().padStart(2, '0')}Ôºö${startMinute}-${endHour.toString().padStart(2, '0')}Ôºö${endMinute}`;
                } else if (time.match(/^\d{4}$/)) {
                    // ËôïÁêÜÂõõ‰ΩçÊï∏ÊôÇÈñìÊ†ºÂºè (Â¶Ç 1300)
                    const hour = parseInt(time.substring(0, 2));
                    const minute = time.substring(2);
                    let period = hour < 12 ? '‰∏äÂçà' : (hour < 18 ? '‰∏ãÂçà' : 'ÊôöÈñì');
                    formattedTime = `${period} ${hour.toString().padStart(2, '0')}Ôºö${minute}`;
                } else if (time.includes(':')) {
                    // ÂéüÊúâÁöÑÂñÆ‰∏ÄÊôÇÈñìÊ†ºÂºèËôïÁêÜ
                    const [hour, minute] = time.split(':');
                    const hourInt = parseInt(hour);
                    if (hourInt < 12) {
                        formattedTime = `‰∏äÂçà ${hour}Ôºö${minute}`;
                    } else if (hourInt < 18) {
                        formattedTime = `‰∏ãÂçà ${hour}Ôºö${minute}`;
                    } else {
                        formattedTime = `ÊôöÈñì ${hour}Ôºö${minute}`;
                    }
                } else {
                    // ÂÖ∂‰ªñÊ†ºÂºèÁõ¥Êé•È°ØÁ§∫
                    formattedTime = time;
                }
            }
            
            // Ê±∫ÂÆöÂûÉÂúæË≥áÊ∫êÈáèÊñáÂ≠ó
            const wasteAmount = wasteType === 'ÊâãÂãïÂ°´ÂØ´' ? 
                (document.getElementById('single-waste-manual').value || 'Â¶ÇÂúñ') : 'Â¶ÇÂúñ';
            
            // ÊßãÂª∫ÂÖ∂‰ªñË™™ÊòéÂÖßÂÆπ
            let otherDetails = '';
            let itemNumber = 4;
            otherNotes.forEach((note, index) => {
                otherDetails += `${itemNumber}.${note}`;
                if (index < otherNotes.length - 1) {
                    otherDetails += '\n';
                }
                itemNumber++;
            });

            const singleTask = `üßë‚ÄçüöÄÂñÆË∂ü‰ªªÂãôüßë‚ÄçüöÄ

‚û°Ô∏èÊó•ÊúüÔºö${dateWithWeekday}
‚û°Ô∏èÊôÇÈñìÔºö${formattedTime}
‚û°Ô∏èÈõªË©±Ôºö${phone}
‚û°Ô∏èÂßìÂêçÔºö${name}
‚û°Ô∏èÂú∞ÂùÄÔºö${address}
‚û°Ô∏è‰∏äÊ®ìÔºö${upstairs || 'ÁÑ°'}
‚û°Ô∏èÂÆ¢Êà∂Ëá™ÂÇôÂ∞àÁî®Ë¢ãÔºö${customerBag}
‚û°Ô∏èË≤ªÁî®Ôºö${fee}
‚û°Ô∏èÂûÉÂúæË≥áÊ∫êÈáèÔºö${wasteAmount}
‚û°Ô∏èÁèæÊ≥ÅÁÖßÁâáÔºö
‚û°Ô∏èÂÖ∂‰ªñÔºö
1.ÂõûÂ†±Ôºö
Ôºà1ÔºâÂñÆË∂üÔºöXX+Ë∑ØÊÆµ/Ë°ó
2.Â∞ëÈáèË∂ÖÈáè‰∏ÄÂæãÊ∏ÖËµ∞
3.ÁÖßÁâáÊãçÂÆåÂñÑ
${otherDetails}

üî•Â∑≤Êñ∞Â¢ûÊó•ÊõÜüî•
üî•ÂãôÂøÖË´ãÈÅéÁõÆüî•
üî•ÊúâÂïèÈ°åÊèêÂá∫üî•`;

            document.getElementById('single-result').textContent = singleTask;
            document.getElementById('single-output').style.display = 'block';
            showStatus('single-status', '‚úÖ ÂñÆË∂ü‰ªªÂãôÂñÆËΩâÊèõÂÆåÊàêÔºÅ', 'success');
        }



        // Clean task generation function
        function generateCleanTask() {
            const date = document.getElementById('clean-date').value;
            const time = document.getElementById('clean-time').value;
            const phone = document.getElementById('clean-phone').value;
            const name = document.getElementById('clean-name').value;
            const address = document.getElementById('clean-address').value;
            const upstairs = document.getElementById('clean-upstairs').value;
            const fee = document.getElementById('clean-fee').value;
            
            // ÂãïÊÖãÊî∂ÈõÜÊâÄÊúâÂÖ∂‰ªñË™™Êòé
            const otherNotes = [];
            const notesContainer = document.getElementById('clean-notes-container');
            const allNoteInputs = notesContainer.querySelectorAll('input[id^="clean-other"]');
            allNoteInputs.forEach(input => {
                const content = input.value;
                if (content && content.trim() !== '') {
                    otherNotes.push(content.trim());
                }
            });
            
            // ÂãïÊÖãÊî∂ÈõÜÊâÄÊúâÊ∏ÖÊΩîÁØÑÂúç
            const cleaningScope = [];
            const scopeContainer = document.getElementById('clean-scope-container');
            const allScopeInputs = scopeContainer.querySelectorAll('input[id^="clean-scope-"]');
            let scopeIndex = 1;
            allScopeInputs.forEach(input => {
                const content = input.value;
                if (content && content.trim() !== '') {
                    cleaningScope.push(`${scopeIndex}.${content.trim()}`);
                    scopeIndex++;
                }
            });
            
            if (!date) {
                showStatus('clean-status', 'Ë´ãÂ°´ÂØ´Ê∏ÖÊΩîÊó•Êúü', 'error');
                return;
            }
            
            const dateObj = new Date(date);
            const weekDays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            const weekDay = weekDays[dateObj.getDay()];
            const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dateWithWeekday = `${formattedDate} ÈÄ±${weekDay}`;
            
            // Ê†ºÂºèÂåñÊôÇÈñì
            let formattedTime = time || '‰∏äÂçà';
            if (time && time.includes(':')) {
                const [hour, minute] = time.split(':');
                const hourInt = parseInt(hour);
                if (hourInt < 12) {
                    formattedTime = `‰∏äÂçà ${hour}Ôºö${minute}`;
                } else if (hourInt < 18) {
                    formattedTime = `‰∏ãÂçà ${hour}Ôºö${minute}`;
                } else {
                    formattedTime = `ÊôöÈñì ${hour}Ôºö${minute}`;
                }
            }
            
            // ÁîüÊàêÊ∏ÖÊΩîÁØÑÂúçÊñáÂ≠ó
            const scopeText = cleaningScope.length > 0 ? cleaningScope.join('\n') : 'ÂæÖÁèæÂ†¥Á¢∫Ë™ç';
            
            // ÊßãÂª∫ÂÖ∂‰ªñË™™ÊòéÂÖßÂÆπ
            let otherDetails = '';
            let itemNumber = 5;
            otherNotes.forEach((note, index) => {
                otherDetails += `${itemNumber}.${note}`;
                if (index < otherNotes.length - 1) {
                    otherDetails += '\n';
                }
                itemNumber++;
            });
            
            const cleanTask = `üßë‚ÄçüöÄÊ∏ÖÊΩî‰ªªÂãôüßë‚ÄçüöÄ

‚û°Ô∏èÊó•ÊúüÔºö${dateWithWeekday}
‚û°Ô∏èÈõªË©±Ôºö${phone}
‚û°Ô∏èÂßìÂêçÔºö${name}
‚û°Ô∏èÂú∞ÂùÄÔºö${address}
‚û°Ô∏è‰∏äÊ®ìÔºö${upstairs || 'ÁÑ°'}
‚û°Ô∏èË≤ªÁî®Ôºö${fee}
‚û°Ô∏èÊ∏ÖÊΩîÁØÑÂúçÔºö
${scopeText}
‚û°Ô∏èÂÖ∂‰ªñÔºö
1.ÂõûÂ†±Ôºö
Ôºà1ÔºâÂñÆË∂üÔºöXX+Ë∑ØÊÆµ/Ë°ó
2.ÁèæÂ†¥Ê∏ÖÊΩîÂæåÂèäÂ∞ëÈáèÂûÉÂúæ
   ‰∏ÄÂæãÂ∏∂Ëµ∞Ê∏ÖÁ©∫
3.ÁÖßÁâáÊãçÂÆåÂñÑ
4.Ê∏ÖÊΩîÁÖßÁâáÂÉÖÊãçÂÆåÊàêÂæåÁÖßÁâáÂç≥ÂèØ
${otherDetails}

üî•Â∑≤Êñ∞Â¢ûÊó•ÊõÜüî•
üî•ÂãôÂøÖË´ãÈÅéÁõÆüî•
üî•ÊúâÂïèÈ°åÊèêÂá∫üî•`;

            document.getElementById('clean-result').textContent = cleanTask;
            document.getElementById('clean-output').style.display = 'block';
            showStatus('clean-status', '‚úÖ Ê∏ÖÊΩî‰ªªÂãôÂñÆËΩâÊèõÂÆåÊàêÔºÅ', 'success');
        }

        // Copy to clipboard function
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function() {
                    const statusId = elementId.includes('quote') ? 'quote-status' : 
                                   elementId.includes('monthly') ? 'monthly-status' :
                                   elementId.includes('single') ? 'single-status' : 'clean-status';
                    showStatus(statusId, '‚úÖ ÂÖßÂÆπÂ∑≤ÊàêÂäüË§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ', 'success');
                }, function(err) {
                    showStatus(statusId, '‚ùå Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÈÅ∏ÂèñÊñáÂ≠óË§áË£Ω', 'error');
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const statusId = elementId.includes('quote') ? 'quote-status' : 
                                   elementId.includes('monthly') ? 'monthly-status' :
                                   elementId.includes('single') ? 'single-status' : 'clean-status';
                    showStatus(statusId, '‚úÖ ÂÖßÂÆπÂ∑≤ÊàêÂäüË§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ', 'success');
                } catch (err) {
                    showStatus(statusId, '‚ùå Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÈÅ∏ÂèñÊñáÂ≠óË§áË£Ω', 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // Show status message
        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
            
            setTimeout(() => {
                statusElement.textContent = '';
                statusElement.className = 'status';
            }, 4000);
        }

        // Clear form functions
        function clearQuoteForm() {
            // Reset form fields to default values
            document.getElementById('service-time').value = '';
            document.getElementById('floor-level').value = '';
            document.getElementById('monthly-fee').value = '';
            document.getElementById('frequency').value = '';
            document.getElementById('trash-bags').value = '';
            document.getElementById('recycle-bags').value = '';
            document.getElementById('trash-max').value = '';
            document.getElementById('recycle-max').value = '';
            document.getElementById('special-notes').value = '';
            
            // Clear and reset checkboxes to default (ÈÄ±‰∫å and ÈÄ±‰∫î)
            const checkboxes = document.querySelectorAll('input[name="service-days"]');
            checkboxes.forEach(cb => cb.checked = false);
            document.querySelector('input[name="service-days"][value="ÈÄ±‰∫å"]').checked = true;
            document.querySelector('input[name="service-days"][value="ÈÄ±‰∫î"]').checked = true;
            
            // Clear trash volume radio buttons
            const trashVolumeRadios = document.querySelectorAll('input[name="trash-volume"]');
            trashVolumeRadios.forEach(radio => radio.checked = false);
            
            // Clear recycle volume radio buttons
            const recycleVolumeRadios = document.querySelectorAll('input[name="recycle-volume"]');
            recycleVolumeRadios.forEach(radio => radio.checked = false);
            
            // Hide output
            document.getElementById('quote-output').style.display = 'none';
            document.getElementById('quote-status').textContent = '';
            
            // Show confirmation message
            showStatus('quote-status', '‚úÖ Ë°®ÂñÆÂ∑≤Ê∏ÖÁ©∫ÈáçÁΩÆÔºÅ', 'success');
        }

        function clearMonthlyForm() {
            document.getElementById('monthly-quote-data').value = '';
            document.getElementById('smart-input-monthly').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('monthly-date').value = today;
            document.getElementById('monthly-time').value = '';
            document.getElementById('monthly-fixed-price').value = '';
            document.getElementById('monthly-upstairs').value = '';
            document.getElementById('monthly-address').value = '';
            document.getElementById('monthly-phone').value = '';
            document.getElementById('monthly-name').value = '';
            document.getElementById('monthly-trash-pickup').value = '';
            document.getElementById('monthly-recycle-pickup').value = '';
            document.getElementById('monthly-key').value = '';
            document.getElementById('monthly-bag').value = '';
            
            // Hide output
            document.getElementById('monthly-output').style.display = 'none';
            document.getElementById('monthly-status').textContent = '';
            
            // Show confirmation message
            showStatus('monthly-status', '‚úÖ Ë°®ÂñÆÂ∑≤Ê∏ÖÁ©∫ÈáçÁΩÆÔºÅ', 'success');
        }

        function clearSingleForm() {
            document.getElementById('smart-input-single').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('single-date').value = today;
            document.getElementById('single-time').value = '';
            document.getElementById('single-phone').value = '';
            document.getElementById('single-name').value = '';
            document.getElementById('single-address').value = '';
            document.getElementById('single-upstairs').value = '';
            document.getElementById('single-customer-bag').value = 'ÁÑ°';
            document.getElementById('single-waste-type').value = 'Â¶ÇÂúñ';
            document.getElementById('single-waste-manual').value = '';
            document.getElementById('single-waste-manual-div').style.display = 'none';
            document.getElementById('single-fee').value = '';
            
            // ÈáçÁΩÆÂãïÊÖãÂÖ∂‰ªñË™™ÊòéÂçÄÂüü - Âè™‰øùÁïôÁ¨¨‰∏ÄÂÄã
            const container = document.getElementById('single-notes-container');
            container.innerHTML = `
                <div class="single-note-item" id="single-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div style="flex: 0 0 100px;">
                        <label>Ë™™Êòé1Ôºö</label>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" id="single-other1" placeholder="‰æãÔºöÂõûÂ†±Ë∑ØÊÆµ" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                </div>
            `;
            singleNoteNextId = 1; // ÈáçÁΩÆIDË®àÊï∏Âô®
            updateSingleNoteButtonState(); // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            
            // Clear images using the new clear function
            clearSingleImages();
            
            // Hide output
            document.getElementById('single-output').style.display = 'none';
            document.getElementById('single-status').textContent = '';
            
            // Show confirmation message
            showStatus('single-status', '‚úÖ Ë°®ÂñÆÂ∑≤Ê∏ÖÁ©∫ÈáçÁΩÆÔºÅ', 'success');
        }

        function clearCleanForm() {
            document.getElementById('smart-input-clean').value = '';
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('clean-date').value = today;
            document.getElementById('clean-time').value = '';
            document.getElementById('clean-phone').value = '';
            document.getElementById('clean-name').value = '';
            document.getElementById('clean-address').value = '';
            document.getElementById('clean-upstairs').value = '';
            document.getElementById('clean-key').value = '';
            document.getElementById('clean-fee').value = '';
            
            // ÈáçÁΩÆÂãïÊÖãÂÖ∂‰ªñË™™ÊòéÂçÄÂüü - Âè™‰øùÁïôÁ¨¨‰∏ÄÂÄã
            const notesContainer = document.getElementById('clean-notes-container');
            notesContainer.innerHTML = `
                <div class="clean-note-item" id="clean-note-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div style="flex: 0 0 100px;">
                        <label>Ë™™Êòé1Ôºö</label>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" id="clean-other1" placeholder="‰æãÔºöÁâπÊÆäÊ∏ÖÊΩîÈúÄÊ±Ç" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                </div>
            `;
            cleanNoteNextId = 1; // ÈáçÁΩÆIDË®àÊï∏Âô®
            updateCleanNoteButtonState(); // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            
            // ÈáçÁΩÆÂãïÊÖãÊ∏ÖÊΩîÁØÑÂúçÂçÄÂüü - Âè™‰øùÁïôÁ¨¨‰∏ÄÂÄã
            const scopeContainer = document.getElementById('clean-scope-container');
            scopeContainer.innerHTML = `
                <div class="clean-scope-item" id="clean-scope-item-1" style="display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;">
                    <div style="flex: 0 0 100px;">
                        <label>È†ÖÁõÆ1Ôºö</label>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" id="clean-scope-1" placeholder="Ê∏ÖÊΩîÈ†ÖÁõÆ 1" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                    </div>
                </div>
            `;
            cleanScopeNextId = 1; // ÈáçÁΩÆIDË®àÊï∏Âô®
            updateCleanScopeButtonState(); // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            
            // Clear images using the new clear function
            clearCleanImages();
            
            // Hide output
            document.getElementById('clean-output').style.display = 'none';
            document.getElementById('clean-status').textContent = '';
            
            // Show confirmation message
            showStatus('clean-status', '‚úÖ Ë°®ÂñÆÂ∑≤Ê∏ÖÁ©∫ÈáçÁΩÆÔºÅ', 'success');
        }

        // Set today's date as default for date inputs
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('monthly-date').value = today;
            document.getElementById('single-date').value = today;
            document.getElementById('clean-date').value = today;
            
            // Initialize drag and drop for single trip and clean photos
            initializeSingleImageUpload();
            initializeCleanImageUpload();
        });

        // Single trip image upload functions
        let singleImages = [];

        function initializeSingleImageUpload() {
            const dropZone = document.getElementById('single-drop-zone');
            const fileInput = document.getElementById('single-images');

            if (!dropZone || !fileInput) return;

            // Drag and drop events
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', (e) => {
                // Only remove dragover if we're actually leaving the drop zone
                if (!dropZone.contains(e.relatedTarget)) {
                    dropZone.classList.remove('dragover');
                }
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleSingleImageFiles(files);
            });

            // File input change event
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleSingleImageFiles(files);
            });
        }

        function handleSingleImageFiles(files) {
            // Filter for image files only
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showStatus('single-status', '‚ùå Ë´ãÈÅ∏ÊìáÊúâÊïàÁöÑÂúñÁâáÊ™îÊ°à (PNG, JPG, JPEG)', 'error');
                return;
            }

            // Add new images to collection
            imageFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = {
                        file: file,
                        dataUrl: e.target.result,
                        id: Date.now() + Math.random()
                    };
                    singleImages.push(imageData);
                    updateSingleImagePreview();
                };
                reader.readAsDataURL(file);
            });

            showStatus('single-status', `‚úÖ Â∑≤Ê∑ªÂä† ${imageFiles.length} ÂºµÁÖßÁâá`, 'success');
        }

        function updateSingleImagePreview() {
            const previewContainer = document.getElementById('single-image-preview');
            const mergeControls = document.getElementById('single-merge-controls');
            
            if (singleImages.length === 0) {
                previewContainer.innerHTML = '';
                mergeControls.style.display = 'none';
                return;
            }

            // Show merge controls
            mergeControls.style.display = 'flex';
            
            // Create compact preview HTML for inline layout
            let previewHTML = '<div style="margin-bottom: 8px; font-size: 14px; color: #ccc;"><strong>Â∑≤‰∏äÂÇ≥ (' + singleImages.length + 'Âºµ)</strong></div>';
            previewHTML += '<div style="display: flex; flex-wrap: wrap; gap: 5px;">';
            
            // Show only first 6 images in preview, indicate more if needed
            const displayCount = Math.min(6, singleImages.length);
            
            for (let i = 0; i < displayCount; i++) {
                const image = singleImages[i];
                previewHTML += `
                    <div class="photo-preview-inline" style="position: relative; display: inline-block;">
                        <img src="${image.dataUrl}" alt="Photo ${i + 1}" style="width: 60px; height: 45px; object-fit: cover; border-radius: 3px; border: 1px solid #444;">
                        <button class="photo-remove-inline" onclick="removeSingleImage(${image.id})" title="Âà™Èô§ÁÖßÁâá" style="position: absolute; top: -5px; right: -5px; background: rgba(231, 76, 60, 0.9); color: white; border: none; border-radius: 50%; width: 16px; height: 16px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center;">√ó</button>
                    </div>
                `;
            }
            
            if (singleImages.length > 6) {
                previewHTML += `<div style="color: #888; font-size: 12px; align-self: center;">+${singleImages.length - 6}Âºµ</div>`;
            }
            
            previewHTML += '</div>';
            previewContainer.innerHTML = previewHTML;
        }

        function removeSingleImage(imageId) {
            singleImages = singleImages.filter(img => img.id !== imageId);
            updateSingleImagePreview();
            
            if (singleImages.length === 0) {
                document.getElementById('single-merged-preview').innerHTML = '';
                showStatus('single-status', '‚úÖ ÊâÄÊúâÁÖßÁâáÂ∑≤Ê∏ÖÈô§', 'success');
            }
        }

        function clearSingleImages() {
            singleImages = [];
            document.getElementById('single-images').value = '';
            document.getElementById('single-image-preview').innerHTML = '';
            document.getElementById('single-merged-preview').innerHTML = '';
            document.getElementById('single-merge-controls').style.display = 'none';
            showStatus('single-status', '‚úÖ ÊâÄÊúâÁÖßÁâáÂ∑≤Ê∏ÖÈô§', 'success');
        }

        function mergeSingleImages() {
            if (singleImages.length === 0) {
                showStatus('single-status', '‚ùå Ë´ãÂÖà‰∏äÂÇ≥ÁÖßÁâá', 'error');
                return;
            }

            showStatus('single-status', 'üîÑ Ê≠£Âú®Âêà‰ΩµÁÖßÁâá...', 'success');

            // Create canvas for merging
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Load all images and merge
            Promise.all(singleImages.map(imageData => {
                return new Promise(resolve => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = imageData.dataUrl;
                });
            })).then(images => {
                // Smart grid layout based on image count
                let imagesPerRow, rows;
                if (images.length === 1) {
                    imagesPerRow = 1;
                    rows = 1;
                } else if (images.length === 2) {
                    imagesPerRow = 2;
                    rows = 1;
                } else if (images.length === 3) {
                    imagesPerRow = 3;
                    rows = 1;
                } else if (images.length === 4) {
                    imagesPerRow = 2;
                    rows = 2;
                } else if (images.length <= 6) {
                    imagesPerRow = 3;
                    rows = 2;
                } else if (images.length <= 9) {
                    imagesPerRow = 3;
                    rows = 3;
                } else {
                    imagesPerRow = 4;
                    rows = Math.ceil(images.length / 4);
                }
                
                const imageSize = Math.floor(600 / Math.max(imagesPerRow, rows));
                const totalWidth = imagesPerRow * imageSize;
                const totalHeight = rows * imageSize;
                
                // Optimize canvas size to reduce white space
                const actualWidth = Math.max(totalWidth, totalHeight);
                const actualHeight = Math.max(totalWidth, totalHeight);
                canvas.width = actualWidth;
                canvas.height = actualHeight;
                const finalMarginX = (actualWidth - totalWidth) / 2;
                const finalMarginY = (actualHeight - totalHeight) / 2;
                
                
                // Draw images in smart grid
                images.forEach((img, index) => {
                    const col = index % imagesPerRow;
                    const row = Math.floor(index / imagesPerRow);
                    const x = finalMarginX + col * imageSize;
                    const y = finalMarginY + row * imageSize;
                    
                    // Draw image as square (crop to fit)
                    const aspectRatio = img.width / img.height;
                    let sourceX = 0, sourceY = 0, sourceSize;
                    
                    if (aspectRatio > 1) {
                        // ÂØ¨ÂúñÁâáÔºåË£ÅÂàáÂ∑¶Âè≥
                        sourceSize = img.height;
                        sourceX = (img.width - sourceSize) / 2;
                    } else {
                        // È´òÂúñÁâáÔºåË£ÅÂàá‰∏ä‰∏ã
                        sourceSize = img.width;
                        sourceY = (img.height - sourceSize) / 2;
                    }
                    
                    ctx.drawImage(img, sourceX, sourceY, sourceSize, sourceSize, x, y, imageSize, imageSize);
                    
                    // Draw red grid lines
                    ctx.strokeStyle = '#FF0000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, imageSize, imageSize);
                });
                
                
                // Display merged image
                const mergedDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                const mergedPreview = document.getElementById('single-merged-preview');
                mergedPreview.innerHTML = `
                    <div class="merged-photo">
                        <div class="merged-photo-content">
                            <div><strong>Âêà‰ΩµÁÖßÁâáÔºö</strong></div>
                            <img src="${mergedDataUrl}" alt="Âêà‰ΩµÁÖßÁâá">
                        </div>
                        <div class="merged-photo-controls">
                            <button class="btn-download" onclick="downloadMergedImage('${mergedDataUrl}', 'single')">‚Üì</button>
                        </div>
                    </div>
                `;
                
                showStatus('single-status', `‚úÖ Â∑≤ÊàêÂäüÂêà‰Ωµ ${images.length} ÂºµÁÖßÁâáÔºÅ`, 'success');
            });
        }

        function downloadMergedImage(dataUrl, type) {
            const link = document.createElement('a');
            link.download = `Âêà‰ΩµÁÖßÁâá_${type}_${new Date().toISOString().slice(0,10)}.jpg`;
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Clean task image upload functions
        let cleanImages = [];

        function initializeCleanImageUpload() {
            const dropZone = document.getElementById('clean-drop-zone');
            const fileInput = document.getElementById('clean-images');

            if (!dropZone || !fileInput) return;

            // Drag and drop events
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', (e) => {
                if (!dropZone.contains(e.relatedTarget)) {
                    dropZone.classList.remove('dragover');
                }
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleCleanImageFiles(files);
            });

            // File input change event
            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleCleanImageFiles(files);
            });
        }

        function handleCleanImageFiles(files) {
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showStatus('clean-status', '‚ùå Ë´ãÈÅ∏ÊìáÊúâÊïàÁöÑÂúñÁâáÊ™îÊ°à (PNG, JPG, JPEG)', 'error');
                return;
            }

            imageFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageData = {
                        file: file,
                        dataUrl: e.target.result,
                        id: Date.now() + Math.random()
                    };
                    cleanImages.push(imageData);
                    updateCleanImagePreview();
                };
                reader.readAsDataURL(file);
            });

            showStatus('clean-status', `‚úÖ Â∑≤Ê∑ªÂä† ${imageFiles.length} ÂºµÁÖßÁâá`, 'success');
        }

        function updateCleanImagePreview() {
            const previewContainer = document.getElementById('clean-image-preview');
            const mergeControls = document.getElementById('clean-merge-controls');
            
            if (cleanImages.length === 0) {
                previewContainer.innerHTML = '';
                mergeControls.style.display = 'none';
                return;
            }

            // Show merge controls
            mergeControls.style.display = 'flex';
            
            // Create compact preview HTML for inline layout
            let previewHTML = '<div style="margin-bottom: 8px; font-size: 14px; color: #ccc;"><strong>Â∑≤‰∏äÂÇ≥ (' + cleanImages.length + 'Âºµ)</strong></div>';
            previewHTML += '<div style="display: flex; flex-wrap: wrap; gap: 5px;">';
            
            const displayCount = Math.min(6, cleanImages.length);
            
            for (let i = 0; i < displayCount; i++) {
                const image = cleanImages[i];
                previewHTML += `
                    <div class="photo-preview-inline" style="position: relative; display: inline-block;">
                        <img src="${image.dataUrl}" alt="Photo ${i + 1}" style="width: 60px; height: 45px; object-fit: cover; border-radius: 3px; border: 1px solid #444;">
                        <button class="photo-remove-inline" onclick="removeCleanImage(${image.id})" title="Âà™Èô§ÁÖßÁâá" style="position: absolute; top: -5px; right: -5px; background: rgba(231, 76, 60, 0.9); color: white; border: none; border-radius: 50%; width: 16px; height: 16px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center;">√ó</button>
                    </div>
                `;
            }
            
            if (cleanImages.length > 6) {
                previewHTML += `<div style="color: #888; font-size: 12px; align-self: center;">+${cleanImages.length - 6}Âºµ</div>`;
            }
            
            previewHTML += '</div>';
            previewContainer.innerHTML = previewHTML;
        }

        function removeCleanImage(imageId) {
            cleanImages = cleanImages.filter(img => img.id !== imageId);
            updateCleanImagePreview();
            
            if (cleanImages.length === 0) {
                document.getElementById('clean-merged-preview').innerHTML = '';
                showStatus('clean-status', '‚úÖ ÊâÄÊúâÁÖßÁâáÂ∑≤Ê∏ÖÈô§', 'success');
            }
        }

        function clearCleanImages() {
            cleanImages = [];
            document.getElementById('clean-images').value = '';
            document.getElementById('clean-image-preview').innerHTML = '';
            document.getElementById('clean-merged-preview').innerHTML = '';
            document.getElementById('clean-merge-controls').style.display = 'none';
            showStatus('clean-status', '‚úÖ ÊâÄÊúâÁÖßÁâáÂ∑≤Ê∏ÖÈô§', 'success');
        }

        function mergeCleanImages() {
            if (cleanImages.length === 0) {
                showStatus('clean-status', '‚ùå Ë´ãÂÖà‰∏äÂÇ≥ÁÖßÁâá', 'error');
                return;
            }

            showStatus('clean-status', 'üîÑ Ê≠£Âú®Âêà‰ΩµÁÖßÁâá...', 'success');

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            Promise.all(cleanImages.map(imageData => {
                return new Promise(resolve => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = imageData.dataUrl;
                });
            })).then(images => {
                // Smart grid layout based on image count
                let imagesPerRow, rows;
                if (images.length === 1) {
                    imagesPerRow = 1;
                    rows = 1;
                } else if (images.length === 2) {
                    imagesPerRow = 2;
                    rows = 1;
                } else if (images.length === 3) {
                    imagesPerRow = 3;
                    rows = 1;
                } else if (images.length === 4) {
                    imagesPerRow = 2;
                    rows = 2;
                } else if (images.length <= 6) {
                    imagesPerRow = 3;
                    rows = 2;
                } else if (images.length <= 9) {
                    imagesPerRow = 3;
                    rows = 3;
                } else {
                    imagesPerRow = 4;
                    rows = Math.ceil(images.length / 4);
                }
                
                const imageSize = Math.floor(600 / Math.max(imagesPerRow, rows));
                const totalWidth = imagesPerRow * imageSize;
                const totalHeight = rows * imageSize;
                
                // Optimize canvas size to reduce white space
                const actualWidth = Math.max(totalWidth, totalHeight);
                const actualHeight = Math.max(totalWidth, totalHeight);
                canvas.width = actualWidth;
                canvas.height = actualHeight;
                const finalMarginX = (actualWidth - totalWidth) / 2;
                const finalMarginY = (actualHeight - totalHeight) / 2;
                
                
                // Draw images in smart grid
                images.forEach((img, index) => {
                    const col = index % imagesPerRow;
                    const row = Math.floor(index / imagesPerRow);
                    const x = finalMarginX + col * imageSize;
                    const y = finalMarginY + row * imageSize;
                    
                    // Draw image as square (crop to fit)
                    const aspectRatio = img.width / img.height;
                    let sourceX = 0, sourceY = 0, sourceSize;
                    
                    if (aspectRatio > 1) {
                        // ÂØ¨ÂúñÁâáÔºåË£ÅÂàáÂ∑¶Âè≥
                        sourceSize = img.height;
                        sourceX = (img.width - sourceSize) / 2;
                    } else {
                        // È´òÂúñÁâáÔºåË£ÅÂàá‰∏ä‰∏ã
                        sourceSize = img.width;
                        sourceY = (img.height - sourceSize) / 2;
                    }
                    
                    ctx.drawImage(img, sourceX, sourceY, sourceSize, sourceSize, x, y, imageSize, imageSize);
                    
                    // Draw red grid lines
                    ctx.strokeStyle = '#FF0000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x, y, imageSize, imageSize);
                });
                
                
                const mergedDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                const mergedPreview = document.getElementById('clean-merged-preview');
                mergedPreview.innerHTML = `
                    <div class="merged-photo">
                        <div class="merged-photo-content">
                            <div><strong>Âêà‰ΩµÁÖßÁâáÔºö</strong></div>
                            <img src="${mergedDataUrl}" alt="Âêà‰ΩµÁÖßÁâá">
                        </div>
                        <div class="merged-photo-controls">
                            <button class="btn-download" onclick="downloadMergedImage('${mergedDataUrl}', 'clean')">‚Üì</button>
                        </div>
                    </div>
                `;
                
                showStatus('clean-status', `‚úÖ Â∑≤ÊàêÂäüÂêà‰Ωµ ${images.length} ÂºµÁÖßÁâáÔºÅ`, 'success');
            });
        }

        // Ëá™ÂãïÂ†±ÂÉπÂñÆÁõ∏ÈóúÂáΩÊï∏
        let autoQuoteData = null;
        
        // Â≠òÂÑ≤Áî®Êà∂ÈÅ∏‰∏≠ÁöÑË≥áÊñôË°å
        let selectedAutoQuoteData = null;
        let selectedAutoQuoteRowIndex = -1;

        function clearAutoQuoteForm() {
            // Ê∏ÖÁ©∫GoogleË©¶ÁÆóË°®Á∂≤ÂùÄ
            document.getElementById('sheets-url').value = '';
            document.getElementById('saved-urls').value = '';
            
            // Ê∏ÖÁ©∫ÊâãÂãïËº∏ÂÖ•Ê¨Ñ‰Ωç
            document.getElementById('manual-fee').value = '';
            document.getElementById('manual-time').value = '';
            document.getElementById('manual-floor').value = '';
            document.getElementById('manual-frequency').value = '';
            document.getElementById('manual-trash').value = '';
            document.getElementById('manual-recycle').value = '';
            document.getElementById('manual-trash-max').value = '';
            document.getElementById('manual-recycle-max').value = '';
            document.getElementById('manual-special-notes').value = '';
            
            // Ê∏ÖÁ©∫Ë§áÈÅ∏Ê°ÜÂíåÂñÆÈÅ∏Ê°Ü
            document.querySelectorAll('input[name="manual-days"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="manual-trash-volume"]').forEach(rb => rb.checked = false);
            document.querySelectorAll('input[name="manual-recycle-volume"]').forEach(rb => rb.checked = false);
            
            // Èö±ËóèËº∏Âá∫ÂçÄÂüü
            document.getElementById('auto-detected-data').style.display = 'none';
            document.getElementById('auto-quote-controls').style.display = 'none';
            document.getElementById('auto-quote-output').style.display = 'none';
            document.getElementById('auto-sheets-status').style.display = 'none';
            document.getElementById('auto-quote-final-status').style.display = 'none';
            
            // Ê∏ÖÁ©∫Êï∏Êìö
            autoQuoteData = null;
            selectedAutoQuoteData = null;
            selectedAutoQuoteRowIndex = -1;
        }

        async function fetchGoogleSheetsData() {
            const sheetsUrl = document.getElementById('sheets-url').value.trim();
            
            if (!sheetsUrl) {
                showStatus('auto-sheets-status', '‚ùå Ë´ãËº∏ÂÖ•GoogleË©¶ÁÆóË°®Á∂≤ÂùÄ', 'error');
                return;
            }

            if (!sheetsUrl.includes('docs.google.com/spreadsheets')) {
                showStatus('auto-sheets-status', '‚ùå Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑGoogleË©¶ÁÆóË°®ÈÄ£Áµê', 'error');
                return;
            }

            showStatus('auto-sheets-status', 'üîÑ Ê≠£Âú®ËºâÂÖ•Ë©¶ÁÆóË°®Ë≥áÊñô...', 'success');

            try {
                // ÂæûURL‰∏≠ÊèêÂèñË©¶ÁÆóË°®ID
                let spreadsheetId = '';
                const urlMatch = sheetsUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (urlMatch) {
                    spreadsheetId = urlMatch[1];
                } else {
                    throw new Error('ÁÑ°Ê≥ïËß£ÊûêË©¶ÁÆóË°®IDÔºåË´ãÁ¢∫Ë™çURLÊ†ºÂºèÊ≠£Á¢∫');
                }

                // ÊßãÂª∫CSVÂ∞éÂá∫URL - Êõ¥Á©©ÂÆöÁöÑÊñπÂºè
                const csvUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv`;
                
                console.log('Ê≠£Âú®ÂòóË©¶ËºâÂÖ•:', csvUrl);

                // ‰ΩøÁî®‰ª£ÁêÜÊñπÂºèÈÅøÂÖçCORSÂïèÈ°å
                const proxyUrl = `https://cors-anywhere.herokuapp.com/${csvUrl}`;
                let response;
                
                try {
                    // È¶ñÂÖàÂòóË©¶Áõ¥Êé•Ë®™Âïè
                    response = await fetch(csvUrl, {
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/csv,text/plain'
                        }
                    });
                } catch (corsError) {
                    console.log('Áõ¥Êé•Ë®™ÂïèÂ§±ÊïóÔºåÂòóË©¶‰ª£ÁêÜÊñπÂºè:', corsError);
                    // Â¶ÇÊûúCORSÂ§±ÊïóÔºåÈ°ØÁ§∫Ë™™Êòé
                    throw new Error('Áî±ÊñºÁÄèË¶ΩÂô®ÂÆâÂÖ®ÈôêÂà∂ÔºåÁÑ°Ê≥ïÁõ¥Êé•ËÆÄÂèñGoogleË©¶ÁÆóË°®„ÄÇË´ãÁ¢∫Ë™çÔºö\n1. Ë©¶ÁÆóË°®Â∑≤Ë®≠ÁÇ∫„ÄåÁü•ÈÅìÈÄ£ÁµêÁöÑ‰ΩøÁî®ËÄÖ„ÄçÂèØÊ™¢Ë¶ñ\n2. ÊàñÊâãÂãïË§áË£ΩË≤º‰∏äË≥áÊñôÂà∞‰∏ãÊñπ');
                }

                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ÁÑ°Ê≥ïÂ≠òÂèñË©¶ÁÆóË°®ÔºåË´ãÁ¢∫Ë™çÂàÜ‰∫´Ë®≠ÂÆöÁÇ∫„ÄåÁü•ÈÅìÈÄ£ÁµêÁöÑ‰ΩøÁî®ËÄÖ„ÄçÂèØÊ™¢Ë¶ñ');
                    } else if (response.status === 404) {
                        throw new Error('Êâæ‰∏çÂà∞Ë©¶ÁÆóË°®ÔºåË´ãÁ¢∫Ë™çÁ∂≤ÂùÄÊ≠£Á¢∫');
                    } else {
                        throw new Error(`ËºâÂÖ•Â§±Êïó (ÈåØË™§‰ª£Á¢º: ${response.status})`);
                    }
                }

                const csvText = await response.text();
                console.log('CSVË≥áÊñô:', csvText.substring(0, 200) + '...');
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('Ë©¶ÁÆóË°®Ë≥áÊñôÁÇ∫Á©∫ÔºåË´ãÁ¢∫Ë™çË°®Ê†º‰∏≠ÊúâË≥áÊñô');
                }

                // ÊîπÈÄ≤ÁöÑCSVËß£Êûê
                const rows = parseCSV(csvText);
                const filteredRows = rows.filter(row => row.some(cell => cell && cell.length > 0));
                
                if (filteredRows.length === 0) {
                    throw new Error('Ë©¶ÁÆóË°®‰∏≠Ê≤íÊúâÊâæÂà∞‰ªª‰ΩïÊúâÊïàË≥áÊñô');
                }

                const startRow = 1; // Âõ∫ÂÆöÂæûÁ¨¨2ÂàóÈñãÂßãÔºàË∑≥ÈÅéË°®È†≠Ôºâ
                const updateMode = document.getElementById('update-mode').value;
                
                // ÂèñÂæóË°®È†≠ÂíåË≥áÊñôË°å
                const headers = filteredRows[0] || [];
                const allDataRows = filteredRows.slice(1); // ÁßªÈô§Ë°®È†≠Ë°å
                
                let dataRows;
                if (updateMode === 'latest') {
                    dataRows = allDataRows.slice(-1);
                } else if (updateMode === 'last-5') {
                    dataRows = allDataRows.slice(-5);
                } else if (updateMode === 'last-10') {
                    dataRows = allDataRows.slice(-10);
                } else if (updateMode === 'last-20') {
                    dataRows = allDataRows.slice(-20);
                } else {
                    dataRows = allDataRows; // ÊâÄÊúâË≥áÊñôÊ®°Âºè
                }

                autoQuoteData = {
                    headers: headers,
                    rows: dataRows
                };

                displayDetectedData(autoQuoteData);
                showStatus('auto-sheets-status', `‚úÖ ÊàêÂäüËºâÂÖ• ${dataRows.length} Á≠ÜË≥áÊñô`, 'success');

            } catch (error) {
                console.error('ËºâÂÖ•Ë©¶ÁÆóË°®Â§±Êïó:', error);
                showStatus('auto-sheets-status', `‚ùå ${error.message}`, 'error');
                
                // È°ØÁ§∫ÊâãÂãïËº∏ÂÖ•ÈÅ∏È†Ö
                showManualDataInput();
            }
        }

        // ÊîπÈÄ≤ÁöÑCSVËß£ÊûêÂáΩÊï∏ - ‰øÆÂæ©Â§öË°åÊ®ôÈ°åÂïèÈ°å
        function parseCSV(csvText) {
            const rows = [];
            
            console.log('CSVÁ∏ΩË°åÊï∏:', csvText.split('\n').length);
            console.log('CSVÂâç500Â≠óÁ¨¶:', csvText.substring(0, 500));
            
            // Êõ¥Âº∑ÂÅ•ÁöÑCSVËß£Êûê - ËôïÁêÜÂµåÂÖ•ÂºèÊèõË°åÁ¨¶
            let current = '';
            let inQuotes = false;
            let currentRow = [];
            let i = 0;
            
            while (i < csvText.length) {
                const char = csvText[i];
                
                if (char === '"') {
                    if (inQuotes && i + 1 < csvText.length && csvText[i + 1] === '"') {
                        // ËôïÁêÜÈõôÂºïËôüËΩâÁæ©
                        current += '"';
                        i += 2;
                        continue;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    // Âè™ÊúâÂú®‰∏çÂú®ÂºïËôüÂÖßÊôÇÊâçË¶ñÁÇ∫Ë°åÁµêÊùü
                    if (current.trim() || currentRow.length > 0) {
                        currentRow.push(current.trim().replace(/^"|"$/g, ''));
                        if (currentRow.some(cell => cell.length > 0)) {
                            rows.push(currentRow);
                        }
                        currentRow = [];
                        current = '';
                    }
                } else if (char !== '\r') {
                    // Âú®ÂºïËôüÂÖßÊôÇÔºå‰øùÁïôÊèõË°åÁ¨¶
                    current += char;
                }
                
                i++;
            }
            
            // ËôïÁêÜÊúÄÂæå‰∏ÄË°å
            if (current.trim() || currentRow.length > 0) {
                currentRow.push(current.trim().replace(/^"|"$/g, ''));
                if (currentRow.some(cell => cell.length > 0)) {
                    rows.push(currentRow);
                }
            }
            
            // ÂÅµÈåØÁ¨¨‰∏ÄË°åÁöÑËß£ÊûêÁµêÊûú
            if (rows.length > 0) {
                console.log('Ê®ôÈ°åË°åËß£ÊûêÁµêÊûú:', rows[0]);
                console.log('Ê®ôÈ°åË°åÊ¨Ñ‰ΩçÊï∏Èáè:', rows[0].length);
                console.log('Ââç5ÂÄãÊ®ôÈ°å:', rows[0].slice(0, 5));
            }
            
            return rows;
        }

        // È°ØÁ§∫ÊâãÂãïË≥áÊñôËº∏ÂÖ•ÈÅ∏È†Ö
        function showManualDataInput() {
            const detectedDataDiv = document.getElementById('auto-detected-data');
            detectedDataDiv.style.display = 'block';
            
            const preview = document.getElementById('detected-data-preview');
            preview.innerHTML = `
                <div style="text-align: center; padding: 20px; background: #333; border-radius: 8px;">
                    <h4 style="color: #ffd700; margin-bottom: 15px;">üìã ÊâãÂãïË≥áÊñôËº∏ÂÖ•</h4>
                    <p style="color: #e0e0e0; margin-bottom: 15px;">Áî±ÊñºËá™ÂãïËÆÄÂèñÂ§±ÊïóÔºåË´ãÊâãÂãïËº∏ÂÖ•ÂÆ¢Êà∂Ë≥áÊñôÔºö</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="manual-name" placeholder="ÂÆ¢Êà∂ÂßìÂêç" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-address" placeholder="ÊúçÂãôÂú∞ÂùÄ" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-phone" placeholder="ËÅØÁµ°ÈõªË©±" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-fee" placeholder="ÊúàË≤ª" value="1200" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-days" placeholder="ÊúçÂãôÊòüÊúü" value="ÈÄ±‰∫å„ÄÅÈÄ±‰∫î" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="text" id="manual-time" placeholder="ÊúçÂãôÊôÇÈñì" value="0800" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-floor" placeholder="Ê®ìÂ±§" value="1" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-trash" placeholder="ÂûÉÂúæË¢ãÊï∏" value="6" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                        <input type="number" id="manual-recycle" placeholder="Ë≥áÊ∫êË¢ãÊï∏" value="3" style="padding: 8px; border-radius: 4px; border: 1px solid #666; background: #2a2a2a; color: #fff;">
                    </div>
                    <button onclick="useManualData()" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 20px; cursor: pointer; font-weight: bold;">
                        ‚úÖ ‰ΩøÁî®ÊâãÂãïË≥áÊñôÁîüÊàêÂ†±ÂÉπÂñÆ
                    </button>
                </div>
            `;
            
            document.getElementById('auto-quote-controls').style.display = 'none';
        }

        // ‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑË≥áÊñô
        function useManualData() {
            showStatus('auto-sheets-status', 'üîÑ Ê≠£Âú®‰ΩøÁî®ÊâãÂãïË≥áÊñôÁîüÊàêÂ†±ÂÉπÂñÆ...', 'success');
            
            const selectedDays = Array.from(document.querySelectorAll('input[name="manual-days"]:checked')).map(cb => cb.value);
            const manualData = {
                lineName: '',
                address: '',
                housingType: '',
                monthlyFee: document.getElementById('manual-fee').value || '',
                serviceDays: selectedDays.join('„ÄÅ') || '',
                serviceTime: document.getElementById('manual-time').value || '',
                floor: document.getElementById('manual-floor').value || '',
                trashBags: document.getElementById('manual-trash').value || '',
                recycleBags: document.getElementById('manual-recycle').value || '',
                trashVolume: document.querySelector('input[name="manual-trash-volume"]:checked')?.value || '',
                recycleVolume: document.querySelector('input[name="manual-recycle-volume"]:checked')?.value || '',
                trashMax: document.getElementById('manual-trash-max').value || '',
                recycleMax: document.getElementById('manual-recycle-max').value || '',
                specialNotes: document.getElementById('manual-special-notes').value || ''
            };

            try {
                const quote = generateQuoteFromData(manualData);
                document.getElementById('auto-quote-result-display').textContent = quote;
                document.getElementById('auto-quote-output').style.display = 'block';
                
                // È°ØÁ§∫‰ΩøÁî®ÁöÑË≥áÊñôÈ†êË¶Ω
                const preview = document.getElementById('detected-data-preview');
                preview.innerHTML = `
                    <div style="background: #2a2a2a; padding: 15px; border-radius: 8px; color: #e0e0e0;">
                        <h4 style="color: #28a745; margin-bottom: 10px;">‚úÖ ‰ΩøÁî®ÁöÑÊâãÂãïË≥áÊñôÔºö</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div><strong>ÊúàË≤ªÔºö</strong> ${manualData.monthlyFee}ÂÖÉ</div>
                            <div><strong>Êî∂ÂèñÊòüÊúüÔºö</strong> ${manualData.serviceDays}</div>
                            <div><strong>ÊúçÂãôÊôÇÈñìÔºö</strong> ${manualData.serviceTime}</div>
                            <div><strong>Ê®ìÂ±§Ôºö</strong> ${manualData.floor}Ê®ì</div>
                            <div><strong>ÂûÉÂúæË¢ãÊï∏Ôºö</strong> ${manualData.trashBags}ÂåÖ</div>
                            <div><strong>Ë≥áÊ∫êË¢ãÊï∏Ôºö</strong> ${manualData.recycleBags}ÂåÖ</div>
                            <div><strong>ÂûÉÂúæË¢ãÂÆπÈáèÔºö</strong> ${manualData.trashVolume}</div>
                            <div><strong>Ë≥áÊ∫êË¢ãÂÆπÈáèÔºö</strong> ${manualData.recycleVolume}</div>
                            <div><strong>ÊúÄÂ§öÂûÉÂúæË¢ãÊï∏Ôºö</strong> ${manualData.trashMax}Ë¢ã</div>
                            <div><strong>ÊúÄÂ§öË≥áÊ∫êË¢ãÊï∏Ôºö</strong> ${manualData.recycleMax}Ë¢ã</div>
                            ${manualData.specialNotes ? `<div><strong>ÁâπÊÆäÈúÄÊ±ÇÔºö</strong> ${manualData.specialNotes}</div>` : ''}
                        </div>
                    </div>
                `;
                
                document.getElementById('auto-detected-data').style.display = 'block';
                showStatus('auto-quote-final-status', '‚úÖ ÊâãÂãïË≥áÊñôÂ†±ÂÉπÂñÆÁîüÊàêÂÆåÊàêÔºÅ', 'success');
                
            } catch (error) {
                showStatus('auto-quote-final-status', `‚ùå ÁîüÊàêÂ§±Êïó: ${error.message}`, 'error');
            }
        }

        function displayDetectedData(data) {
            const preview = document.getElementById('detected-data-preview');
            let html = '<table style="width: 100%; border-collapse: collapse; color: #e0e0e0;">';
            
            if (data.headers.length > 0) {
                html += '<tr style="background: #404040;">';
                data.headers.forEach(header => {
                    // Á∞°ÂåñË°®È†≠È°ØÁ§∫ÔºöÁßªÈô§Ë°®ÊÉÖÁ¨¶ËôüÔºåÊèêÂèñÈóúÈçµÂ≠ó
                    let simplifiedHeader = header;
                    
                    // ÁßªÈô§ÊâÄÊúâË°®ÊÉÖÁ¨¶Ëôü
                    simplifiedHeader = simplifiedHeader.replace(/[\u{1F000}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
                    
                    // Âà§Êñ∑Ê¨Ñ‰ΩçÈ°ûÂûã
                    const isResourceField = header.toLowerCase().includes('Ë≥áÊ∫ê');
                    const isTrashField = header.toLowerCase().includes('ÂûÉÂúæ');
                    
                    // ÊèêÂèñÈóúÈçµÂ≠óÔºàÊñπÊã¨ËôüÂÖßÁöÑÂÖßÂÆπÊàñÊúÄÂæåÁöÑÈáçË¶ÅË©ûÂΩôÔºâ
                    const bracketMatch = simplifiedHeader.match(/\[([^\]]+)\]/);
                    if (bracketMatch) {
                        simplifiedHeader = bracketMatch[1];
                    } else {
                        // Â¶ÇÊûúÊ≤íÊúâÊñπÊã¨ËôüÔºåÊèêÂèñÊúÄÂæåÁöÑÈóúÈçµË©û
                        if (simplifiedHeader.includes('Âú∞ÂùÄ')) {
                            simplifiedHeader = 'Âú∞ÂùÄ';
                        } else {
                            simplifiedHeader = simplifiedHeader.trim()
                                .replace(/.*ÂûÉÂúæ.*/, 'ÂûÉÂúæÈáè')
                                .replace(/.*Ë≥áÊ∫ê.*/, 'Ë≥áÊ∫êÈáè')
                                .replace(/.*ÊúàË≤ª.*|.*Ë≤ªÁî®.*/, 'ÊúàË≤ª')
                                .replace(/.*ÊòüÊúü.*|.*Êî∂Âèñ.*/, 'Ê¨°Êï∏')
                                .replace(/.*ÊôÇÈñì.*/, 'ÊôÇÈñì')
                                .replace(/.*Ê®ìÂ±§.*/, 'Ê®ìÂ±§')
                                .replace(/.*line.*|.*Êö±Á®±.*/, 'LINEÊö±Á®±')
                                .replace(/.*‰ΩèÂÆÖ.*|.*ÊÄßË≥™.*/, '‰ΩèÂÆÖÊÄßË≥™');
                        }
                    }
                    
                    // Ê∏ÖÁêÜÂ§öÈ§òÁöÑÁ©∫Ê†ºÂíåÁ¨¶Ëôü
                    simplifiedHeader = simplifiedHeader.replace(/["""'']/g, '').trim();
                    
                    // Ë®≠ÂÆöÊ®£ÂºèÔºöÂûÉÂúæÊ¨Ñ‰ΩçÁî®Á¥ÖËâ≤ÔºåË≥áÊ∫êÊ¨Ñ‰ΩçÁî®Á∂†Ëâ≤
                    let backgroundColor = '#404040';
                    let textColor = '#e0e0e0';
                    
                    if (isTrashField) {
                        backgroundColor = '#dc3545'; // Á¥ÖËâ≤
                        textColor = '#ffffff';
                    } else if (isResourceField) {
                        backgroundColor = '#28a745'; // Á∂†Ëâ≤
                        textColor = '#ffffff';
                    }
                    
                    html += `<th style="border: 1px solid #666; padding: 8px; text-align: left; background-color: ${backgroundColor}; color: ${textColor};">${simplifiedHeader}</th>`;
                });
                html += '</tr>';
            }

            data.rows.forEach((row, index) => {
                html += `<tr onclick="selectAutoQuoteRowForQuote(${index})" style="cursor: pointer; background: ${index % 2 === 0 ? '#2a2a2a' : '#333333'};" class="auto-data-row" title="ÈªûÊìäÈÅ∏ÊìáÊ≠§Ë≥áÊñô‰ΩúÁÇ∫Â†±ÂÉπÂñÆ‰æÜÊ∫ê" onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='${index % 2 === 0 ? '#2a2a2a' : '#333333'}'">`;
                row.forEach(cell => {
                    html += `<td style="border: 1px solid #666; padding: 8px;">${cell}</td>`;
                });
                html += '</tr>';
            });

            html += '</table>';
            preview.innerHTML = html;
            
            document.getElementById('auto-detected-data').style.display = 'block';
            document.getElementById('auto-quote-controls').style.display = 'none'; // ÂÖàÈö±ËóèÁîüÊàêÊåâÈàïÔºåÈúÄË¶ÅÈÅ∏ÊìáË≥áÊñôÂæåÊâçÈ°ØÁ§∫
        }
        
        // ÈÅ∏ÊìáÂåÖÊúàËá™ÂãïÂ†±ÂÉπË≥áÊñôË°å
        function selectAutoQuoteRowForQuote(rowIndex) {
            console.log('selectAutoQuoteRowForQuote called with index:', rowIndex);
            
            if (!autoQuoteData || !autoQuoteData.rows || rowIndex >= autoQuoteData.rows.length) {
                console.error('Invalid row index or data not available');
                return;
            }
            
            const headers = autoQuoteData.headers;
            const selectedRowData = autoQuoteData.rows[rowIndex];
            
            console.log('Available headers:', headers);
            console.log('Selected row data:', selectedRowData);
            
            // Êõ¥Êñ∞ÈÅ∏‰∏≠Ë°åÁöÑË¶ñË¶∫ÊïàÊûú
            const allRows = document.querySelectorAll('.auto-data-row');
            allRows.forEach((row, index) => {
                if (index === rowIndex) {
                    row.style.border = '3px solid #FFD700';
                    row.style.background = '#4a4a00';
                } else {
                    row.style.border = '';
                    row.style.background = index % 2 === 0 ? '#2a2a2a' : '#333333';
                }
            });
            
            // ÂÑ≤Â≠òÈÅ∏‰∏≠ÁöÑË≥áÊñô
            selectedAutoQuoteData = selectedRowData;
            selectedAutoQuoteRowIndex = rowIndex;
            
            // È°ØÁ§∫ÁîüÊàêÊåâÈàï
            document.getElementById('auto-quote-controls').style.display = 'block';
            
            // ÂÅµÊ∏¨‰∏¶È†êË¶ΩÈÅ∏‰∏≠Ë≥áÊñôÁöÑÈóúÈçµË≥áË®ä
            const previewData = {};
            headers.forEach((header, index) => {
                const cellValue = selectedRowData[index];
                const lowerHeader = header.toLowerCase();
                
                if (lowerHeader.includes('line') || lowerHeader.includes('Êö±Á®±')) {
                    previewData.lineName = cellValue;
                } else if (header.includes('Âú∞ÂùÄ') || header.includes('ÂçÄÂüü')) {
                    previewData.address = cellValue;
                } else if (lowerHeader.includes('ÊúàË≤ª') || lowerHeader.includes('Ë≤ªÁî®')) {
                    previewData.monthlyFee = cellValue;
                } else if (header.includes('‰ΩèÂÆÖ') || header.includes('ÊÄßË≥™')) {
                    previewData.housingType = cellValue;
                }
            });
            
            // È°ØÁ§∫ÈÅ∏ÊìáÁãÄÊÖã
            let statusMsg = `‚úÖ Â∑≤ÈÅ∏ÊìáÁ¨¨ ${rowIndex + 1} Ë°åË≥áÊñô`;
            if (previewData.lineName) {
                statusMsg += ` | ÂÆ¢Êà∂: ${previewData.lineName}`;
            }
            if (previewData.address) {
                statusMsg += ` | Âú∞ÂùÄ: ${previewData.address.substring(0, 15)}...`;
            }
            if (previewData.monthlyFee) {
                statusMsg += ` | ÊúàË≤ª: ${previewData.monthlyFee}ÂÖÉ`;
            }
            
            showStatus('auto-sheets-status', statusMsg, 'success');
        }

        function generateAutoQuote() {
            if (!autoQuoteData || !autoQuoteData.rows || autoQuoteData.rows.length === 0) {
                showStatus('auto-quote-final-status', '‚ùå Ë´ãÂÖàËºâÂÖ•Ë©¶ÁÆóË°®Ë≥áÊñô', 'error');
                return;
            }
            
            if (selectedAutoQuoteData === null || selectedAutoQuoteRowIndex === -1) {
                showStatus('auto-quote-final-status', '‚ùå Ë´ãÂÖàÈªûÊìäÈÅ∏ÊìáË¶ÅÁî®ÊñºÁîüÊàêÂ†±ÂÉπÂñÆÁöÑË≥áÊñôË°å', 'error');
                return;
            }

            showStatus('auto-quote-final-status', 'üîÑ Ê≠£Âú®ÁîüÊàêËá™ÂãïÂ†±ÂÉπÂñÆ...', 'success');

            try {
                const selectedRow = selectedAutoQuoteData;
                const headers = autoQuoteData.headers;
                
                // ÂÖàÁç≤ÂèñÊâãÂãïËº∏ÂÖ•ÁöÑË≥áÊñô
                const selectedDays = Array.from(document.querySelectorAll('input[name="manual-days"]:checked')).map(cb => cb.value);
                const manualData = {
                    lineName: '',
                    address: '',
                    housingType: '',
                    monthlyFee: document.getElementById('manual-fee').value || '',
                    serviceDays: selectedDays.join('„ÄÅ') || '',
                    serviceTime: document.getElementById('manual-time').value || '',
                    floor: document.getElementById('manual-floor').value || '',
                    frequency: document.getElementById('manual-frequency').value || '',
                    trashBags: document.getElementById('manual-trash').value || '',
                    recycleBags: document.getElementById('manual-recycle').value || '',
                    trashVolume: document.querySelector('input[name="manual-trash-volume"]:checked')?.value || '',
                    recycleVolume: document.querySelector('input[name="manual-recycle-volume"]:checked')?.value || '',
                    trashMax: document.getElementById('manual-trash-max').value || '',
                    recycleMax: document.getElementById('manual-recycle-max').value || '',
                    specialNotes: document.getElementById('manual-special-notes').value || ''
                };
                
                console.log('Manual data collected:', manualData);

                const fieldMapping = {};
                console.log('Headers:', headers);
                console.log('Headers length:', headers.length);
                console.log('Selected row:', selectedRow);
                console.log('Selected row length:', selectedRow.length);
                
                // Êî∂ÈõÜÂûÉÂúæÂíåË≥áÊ∫êÁöÑÂåÖÊï∏ËàáÂÆπÈáèÊï∏Êìö
                let trashData = { bags: '', volume: '' };
                let recycleData = { bags: '', volume: '' };
                
                headers.forEach((header, index) => {
                    const lowerHeader = header.toLowerCase();
                    const cellValue = selectedRow[index];
                    console.log(`Processing header: "${header}" (${lowerHeader}) with value: "${cellValue}"`);
                    
                    // Êõ¥Á≤æÁ¢∫ÁöÑÊ¨Ñ‰ΩçÂÅµÊ∏¨ÈÇèËºØ
                    if (lowerHeader.includes('line') || lowerHeader.includes('Êö±Á®±')) {
                        fieldMapping.lineName = cellValue;
                        console.log(`Detected LINE name: ${cellValue}`);
                    } else if (header.includes('Âú∞ÂùÄ') || header.includes('ÂçÄÂüü') || (header.includes('Êî∂Âèñ') && (header.includes('Âú∞ÂùÄ') || header.includes('ÂçÄÂüü')))) {
                        fieldMapping.address = cellValue;
                        console.log(`Detected address from header "${header}": ${cellValue}`);
                        
                        // Ëá™ÂãïÂÅµÊ∏¨Âú∞ÂùÄ‰∏≠ÁöÑÊ®ìÂ±§Êï∏Â≠ó‰∏¶Â°´ÂÖ•Ê®ìÂ±§Ê¨Ñ‰ΩçÔºàÂè™Âú®ÊâãÂãïÊ¨Ñ‰ΩçÁÇ∫Á©∫ÊôÇÔºâ
                        if (cellValue && (!manualData.floor || manualData.floor.trim() === '')) {
                            const floorMatch = cellValue.match(/(\d+)[Ê®ìF]/);
                            if (floorMatch) {
                                fieldMapping.floor = floorMatch[1];
                                // Âè™Âú®ÊâãÂãïÊ¨Ñ‰ΩçÁÇ∫Á©∫ÊôÇËá™ÂãïÂ°´ÂÖ•
                                document.getElementById('manual-floor').value = floorMatch[1];
                                console.log(`Auto-detected floor: ${floorMatch[1]} from address: ${cellValue}`);
                            } else {
                                console.log(`No floor detected in address: ${cellValue}, keeping manual input`);
                            }
                        }
                    } else if (header.includes('‰ΩèÂÆÖ') || header.includes('ÊÄßË≥™')) {
                        fieldMapping.housingType = cellValue;
                        console.log(`Detected housing type from header "${header}": ${cellValue}`);
                    } else if (lowerHeader.includes('ÊúàË≤ª') || lowerHeader.includes('Ë≤ªÁî®')) {
                        // ÂÑ™ÂÖà‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑÊúàË≤ªÔºåÂÖ∂Ê¨°ÊòØË©¶ÁÆóË°®Êï∏Êìö
                        fieldMapping.monthlyFee = (manualData.monthlyFee && manualData.monthlyFee.trim() !== '') ? manualData.monthlyFee : cellValue;
                    } else if (lowerHeader.includes('ÊòüÊúü') || lowerHeader.includes('Êî∂Âèñ')) {
                        // ËôïÁêÜÊ¨°Êï∏Ê¨Ñ‰ΩçÔºåÁîüÊàê„Äå‰∏ÄÈÄ±Ë∂üÊï∏ÔºöXË∂ü„ÄçÊ†ºÂºè
                        if (cellValue && cellValue.trim() !== '') {
                            const frequencyMatch = cellValue.match(/(\d+)/);
                            if (frequencyMatch) {
                                fieldMapping.weeklyFrequency = `‰∏ÄÈÄ±Ë∂üÊï∏Ôºö${frequencyMatch[1]}Ë∂ü`;
                            } else {
                                fieldMapping.weeklyFrequency = `‰∏ÄÈÄ±Ë∂üÊï∏Ôºö${cellValue}Ë∂ü`;
                            }
                        }
                        // ‰øùÊåÅÂéüÊúâÁöÑÊúçÂãôÊó•ÈÇèËºØÔºåÂÑ™ÂÖà‰ΩøÁî®ÊâãÂãïÈÅ∏ÊìáÁöÑÊòüÊúü
                        fieldMapping.serviceDays = manualData.serviceDays;
                    } else if (lowerHeader.includes('ÊôÇÈñì')) {
                        // ÂÑ™ÂÖà‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑÊôÇÈñìÔºåÂÖ∂Ê¨°ÊòØË©¶ÁÆóË°®Êï∏Êìö
                        fieldMapping.serviceTime = (manualData.serviceTime && manualData.serviceTime.trim() !== '') ? manualData.serviceTime : cellValue;
                    } else if (lowerHeader.includes('Ê®ìÂ±§')) {
                        // ÂÑ™ÂÖà‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑÊ®ìÂ±§Ë≥áÊñôÔºåÂÖ∂Ê¨°ÊòØË©¶ÁÆóË°®‰∏≠ÁöÑÊ®ìÂ±§Ë≥áÊñôÔºåÊúÄÂæåÈ†êË®≠ÁÇ∫0
                        fieldMapping.floor = (manualData.floor && manualData.floor.trim() !== '') ? manualData.floor : ((cellValue && cellValue.trim() !== '') ? cellValue : '0');
                    } else if (lowerHeader.includes('ÂûÉÂúæ')) {
                        console.log(`Found trash header: "${header}" with value: "${cellValue}"`);
                        // Â¶ÇÊûúË©≤Ê¨Ñ‰ΩçÊúâÊï∏ÊìöÔºåÂêåÊôÇË®òÈåÑÂåÖÊï∏ÂíåÂÆπÈáè
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)ÂåÖ/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?ÂÖ¨Âçá)/);
                            
                            if (bagMatch) {
                                trashData.bags = bagMatch[1];
                                // ÂêåÊôÇË®òÈåÑË©≤Ê¨Ñ‰ΩçÂ∞çÊáâÁöÑÂÆπÈáè
                                if (headerVolumeMatch) {
                                    trashData.volume = headerVolumeMatch[1];
                                }
                                console.log(`Trash data found: ${trashData.bags}ÂåÖ in ${header} (volume: ${trashData.volume})`);
                            }
                        }
                    } else if (lowerHeader.includes('Ë≥áÊ∫ê')) {
                        console.log(`Found recycle header: "${header}" with value: "${cellValue}"`);
                        // Â¶ÇÊûúË©≤Ê¨Ñ‰ΩçÊúâÊï∏ÊìöÔºåÂêåÊôÇË®òÈåÑÂåÖÊï∏ÂíåÂÆπÈáè
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)ÂåÖ/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?ÂÖ¨Âçá)/);
                            
                            if (bagMatch) {
                                recycleData.bags = bagMatch[1];
                                // ÂêåÊôÇË®òÈåÑË©≤Ê¨Ñ‰ΩçÂ∞çÊáâÁöÑÂÆπÈáè
                                if (headerVolumeMatch) {
                                    recycleData.volume = headerVolumeMatch[1];
                                }
                                console.log(`Recycle data found: ${recycleData.bags}ÂåÖ in ${header} (volume: ${recycleData.volume})`);
                            }
                        }
                    }
                });
                
                // ÁµÑÂêàÂûÉÂúæË¢ãÊï∏Êìö
                if (manualData.trashBags || manualData.trashVolume) {
                    if (manualData.trashBags && manualData.trashVolume) {
                        fieldMapping.trashBags = `${manualData.trashBags}ÂåÖÊï∏Ôºà${manualData.trashVolume}Ôºâ`;
                    } else if (manualData.trashBags) {
                        fieldMapping.trashBags = `${manualData.trashBags}ÂåÖÊï∏Ôºà14ÂÖ¨ÂçáÔºâ`;
                    } else {
                        fieldMapping.trashBags = `6ÂåÖÊï∏Ôºà${manualData.trashVolume}Ôºâ`;
                    }
                } else if (trashData.bags && trashData.volume) {
                    fieldMapping.trashBags = `${trashData.bags}ÂåÖÔºà${trashData.volume}Ôºâ`;
                } else if (trashData.bags) {
                    fieldMapping.trashBags = `${trashData.bags}ÂåÖÔºà14ÂÖ¨ÂçáÔºâ`;
                } else {
                    fieldMapping.trashBags = '6ÂåÖÔºà14ÂÖ¨ÂçáÔºâ';
                }
                
                // ÁµÑÂêàË≥áÊ∫êË¢ãÊï∏Êìö
                if (manualData.recycleBags || manualData.recycleVolume) {
                    if (manualData.recycleBags && manualData.recycleVolume) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}ÂåÖÊï∏Ôºà${manualData.recycleVolume}Ôºâ`;
                    } else if (manualData.recycleBags) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}ÂåÖÊï∏Ôºà14ÂÖ¨ÂçáÔºâ`;
                    } else {
                        fieldMapping.recycleBags = `3ÂåÖÊï∏Ôºà${manualData.recycleVolume}Ôºâ`;
                    }
                } else if (recycleData.bags && recycleData.volume) {
                    fieldMapping.recycleBags = `${recycleData.bags}ÂåÖÔºà${recycleData.volume}Ôºâ`;
                } else if (recycleData.bags) {
                    fieldMapping.recycleBags = `${recycleData.bags}ÂåÖÔºà14ÂÖ¨ÂçáÔºâ`;
                } else {
                    fieldMapping.recycleBags = '3ÂåÖÔºà14ÂÖ¨ÂçáÔºâ';
                }
                
                console.log(`Final trash data: bags="${trashData.bags}", volume="${trashData.volume}", result="${fieldMapping.trashBags}"`);
                console.log(`Final recycle data: bags="${recycleData.bags}", volume="${recycleData.volume}", result="${fieldMapping.recycleBags}"`);
                
                console.log('Final field mapping:', fieldMapping);
                
                // Âä†ÂÖ•ÊâãÂãïËº∏ÂÖ•ÁöÑÂÖ∂‰ªñÊï∏Êìö
                if (manualData.trashMax) {
                    fieldMapping.trashMax = manualData.trashMax;
                }
                if (manualData.recycleMax) {
                    fieldMapping.recycleMax = manualData.recycleMax;
                }
                if (manualData.specialNotes) {
                    fieldMapping.specialNotes = manualData.specialNotes;
                }
                // Á¢∫‰øùÊâãÂãïËº∏ÂÖ•ÁöÑÈáçË¶ÅÊ¨Ñ‰ΩçÊ≠£Á¢∫ÂÇ≥ÈÅûÔºàË¶ÜËìã‰πãÂâçÁöÑË®≠ÂÆöÔºâ
                if (manualData.frequency) {
                    fieldMapping.frequency = manualData.frequency;
                }
                // Á¢∫‰øùÊâãÂãïËº∏ÂÖ•ÁöÑÊî∂ÂèñÊòüÊúü‰∏ÄÂÆöÂÑ™ÂÖà‰ΩøÁî®
                if (manualData.serviceDays && manualData.serviceDays.trim() !== '') {
                    fieldMapping.serviceDays = manualData.serviceDays;
                }
                // Á¢∫‰øùÊâãÂãïËº∏ÂÖ•ÁöÑÊ®ìÂ±§‰∏ÄÂÆöÂÑ™ÂÖà‰ΩøÁî®
                if (manualData.floor && manualData.floor.trim() !== '') {
                    fieldMapping.floor = manualData.floor;
                }
                // Á¢∫‰øùÊâãÂãïËº∏ÂÖ•ÁöÑÊúàË≤ª‰∏ÄÂÆöÂÑ™ÂÖà‰ΩøÁî®
                if (manualData.monthlyFee && manualData.monthlyFee.trim() !== '') {
                    fieldMapping.monthlyFee = manualData.monthlyFee;
                }
                // Á¢∫‰øùÊâãÂãïËº∏ÂÖ•ÁöÑÊôÇÈñì‰∏ÄÂÆöÂÑ™ÂÖà‰ΩøÁî®
                if (manualData.serviceTime && manualData.serviceTime.trim() !== '') {
                    fieldMapping.serviceTime = manualData.serviceTime;
                }
                
                console.log('Final fieldMapping with manual overrides:', fieldMapping);

                // ÁîüÊàêÁ´∂Áà≠Âª†ÂïÜÊØîËºÉ
                generateVendorComparison(fieldMapping);

                const quote = generateQuoteFromData(fieldMapping);
                
                document.getElementById('auto-quote-result-display').textContent = quote;
                document.getElementById('auto-quote-output').style.display = 'block';
                showStatus('auto-quote-final-status', '‚úÖ Ëá™ÂãïÂ†±ÂÉπÂñÆÁîüÊàêÂÆåÊàêÔºÅ', 'success');

            } catch (error) {
                console.error('ÁîüÊàêÂ†±ÂÉπÂñÆÂ§±Êïó:', error);
                showStatus('auto-quote-final-status', `‚ùå ÁîüÊàêÂ§±Êïó: ${error.message}`, 'error');
            }
        }

        function generateQuoteFromData(data) {
            const lineName = data.lineName || '';
            const address = data.address || '';
            const housingType = data.housingType || '';
            const monthlyFee = (data.monthlyFee && data.monthlyFee.trim() !== '') ? data.monthlyFee : '0';
            const serviceDays = data.serviceDays || 'ÈÄ±‰∫å„ÄÅÈÄ±‰∫î';
            const serviceTime = (data.serviceTime && data.serviceTime.trim() !== '') ? data.serviceTime : '0';
            const floor = (data.floor && data.floor.trim() !== '') ? data.floor : '0';
            const trashBags = data.trashBags || '6';
            const recycleBags = data.recycleBags || '3';

            // Ê®ìÂ±§È°ØÁ§∫
            let floorDisplay;
            const floorNum = parseInt(floor);
            if (floorNum < 0) {
                floorDisplay = `Âú∞‰∏ã${Math.abs(floorNum)}Ê®ì`;
            } else {
                floorDisplay = `${floorNum}F`;
            }

            // ÊôÇÈñìÊ†ºÂºèÂåñ - Ê†πÊìöÊôÇÈñìËá™ÂãïÂà§Êñ∑‰∏äÂçà/‰∏ãÂçà/Êôö‰∏ä
            let timeDisplay = serviceTime;
            if (serviceTime && serviceTime.length === 4 && /^\d{4}$/.test(serviceTime)) {
                const hour = parseInt(serviceTime.substring(0, 2));
                const minute = serviceTime.substring(2);
                
                let period;
                if (hour >= 6 && hour < 12) {
                    period = '‰∏äÂçà';
                } else if (hour >= 12 && hour < 18) {
                    period = '‰∏ãÂçà';
                } else {
                    period = 'ÊôöÈñì';
                }
                
                timeDisplay = `${period} ${hour.toString().padStart(2, '0')}Ôºö${minute}`;
            } else if (serviceTime && serviceTime.includes(':')) {
                // Â¶ÇÊûúÂ∑≤Á∂ìÊòØÊôÇÈñìÊ†ºÂºèÔºåÊ™¢Êü•ÊòØÂê¶ÈúÄË¶ÅÂä†‰∏äÊôÇÊÆµ
                const timeMatch = serviceTime.match(/(\d{1,2}):(\d{2})/);
                if (timeMatch) {
                    const hour = parseInt(timeMatch[1]);
                    const minute = timeMatch[2];
                    
                    let period;
                    if (hour >= 6 && hour < 12) {
                        period = '‰∏äÂçà';
                    } else if (hour >= 12 && hour < 18) {
                        period = '‰∏ãÂçà';
                    } else {
                        period = 'ÊôöÈñì';
                    }
                    
                    timeDisplay = `${period} ${hour.toString().padStart(2, '0')}Ôºö${minute}`;
                } else {
                    timeDisplay = serviceTime;
                }
            } else if (!serviceTime || serviceTime.trim() === '' || serviceTime === '0') {
                // Â¶ÇÊûúÊ≤íÊúâËº∏ÂÖ•ÊôÇÈñìÊàñÊôÇÈñìÁÇ∫0ÔºåÈ°ØÁ§∫0
                timeDisplay = '0';
            }

            // Êî∂ÂèñÊôÇÈñìÊèèËø∞ - Ê†πÊìöÊôÇÈñìÊÆµÂãïÊÖãÁîüÊàê
            let collectionTimeDesc = '';
            if (timeDisplay.includes('‰∏äÂçà')) {
                collectionTimeDesc = '‰∏≠ÂçàÂâç';
            } else if (timeDisplay.includes('‰∏ãÂçà')) {
                collectionTimeDesc = '‰∏ãÂçàÂâç';
            } else if (timeDisplay.includes('ÊôöÈñì')) {
                collectionTimeDesc = 'ÂçäÂ§úÂâç';
            } else {
                collectionTimeDesc = '‰∏≠ÂçàÂâç';
            }

            // Èë∞ÂåôÊèêÁ§∫ - Ê†πÊìöÊ®ìÂ±§ÂãïÊÖãÁîüÊàê
            const keyNote = floorNum > 1 ? 'Ôºà‰∏äÊ®ì‰ª£Êî∂ÈúÄÊèê‰æõ1Ê®ìÂ§ßÈñÄÈë∞ÂåôÔºâ' : 
                           floorNum < 0 ? 'ÔºàÂú∞‰∏ãÂÆ§‰ª£Êî∂ÈúÄÊèê‰æõÂú∞‰∏ãÂÆ§Èë∞ÂåôÔºâ' : '';

            // ÊúçÂãôÊòüÊúüÊ†ºÂºèÂåñ
            let daysDisplay = serviceDays;
            if (serviceDays.includes('ÈÄ±')) {
                daysDisplay = serviceDays.replace(/ÈÄ±/g, 'ÈÄ±').replace(/„ÄÅ/g, '+');
            }

            // ËôïÁêÜÂûÉÂúæË¢ãÈ°ØÁ§∫Ê†ºÂºè
            let trashDisplay;
            if (typeof trashBags === 'string' && (trashBags.includes('ÂÖ¨Âçá') || trashBags.includes('ÂåÖ'))) {
                // Â¶ÇÊûúÂ∑≤Á∂ìÂåÖÂê´ÂÆåÊï¥Ê†ºÂºèÔºàÂ¶ÇÔºö3ÂåÖ 75/76ÂÖ¨ÂçáÔºâÔºåÈúÄË¶ÅËΩâÊèõÁÇ∫Ê®ôÊ∫ñÊ†ºÂºè
                if (trashBags.includes('ÂåÖ') && trashBags.includes('ÂÖ¨Âçá')) {
                    // ÊèêÂèñÂåÖÊï∏ÂíåÂÆπÈáè
                    const bagMatch = trashBags.match(/(\d+)ÂåÖ/);
                    const volumeMatch = trashBags.match(/(\d+(?:\/\d+)?ÂÖ¨Âçá)/);
                    if (bagMatch && volumeMatch) {
                        trashDisplay = `${bagMatch[1]}ÂåÖÊï∏Ôºà${volumeMatch[1]}Ôºâ`;
                    } else {
                        trashDisplay = trashBags;
                    }
                } else {
                    trashDisplay = trashBags;
                }
            } else {
                // Âê¶ÂâáÂæûÊï∏Â≠óÂª∫Á´ãÊ†ºÂºè
                const trashNum = parseInt(trashBags) || 6;
                trashDisplay = `${trashNum}ÂåÖÊï∏Ôºà14ÂÖ¨ÂçáÔºâ`;
            }

            // ËôïÁêÜË≥áÊ∫êË¢ãÈ°ØÁ§∫Ê†ºÂºè
            let recycleDisplay;
            if (typeof recycleBags === 'string' && (recycleBags.includes('ÂÖ¨Âçá') || recycleBags.includes('ÂåÖ'))) {
                // Â¶ÇÊûúÂ∑≤Á∂ìÂåÖÂê´ÂÆåÊï¥Ê†ºÂºèÔºàÂ¶ÇÔºö3ÂåÖ 14ÂÖ¨ÂçáÔºâÔºåÈúÄË¶ÅËΩâÊèõÁÇ∫Ê®ôÊ∫ñÊ†ºÂºè
                if (recycleBags.includes('ÂåÖ') && recycleBags.includes('ÂÖ¨Âçá')) {
                    // ÊèêÂèñÂåÖÊï∏ÂíåÂÆπÈáè
                    const bagMatch = recycleBags.match(/(\d+)ÂåÖ/);
                    const volumeMatch = recycleBags.match(/(\d+(?:\/\d+)?ÂÖ¨Âçá)/);
                    if (bagMatch && volumeMatch) {
                        recycleDisplay = `${bagMatch[1]}ÂåÖÊï∏Ôºà${volumeMatch[1]}Ôºâ`;
                    } else {
                        recycleDisplay = recycleBags;
                    }
                } else {
                    recycleDisplay = recycleBags;
                }
            } else {
                // Âê¶ÂâáÂæûÊï∏Â≠óÂª∫Á´ãÊ†ºÂºè
                const recycleNum = parseInt(recycleBags) || 3;
                recycleDisplay = `${recycleNum}ÂåÖÊï∏Ôºà14ÂÖ¨ÂçáÔºâ`;
            }

            // Ë®àÁÆóÊØèÊ¨°ÊúÄÂ§öÊî∂ÂèñË¢ãÊï∏ÔºàÂæûÈ°ØÁ§∫ÊñáÂ≠ó‰∏≠ÊèêÂèñÊï∏Â≠óÔºâ
            const trashNum = parseInt(trashDisplay.match(/(\d+)ÂåÖ/)?.[1]) || 6;
            const recycleNum = parseInt(recycleDisplay.match(/(\d+)ÂåÖ/)?.[1]) || 3;
            
            // Â¶ÇÊûúÊâãÂãïËº∏ÂÖ•‰∫ÜÊúÄÂ§ßË¢ãÊï∏Ôºå‰ΩøÁî®ÊâãÂãïÊï∏ÊìöÔºåÂê¶ÂâáË®àÁÆó
            let trashMax, recycleMax;
            if (data.trashMax) {
                trashMax = parseInt(data.trashMax);
            } else {
                trashMax = Math.floor(trashNum / 2) || 3;
            }
            
            if (data.recycleMax) {
                recycleMax = parseInt(data.recycleMax);
            } else {
                recycleMax = Math.floor(recycleNum / 2) || 3;
            }

            // È°ØÁ§∫ÂÆ¢Êà∂Ë≥áË®äÔºàÂ¶ÇÊûúÊúâÁöÑË©±Ôºâ
            let customerInfo = '';
            if (lineName) customerInfo += `LINEÊö±Á®±Ôºö${lineName}\n`;
            if (address) customerInfo += `Âú∞ÂùÄÔºö${address}\n`;
            if (housingType) customerInfo += `‰ΩèÂÆÖÊÄßË≥™Ôºö${housingType}\n`;
            if (customerInfo) customerInfo += '\n------------------------------------\n\n';

            // ÂÑ™ÂÖà‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑË∂üÊï∏ÔºåÂÖ∂Ê¨°ÊòØËá™ÂãïÂÅµÊ∏¨ÔºåÊúÄÂæåÊòØÈ†êË®≠ÂÄº
            let weeklyFrequency;
            if (data.frequency) {
                weeklyFrequency = `‰∏ÄÈÄ±Ë∂üÊï∏Ôºö${data.frequency}Ë∂ü`;
            } else if (data.weeklyFrequency) {
                weeklyFrequency = data.weeklyFrequency;
            } else {
                weeklyFrequency = '‰∏ÄÈÄ±Ë∂üÊï∏Ôºö2Ë∂ü';
            }
            
            // Â¶ÇÊûúÊ≤íÊúâÈÅ∏ÊìáÊúçÂãôÊòüÊúüÔºå‰ΩøÁî®È†êË®≠ÂÄº
            let finalDaysDisplay = daysDisplay;
            if (!serviceDays || serviceDays.trim() === '') {
                finalDaysDisplay = 'ÈÄ±‰∫å„ÄÅÈÄ±‰∫î';
            }
            
            // ÊúÄÁµÇÊ†ºÂºèÔºöË∂üÊï∏-ÊòüÊúü
            const serviceSchedule = `${weeklyFrequency}-${finalDaysDisplay}`;
            
            const quote = `${customerInfo}‚õîÂ†±ÂÉπË≥áÊñô‚õî

${serviceSchedule}
   ÁΩÆÊîæÊôÇÈñìÔºö${timeDisplay}
   ÁΩÆÊîæÊ®ìÂ±§Ôºö${floorDisplay}

Ôºà‚ö†Ô∏èÂûÉÂúæÁï∂Êó•:${collectionTimeDesc} ‰ª£Êî∂ÂÆåÁï¢Ôºâ
Ôºà‚ö†Ô∏èÈÅéÁ®ã‰∏≠Âö¥Á¶ÅÂÇ¨‰øÉÔºâ
Ôºà‚ö†Ô∏èË´ãÊ∫ñÊôÇÁΩÆÊîæ‰ª•ÂÖçÂ§öÊúâÁ≥æÁ¥õÔºâ

 1ÈÄ±ÂûÉÂúæÔºö${trashDisplay}
Ôºà1Ê¨°ÊúÄÂ§öÊî∂Âèñ${trashMax}Ë¢ã--Ë∂ÖÈáèÊãíÊî∂Ôºâ
ÔºàÂûÉÂúæË´ãÁ∂ÅÁ∑ä„ÄÅÂãøÂ§ñÈú≤Ôºâ
ÔºàÂûÉÂúæË¢ãÂ§ñÈÉ®ÂãøÊµÅÊπØÊ±ÅÔºâ
Ôºà‰∏ÄÊ¨°ÊÄßÁ¥ô/Â°ëËÜ†ÂÆπÂô®ÂùáÂûÉÂúæÔºâ


 1ÈÄ±Ë≥áÊ∫ê:${recycleDisplay}-Áî®‰∏ÄËà¨Â°ëËÜ†Ë¢ã
Ôºà1Ê¨°ÊúÄÂ§öÊî∂Âèñ${recycleMax}Ë¢ã--Ë∂ÖÈáèÊãíÊî∂Ôºâ
ÔºàËã•Êú™Ë£ùË¢ã‰∏ÄÂæãÊãíÊî∂Ôºâ
ÔºàË´ãÂãøÁî®ÈªëËâ≤Ë¢ãÂ≠êË£ùË≥áÊ∫êÔºâ
ÔºàÂÉÖÊî∂ÂØ∂ÁâπÁéªÁíÉÈêµÈãÅÁΩêÔºâ
ÔºàÂÉÖÊî∂‰∏≠Â∞èÁ¥ôÊùøÁÆ±Â£ìÊâÅÊäòÂ•ΩÔºâ
ÔºàÂÉÖÊî∂Êõ∏Êú¨/‰πæÊ∑®Á¥ôÂºµÔºâ

‚ö†Ô∏è‰∏ãÂàóÁâ©ÂìÅË¶ñÁÇ∫ÂûÉÂúæ
Ôºà‰æøÁï∂Áõí/Â°ëËÜ†Ë¢ã/Âê∏ÁÆ°‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàËªüÂ°ëËÜ†Ëìã/Âê∏ÁÆ°‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàÊó©È§êÁõí/Âø´È£≤ÊùØ‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàÊ≥°Ê£â/ÈõûËõãËªüÂ°ëËÜ†Áõí‚û°Ô∏èÂûÉÂúæÔºâ
ÔºàËõãÁ≥ïÁõí/Á∑©Ë°ùÊùêÊñô‚û°Ô∏èÂûÉÂúæÔºâ

‰∏ÄÂÄãÊúàË≤ªÁî®Ôºö${monthlyFee}ÂÖÉ
${keyNote}

-
üìëÈÖçÂêà‰∫ãÈ†Öüìë
‚ñ™ÂûÉÂúæÂãôÂøÖÊâìÂåÖÁ∂ÅÂ•ΩÊîæÁΩÆÈñÄÂè£
‚ñ™Â¶ÇÂõ†ÊîøÁ≠ñËÆäÂãïÈúÄÊîπÊôÇÈñì
‚¨áÔ∏èÂ∞áÊèêÂâçÂëäÁü•ÁÖ©Ë´ãÈÖçÂêà
‚ñ™Ëá™ÂÇôÈõôÂåóÂ∏ÇÊîøÂ∫úÂ∞àÁî®ÂûÉÂúæË¢ã
‚ñ™Êî∂Ê¨æÂæå‰∏çÈÄÄÊ¨æÂÖßÂÆπ‰∏çÊõ¥Êîπ
‚ñ™ÊúâË∂ÖÈáè‰∏ÄÂæãÊãíÊî∂

    ‚á©

üö® ÂÖ∂‰ªñÂïèÈ°å üö®
üìÑË´ãÂÖàÂÆåÊï¥Èñ±ËÆÄÂ†±ÂÉπÂÖßÂÆπÊèêÂá∫
üí¨ÂÆ¢ÊúçËß£Ê±∫‰ªª‰ΩïÂïèÈ°å

    ‚á©

‚≠ïËß£Ê±∫ÂïèÈ°å‚≠ï
‚úîÔ∏è.‰∏äËø∞ÂïèÈ°åÂùáËß£Ê±∫
‚úîÔ∏è.‰∏äËø∞ÂÖßÂÆπËÉΩÈÖçÂêà
ÂõûË¶ÜÂëäÁü•ÊàëÂÄëÔºöÂêåÊÑè‚úÖ+ÈñãÂßãÊó•

    ‚á©

Êî∂Âà∞_ÂêåÊÑè‚úÖ_Âæå
üíßÂÆ¢Êúç‚û°Ô∏èÊèê‰æõÁπ≥Ë≤ªÂñÆ
üíßÂÆ¢Êà∂‚û°Ô∏èÂÆåÊàêÁπ≥Ë≤ª
üíßÂÆ¢Êúç‚û°Ô∏èÈñãÂßã‰ª£Êî∂

‚ö†Ô∏è Ê≥®ÊÑè‰∫ãÈ†Ö ‚ö†Ô∏è
üî¥1ÂàÜÈå¢1ÂàÜÊúçÂãô‰ΩéÂÉπÁÑ°ÂÆâÂÖ®‰øùÈöú
üü†ËøëÊúüÂ§öËµ∑Ê°à‰æãË´ãÂãôÂøÖÁïôÊÑè
üü°Âπ¥ËºïÂ∞àÊ•≠ÂúòÈöä-ÊµÅÁ®ãÁöÜÊúâ SOP
üü¢ÊàêÂì°Âπ≥Âùá 30-35 Ê≠≤ÁöÜÂÖ∑ËâØÊ∞ëË≠â
üîµÈÅéÂπ¥ÂèäÂ§©ÁÅΩ‰∫∫Á¶çÂÅúÊ≠¢‰ª£Êî∂ÁÑ°ÈÄÄÊ¨æ
‚û°Ô∏èÂª∂Ëá≥‰∏ã‰∏ÄÊ¨°ÂèØ‰ª£Êî∂Â∑•‰ΩúÊó•



üåçËß£Ê±∫ÂûÉÂúæ‰∏¶‰∏çÂè™ÊòØÊî∂Ëµ∞
‚ö°ÊàëÂÄëÊîπËÆäÁöÑÊòØÂüéÂ∏ÇÁöÑÈÅãËΩâÈÄüÂ∫¶`;

            return quote;
        }

        function copyAutoQuote() {
            const quoteText = document.getElementById('auto-quote-result-display').textContent;
            
            if (!quoteText) {
                showStatus('auto-quote-copy-status', '‚ùå Ê≤íÊúâÂ†±ÂÉπÂñÆÂèØË§áË£Ω', 'error');
                return;
            }

            navigator.clipboard.writeText(quoteText).then(() => {
                showStatus('auto-quote-copy-status', '‚úÖ Ëá™ÂãïÂ†±ÂÉπÂñÆÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø', 'success');
            }).catch(() => {
                showStatus('auto-quote-copy-status', '‚ùå Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÈÅ∏ÊìáË§áË£Ω', 'error');
            });
        }

        // ÂñÆË∂üÂ†±ÂÉπGoogleË©¶ÁÆóË°®ËÆÄÂèñÂäüËÉΩ
        async function fetchSingleQuoteGoogleSheetsData() {
            const sheetsUrl = document.getElementById('single-quote-sheets-url').value.trim();
            
            if (!sheetsUrl) {
                showStatus('single-quote-sheets-status', '‚ùå Ë´ãËº∏ÂÖ•GoogleË©¶ÁÆóË°®Á∂≤ÂùÄ', 'error');
                return;
            }

            if (!sheetsUrl.includes('docs.google.com/spreadsheets')) {
                showStatus('single-quote-sheets-status', '‚ùå Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑGoogleË©¶ÁÆóË°®ÈÄ£Áµê', 'error');
                return;
            }

            showStatus('single-quote-sheets-status', 'üîÑ Ê≠£Âú®ËºâÂÖ•Ë©¶ÁÆóË°®Ë≥áÊñô...', 'success');

            try {
                // ÂæûURL‰∏≠ÊèêÂèñË©¶ÁÆóË°®ID
                let spreadsheetId = '';
                const urlMatch = sheetsUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (urlMatch) {
                    spreadsheetId = urlMatch[1];
                } else {
                    throw new Error('ÁÑ°Ê≥ïËß£ÊûêË©¶ÁÆóË°®IDÔºåË´ãÁ¢∫Ë™çURLÊ†ºÂºèÊ≠£Á¢∫');
                }

                // ÊßãÂª∫CSVÂ∞éÂá∫URL
                const csvUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv`;
                
                let response;
                try {
                    response = await fetch(csvUrl, {
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/csv,text/plain'
                        }
                    });
                } catch (corsError) {
                    throw new Error('Áî±ÊñºÁÄèË¶ΩÂô®ÂÆâÂÖ®ÈôêÂà∂ÔºåÁÑ°Ê≥ïÁõ¥Êé•ËÆÄÂèñGoogleË©¶ÁÆóË°®„ÄÇË´ãÁ¢∫Ë™çÔºö\n1. Ë©¶ÁÆóË°®Â∑≤Ë®≠ÁÇ∫„ÄåÁü•ÈÅìÈÄ£ÁµêÁöÑ‰ΩøÁî®ËÄÖ„ÄçÂèØÊ™¢Ë¶ñ\n2. ÊàñÊâãÂãïË§áË£ΩË≤º‰∏äË≥áÊñô');
                }

                if (!response.ok) {
                    if (response.status === 403) {
                        throw new Error('ÁÑ°Ê≥ïÂ≠òÂèñË©¶ÁÆóË°®ÔºåË´ãÁ¢∫Ë™çÂàÜ‰∫´Ë®≠ÂÆöÁÇ∫„ÄåÁü•ÈÅìÈÄ£ÁµêÁöÑ‰ΩøÁî®ËÄÖ„ÄçÂèØÊ™¢Ë¶ñ');
                    } else if (response.status === 404) {
                        throw new Error('Êâæ‰∏çÂà∞Ë©¶ÁÆóË°®ÔºåË´ãÁ¢∫Ë™çÁ∂≤ÂùÄÊ≠£Á¢∫');
                    } else {
                        throw new Error(`ËºâÂÖ•Â§±Êïó (ÈåØË™§‰ª£Á¢º: ${response.status})`);
                    }
                }

                const csvText = await response.text();
                
                if (!csvText || csvText.trim().length === 0) {
                    throw new Error('Ë©¶ÁÆóË°®Ë≥áÊñôÁÇ∫Á©∫ÔºåË´ãÁ¢∫Ë™çË°®Ê†º‰∏≠ÊúâË≥áÊñô');
                }

                // CSVËß£Êûê
                const rows = parseCSV(csvText);
                const filteredRows = rows.filter(row => row.some(cell => cell && cell.length > 0));
                
                if (filteredRows.length === 0) {
                    throw new Error('Ë©¶ÁÆóË°®‰∏≠Ê≤íÊúâÊâæÂà∞‰ªª‰ΩïÊúâÊïàË≥áÊñô');
                }

                const updateMode = document.getElementById('single-quote-update-mode').value;
                
                // ÂèñÂæóË°®È†≠ÂíåË≥áÊñôË°å
                const headers = filteredRows[0] || [];
                const allDataRows = filteredRows.slice(1);
                
                let dataRows;
                if (updateMode === 'latest') {
                    dataRows = allDataRows.slice(-1);
                } else if (updateMode === 'last-5') {
                    dataRows = allDataRows.slice(-5);
                } else if (updateMode === 'last-10') {
                    dataRows = allDataRows.slice(-10);
                } else if (updateMode === 'last-20') {
                    dataRows = allDataRows.slice(-20);
                } else {
                    dataRows = allDataRows;
                }

                if (dataRows.length === 0) {
                    throw new Error('Ê≤íÊúâÊâæÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑË≥áÊñôË°å');
                }

                // È°ØÁ§∫Ë≥áÊñôÈ†êË¶Ω
                displaySingleQuoteData(headers, dataRows);
                showStatus('single-quote-sheets-status', `‚úÖ ÊàêÂäüËºâÂÖ• ${dataRows.length} Ë°åË≥áÊñô`, 'success');

            } catch (error) {
                console.error('ËºâÂÖ•Ë≥áÊñôÂ§±Êïó:', error);
                showStatus('single-quote-sheets-status', `‚ùå ${error.message}`, 'error');
            }
        }

        // Â≠òÂÑ≤Ë©¶ÁÆóË°®Ë≥áÊñô‰æõÈÅ∏Êìá‰ΩøÁî®
        let singleQuoteTableData = {
            headers: [],
            rows: []
        };

        function displaySingleQuoteData(headers, rows) {
            // ÂÑ≤Â≠òË≥áÊñô‰æõÂæåÁ∫å‰ΩøÁî®
            singleQuoteTableData.headers = headers;
            singleQuoteTableData.rows = rows;
            
            const container = document.getElementById('single-quote-detected-data-preview');
            
            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
            
            // Ë°®È†≠
            html += '<tr style="background: #404040;">';
            headers.forEach(header => {
                html += `<th style="border: 1px solid #666; padding: 8px; text-align: left; color: #fff;">${header}</th>`;
            });
            html += '</tr>';
            
            // Ë≥áÊñôË°å
            rows.forEach((row, index) => {
                const bgColor = index % 2 === 0 ? '#333333' : '#2a2a2a';
                html += `<tr onclick="selectSingleQuoteRowForQuote(${index})" style="cursor: pointer; background: ${bgColor};" class="single-data-row" title="ÈªûÊìäÈÅ∏ÊìáÊ≠§Ë≥áÊñô‰ΩúÁÇ∫Â†±ÂÉπÂñÆ‰æÜÊ∫ê" onmouseover="this.style.background='#4a4a4a'" onmouseout="this.style.background='${bgColor}'">`;
                row.forEach(cell => {
                    html += `<td style="border: 1px solid #666; padding: 8px; color: #e0e0e0;">${cell || ''}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</table>';
            container.innerHTML = html;
            
            document.getElementById('single-quote-detected-data').style.display = 'block';
            document.getElementById('single-quote-controls').style.display = 'block';
        }

        let singleQuoteSelectedData = null;
        let singleQuoteSelectedRowIndex = -1;

        function selectSingleQuoteRowForQuote(rowIndex) {
            console.log('selectSingleQuoteRow called with index:', rowIndex);
            
            // ‰ΩøÁî®Â≠òÂÑ≤ÁöÑË≥áÊñôËÄå‰∏çÊòØDOMÊü•Ë©¢
            const headers = singleQuoteTableData.headers;
            const rows = singleQuoteTableData.rows;
            const selectedRowData = rows[rowIndex];
            
            console.log('Available headers:', headers);
            console.log('Selected row data:', selectedRowData);
            
            // ÂêåÊôÇÊõ¥Êñ∞DOMÈ´ò‰∫Æ
            const container = document.getElementById('single-quote-detected-data-preview');
            const table = container.querySelector('table');
            const dataRows = Array.from(table.querySelectorAll('tr')).slice(1);
            const selectedRow = dataRows[rowIndex];
            
            if (selectedRow) {
                // Ê∏ÖÈô§‰πãÂâçÁöÑÈÅ∏ÊìáÈ´ò‰∫Æ
                dataRows.forEach(row => {
                    row.style.border = '';
                });
                
                // È´ò‰∫ÆÈÅ∏‰∏≠ÁöÑË°å
                selectedRow.style.border = '3px solid #FFD700';
            }
            
            // Ëß£ÊûêÈÅ∏‰∏≠Ë°åÁöÑË≥áÊñô
            const fieldMapping = {};
            headers.forEach((header, index) => {
                fieldMapping[header] = selectedRowData[index] || '';
            });
            
            // Êô∫ËÉΩÊ¨Ñ‰ΩçÂÅµÊ∏¨
            const detectedData = {
                address: '',
                lineName: '',
                serviceTime: '',
                weeklyFrequency: '',
                serviceDays: '',
                housingType: '',
                trashBags: '',
                recycleBags: ''
            };
            
            // ÂÅµÊ∏¨Âú∞ÂùÄ - Êì¥Â±ïÂÅµÊ∏¨Ê¢ù‰ª∂
            for (const [header, value] of Object.entries(fieldMapping)) {
                if (header.includes('Âú∞ÂùÄ') || 
                    (header.includes('Êî∂Âèñ') && header.includes('Âú∞ÂùÄ')) || 
                    header.includes('ÂçÄÂüü+Âú∞ÂùÄ') || 
                    header.includes('Êî∂ÂèñÂçÄÂüü') ||
                    header.includes('Ê≠£Á¢∫Êî∂ÂèñÂú∞ÂùÄ') ||
                    header.includes('Êî∂Âèñ‰ΩçÁΩÆ') ||
                    header.includes('ÊúçÂãôÂú∞ÂùÄ')) {
                    detectedData.address = value;
                    break;
                }
            }
            
            // ÂÅµÊ∏¨LINEÊö±Á®± - Êì¥Â±ïÂÅµÊ∏¨Ê¢ù‰ª∂
            for (const [header, value] of Object.entries(fieldMapping)) {
                if (header.includes('Êö±Á®±') || 
                    header.includes('Line') || 
                    header.includes('LINE') || 
                    (header.includes('È°ØÁ§∫') && header.includes('Êö±Á®±')) || 
                    header.includes('LineÈ°ØÁ§∫') ||
                    header.includes('ÂÆ¢Êà∂Êö±Á®±') ||
                    header.includes('Áî®Êà∂Êö±Á®±')) {
                    detectedData.lineName = value;
                    break;
                }
            }
            
            // ÂÑ≤Â≠òÈÅ∏‰∏≠ÁöÑË≥áÊñô
            singleQuoteSelectedData = detectedData;
            singleQuoteSelectedRowIndex = rowIndex;
            
            console.log('Selected row field mapping:', fieldMapping);
            console.log('Detected data:', detectedData);
            
            // Êõ¥Êñ∞ÊâÄÊúâË°åÊ®£Âºè
            const allRows = document.querySelectorAll('.single-data-row');
            allRows.forEach((row, index) => {
                if (index === rowIndex) {
                    row.style.border = '3px solid #FFD700';
                    row.style.background = '#4a4a00';
                } else {
                    row.style.border = '';
                    row.style.background = index % 2 === 0 ? '#333333' : '#2a2a2a';
                }
            });
            
            // È°ØÁ§∫ÂÅµÊ∏¨ÁµêÊûúÁãÄÊÖã
            let statusMsg = `‚úÖ Â∑≤ÈÅ∏ÊìáÁ¨¨ ${rowIndex + 1} Ë°åË≥áÊñô`;
            if (detectedData.address) {
                statusMsg += ` | Âú∞ÂùÄ: ${detectedData.address.substring(0, 20)}...`;
            }
            if (detectedData.lineName) {
                statusMsg += ` | Êö±Á®±: ${detectedData.lineName}`;
            }
            
            showStatus('single-quote-sheets-status', statusMsg, 'success');
            
            // Ëß£Êûê‰∏¶È°ØÁ§∫ÁÖßÁâá
            displaySingleQuotePhotos(fieldMapping);
        }

        // Google Drive URL ËΩâÊèõÂáΩÊï∏
        function convertGoogleDriveUrl(url) {
            // Âæû Google Drive URL ‰∏≠ÊèêÂèñ file ID
            // ÊîØÊåÅÊ†ºÂºè: https://drive.google.com/open?id=FILE_ID
            const idMatch = url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
            if (idMatch) {
                const fileId = idMatch[1];
                return {
                    thumbnail: `https://drive.google.com/thumbnail?id=${fileId}&sz=w400`,
                    view: `https://drive.google.com/file/d/${fileId}/view`,
                    download: `https://drive.google.com/uc?export=download&id=${fileId}`
                };
            }
            return null;
        }

        // Ëß£Êûê‰∏¶È°ØÁ§∫ÁÖßÁâá
        function displaySingleQuotePhotos(fieldMapping) {
            const photosContainer = document.getElementById('single-quote-photos-container');
            const photosSection = document.getElementById('single-quote-photos-section');
            
            // Êü•ÊâæÁÖßÁâáÊ¨Ñ‰Ωç - ÊîØÊåÅÂ§öÁ®ÆÂèØËÉΩÁöÑÊ¨Ñ‰ΩçÂêçÁ®±
            let photoUrls = [];
            for (const [header, value] of Object.entries(fieldMapping)) {
                if (header.includes('ÁÖßÁâá') || 
                    header.includes('ÂúñÁâá') || 
                    header.includes('photo') || 
                    header.includes('image') ||
                    header.includes('ÂûÉÂúæ') && header.includes('ÁÖßÁâá')) {
                    
                    // Ëß£ÊûêÂ§öÂÄã URLÔºà‰ª•ÈÄóËôüÂàÜÈöîÔºâ
                    if (value && value.trim()) {
                        const urls = value.split(',').map(url => url.trim()).filter(url => url.length > 0);
                        photoUrls = urls;
                        break;
                    }
                }
            }
            
            // Â¶ÇÊûúÊ≤íÊúâÁÖßÁâáÔºåÈö±ËóèÁÖßÁâáÂçÄÂüü
            if (photoUrls.length === 0) {
                photosSection.style.display = 'none';
                photoDownloadUrls = []; // Ê∏ÖÁ©∫‰∏ãËºâ URLs
                return;
            }
            
            // È°ØÁ§∫ÁÖßÁâáÂçÄÂüü
            photosSection.style.display = 'block';
            
            // Ê∏ÖÁ©∫ÁèæÊúâÂÖßÂÆπ
            photosContainer.innerHTML = '';
            
            // Ê∏ÖÁ©∫‰∏¶Ê∫ñÂÇôÊñ∞ÁöÑ‰∏ãËºâ URLs
            photoDownloadUrls = [];
            
            // ÁÇ∫ÊØèÂºµÁÖßÁâáÂâµÂª∫Âç°Áâá
            photoUrls.forEach((url, index) => {
                const converted = convertGoogleDriveUrl(url);
                if (!converted) return;
                
                // ‰øùÂ≠ò‰∏ãËºâ URL
                photoDownloadUrls.push(converted.download);
                
                const photoCard = document.createElement('div');
                photoCard.style.cssText = `
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 8px;
                    padding: 10px;
                    background: #333;
                    border-radius: 8px;
                    border: 2px solid #444;
                    transition: all 0.3s ease;
                    width: 200px;
                `;
                
                photoCard.onmouseover = function() {
                    this.style.borderColor = '#667eea';
                    this.style.transform = 'translateY(-3px)';
                };
                photoCard.onmouseout = function() {
                    this.style.borderColor = '#444';
                    this.style.transform = 'translateY(0)';
                };
                
                // ÂúñÁâáÂÆπÂô®
                const imgContainer = document.createElement('div');
                imgContainer.style.cssText = `
                    width: 180px;
                    height: 180px;
                    overflow: hidden;
                    border-radius: 6px;
                    background: #222;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                const img = document.createElement('img');
                img.src = converted.thumbnail;
                img.alt = `ÁÖßÁâá ${index + 1}`;
                img.style.cssText = `
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    cursor: pointer;
                `;
                img.onclick = () => window.open(converted.view, '_blank');
                
                // ËôïÁêÜÂúñÁâáËºâÂÖ•ÈåØË™§
                img.onerror = function() {
                    imgContainer.innerHTML = `
                        <div style="color: #999; text-align: center; padding: 10px;">
                            <div style="font-size: 40px;">üì∑</div>
                            <div style="font-size: 12px; margin-top: 5px;">ËºâÂÖ•Â§±Êïó</div>
                        </div>
                    `;
                };
                
                imgContainer.appendChild(img);
                
                // ÁÖßÁâáÁ∑®Ëôü
                const label = document.createElement('div');
                label.textContent = `ÁÖßÁâá ${index + 1}`;
                label.style.cssText = `
                    color: #e0e0e0;
                    font-size: 14px;
                    font-weight: 500;
                `;
                
                // ÊåâÈàïÂÆπÂô®
                const btnContainer = document.createElement('div');
                btnContainer.style.cssText = `
                    display: flex;
                    gap: 8px;
                    width: 100%;
                `;
                
                // Êü•ÁúãÊåâÈàï
                const viewBtn = document.createElement('button');
                viewBtn.textContent = 'üëÅÔ∏è Êü•Áúã';
                viewBtn.style.cssText = `
                    flex: 1;
                    padding: 6px 12px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: 600;
                    transition: all 0.3s ease;
                `;
                viewBtn.onmouseover = function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.4)';
                };
                viewBtn.onmouseout = function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                };
                viewBtn.onclick = () => window.open(converted.view, '_blank');
                
                // ‰∏ãËºâÊåâÈàï
                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'üì• ‰∏ãËºâ';
                downloadBtn.style.cssText = `
                    flex: 1;
                    padding: 6px 12px;
                    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: 600;
                    transition: all 0.3s ease;
                `;
                downloadBtn.onmouseover = function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 4px 12px rgba(40, 167, 69, 0.4)';
                };
                downloadBtn.onmouseout = function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                };
                downloadBtn.onclick = () => window.open(converted.download, '_blank');
                
                btnContainer.appendChild(viewBtn);
                btnContainer.appendChild(downloadBtn);
                
                photoCard.appendChild(imgContainer);
                photoCard.appendChild(label);
                photoCard.appendChild(btnContainer);
                
                photosContainer.appendChild(photoCard);
            });
            
            console.log(`È°ØÁ§∫‰∫Ü ${photoUrls.length} ÂºµÁÖßÁâá`);
        }

        // ÂÖ®Â±ÄËÆäÈáèÂ≠òÂÑ≤ÁÖßÁâá‰∏ãËºâ URLs
        let photoDownloadUrls = [];

        // ‰∏ÄÈçµ‰∏ãËºâÂÖ®ÈÉ®ÁÖßÁâá
        function downloadAllPhotos() {
            if (photoDownloadUrls.length === 0) {
                alert('ÁõÆÂâçÊ≤íÊúâÂèØ‰∏ãËºâÁöÑÁÖßÁâá');
                return;
            }
            
            // Ë©¢ÂïèÁî®Êà∂Á¢∫Ë™ç
            const confirmMsg = `Âç≥Â∞á‰∏ãËºâ ${photoDownloadUrls.length} ÂºµÁÖßÁâáÔºåÁ¢∫ÂÆöÁπºÁ∫åÂóéÔºü`;
            if (!confirm(confirmMsg)) {
                return;
            }
            
            // ‰æùÂ∫è‰∏ãËºâÊØèÂºµÁÖßÁâáÔºåË®≠ÂÆöÁü≠Êö´Âª∂ÈÅ≤ÈÅøÂÖçÁÄèË¶ΩÂô®ÈòªÊìã
            photoDownloadUrls.forEach((url, index) => {
                setTimeout(() => {
                    window.open(url, '_blank');
                }, index * 300); // ÊØèÂºµÁÖßÁâáÈñìÈöî 300ms
            });
            
            showStatus('single-quote-sheets-status', `‚úÖ Â∑≤ÈñãÂßã‰∏ãËºâ ${photoDownloadUrls.length} ÂºµÁÖßÁâá`, 'success');
        }

        // Êó•ÊúüËΩâÊèõÁÇ∫ÂåÖÂê´ÊòüÊúüÂπæÁöÑÊ†ºÂºè
        function formatDateWithWeekday(dateString) {
            if (!dateString) return 'ÂæÖÁ¢∫Ë™ç';
            
            const date = new Date(dateString);
            const weekdays = ['ÈÄ±Êó•', 'ÈÄ±‰∏Ä', 'ÈÄ±‰∫å', 'ÈÄ±‰∏â', 'ÈÄ±Âõõ', 'ÈÄ±‰∫î', 'ÈÄ±ÂÖ≠'];
            const weekday = weekdays[date.getDay()];
            
            // Ê†ºÂºèÂåñÁÇ∫ YYYY/MM/DD (ÊòüÊúüX)
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return `${year}/${month}/${day} (${weekday})`;
        }

        // ÊôÇÈñìÊ†ºÂºèËΩâÊèõ
        function formatTime(timeString) {
            if (!timeString || timeString.trim() === '') return 'ÂæÖÁ¢∫Ë™ç';
            
            // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Êï∏Â≠óÊ†ºÂºèÁöÑÊôÇÈñì (Â¶Ç 1200-1300ÂÆåÊàê)
            const timePattern = /(\d{3,4})-(\d{3,4})(.*)$/;
            const match = timeString.match(timePattern);
            
            if (match) {
                const startTime = match[1];
                const endTime = match[2];
                const suffix = match[3] || '';
                
                // ËΩâÊèõÊôÇÈñìÊ†ºÂºè
                const formatHour = (time, isStart = false) => {
                    const hour = parseInt(time.slice(0, -2));
                    const minute = time.slice(-2);
                    
                    if (hour >= 12) {
                        const displayHour = hour === 12 ? 12 : hour - 12;
                        const period = isStart ? '‰∏ãÂçà ' : '';
                        return `${period}${displayHour}Ôºö${minute}`;
                    } else {
                        const displayHour = hour === 0 ? 12 : hour;
                        const period = isStart ? '‰∏äÂçà ' : '';
                        return `${period}${displayHour}Ôºö${minute}`;
                    }
                };
                
                const startHour = parseInt(startTime.slice(0, -2));
                const endHour = parseInt(endTime.slice(0, -2));
                
                // Âà§Êñ∑ÊôÇÈñìÊÆµÔºåÂè™Âú®ÈñãÂßãÊôÇÈñìÈ°ØÁ§∫‰∏äÂçà/‰∏ãÂçà
                if (startHour >= 12 && endHour >= 12) {
                    // ÈÉΩÊòØ‰∏ãÂçà
                    return `‰∏ãÂçà ${formatHour(startTime, false)}-${formatHour(endTime, false)}${suffix}`;
                } else if (startHour < 12 && endHour < 12) {
                    // ÈÉΩÊòØ‰∏äÂçà
                    return `‰∏äÂçà ${formatHour(startTime, false)}-${formatHour(endTime, false)}${suffix}`;
                } else {
                    // Ë∑®Ë∂ä‰∏äÂçà‰∏ãÂçà
                    return `${formatHour(startTime, true)}-${formatHour(endTime, true)}${suffix}`;
                }
            }
            
            // Â¶ÇÊûú‰∏çÊòØÊï∏Â≠óÊ†ºÂºèÔºåÁõ¥Êé•ËøîÂõûÂéüÂßãÊñáÂ≠ó
            return timeString;
        }

        // ÂãïÊÖãÁÖßÁâáÊèèËø∞ÁÆ°ÁêÜ
        let photoDescriptionNextId = 1; // ËøΩËπ§‰∏ã‰∏ÄÂÄãIDÔºà‰øùÊåÅÂîØ‰∏ÄÊÄßÔºâ
        const maxDescriptions = 15; // ÊúÄÂ§ö15ÂÄãÊèèËø∞

        // Áç≤ÂèñÁï∂ÂâçÊ¥ªË∫çÁöÑÊèèËø∞Êï∏Èáè
        function getActiveDescriptionCount() {
            const container = document.getElementById('photo-descriptions-container');
            return container.querySelectorAll('.photo-description-item').length;
        }

        // Êõ¥Êñ∞Ê∑ªÂä†ÊåâÈàïÁãÄÊÖã
        function updateAddButtonState() {
            const activeCount = getActiveDescriptionCount();
            const addBtn = document.getElementById('add-description-btn');
            
            if (activeCount >= maxDescriptions) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        // Â¢ûÂä†ÁÖßÁâáÊèèËø∞
        function addPhotoDescription() {
            const activeCount = getActiveDescriptionCount();
            
            if (activeCount >= maxDescriptions) {
                alert(`ÊúÄÂ§öÂè™ËÉΩÊ∑ªÂä†${maxDescriptions}ÂÄãÊèèËø∞`);
                return;
            }
            
            photoDescriptionNextId++;
            const container = document.getElementById('photo-descriptions-container');
            
            const descItem = document.createElement('div');
            descItem.className = 'photo-description-item';
            descItem.id = `photo-desc-${photoDescriptionNextId}`;
            descItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            descItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>üóëÔ∏èÊèèËø∞${activeCount + 1}Ôºö</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="single-quote-photo${photoDescriptionNextId}" placeholder="‰æãÂ¶ÇÔºöÂûÉÂúæÊèèËø∞" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removePhotoDescription(${photoDescriptionNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        ‚ùå Âà™Èô§
                    </button>
                </div>
            `;
            
            container.appendChild(descItem);
            updateAddButtonState();
        }

        // ÁßªÈô§ÁÖßÁâáÊèèËø∞
        function removePhotoDescription(id) {
            const descItem = document.getElementById(`photo-desc-${id}`);
            if (descItem) {
                descItem.remove();
                updateAddButtonState();
            }
        }

        // ÂãïÊÖãÂÖ∂‰ªñË™™ÊòéÁÆ°ÁêÜ
        let singleNoteNextId = 1; // ËøΩËπ§‰∏ã‰∏ÄÂÄãIDÔºà‰øùÊåÅÂîØ‰∏ÄÊÄßÔºâ
        const maxNotes = 10; // ÊúÄÂ§ö10ÂÄãË™™Êòé

        // Áç≤ÂèñÁï∂ÂâçÊ¥ªË∫çÁöÑÂÖ∂‰ªñË™™ÊòéÊï∏Èáè
        function getActiveSingleNoteCount() {
            const container = document.getElementById('single-notes-container');
            return container.querySelectorAll('.single-note-item').length;
        }

        // Êõ¥Êñ∞Ê∑ªÂä†Ë™™ÊòéÊåâÈàïÁãÄÊÖã
        function updateSingleNoteButtonState() {
            const activeCount = getActiveSingleNoteCount();
            const addBtn = document.getElementById('add-single-note-btn');
            
            if (activeCount >= maxNotes) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        // Â¢ûÂä†ÂÖ∂‰ªñË™™Êòé
        function addSingleNote() {
            const activeCount = getActiveSingleNoteCount();
            
            if (activeCount >= maxNotes) {
                alert(`ÊúÄÂ§öÂè™ËÉΩÊ∑ªÂä†${maxNotes}ÂÄãË™™Êòé`);
                return;
            }
            
            singleNoteNextId++;
            const container = document.getElementById('single-notes-container');
            
            const noteItem = document.createElement('div');
            noteItem.className = 'single-note-item';
            noteItem.id = `single-note-${singleNoteNextId}`;
            noteItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            noteItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>Ë™™Êòé${activeCount + 1}Ôºö</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="single-other${singleNoteNextId}" placeholder="‰æãÂ¶ÇÔºöÈ°çÂ§ñÂÇôË®ª" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removeSingleNote(${singleNoteNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        ‚ùå Âà™Èô§
                    </button>
                </div>
            `;
            
            container.appendChild(noteItem);
            updateSingleNoteButtonState();
        }

        // ÁßªÈô§ÂÖ∂‰ªñË™™Êòé
        function removeSingleNote(id) {
            const noteItem = document.getElementById(`single-note-${id}`);
            if (noteItem) {
                noteItem.remove();
                updateSingleNoteButtonState();
            }
        }

        // ÂãïÊÖãÊ∏ÖÊΩîÂÖ∂‰ªñË™™ÊòéÁÆ°ÁêÜ
        let cleanNoteNextId = 1;
        const maxCleanNotes = 10;

        function getActiveCleanNoteCount() {
            const container = document.getElementById('clean-notes-container');
            return container.querySelectorAll('.clean-note-item').length;
        }

        function updateCleanNoteButtonState() {
            const activeCount = getActiveCleanNoteCount();
            const addBtn = document.getElementById('add-clean-note-btn');
            
            if (activeCount >= maxCleanNotes) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        function addCleanNote() {
            const activeCount = getActiveCleanNoteCount();
            
            if (activeCount >= maxCleanNotes) {
                alert(`ÊúÄÂ§öÂè™ËÉΩÊ∑ªÂä†${maxCleanNotes}ÂÄãË™™Êòé`);
                return;
            }
            
            cleanNoteNextId++;
            const container = document.getElementById('clean-notes-container');
            
            const noteItem = document.createElement('div');
            noteItem.className = 'clean-note-item';
            noteItem.id = `clean-note-${cleanNoteNextId}`;
            noteItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            noteItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>Ë™™Êòé${activeCount + 1}Ôºö</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="clean-other${cleanNoteNextId}" placeholder="‰æãÔºöÈ°çÂ§ñÂÇôË®ª" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removeCleanNote(${cleanNoteNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        ‚ùå Âà™Èô§
                    </button>
                </div>
            `;
            
            container.appendChild(noteItem);
            updateCleanNoteButtonState();
        }

        function removeCleanNote(id) {
            const noteItem = document.getElementById(`clean-note-${id}`);
            if (noteItem) {
                noteItem.remove();
                updateCleanNoteButtonState();
            }
        }

        // ÂãïÊÖãÊ∏ÖÊΩîÁØÑÂúçÁÆ°ÁêÜ
        let cleanScopeNextId = 1;
        const maxCleanScopes = 20;

        function getActiveCleanScopeCount() {
            const container = document.getElementById('clean-scope-container');
            return container.querySelectorAll('.clean-scope-item').length;
        }

        function updateCleanScopeButtonState() {
            const activeCount = getActiveCleanScopeCount();
            const addBtn = document.getElementById('add-clean-scope-btn');
            
            if (activeCount >= maxCleanScopes) {
                addBtn.disabled = true;
                addBtn.style.opacity = '0.5';
                addBtn.style.cursor = 'not-allowed';
            } else {
                addBtn.disabled = false;
                addBtn.style.opacity = '1';
                addBtn.style.cursor = 'pointer';
            }
        }

        function addCleanScope() {
            const activeCount = getActiveCleanScopeCount();
            
            if (activeCount >= maxCleanScopes) {
                alert(`ÊúÄÂ§öÂè™ËÉΩÊ∑ªÂä†${maxCleanScopes}ÂÄãÊ∏ÖÊΩîÈ†ÖÁõÆ`);
                return;
            }
            
            cleanScopeNextId++;
            const container = document.getElementById('clean-scope-container');
            
            const scopeItem = document.createElement('div');
            scopeItem.className = 'clean-scope-item';
            scopeItem.id = `clean-scope-item-${cleanScopeNextId}`;
            scopeItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 15px; align-items: flex-end;';
            
            scopeItem.innerHTML = `
                <div style="flex: 0 0 100px;">
                    <label>È†ÖÁõÆ${activeCount + 1}Ôºö</label>
                </div>
                <div style="flex: 1;">
                    <input type="text" id="clean-scope-${cleanScopeNextId}" placeholder="Ê∏ÖÊΩîÈ†ÖÁõÆ ${activeCount + 1}" value="" style="width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #2a2a2a; color: #e0e0e0;">
                </div>
                <div style="flex: 0 0 auto;">
                    <button onclick="removeCleanScope(${cleanScopeNextId})" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                        ‚ùå Âà™Èô§
                    </button>
                </div>
            `;
            
            container.appendChild(scopeItem);
            updateCleanScopeButtonState();
        }

        function removeCleanScope(id) {
            const scopeItem = document.getElementById(`clean-scope-item-${id}`);
            if (scopeItem) {
                scopeItem.remove();
                updateCleanScopeButtonState();
            }
        }

        // ÁîüÊàêÂñÆË∂üÂûÉÂúæ‰ª£Êî∂Â†±ÂÉπÂñÆ
        function generateSingleQuote() {
            try {
                // Áç≤ÂèñË≤ªÁî®Ë≥áÊñô - Áõ¥Êé•ËÆÄÂèñÊï∏Â≠óËº∏ÂÖ•Ê°Ü
                const groundFeeValue = document.getElementById('single-quote-ground-fee').value;
                const upstairsFeeValue = document.getElementById('single-quote-upstairs-fee').value;
                
                // Âè™ÊúâÁï∂Ëº∏ÂÖ•ÂÄºÂ≠òÂú®‰∏î‰∏çÁÇ∫0ÊôÇÊâç‰ΩøÁî®
                const groundFee = groundFeeValue && parseFloat(groundFeeValue) > 0 ? groundFeeValue : null;
                const upstairsFee = upstairsFeeValue && parseFloat(upstairsFeeValue) > 0 ? upstairsFeeValue : null;
                
                const upstairsOption = document.getElementById('single-quote-upstairs-option').value || 'Êúâ/ÁÑ°/Ëá™ÈÅ∏';
                const dateRaw = document.getElementById('single-quote-date').value;
                const timeRaw = document.getElementById('single-quote-time').value;
                
                // Ê†ºÂºèÂåñÊó•ÊúüÂíåÊôÇÈñì
                const date = formatDateWithWeekday(dateRaw);
                const time = formatTime(timeRaw);
                
                // Áç≤ÂèñÁÖßÁâáÊèèËø∞ - ÂæûÂãïÊÖãÊ¨Ñ‰ΩçÊî∂ÈõÜ
                const photos = [];
                const container = document.getElementById('photo-descriptions-container');
                const allInputs = container.querySelectorAll('input[id^="single-quote-photo"]');
                allInputs.forEach(input => {
                    const content = input.value;
                    if (content && content.trim() !== '') {
                        photos.push(content.trim());
                    }
                });

                // ÂæûÈÅ∏‰∏≠ÁöÑË©¶ÁÆóË°®Ë≥áÊñô‰∏≠Áç≤ÂèñÂú∞ÂùÄÂíåLINEÊö±Á®±
                const address = singleQuoteSelectedData ? singleQuoteSelectedData.address : '';
                const lineName = singleQuoteSelectedData ? singleQuoteSelectedData.lineName : '';
                
                console.log('Generate quote - Address:', address);
                console.log('Generate quote - Line Name:', lineName);
                console.log('singleQuoteSelectedData:', singleQuoteSelectedData);

                // ÁîüÊàêÂ†±ÂÉπÂñÆ
                const quote = generateSingleQuoteTemplate({
                    groundFee,
                    upstairsFee,
                    upstairsOption,
                    date,
                    time,
                    photos,
                    address,
                    lineName
                });

                // È°ØÁ§∫ÁµêÊûú
                document.getElementById('single-quote-result-display').textContent = quote;
                document.getElementById('single-quote-output').style.display = 'block';
                
                showStatus('single-quote-copy-status', '‚úÖ ÂñÆË∂üÂûÉÂúæ‰ª£Êî∂Â†±ÂÉπÂñÆÂ∑≤ÁîüÊàê', 'success');

            } catch (error) {
                showStatus('single-quote-copy-status', `‚ùå ÁîüÊàêÂ§±Êïó: ${error.message}`, 'error');
            }
        }

        // ÂñÆË∂üÂûÉÂúæ‰ª£Êî∂Â†±ÂÉπÂñÆÁØÑÊú¨
        function generateSingleQuoteTemplate(data) {
            const {groundFee, upstairsFee, upstairsOption, date, time, photos, address, lineName} = data;
            
            console.log('Template generation - Address:', address);
            console.log('Template generation - Line Name:', lineName);
            console.log('Template generation - Full data:', data);
            
            let quote = ``;

            // Â¶ÇÊûúÊúâLINEÊö±Á®±ÔºåÈ°ØÁ§∫Âú®ÊúÄ‰∏äÊñπ
            if (lineName) {
                quote += `LINEÊö±Á®±Ôºö${lineName}\n`;
                console.log('Added line name to quote');
            }
            
            // Â¶ÇÊûúÊúâÂú∞ÂùÄÔºåÈ°ØÁ§∫Âú®Êö±Á®±‰∏ãÊñπ
            if (address) {
                quote += `Âú∞ÂùÄÔºö${address}\n`;
                console.log('Added address to quote');
            }
            
            // Â¶ÇÊûúÊúâ‰ΩèÂÆÖÊÄßË≥™ÔºåÂæûÈÅ∏‰∏≠Ë≥áÊñô‰∏≠ÂèñÂæó
            if (singleQuoteSelectedData && singleQuoteSelectedData.housingType) {
                quote += `‰ΩèÂÆÖÊÄßË≥™Ôºö${singleQuoteSelectedData.housingType}\n`;
                console.log('Added housing type to quote');
            }
            
            // Â¶ÇÊûúÊúâ‰ªª‰ΩïÂÆ¢Êà∂Ë≥áË®äÔºåÊ∑ªÂä†ÂàÜÈöîÁ∑öÔºåÁÑ∂ÂæåÂä†‰∏äÊ®ôÈ°å
            if (lineName || address || (singleQuoteSelectedData && singleQuoteSelectedData.housingType)) {
                quote += `\n------------------------------------\n\nüî•ÂñÆË∂üÂûÉÂúæ‰ª£Êî∂üî•

`;
                console.log('Added separator line and title');
            } else {
                quote += `üî•ÂñÆË∂üÂûÉÂúæ‰ª£Êî∂üî•

`;
            }
            
            quote += `üóëÔ∏èÂûÉÂúæË≥áÊ∫êüóëÔ∏èÔºö

`;

            // Ê∑ªÂä†ÁÖßÁâáÊèèËø∞ - Âè™È°ØÁ§∫ÊúâÂÖßÂÆπÁöÑÁÖßÁâá
            if (photos && photos.length > 0) {
                photos.forEach((photo, index) => {
                    quote += `${index + 1}.${photo}\n`;
                });
            }

            quote += `


‚ö†Ô∏è‰ª£Êî∂Ë¶èÁØÑ‚ö†Ô∏è
‰æùÁÖßÁâá‰∏ªÈ´î‰ª£Êî∂
ÁØÑÂúçË´ãÂäÉÁ∑öÊ®ôÁ§∫
‰∫ãÊ•≠Âª¢Ê£ÑÁâ©ÊãíÊî∂
ÂÉÖÊî∂‰∏ÄËà¨ÁîüÊ¥ªÂûÉÂúæ
Ë∂ÖÈáè/Ë∂ÖÊï∏/Ë∂ÖË∂ü=ÊãíÊî∂

‚òùÔ∏èÊ≥®ÊÑè‰∫ãÈ†Ö‚òùÔ∏è
1ÂàÜÈå¢1ÂàÜÊúçÂãô
ÂêàÊ≥ï‰ª£Êî∂ÊñπÂºè
‰∫íÂä©‰∫íÂà©‰∫íÁõ∏`;

            // Âè™È°ØÁ§∫ÊúâË®≠ÂÆöË≤ªÁî®ÁöÑÊñπÊ°à
            if (groundFee) {
                quote += `

ÊñπÊ°à1
‰∏ÄÊ®ì‰ª£Êî∂Ë≤ªÁî®Ôºö${groundFee}ÂÖÉ`;
            }
            
            if (upstairsFee) {
                quote += `
ÊñπÊ°à2
‰∏äÊ®ì‰ª£Êî∂Ë≤ªÁî®Ôºö${upstairsFee}ÂÖÉ`;
            }

            quote += `

Âü∑Ë°åÊó•ÊúüÔºö${date}
Âü∑Ë°åÊôÇÈñìÔºö${time}

‚úÖÂêåÊÑè‰∏äËø∞ÂÖßÂÆπÂæåË´ãÂõûË¶Ü
‚úÖÂ∞áÈñãÁ´ãÁπ≥Ë≤ªÂñÆ
‚úÖ20 ÂàÜÂÖßÂÆåÊàêÁπ≥Ë≤ª
‚úÖÊèê‰æõÈõªË©±ËàáÂßìÂêç
‚úÖÂñÆË∂üÈ†êÁ¥ÑÂç≥ÂÆåÊàê
‚úÖÊî∂Ê¨æÂæåË≤ªÁî®ÁÑ°Ê≥ïÈÄÄÊ¨æ
‚úÖÊî∂Ê¨æÂæåÂÖßÂÆπÁÑ°Ê≥ïÊõ¥Êîπ

üì∏ÁÖßÁâáËàáÂõûÂ†±Ë¶èÁØÑ
1Ô∏è‚É£ÁΩÆÊîæ1Ê®ìËÄÖ
üñºÊèê‰æõÂÆåÊï¥ÁÖßÁâá
üì©‰∏¶ÂõûÂÇ≥Áµ¶ÂÆ¢Êúç
2Ô∏è‚É£‰∏äÊ®ìËÄÖÔºöÁÑ°ÈúÄÂõûÂÇ≥
3Ô∏è‚É£ÁΩÆÊîæÂÆåÁï¢Âç≥ÂèØÈõ¢Èñã
4Ô∏è‚É£‰ª£Êî∂ÂÆåÊàêÂæåÊúÉÂõûÂ†±

üåçËß£Ê±∫ÂûÉÂúæ‰∏¶‰∏çÂè™ÊòØÊî∂Ëµ∞
‚ö°ÊàëÂÄëÊîπËÆäÁöÑÊòØÂüéÂ∏ÇÁöÑÈÅãËΩâÈÄüÂ∫¶`;

            return quote;
        }

        // Ë§áË£ΩÂñÆË∂üÂ†±ÂÉπÂñÆ
        function copySingleQuote() {
            const quoteText = document.getElementById('single-quote-result-display').textContent;
            
            if (!quoteText) {
                showStatus('single-quote-copy-status', '‚ùå Ê≤íÊúâÂ†±ÂÉπÂñÆÂèØË§áË£Ω', 'error');
                return;
            }

            navigator.clipboard.writeText(quoteText).then(() => {
                showStatus('single-quote-copy-status', '‚úÖ ÂñÆË∂üÂûÉÂúæ‰ª£Êî∂Â†±ÂÉπÂñÆÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø', 'success');
            }).catch(() => {
                showStatus('single-quote-copy-status', '‚ùå Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÈÅ∏ÊìáË§áË£Ω', 'error');
            });
        }

        // ÂñÆË∂üÂ†±ÂÉπÊ≠∑Âè≤Á∂≤ÂùÄÁÆ°ÁêÜ
        function saveSingleQuoteUrlToHistory() {
            const url = document.getElementById('single-quote-sheets-url').value.trim();
            if (!url) return;
            
            let savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            
            // Ê™¢Êü•ÊòØÂê¶Â∑≤Â≠òÂú®Áõ∏ÂêåÁ∂≤ÂùÄ
            const existingIndex = savedUrls.findIndex(item => (typeof item === 'string' ? item : item.url) === url);
            
            if (existingIndex === -1) {
                // Êñ∞Â¢ûÁ∂≤ÂùÄÔºåË©¢ÂïèËá™ÂÆöÁæ©ÂêçÁ®±
                const customName = prompt('Ë´ãÁÇ∫Ê≠§Á∂≤ÂùÄË®≠ÂÆö‰∏ÄÂÄãËá™ÂÆöÁæ©ÂêçÁ®±ÔºàÂèØÈÅ∏ÔºåÁõ¥Êé•ÊåâÁ¢∫ÂÆö‰ΩøÁî®È†êË®≠ÂêçÁ®±ÔºâÔºö', `ÂñÆË∂üË©¶ÁÆóË°® ${savedUrls.length + 1}`);
                const urlData = {
                    url: url,
                    name: customName && customName.trim() !== '' ? customName.trim() : `ÂñÆË∂üË©¶ÁÆóË°® ${savedUrls.length + 1}`,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
                
                // Êñ∞Â¢ûÂà∞ÊúÄÂâçÈù¢
                savedUrls.unshift(urlData);
                
                // ‰øùÁïôÊúÄÂ§ö10Á≠ÜË®òÈåÑ
                savedUrls = savedUrls.slice(0, 10);
                
                // ÂÑ≤Â≠òÂà∞localStorage
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                
                showStatus('single-quote-sheets-status', `‚úÖ Á∂≤ÂùÄÂ∑≤ÂÑ≤Â≠òÁÇ∫„Äå${urlData.name}„Äç`, 'success');
            } else {
                // Á∂≤ÂùÄÂ∑≤Â≠òÂú®ÔºåÁßªÂà∞ÊúÄÂâçÈù¢
                const existingItem = savedUrls.splice(existingIndex, 1)[0];
                savedUrls.unshift(existingItem);
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                
                const itemName = typeof existingItem === 'string' ? 'ÂñÆË∂üË©¶ÁÆóË°®' : existingItem.name;
                showStatus('single-quote-sheets-status', `‚úÖ Á∂≤ÂùÄ„Äå${itemName}„ÄçÂ∑≤ÁßªËá≥ÊúÄ‰∏äÊñπ`, 'success');
            }
            
            // Êõ¥Êñ∞‰∏ãÊãâÈÅ∏ÂñÆ
            updateSingleQuoteSavedUrlsDropdown();
        }

        function loadSingleQuoteSavedUrl() {
            const select = document.getElementById('single-quote-saved-urls');
            const selectedValue = select.value;
            
            if (selectedValue) {
                document.getElementById('single-quote-sheets-url').value = selectedValue;
                select.value = ''; // Ê∏ÖÁ©∫ÈÅ∏Êìá
                
                // Ëá™ÂãïËß∏ÁôºÂÑ≤Â≠òÂäüËÉΩÔºåÂ∞áÈÅ∏ÂèñÁöÑÁ∂≤ÂùÄÁßªÂà∞ÊúÄÂâçÈù¢
                saveSingleQuoteUrlToHistory();
            }
        }

        function updateSingleQuoteSavedUrlsDropdown() {
            const select = document.getElementById('single-quote-saved-urls');
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            
            // Ê∏ÖÁ©∫ÁèæÊúâÈÅ∏È†ÖÔºà‰øùÁïôÁ¨¨‰∏ÄÂÄãÁ©∫ÈÅ∏È†ÖÔºâ
            select.innerHTML = '<option value="">ÈÅ∏ÊìáÊ≠∑Âè≤Á∂≤ÂùÄ</option>';
            
            // Âä†ÂÖ•ÂÑ≤Â≠òÁöÑÁ∂≤ÂùÄ
            savedUrls.forEach((item, index) => {
                const option = document.createElement('option');
                
                if (typeof item === 'string') {
                    // ËàäÊ†ºÂºèÁõ∏ÂÆπÊÄß
                    option.value = item;
                    option.textContent = `${index + 1}. ${item.length > 45 ? item.substring(0, 45) + '...' : item}`;
                } else {
                    // Êñ∞Ê†ºÂºèÔºåÈ°ØÁ§∫Ëá™ÂÆöÁæ©ÂêçÁ®±ÂíåÊó•Êúü
                    option.value = item.url;
                    option.textContent = `${index + 1}. ${item.name} (${item.dateAdded})`;
                }
                
                select.appendChild(option);
            });
            
            // Êõ¥Êñ∞ÁÆ°ÁêÜÂàóË°®
            updateSingleQuoteUrlManagerList();
        }

        function updateSingleQuoteUrlManagerList() {
            const container = document.getElementById('single-quote-url-manager');
            if (!container) return;
            
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            
            if (savedUrls.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Êö´ÁÑ°ÂÑ≤Â≠òÁöÑÁ∂≤ÂùÄ</div>';
                return;
            }
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            savedUrls.forEach((item, index) => {
                let displayText, fullUrl;
                
                if (typeof item === 'string') {
                    // ËàäÊ†ºÂºèÁõ∏ÂÆπÊÄß
                    displayText = `${index + 1}. ${item}`;
                    fullUrl = item;
                } else {
                    // Êñ∞Ê†ºÂºèÔºåÈ°ØÁ§∫Ëá™ÂÆöÁæ©ÂêçÁ®±ÂíåÂÑ≤Â≠òÊó•Êúü
                    displayText = `${index + 1}. ${item.name} (${item.dateAdded})`;
                    fullUrl = item.url;
                }
                
                html += `
                    <div style="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: #333; border-radius: 5px;">
                        <div style="flex: 1; margin-right: 10px;">
                            <div style="color: #fff; font-weight: bold; margin-bottom: 5px;">
                                ${displayText}
                            </div>
                            <div style="color: #aaa; font-size: 11px; word-break: break-all;">
                                ${fullUrl}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editSingleQuoteUrlName(${index})" style="background: #28a745; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">ÊîπÂêç</button>
                            <button onclick="editSingleQuoteUrl(${index})" style="background: #007bff; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Á∑®ËºØ</button>
                            <button onclick="deleteSingleQuoteUrl(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Âà™Èô§</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        function editSingleQuoteUrlName(index) {
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            let currentName;
            
            if (typeof item === 'string') {
                currentName = `ÂñÆË∂üË©¶ÁÆóË°® ${index + 1}`;
                // ÂçáÁ¥öËàäÊ†ºÂºèÂà∞Êñ∞Ê†ºÂºè
                savedUrls[index] = {
                    url: item,
                    name: currentName,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
            } else {
                currentName = item.name;
            }
            
            const newName = prompt('Á∑®ËºØÂêçÁ®±Ôºö', currentName);
            
            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                savedUrls[index].name = newName.trim();
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', '‚úÖ ÂêçÁ®±Â∑≤Êõ¥Êñ∞', 'success');
            }
        }

        function editSingleQuoteUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const oldUrl = typeof item === 'string' ? item : item.url;
            const newUrl = prompt('Á∑®ËºØÁ∂≤ÂùÄÔºö', oldUrl);
            
            if (newUrl && newUrl.trim() !== '' && newUrl.trim() !== oldUrl) {
                if (typeof item === 'string') {
                    // ÂçáÁ¥öËàäÊ†ºÂºèÂà∞Êñ∞Ê†ºÂºè
                    savedUrls[index] = {
                        url: newUrl.trim(),
                        name: `ÂñÆË∂üË©¶ÁÆóË°® ${index + 1}`,
                        dateAdded: new Date().toLocaleDateString('zh-TW')
                    };
                } else {
                    savedUrls[index].url = newUrl.trim();
                }
                
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', '‚úÖ Á∂≤ÂùÄÂ∑≤Êõ¥Êñ∞', 'success');
            }
        }

        function deleteSingleQuoteUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('singleQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const itemName = typeof item === 'string' ? 'ÂñÆË∂üË©¶ÁÆóË°®' : item.name;
            
            if (confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${itemName}„ÄçÂóéÔºü`)) {
                savedUrls.splice(index, 1);
                localStorage.setItem('singleQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', `‚úÖ „Äå${itemName}„ÄçÂ∑≤Âà™Èô§`, 'success');
            }
        }

        function clearAllSingleQuoteUrls() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊ≠∑Âè≤Á∂≤ÂùÄÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
                localStorage.removeItem('singleQuoteSavedUrls');
                updateSingleQuoteSavedUrlsDropdown();
                showStatus('single-quote-sheets-status', '‚úÖ ÊâÄÊúâÊ≠∑Âè≤Á∂≤ÂùÄÂ∑≤Ê∏ÖÁ©∫', 'success');
            }
        }

        function toggleSingleQuoteUrlManager() {
            const manager = document.getElementById('single-quote-url-manager');
            const button = document.getElementById('single-quote-manage-urls-btn');
            
            if (manager.style.display === 'none' || !manager.style.display) {
                manager.style.display = 'block';
                button.textContent = 'Èö±ËóèÊ≠∑Âè≤Á∂≤ÂùÄÁÆ°ÁêÜ';
                updateSingleQuoteUrlManagerList();
            } else {
                manager.style.display = 'none';
                button.textContent = 'Ê≠∑Âè≤Á∂≤ÂùÄ';
            }
        }

        // Ê∏ÖÁ©∫ÂñÆË∂üÂ†±ÂÉπË°®ÂñÆ
        function clearSingleQuoteForm() {
            // Ê∏ÖÁ©∫GoogleË©¶ÁÆóË°®Á∂≤ÂùÄ
            document.getElementById('single-quote-sheets-url').value = '';
            document.getElementById('single-quote-saved-urls').value = '';
            
            // ÈáçÁΩÆË≤ªÁî®Ë®≠ÂÆö
            document.getElementById('single-quote-ground-fee').value = '';
            document.getElementById('single-quote-upstairs-fee').value = '';
            
            // Ê∏ÖÁ©∫Âü∫Êú¨Ë®≠ÂÆö
            document.getElementById('single-quote-upstairs-option').value = '';
            document.getElementById('single-quote-date').value = '';
            document.getElementById('single-quote-time').value = '';
            
            // ÈáçÁΩÆÂãïÊÖãÁÖßÁâáÊèèËø∞
            const container = document.getElementById('photo-descriptions-container');
            // ‰øùÁïôÊèèËø∞1ÔºåÊ∏ÖÁ©∫ÂÖ∂ÂÄº
            const photo1 = document.getElementById('single-quote-photo1');
            if (photo1) {
                photo1.value = '';
            }
            // ÁßªÈô§ÊâÄÊúâÂÖ∂‰ªñÊèèËø∞Ôºà2Âèä‰ª•‰∏äÔºâ
            const allDescItems = container.querySelectorAll('.photo-description-item');
            allDescItems.forEach((item, index) => {
                if (index > 0) { // ‰øùÁïôÁ¨¨‰∏ÄÂÄãÔºàÊèèËø∞1Ôºâ
                    item.remove();
                }
            });
            // ÈáçÁΩÆIDË®àÊï∏Âô®
            photoDescriptionNextId = 1;
            // Êõ¥Êñ∞Ê∑ªÂä†ÊåâÈàïÁãÄÊÖã
            updateAddButtonState();
            
            // Èö±ËóèËº∏Âá∫ÂçÄÂüü
            document.getElementById('single-quote-detected-data').style.display = 'none';
            document.getElementById('single-quote-controls').style.display = 'none';
            document.getElementById('single-quote-output').style.display = 'none';
            document.getElementById('single-quote-sheets-status').style.display = 'none';
            document.getElementById('single-quote-final-status').style.display = 'none';
            document.getElementById('single-quote-photos-section').style.display = 'none';
        }

        // Removed duplicate DOMContentLoaded - using unified one below

        // ÂåÖÊúàËá™ÂãïÂ†±ÂÉπÊ≠∑Âè≤Á∂≤ÂùÄÁÆ°ÁêÜ
        function saveUrlToHistory() {
            const url = document.getElementById('sheets-url').value.trim();
            if (!url) return;
            
            let savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            
            // Ê™¢Êü•ÊòØÂê¶Â∑≤Â≠òÂú®Áõ∏ÂêåÁ∂≤ÂùÄ
            const existingIndex = savedUrls.findIndex(item => (typeof item === 'string' ? item : item.url) === url);
            
            if (existingIndex === -1) {
                // Êñ∞Â¢ûÁ∂≤ÂùÄÔºåË©¢ÂïèËá™ÂÆöÁæ©ÂêçÁ®±
                const customName = prompt('Ë´ãÁÇ∫Ê≠§Á∂≤ÂùÄË®≠ÂÆö‰∏ÄÂÄãËá™ÂÆöÁæ©ÂêçÁ®±ÔºàÂèØÈÅ∏ÔºåÁõ¥Êé•ÊåâÁ¢∫ÂÆö‰ΩøÁî®È†êË®≠ÂêçÁ®±ÔºâÔºö', `Ë©¶ÁÆóË°® ${savedUrls.length + 1}`);
                const urlData = {
                    url: url,
                    name: customName && customName.trim() !== '' ? customName.trim() : `Ë©¶ÁÆóË°® ${savedUrls.length + 1}`,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
                
                // Êñ∞Â¢ûÂà∞ÊúÄÂâçÈù¢
                savedUrls.unshift(urlData);
                
                // ‰øùÁïôÊúÄÂ§ö10Á≠ÜË®òÈåÑ
                savedUrls = savedUrls.slice(0, 10);
                
                // ÂÑ≤Â≠òÂà∞localStorage
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                
                showStatus('auto-sheets-status', `‚úÖ Á∂≤ÂùÄÂ∑≤ÂÑ≤Â≠òÁÇ∫„Äå${urlData.name}„Äç`, 'success');
            } else {
                // Á∂≤ÂùÄÂ∑≤Â≠òÂú®ÔºåÁßªÂà∞ÊúÄÂâçÈù¢
                const existingItem = savedUrls.splice(existingIndex, 1)[0];
                savedUrls.unshift(existingItem);
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                
                const itemName = typeof existingItem === 'string' ? 'Ë©¶ÁÆóË°®' : existingItem.name;
                showStatus('auto-sheets-status', `‚úÖ Á∂≤ÂùÄ„Äå${itemName}„ÄçÂ∑≤ÁßªËá≥ÊúÄ‰∏äÊñπ`, 'success');
            }
            
            // Êõ¥Êñ∞‰∏ãÊãâÈÅ∏ÂñÆ
            updateSavedUrlsDropdown();
        }

        function loadSavedUrl() {
            const select = document.getElementById('saved-urls');
            const selectedValue = select.value;
            
            if (selectedValue) {
                document.getElementById('sheets-url').value = selectedValue;
                select.value = ''; // Ê∏ÖÁ©∫ÈÅ∏Êìá
                
                // Ëá™ÂãïËß∏ÁôºÂÑ≤Â≠òÂäüËÉΩÔºåÂ∞áÈÅ∏ÂèñÁöÑÁ∂≤ÂùÄÁßªÂà∞ÊúÄÂâçÈù¢
                saveUrlToHistory();
            }
        }

        function updateSavedUrlsDropdown() {
            const select = document.getElementById('saved-urls');
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            
            // Ê∏ÖÁ©∫ÁèæÊúâÈÅ∏È†ÖÔºà‰øùÁïôÁ¨¨‰∏ÄÂÄãÁ©∫ÈÅ∏È†ÖÔºâ
            select.innerHTML = '<option value="">ÈÅ∏ÊìáÊ≠∑Âè≤Á∂≤ÂùÄ</option>';
            
            // Âä†ÂÖ•ÂÑ≤Â≠òÁöÑÁ∂≤ÂùÄ
            savedUrls.forEach((item, index) => {
                const option = document.createElement('option');
                
                if (typeof item === 'string') {
                    // ËàäÊ†ºÂºèÁõ∏ÂÆπÊÄß
                    option.value = item;
                    option.textContent = `${index + 1}. ${item.length > 45 ? item.substring(0, 45) + '...' : item}`;
                } else {
                    // Êñ∞Ê†ºÂºèÔºåÂåÖÂê´Ëá™ÂÆöÁæ©ÂêçÁ®±
                    option.value = item.url;
                    option.textContent = `${index + 1}. ${item.name} (${item.dateAdded})`;
                }
                
                select.appendChild(option);
            });
            
            // Êõ¥Êñ∞ÁÆ°ÁêÜÂàóË°®
            updateUrlManagerList();
        }

        function updateUrlManagerList() {
            const container = document.getElementById('url-manager');
            if (!container) return;
            
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            
            if (savedUrls.length === 0) {
                container.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">Êö´ÁÑ°ÂÑ≤Â≠òÁöÑÁ∂≤ÂùÄ</div>';
                return;
            }
            
            let html = '<div style="max-height: 300px; overflow-y: auto;">';
            savedUrls.forEach((item, index) => {
                let displayText, fullUrl;
                
                if (typeof item === 'string') {
                    // ËàäÊ†ºÂºèÁõ∏ÂÆπÊÄß
                    displayText = `${index + 1}. ${item}`;
                    fullUrl = item;
                } else {
                    // Êñ∞Ê†ºÂºèÔºåÈ°ØÁ§∫Ëá™ÂÆöÁæ©ÂêçÁ®±ÂíåÂÑ≤Â≠òÊó•Êúü
                    displayText = `${index + 1}. ${item.name} (${item.dateAdded})`;
                    fullUrl = item.url;
                }
                
                html += `
                    <div style="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: #333; border-radius: 5px;">
                        <div style="flex: 1; margin-right: 10px;">
                            <div style="color: #fff; font-weight: bold; margin-bottom: 5px;">
                                ${displayText}
                            </div>
                            <div style="color: #aaa; font-size: 11px; word-break: break-all;">
                                ${fullUrl}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <button onclick="editUrlName(${index})" style="background: #28a745; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">ÊîπÂêç</button>
                            <button onclick="editUrl(${index})" style="background: #007bff; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Á∑®ËºØ</button>
                            <button onclick="deleteUrl(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 8px; border-radius: 3px; cursor: pointer; font-size: 11px;">Âà™Èô§</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        function editUrlName(index) {
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            let currentName;
            
            if (typeof item === 'string') {
                currentName = `Ë©¶ÁÆóË°® ${index + 1}`;
                // ÂçáÁ¥öËàäÊ†ºÂºèÂà∞Êñ∞Ê†ºÂºè
                savedUrls[index] = {
                    url: item,
                    name: currentName,
                    dateAdded: new Date().toLocaleDateString('zh-TW')
                };
            } else {
                currentName = item.name;
            }
            
            const newName = prompt('Á∑®ËºØÂêçÁ®±Ôºö', currentName);
            
            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                savedUrls[index].name = newName.trim();
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', '‚úÖ ÂêçÁ®±Â∑≤Êõ¥Êñ∞', 'success');
            }
        }

        function editUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const oldUrl = typeof item === 'string' ? item : item.url;
            const newUrl = prompt('Á∑®ËºØÁ∂≤ÂùÄÔºö', oldUrl);
            
            if (newUrl && newUrl.trim() !== '' && newUrl.trim() !== oldUrl) {
                if (typeof item === 'string') {
                    // ÂçáÁ¥öËàäÊ†ºÂºèÂà∞Êñ∞Ê†ºÂºè
                    savedUrls[index] = {
                        url: newUrl.trim(),
                        name: `Ë©¶ÁÆóË°® ${index + 1}`,
                        dateAdded: new Date().toLocaleDateString('zh-TW')
                    };
                } else {
                    savedUrls[index].url = newUrl.trim();
                }
                
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', '‚úÖ Á∂≤ÂùÄÂ∑≤Êõ¥Êñ∞', 'success');
            }
        }

        function deleteUrl(index) {
            const savedUrls = JSON.parse(localStorage.getItem('autoQuoteSavedUrls') || '[]');
            if (index >= savedUrls.length) return;
            
            const item = savedUrls[index];
            const itemName = typeof item === 'string' ? 'Ë©¶ÁÆóË°®' : item.name;
            
            if (confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${itemName}„ÄçÂóéÔºü`)) {
                savedUrls.splice(index, 1);
                localStorage.setItem('autoQuoteSavedUrls', JSON.stringify(savedUrls));
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', `‚úÖ „Äå${itemName}„ÄçÂ∑≤Âà™Èô§`, 'success');
            }
        }

        function clearAllUrls() {
            if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊ≠∑Âè≤Á∂≤ÂùÄÂóéÔºüÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÂæ©Âéü„ÄÇ')) {
                localStorage.removeItem('autoQuoteSavedUrls');
                updateSavedUrlsDropdown();
                showStatus('auto-sheets-status', '‚úÖ ÊâÄÊúâÊ≠∑Âè≤Á∂≤ÂùÄÂ∑≤Ê∏ÖÁ©∫', 'success');
            }
        }

        function toggleUrlManager() {
            const manager = document.getElementById('url-manager');
            const button = document.getElementById('manage-urls-btn');
            
            if (manager.style.display === 'none' || !manager.style.display) {
                manager.style.display = 'block';
                button.textContent = 'Èö±ËóèÊ≠∑Âè≤Á∂≤ÂùÄÁÆ°ÁêÜ';
                updateUrlManagerList();
            } else {
                manager.style.display = 'none';
                button.textContent = 'Ê≠∑Âè≤Á∂≤ÂùÄ';
            }
        }

        // Á∂≤ÂùÄË®òÊÜ∂ÂäüËÉΩ (ËàäÁâàÂ∑≤Ë¢´Êñ∞ÁâàÂèñ‰ª£)




        // ÊéßÂà∂Êõ¥Êñ∞Ê®°ÂºèUIÔºàÁõÆÂâçÁÑ°ÈúÄÈ°çÂ§ñËº∏ÂÖ•Ê¨Ñ‰ΩçÔºâ
        function toggleCustomRowInput() {
            // ÊâÄÊúâÊ®°ÂºèÈÉΩ‰∏çÈúÄË¶ÅÈ°çÂ§ñËº∏ÂÖ•Ê¨Ñ‰Ωç
        }

        // ÈÅ∏ÊìáÁâπÂÆöË°å‰ΩúÁÇ∫Â†±ÂÉπÂñÆ‰æÜÊ∫ê
        function selectRowForQuote(rowIndex) {
            if (!autoQuoteData || !autoQuoteData.rows || rowIndex >= autoQuoteData.rows.length) {
                showStatus('auto-quote-final-status', '‚ùå ÁÑ°ÊïàÁöÑË≥áÊñôË°åÈÅ∏Êìá', 'error');
                return;
            }

            showStatus('auto-quote-final-status', `üîÑ Ê≠£Âú®‰ΩøÁî®Á¨¨${rowIndex + 1}Ë°åË≥áÊñôÁîüÊàêÂ†±ÂÉπÂñÆ...`, 'success');

            try {
                // ÁßªÈô§‰πãÂâçÈÅ∏‰∏≠Ë°åÁöÑÈ´ò‰∫Æ
                document.querySelectorAll('.data-row').forEach(row => {
                    row.style.border = '';
                    row.style.boxShadow = '';
                });

                // È´ò‰∫ÆÈÅ∏‰∏≠ÁöÑË°å
                const selectedRow = document.querySelector(`tr[onclick="selectRowForQuote(${rowIndex})"]`);
                if (selectedRow) {
                    selectedRow.style.border = '2px solid #ffd700';
                    selectedRow.style.boxShadow = '0 0 10px rgba(255, 215, 0, 0.3)';
                }

                const selectedRowData = autoQuoteData.rows[rowIndex];
                const headers = autoQuoteData.headers;

                // Áç≤ÂèñÊâãÂãïËº∏ÂÖ•ÁöÑË≥áÊñô
                const selectedDays = Array.from(document.querySelectorAll('input[name="manual-days"]:checked')).map(cb => cb.value);
                const manualData = {
                    lineName: '',
                    address: '',
                    housingType: '',
                    monthlyFee: document.getElementById('manual-fee').value || '',
                    serviceDays: selectedDays.join('„ÄÅ') || '',
                    serviceTime: document.getElementById('manual-time').value || '',
                    floor: document.getElementById('manual-floor').value || '',
                    frequency: document.getElementById('manual-frequency').value || '',
                    trashBags: document.getElementById('manual-trash').value || '',
                    recycleBags: document.getElementById('manual-recycle').value || '',
                    trashVolume: document.querySelector('input[name="manual-trash-volume"]:checked')?.value || '',
                    recycleVolume: document.querySelector('input[name="manual-recycle-volume"]:checked')?.value || '',
                    trashMax: document.getElementById('manual-trash-max').value || '',
                    recycleMax: document.getElementById('manual-recycle-max').value || '',
                    specialNotes: document.getElementById('manual-special-notes').value || ''
                };

                const fieldMapping = {};
                let trashData = { bags: '', volume: '' };
                let recycleData = { bags: '', volume: '' };

                // ËôïÁêÜÈÅ∏‰∏≠Ë°åÁöÑË≥áÊñôÔºà‰ΩøÁî®ËàágenerateAutoQuoteÁõ∏ÂêåÁöÑÈÇèËºØÔºâ
                headers.forEach((header, index) => {
                    const lowerHeader = header.toLowerCase();
                    const cellValue = selectedRowData[index];

                    if (lowerHeader.includes('line') || lowerHeader.includes('Êö±Á®±')) {
                        fieldMapping.lineName = cellValue;
                    } else if (lowerHeader.includes('Âú∞ÂùÄ')) {
                        fieldMapping.address = cellValue;
                        if (cellValue && (!manualData.floor || manualData.floor.trim() === '')) {
                            const floorMatch = cellValue.match(/(\d+)[Ê®ìF]/);
                            if (floorMatch) {
                                fieldMapping.floor = floorMatch[1];
                                document.getElementById('manual-floor').value = floorMatch[1];
                            }
                        }
                    } else if (lowerHeader.includes('‰ΩèÂÆÖ') || lowerHeader.includes('ÊÄßË≥™')) {
                        fieldMapping.housingType = cellValue;
                    } else if (lowerHeader.includes('ÊúàË≤ª') || lowerHeader.includes('Ë≤ªÁî®')) {
                        fieldMapping.monthlyFee = (manualData.monthlyFee && manualData.monthlyFee.trim() !== '') ? manualData.monthlyFee : cellValue;
                    } else if (lowerHeader.includes('ÊòüÊúü') || lowerHeader.includes('Êî∂Âèñ')) {
                        if (cellValue && cellValue.trim() !== '') {
                            const frequencyMatch = cellValue.match(/(\d+)/);
                            if (frequencyMatch) {
                                fieldMapping.weeklyFrequency = `‰∏ÄÈÄ±Ë∂üÊï∏Ôºö${frequencyMatch[1]}Ë∂ü`;
                            } else {
                                fieldMapping.weeklyFrequency = `‰∏ÄÈÄ±Ë∂üÊï∏Ôºö${cellValue}Ë∂ü`;
                            }
                        }
                        fieldMapping.serviceDays = manualData.serviceDays;
                    } else if (lowerHeader.includes('ÊôÇÈñì')) {
                        fieldMapping.serviceTime = (manualData.serviceTime && manualData.serviceTime.trim() !== '') ? manualData.serviceTime : cellValue;
                    } else if (lowerHeader.includes('Ê®ìÂ±§')) {
                        fieldMapping.floor = (manualData.floor && manualData.floor.trim() !== '') ? manualData.floor : ((cellValue && cellValue.trim() !== '') ? cellValue : '0');
                    } else if (lowerHeader.includes('ÂûÉÂúæ')) {
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)ÂåÖ/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?ÂÖ¨Âçá)/);
                            if (bagMatch) {
                                trashData.bags = bagMatch[1];
                                if (headerVolumeMatch) {
                                    trashData.volume = headerVolumeMatch[1];
                                }
                            }
                        }
                    } else if (lowerHeader.includes('Ë≥áÊ∫ê')) {
                        if (cellValue && cellValue.trim() !== '') {
                            const bagMatch = cellValue.match(/(\d+)ÂåÖ/);
                            const headerVolumeMatch = header.match(/(\d+(?:\/\d+)?ÂÖ¨Âçá)/);
                            if (bagMatch) {
                                recycleData.bags = bagMatch[1];
                                if (headerVolumeMatch) {
                                    recycleData.volume = headerVolumeMatch[1];
                                }
                            }
                        }
                    }
                });

                // ÁµÑÂêàÂûÉÂúæË¢ãÂíåË≥áÊ∫êË¢ãË≥áÊñô
                if (manualData.trashBags || manualData.trashVolume) {
                    if (manualData.trashBags && manualData.trashVolume) {
                        fieldMapping.trashBags = `${manualData.trashBags}ÂåÖÊï∏Ôºà${manualData.trashVolume}Ôºâ`;
                    } else if (manualData.trashBags) {
                        fieldMapping.trashBags = `${manualData.trashBags}ÂåÖÊï∏Ôºà14ÂÖ¨ÂçáÔºâ`;
                    } else {
                        fieldMapping.trashBags = `6ÂåÖÊï∏Ôºà${manualData.trashVolume}Ôºâ`;
                    }
                } else if (trashData.bags && trashData.volume) {
                    fieldMapping.trashBags = `${trashData.bags}ÂåÖÔºà${trashData.volume}Ôºâ`;
                } else if (trashData.bags) {
                    fieldMapping.trashBags = `${trashData.bags}ÂåÖÔºà14ÂÖ¨ÂçáÔºâ`;
                } else {
                    fieldMapping.trashBags = '6ÂåÖÔºà14ÂÖ¨ÂçáÔºâ';
                }

                if (manualData.recycleBags || manualData.recycleVolume) {
                    if (manualData.recycleBags && manualData.recycleVolume) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}ÂåÖÊï∏Ôºà${manualData.recycleVolume}Ôºâ`;
                    } else if (manualData.recycleBags) {
                        fieldMapping.recycleBags = `${manualData.recycleBags}ÂåÖÊï∏Ôºà14ÂÖ¨ÂçáÔºâ`;
                    } else {
                        fieldMapping.recycleBags = `3ÂåÖÊï∏Ôºà${manualData.recycleVolume}Ôºâ`;
                    }
                } else if (recycleData.bags && recycleData.volume) {
                    fieldMapping.recycleBags = `${recycleData.bags}ÂåÖÔºà${recycleData.volume}Ôºâ`;
                } else if (recycleData.bags) {
                    fieldMapping.recycleBags = `${recycleData.bags}ÂåÖÔºà14ÂÖ¨ÂçáÔºâ`;
                } else {
                    fieldMapping.recycleBags = '3ÂåÖÔºà14ÂÖ¨ÂçáÔºâ';
                }

                console.log(`Selected row ${rowIndex + 1} field mapping:`, fieldMapping);

                const quote = generateQuoteFromData(fieldMapping);
                document.getElementById('auto-quote-result-display').textContent = quote;
                document.getElementById('auto-quote-output').style.display = 'block';

                showStatus('auto-quote-final-status', `‚úÖ Â∑≤‰ΩøÁî®Á¨¨${rowIndex + 1}Ë°åË≥áÊñôÁîüÊàêÂ†±ÂÉπÂñÆÔºÅ`, 'success');

            } catch (error) {
                showStatus('auto-quote-final-status', `‚ùå ÁîüÊàêÂ§±Êïó: ${error.message}`, 'error');
            }
        }

        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂàùÂßãÂåñÁ∂≤ÂùÄ‰∏ãÊãâÈÅ∏ÂñÆ
        document.addEventListener('DOMContentLoaded', function() {
            updateSingleQuoteSavedUrlsDropdown();
            updateSavedUrlsDropdown();
            showTab('auto-quote'); // Initialize first tab as active
            loadVendorData(); // ËºâÂÖ•Â§ñÈÉ®ÂÉπÊ†ºË≥áÊñô
        });

        // ========== Â§ñÈÉ®ÂÉπÊ†ºÁÆ°ÁêÜÂäüËÉΩ ==========
        
        // Â§ñÈÉ®ÂÉπÊ†ºË≥áÊñô
        const defaultVendorData = [
            // Êàë‰æÜÁßëÊäÄ
            {
                vendorName: "Êàë‰æÜÁßëÊäÄ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "1",
                otherVolume: "22X2",
                ourConvert14: "25X1+25X1",
                ourConvert25: "14X2+14X2",
                originalPrice: "480",
                discount1m: "470",
                discount3m: "",
                discount6m: "",
                vendorUrl: "https://www.wecometechnology.com"
            },
            {
                vendorName: "Êàë‰æÜÁßëÊäÄ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "2",
                otherVolume: "22X4",
                ourConvert14: "25X2+25X2",
                ourConvert25: "14X4+14X4",
                originalPrice: "980",
                discount1m: "960",
                discount3m: "",
                discount6m: "",
                vendorUrl: "https://www.wecometechnology.com"
            },
            {
                vendorName: "Êàë‰æÜÁßëÊäÄ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "22X6",
                ourConvert14: "25X3+25X3",
                ourConvert25: "14X6+14X6",
                originalPrice: "1,480",
                discount1m: "1,450",
                discount3m: "",
                discount6m: "",
                vendorUrl: "https://www.wecometechnology.com"
            },
            // ÂûÉÂèØ
            {
                vendorName: "ÂûÉÂèØ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "1",
                otherVolume: "30X1",
                ourConvert14: "14X1+14X1",
                ourConvert25: "25X1",
                originalPrice: "380",
                discount1m: "ÁÑ°",
                discount3m: "361",
                discount6m: "342",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "2",
                otherVolume: "30X2",
                ourConvert14: "14X2+14X2",
                ourConvert25: "25X1+25X1",
                originalPrice: "760",
                discount1m: "ÁÑ°",
                discount3m: "722",
                discount6m: "684",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "30X3",
                ourConvert14: "14X3+14X3",
                ourConvert25: "25X2+25X1",
                originalPrice: "1,140",
                discount1m: "ÁÑ°",
                discount3m: "1,083",
                discount6m: "1,026",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "4",
                otherVolume: "30X4",
                ourConvert14: "14X4+14X4",
                ourConvert25: "25X2+25X2",
                originalPrice: "1,440",
                discount1m: "ÁÑ°",
                discount3m: "1,368",
                discount6m: "1,296",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "5",
                otherVolume: "30X5",
                ourConvert14: "14X5+14X5",
                ourConvert25: "25X3+25X2",
                originalPrice: "1,800",
                discount1m: "ÁÑ°",
                discount3m: "1,710",
                discount6m: "1,620",
                vendorUrl: "https://trashapp.com.tw"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "1",
                otherVolume: "60X1",
                ourConvert14: "14X2+14X2",
                ourConvert25: "25X1+25X1",
                originalPrice: "560",
                discount1m: "ÁÑ°",
                discount3m: "532",
                discount6m: "504"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "2",
                otherVolume: "60X2",
                ourConvert14: "14X4+14X4",
                ourConvert25: "25X2+25X2",
                originalPrice: "1,120",
                discount1m: "ÁÑ°",
                discount3m: "1,064",
                discount6m: "1,008"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "60X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X4+25X2",
                originalPrice: "1,680",
                discount1m: "ÁÑ°",
                discount3m: "1,596",
                discount6m: "1,512"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "4",
                otherVolume: "60X4",
                ourConvert14: "14X8+14X8",
                ourConvert25: "25X4+25X4",
                originalPrice: "2,160",
                discount1m: "ÁÑ°",
                discount3m: "2,052",
                discount6m: "1,944"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "5",
                otherVolume: "60X5",
                ourConvert14: "14X10+14X10",
                ourConvert25: "25X6+25X4",
                originalPrice: "2,700",
                discount1m: "ÁÑ°",
                discount3m: "2,565",
                discount6m: "2,430"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂïÜÂãôÊñπÊ°à",
                weeklyFreq: "1",
                otherVolume: "76X1",
                ourConvert14: "33X1+33X1",
                ourConvert25: "25X2+25X1",
                originalPrice: "800",
                discount1m: "ÁÑ°",
                discount3m: "760",
                discount6m: "720"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂïÜÂãôÊñπÊ°à",
                weeklyFreq: "2",
                otherVolume: "76X2",
                ourConvert14: "33X2+33X2",
                ourConvert25: "25X4+25X2",
                originalPrice: "1,600",
                discount1m: "ÁÑ°",
                discount3m: "1,520",
                discount6m: "1,440"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂïÜÂãôÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "76X3",
                ourConvert14: "33X3+33X3",
                ourConvert25: "25X6+25X3",
                originalPrice: "2,400",
                discount1m: "ÁÑ°",
                discount3m: "2,280",
                discount6m: "2,160"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂïÜÂãôÊñπÊ°à",
                weeklyFreq: "4",
                otherVolume: "76X4",
                ourConvert14: "33X4+33X4",
                ourConvert25: "25X8+25X4",
                originalPrice: "3,040",
                discount1m: "ÁÑ°",
                discount3m: "2,888",
                discount6m: "2,736"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "ÂïÜÂãôÊñπÊ°à",
                weeklyFreq: "5",
                otherVolume: "76X5",
                ourConvert14: "33X5+33X5",
                ourConvert25: "25X10+25X5",
                originalPrice: "3,800",
                discount1m: "ÁÑ°",
                discount3m: "3,610",
                discount6m: "3,420"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "‰ºÅÊ•≠ÊñπÊ°à",
                weeklyFreq: "1",
                otherVolume: "152X1",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "1,080",
                discount1m: "ÁÑ°",
                discount3m: "1,026",
                discount6m: "972"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "‰ºÅÊ•≠ÊñπÊ°à",
                weeklyFreq: "2",
                otherVolume: "152X2",
                ourConvert14: "14X12+14X12",
                ourConvert25: "25X6+25X6",
                originalPrice: "2,160",
                discount1m: "ÁÑ°",
                discount3m: "2,052",
                discount6m: "1,944"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "‰ºÅÊ•≠ÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "152X3",
                ourConvert14: "14X18+14X18",
                ourConvert25: "25X9+25X9",
                originalPrice: "3,240",
                discount1m: "ÁÑ°",
                discount3m: "3,078",
                discount6m: "2,916"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "‰ºÅÊ•≠ÊñπÊ°à",
                weeklyFreq: "4",
                otherVolume: "152X4",
                ourConvert14: "14X24+14X24",
                ourConvert25: "25X12+25X12",
                originalPrice: "4,160",
                discount1m: "ÁÑ°",
                discount3m: "3,952",
                discount6m: "3,744"
            },
            {
                vendorName: "ÂûÉÂèØ",
                planName: "‰ºÅÊ•≠ÊñπÊ°à",
                weeklyFreq: "5",
                otherVolume: "152X5",
                ourConvert14: "14X30+14X30",
                ourConvert25: "25X15+25X15",
                originalPrice: "5,200",
                discount1m: "ÁÑ°",
                discount3m: "4,940",
                discount6m: "4,680"
            },
            // ‰ø°Áæ©ÂûÉÂúæ
            {
                vendorName: "‰ø°Áæ©ÂûÉÂúæ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "30X3",
                ourConvert14: "14X3+14X3",
                ourConvert25: "25X2+25X1",
                originalPrice: "361",
                discount1m: "ÁÑ°",
                discount3m: "1,083",
                discount6m: "ÁÑ°"
            },
            {
                vendorName: "‰ø°Áæ©ÂûÉÂúæ",
                planName: "Â∞èË≥áÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "30X3",
                ourConvert14: "14X3+14X3",
                ourConvert25: "25X2+25X1",
                originalPrice: "342",
                discount1m: "ÁÑ°",
                discount3m: "ÁÑ°",
                discount6m: "2,052"
            },
            {
                vendorName: "‰ø°Áæ©ÂûÉÂúæ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "60X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "532",
                discount1m: "ÁÑ°",
                discount3m: "1,596",
                discount6m: "ÁÑ°"
            },
            {
                vendorName: "‰ø°Áæ©ÂûÉÂúæ",
                planName: "ÂÆ∂Â∫≠ÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "60X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "504",
                discount1m: "ÁÑ°",
                discount3m: "ÁÑ°",
                discount6m: "3,024"
            },
            // Â§ßÂè∞ÂåóÊî∂ÂûÉÂúæ
            {
                vendorName: "Â§ßÂè∞ÂåóÊî∂ÂûÉÂúæ",
                planName: "1Ê¨°ÊñπÊ°à",
                weeklyFreq: "1",
                otherVolume: "25X1+25X1",
                ourConvert14: "14X2+14X2",
                ourConvert25: "25X1+25X1",
                originalPrice: "600",
                discount1m: "ÁÑ°",
                discount3m: "ÁÑ°",
                discount6m: "ÁÑ°"
            },
            {
                vendorName: "Â§ßÂè∞ÂåóÊî∂ÂûÉÂúæ",
                planName: "2Ê¨°ÊñπÊ°à",
                weeklyFreq: "2",
                otherVolume: "25X2+25X2",
                ourConvert14: "14X4+14X4",
                ourConvert25: "25X2+25X2",
                originalPrice: "800",
                discount1m: "ÁÑ°",
                discount3m: "ÁÑ°",
                discount6m: "ÁÑ°"
            },
            {
                vendorName: "Â§ßÂè∞ÂåóÊî∂ÂûÉÂúæ",
                planName: "3Ê¨°ÊñπÊ°à",
                weeklyFreq: "3",
                otherVolume: "25X3+25X3",
                ourConvert14: "14X6+14X6",
                ourConvert25: "25X3+25X3",
                originalPrice: "1100",
                discount1m: "ÁÑ°",
                discount3m: "ÁÑ°",
                discount6m: "ÁÑ°"
            }
        ];

        // ËºâÂÖ•Âª†ÂïÜË≥áÊñô
        function loadVendorData() {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            // Á¢∫‰øùÊâÄÊúâÂª†ÂïÜË≥áÊñôÈÉΩÊúâ vendorUrl Ê¨Ñ‰Ωç
            vendorData = vendorData.map(vendor => {
                if (!vendor.hasOwnProperty('vendorUrl')) {
                    // Ê†πÊìöÂª†ÂïÜÂêçÁ®±Ë®≠ÂÆöÈ†êË®≠Á∂≤ÂùÄ
                    let defaultUrl = '';
                    switch(vendor.vendorName) {
                        case 'Êàë‰æÜÁßëÊäÄ':
                            defaultUrl = 'https://www.wecometechnology.com';
                            break;
                        case 'ÂûÉÂèØ':
                            defaultUrl = 'https://trashapp.com.tw';
                            break;
                        case '‰ø°Áæ©ÂûÉÂúæ':
                            defaultUrl = 'https://xinyi-waste.com.tw';
                            break;
                        case 'ÂÑ™Âäõ':
                            defaultUrl = 'https://youli-service.com';
                            break;
                        case 'ÂìàÂõâÊî∂':
                            defaultUrl = 'https://hellocollect.tw';
                            break;
                        case '‰ª£Êî∂Âì•':
                            defaultUrl = 'https://pickup-bro.com';
                            break;
                        default:
                            defaultUrl = '';
                    }
                    return { ...vendor, vendorUrl: defaultUrl };
                }
                return vendor;
            });
            
            // ÂÑ≤Â≠òÊõ¥Êñ∞ÂæåÁöÑË≥áÊñô
            localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            
            renderVendorTable(vendorData);
        }

        // Ê∏≤ÊüìÂª†ÂïÜË°®Ê†º
        function renderVendorTable(data) {
            const tbody = document.getElementById('vendor-table-body');
            tbody.innerHTML = '';
            
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                // ËôïÁêÜÂª†ÂïÜÂêçÁ®±ËàáÁ∂≤ÂùÄÂêà‰ΩµÈ°ØÁ§∫
                let vendorNameDisplay = '';
                if (row.vendorUrl && row.vendorUrl.trim() !== '') {
                    vendorNameDisplay = `<a href="${row.vendorUrl}" target="_blank" class="vendor-name-link" onclick="event.stopPropagation();">${row.vendorName} üîó</a><br><small class="vendor-edit-hint" onclick="makeVendorEditable(this, ${index})">ÈªûÊìäÁ∑®ËºØ</small>`;
                } else {
                    vendorNameDisplay = `<span class="vendor-name-no-url">${row.vendorName}</span><br><small class="vendor-edit-hint" onclick="makeVendorEditable(this, ${index})">ÈªûÊìäÊñ∞Â¢ûÁ∂≤ÂùÄ</small>`;
                }
                
                tr.innerHTML = `
                    <td class="vendor-name-cell">${vendorNameDisplay}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'planName')">${row.planName}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'weeklyFreq')">${row.weeklyFreq}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'otherVolume')">${row.otherVolume}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'ourConvert14')">${row.ourConvert14}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'ourConvert25')">${row.ourConvert25}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'originalPrice')">${row.originalPrice}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'discount1m')">${row.discount1m}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'discount3m')">${row.discount3m}</td>
                    <td class="editable" onclick="makeEditable(this, ${index}, 'discount6m')">${row.discount6m}</td>
                    <td><button class="delete-row-btn" onclick="deleteVendorRow(${index})">üóëÔ∏è Âà™Èô§</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ‰ΩøÂÑ≤Â≠òÊ†ºÂèØÁ∑®ËºØ
        function makeEditable(cell, rowIndex, field) {
            if (cell.querySelector('input')) return; // Â∑≤Á∂ìÂú®Á∑®ËºØ‰∏≠
            
            const currentValue = cell.textContent;
            cell.classList.add('editing');
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.style.width = '100%';
            
            // Áï∂Â§±ÂéªÁÑ¶ÈªûÊàñÊåâ‰∏ã Enter ÊôÇ‰øùÂ≠ò
            input.onblur = () => saveCell(cell, input, rowIndex, field);
            input.onkeypress = (e) => {
                if (e.key === 'Enter') {
                    saveCell(cell, input, rowIndex, field);
                }
            };
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            input.select();
        }

        // ‰øùÂ≠òÂÑ≤Â≠òÊ†ºÁ∑®ËºØ
        function saveCell(cell, input, rowIndex, field) {
            const newValue = input.value.trim();
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            if (rowIndex < vendorData.length) {
                vendorData[rowIndex][field] = newValue;
                localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            }
            
            cell.classList.remove('editing');
            cell.textContent = newValue;
            cell.onclick = () => makeEditable(cell, rowIndex, field);
            
            showVendorStatus('‚úÖ Ë≥áÊñôÂ∑≤Êõ¥Êñ∞', 'success');
        }

        // Á∑®ËºØÂª†ÂïÜÂêçÁ®±ËàáÁ∂≤ÂùÄ
        function makeVendorEditable(element, index) {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            const row = vendorData[index];
            
            const cell = element.parentNode;
            const originalContent = cell.innerHTML;
            
            cell.innerHTML = `
                <div class="vendor-edit-form">
                    <input type="text" class="vendor-edit-input" id="vendorName_${index}" 
                           value="${row.vendorName}" placeholder="Âª†ÂïÜÂêçÁ®±">
                    <input type="url" class="vendor-edit-input" id="vendorUrl_${index}" 
                           value="${row.vendorUrl || ''}" placeholder="Âª†ÂïÜÁ∂≤ÂùÄ (ÈÅ∏Â°´)">
                    <div class="vendor-edit-buttons">
                        <button class="vendor-save-btn" onclick="saveVendorEdit(${index})">ÂÑ≤Â≠ò</button>
                        <button class="vendor-cancel-btn" onclick="cancelVendorEdit(${index})">ÂèñÊ∂à</button>
                    </div>
                </div>
            `;
            
            // ÂÑ≤Â≠òÂéüÂßãÂÖßÂÆπ‰æõÂèñÊ∂àÊôÇ‰ΩøÁî®
            cell.dataset.originalContent = originalContent;
            document.getElementById(`vendorName_${index}`).focus();
        }
        
        // ÂÑ≤Â≠òÂª†ÂïÜÁ∑®ËºØ
        function saveVendorEdit(index) {
            const vendorNameInput = document.getElementById(`vendorName_${index}`);
            const vendorUrlInput = document.getElementById(`vendorUrl_${index}`);
            
            if (!vendorNameInput.value.trim()) {
                alert('Ë´ãËº∏ÂÖ•Âª†ÂïÜÂêçÁ®±');
                return;
            }
            
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            vendorData[index].vendorName = vendorNameInput.value.trim();
            vendorData[index].vendorUrl = vendorUrlInput.value.trim();
            
            localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            renderVendorTable(vendorData);
            showVendorStatus('‚úÖ Âª†ÂïÜË≥áÊñôÂ∑≤Êõ¥Êñ∞', 'success');
        }
        
        // ÂèñÊ∂àÂª†ÂïÜÁ∑®ËºØ
        function cancelVendorEdit(index) {
            const cell = document.querySelector(`#vendor-table-body tr:nth-child(${index + 1}) td:first-child`);
            if (cell && cell.dataset.originalContent) {
                cell.innerHTML = cell.dataset.originalContent;
            }
        }

        // Êñ∞Â¢ûÂª†ÂïÜË≥áÊñôÂàó
        function addVendorRow() {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            const newRow = {
                vendorName: "Êñ∞Âª†ÂïÜ",
                planName: "Êñ∞ÊñπÊ°à", 
                weeklyFreq: "1Ê¨°",
                otherVolume: "0L",
                ourConvert14: "0ÂåÖ",
                ourConvert25: "0ÂåÖ",
                originalPrice: "0",
                discount1m: "0",
                discount3m: "0", 
                discount6m: "0",
                vendorUrl: ""
            };
            
            vendorData.push(newRow);
            localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
            renderVendorTable(vendorData);
            showVendorStatus('‚úÖ Â∑≤Êñ∞Â¢ûÂª†ÂïÜË≥áÊñô', 'success');
        }

        // Âà™Èô§Âª†ÂïÜË≥áÊñôÂàó  
        function deleteVendorRow(index) {
            const savedData = localStorage.getItem('vendorPricingData');
            let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            if (index >= 0 && index < vendorData.length) {
                const deletedVendor = vendorData[index].vendorName;
                vendorData.splice(index, 1);
                localStorage.setItem('vendorPricingData', JSON.stringify(vendorData));
                renderVendorTable(vendorData);
                showVendorStatus(`‚úÖ Â∑≤Âà™Èô§„Äå${deletedVendor}„Äç`, 'success');
            }
        }

        // ÂÑ≤Â≠òÊâÄÊúâÂª†ÂïÜË≥áÊñôÂà∞ localStorage
        function saveVendorData() {
            const savedData = localStorage.getItem('vendorPricingData');
            if (savedData) {
                showVendorStatus('‚úÖ Ë≥áÊñôÂ∑≤ÂÑ≤Â≠òÂà∞ÁÄèË¶ΩÂô®', 'success');
            } else {
                showVendorStatus('‚ùå Ê≤íÊúâË≥áÊñôÈúÄË¶ÅÂÑ≤Â≠ò', 'error');
            }
        }

        // ÂåØÂá∫Âª†ÂïÜË≥áÊñôÁÇ∫ Excel Ê™îÊ°à
        function exportVendorData() {
            const savedData = localStorage.getItem('vendorPricingData');
            const vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
            
            // ÂâµÂª∫Â∑•‰ΩúË°®Ë≥áÊñô
            const worksheetData = [
                // Ë°®È†≠
                ['Âª†ÂïÜÂêçÁ®±', 'ÊñπÊ°àÂêçÁ®±', '‰∏ÄÈÄ±Ê¨°Êï∏', 'Âª†ÂïÜÁ∏ΩÈáè', 'ÊèõÁÆó14ÂÖ¨Âçá', 'ÊèõÁÆó25ÂÖ¨Âçá', 'ÂéüÂÉπ', '1ÊúàÂÑ™', '3ÊúàÂÑ™', '6ÊúàÂÑ™', 'Âª†ÂïÜÁ∂≤ÂùÄ'],
                // Ë≥áÊñôË°å
                ...vendorData.map(row => [
                    row.vendorName,
                    row.planName,
                    row.weeklyFreq,
                    row.otherVolume,
                    row.ourConvert14,
                    row.ourConvert25,
                    row.originalPrice,
                    row.discount1m,
                    row.discount3m,
                    row.discount6m,
                    row.vendorUrl || ''
                ])
            ];
            
            // ÂâµÂª∫Â∑•‰ΩúÁ∞øÂíåÂ∑•‰ΩúË°®
            const workbook = XLSX.utils.book_new();
            const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
            
            // Ë®≠ÂÆöÊ¨Ñ‰ΩçÂØ¨Â∫¶
            const colWidths = [
                { wch: 15 }, // Âª†ÂïÜÂêçÁ®±
                { wch: 12 }, // ÊñπÊ°àÂêçÁ®±
                { wch: 8 },  // ‰∏ÄÈÄ±Ê¨°Êï∏
                { wch: 15 }, // Âª†ÂïÜÁ∏ΩÈáè
                { wch: 18 }, // ÊèõÁÆó14ÂÖ¨Âçá
                { wch: 18 }, // ÊèõÁÆó25ÂÖ¨Âçá
                { wch: 10 }, // ÂéüÂÉπ
                { wch: 8 },  // 1ÊúàÂÑ™
                { wch: 8 },  // 3ÊúàÂÑ™
                { wch: 8 },  // 6ÊúàÂÑ™
                { wch: 25 }  // Âª†ÂïÜÁ∂≤ÂùÄ
            ];
            worksheet['!cols'] = colWidths;
            
            // Â∞áÂ∑•‰ΩúË°®Ê∑ªÂä†Âà∞Â∑•‰ΩúÁ∞ø
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Â§ñÈÉ®ÂÉπÊ†º');
            
            // ÂåØÂá∫ExcelÊ™îÊ°à
            const fileName = `Â§ñÈÉ®ÂÉπÊ†ºË≥áÊñô_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(workbook, fileName);
            
            showVendorStatus('‚úÖ Ë≥áÊñôÂ∑≤ÂåØÂá∫ÁÇ∫ Excel Ê™îÊ°à', 'success');
        }

        // ÂåØÂÖ• Excel Ê™îÊ°à
        function importVendorData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // ËÆÄÂèñExcelÊ™îÊ°à
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // ÂèñÂæóÁ¨¨‰∏ÄÂÄãÂ∑•‰ΩúË°®
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    
                    // ËΩâÊèõÁÇ∫JSONÊ†ºÂºè
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length < 2) {
                        showVendorStatus('‚ùå Excel Ê™îÊ°àÂÖßÂÆπ‰∏çË∂≥', 'error');
                        return;
                    }
                    
                    // ÂèñÂæóË°®È†≠ (Á¨¨‰∏ÄË°å)
                    const headers = jsonData[0];
                    const expectedHeaders = ['Âª†ÂïÜÂêçÁ®±', 'ÊñπÊ°àÂêçÁ®±', '‰∏ÄÈÄ±Ê¨°Êï∏', 'Âª†ÂïÜÁ∏ΩÈáè', 'ÊèõÁÆó14ÂÖ¨Âçá', 'ÊèõÁÆó25ÂÖ¨Âçá', 'ÂéüÂÉπ', '1ÊúàÂÑ™', '3ÊúàÂÑ™', '6ÊúàÂÑ™'];
                    
                    // È©óË≠âË°®È†≠Ê†ºÂºè
                    const headersMatch = expectedHeaders.every(header => headers.includes(header));
                    if (!headersMatch) {
                        showVendorStatus('‚ùå Excel Ê™îÊ°àË°®È†≠Ê†ºÂºè‰∏çÊ≠£Á¢∫', 'error');
                        return;
                    }
                    
                    // ËΩâÊèõË≥áÊñôÊ†ºÂºè
                    const importedData = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length >= 10 && row[0]) { // Á¢∫‰øùÊúâË∂≥Â§†ÁöÑÊ¨Ñ‰Ωç‰∏îÂª†ÂïÜÂêçÁ®±‰∏çÁÇ∫Á©∫
                            importedData.push({
                                vendorName: row[0] || '',
                                planName: row[1] || '',
                                weeklyFreq: row[2] || '',
                                otherVolume: row[3] || '',
                                ourConvert14: row[4] || '',
                                ourConvert25: row[5] || '',
                                originalPrice: row[6] || '',
                                discount1m: row[7] || '',
                                discount3m: row[8] || '',
                                discount6m: row[9] || '',
                                vendorUrl: row[10] || ''
                            });
                        }
                    }
                    
                    if (importedData.length > 0) {
                        localStorage.setItem('vendorPricingData', JSON.stringify(importedData));
                        renderVendorTable(importedData);
                        showVendorStatus(`‚úÖ ÊàêÂäüÂåØÂÖ• ${importedData.length} Á≠ÜÂª†ÂïÜË≥áÊñô`, 'success');
                    } else {
                        showVendorStatus('‚ùå Excel Ê™îÊ°àÁÑ°ÊúâÊïàË≥áÊñô', 'error');
                    }
                    
                } catch (error) {
                    console.error('Excel import error:', error);
                    showVendorStatus('‚ùå Excel Ê™îÊ°àËß£ÊûêÂ§±Êïó', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Ê∏ÖÁ©∫ file input
            event.target.value = '';
        }

        // È°ØÁ§∫Âª†ÂïÜÂäüËÉΩÁãÄÊÖãË®äÊÅØ
        function showVendorStatus(message, type) {
            const statusDiv = document.getElementById('vendor-status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            
            // 3ÁßíÂæåÊ∏ÖÈô§Ë®äÊÅØ
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = 'status';
            }, 3000);
        }

        // ========== Á´∂Áà≠Âª†ÂïÜÊØîËºÉÂäüËÉΩ ==========
        
        // ÁÇ∫ÊâãÂãïÂ†±ÂÉπÁîüÊàêÁ´∂Áà≠Âª†ÂïÜÊØîËºÉË°®Ê†º
        function generateQuoteVendorComparison(fieldMapping) {
            try {
                // Âæû localStorage Áç≤ÂèñÂª†ÂïÜË≥áÊñôÔºåÂ¶ÇÊûúÊ≤íÊúâÂâá‰ΩøÁî®È†êË®≠Ë≥áÊñô
                const savedData = localStorage.getItem('vendorPricingData');
                let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
                
                // ÂèñÂæóÂÆ¢Êà∂ÁöÑ‰∏ÄÈÄ±Ê¨°Êï∏
                let frequency = 0;
                
                // Âæû fieldMapping Ëß£Êûê‰∏ÄÈÄ±Ê¨°Êï∏
                if (fieldMapping.weeklyFrequency) {
                    const match = fieldMapping.weeklyFrequency.match(/(\d+)Ë∂ü/);
                    if (match) {
                        frequency = parseInt(match[1]);
                    }
                }
                
                // Â¶ÇÊûúÈÇÑÊòØÊ≤íÊúâÈ†ªÁéáÔºåÊâç‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑ frequency
                if (frequency === 0) {
                    frequency = parseInt(fieldMapping.frequency) || 0;
                }
                
                console.log('Quote Customer frequency:', frequency);
                
                if (frequency === 0) {
                    document.getElementById('quote-vendor-comparison-table').innerHTML = '<div class="no-comparison">ÁÑ°Ê≥ïÁ¢∫ÂÆö‰∏ÄÈÄ±Ê¨°Êï∏ÔºåÁÑ°Ê≥ïÈÄ≤Ë°åÂª†ÂïÜÊØîËºÉ</div>';
                    document.getElementById('quote-vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ÁØ©ÈÅ∏Áõ∏Âêå‰∏ÄÈÄ±Ê¨°Êï∏ÁöÑÂª†ÂïÜÊñπÊ°à
                const matchingPlans = vendorData.filter(vendor => {
                    const vendorFreq = parseInt(vendor.weeklyFreq) || 0;
                    return vendorFreq === frequency;
                });
                
                console.log('Quote Matching plans by frequency:', matchingPlans);
                
                if (matchingPlans.length === 0) {
                    document.getElementById('quote-vendor-comparison-table').innerHTML = '<div class="no-comparison">Ê≤íÊúâÊâæÂà∞Áõ∏Âêå‰∏ÄÈÄ±Ê¨°Êï∏ÁöÑÁ´∂Áà≠Âª†ÂïÜÊñπÊ°à</div>';
                    document.getElementById('quote-vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ÁîüÊàêÊØîËºÉË°®Ê†º HTML
                let tableHtml = `
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Âª†ÂïÜÂêçÁ®±</th>
                                <th>ÊñπÊ°àÂêçÁ®±</th>
                                <th>‰∏ÄÈÄ±Ê¨°Êï∏</th>
                                <th>ÂûÉÂúæÈáè</th>
                                <th>ÊèõÁÆó14ÂÖ¨Âçá</th>
                                <th>ÊèõÁÆó25ÂÖ¨Âçá</th>
                                <th>ÂéüÂÉπ</th>
                                <th>1ÊúàÂÑ™</th>
                                <th>3ÊúàÂÑ™</th>
                                <th>6ÊúàÂÑ™</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                matchingPlans.forEach(vendor => {
                    tableHtml += `
                        <tr>
                            <td class="vendor-name">${vendor.vendorName}</td>
                            <td>${vendor.planName}</td>
                            <td>${vendor.weeklyFreq}Ê¨°</td>
                            <td>${vendor.otherVolume}</td>
                            <td class="price-cell">${vendor.ourConvert14}ÂåÖ</td>
                            <td class="price-cell">${vendor.ourConvert25}ÂåÖ</td>
                            <td class="price-cell">$${vendor.originalPrice}</td>
                            <td class="price-cell">${vendor.discount1m === 'ÁÑ°' ? 'ÁÑ°' : '$' + vendor.discount1m}</td>
                            <td class="price-cell">${vendor.discount3m === 'ÁÑ°' ? 'ÁÑ°' : '$' + vendor.discount3m}</td>
                            <td class="price-cell">${vendor.discount6m === 'ÁÑ°' ? 'ÁÑ°' : '$' + vendor.discount6m}</td>
                        </tr>
                    `;
                });
                
                tableHtml += `
                        </tbody>
                    </table>
                `;
                
                document.getElementById('quote-vendor-comparison-table').innerHTML = tableHtml;
                document.getElementById('quote-vendor-comparison').style.display = 'block';
                
                console.log('Quote vendor comparison generated successfully');
                
            } catch (error) {
                console.error('Error generating quote vendor comparison:', error);
                document.getElementById('quote-vendor-comparison-table').innerHTML = '<div class="no-comparison">ËºâÂÖ•Á´∂Áà≠Âª†ÂïÜË≥áÊñôÂ§±Êïó</div>';
                document.getElementById('quote-vendor-comparison').style.display = 'block';
            }
        }
        
        // ÁîüÊàêÁ´∂Áà≠Âª†ÂïÜÊØîËºÉË°®Ê†º
        function generateVendorComparison(fieldMapping) {
            try {
                // ÂæûlocalStorageÁç≤ÂèñÂª†ÂïÜË≥áÊñôÔºåÂ¶ÇÊûúÊ≤íÊúâÂâá‰ΩøÁî®È†êË®≠Ë≥áÊñô
                const savedData = localStorage.getItem('vendorPricingData');
                let vendorData = savedData ? JSON.parse(savedData) : defaultVendorData;
                
                // ÂèñÂæóÂÆ¢Êà∂ÁöÑ‰∏ÄÈÄ±Ê¨°Êï∏ - ÂÑ™ÂÖà‰ΩøÁî®GoogleË©¶ÁÆóË°®ÁöÑweeklyFrequencyÔºåÂÜç‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑfrequency
                let frequency = 0;
                
                // ÂÑ™ÂÖàÂæûweeklyFrequencyËß£ÊûêÔºàGoogleË©¶ÁÆóË°®Ë≥áÊñôÊõ¥Ê∫ñÁ¢∫Ôºâ
                if (fieldMapping.weeklyFrequency) {
                    const match = fieldMapping.weeklyFrequency.match(/(\d+)Ë∂ü/);
                    if (match) {
                        frequency = parseInt(match[1]);
                    }
                }
                
                // Â¶ÇÊûúÈÇÑÊòØÊ≤íÊúâÈ†ªÁéáÔºåÊâç‰ΩøÁî®ÊâãÂãïËº∏ÂÖ•ÁöÑfrequency
                if (frequency === 0) {
                    frequency = parseInt(fieldMapping.frequency) || 0;
                }
                
                console.log('Customer frequency:', frequency);
                console.log('FieldMapping frequency:', fieldMapping.frequency);
                console.log('FieldMapping weeklyFrequency:', fieldMapping.weeklyFrequency);
                
                if (frequency === 0) {
                    document.getElementById('vendor-comparison-table').innerHTML = '<div class="no-comparison">ÁÑ°Ê≥ïÁ¢∫ÂÆö‰∏ÄÈÄ±Ê¨°Êï∏ÔºåÁÑ°Ê≥ïÈÄ≤Ë°åÂª†ÂïÜÊØîËºÉ</div>';
                    document.getElementById('vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ÁØ©ÈÅ∏Áõ∏Âêå‰∏ÄÈÄ±Ê¨°Êï∏ÁöÑÂª†ÂïÜÊñπÊ°à
                const matchingPlans = vendorData.filter(vendor => {
                    const vendorFreq = parseInt(vendor.weeklyFreq) || 0;
                    return vendorFreq === frequency;
                });
                
                console.log('Matching plans by frequency:', matchingPlans);
                
                if (matchingPlans.length === 0) {
                    document.getElementById('vendor-comparison-table').innerHTML = '<div class="no-comparison">Ê≤íÊúâÊâæÂà∞Áõ∏Âêå‰∏ÄÈÄ±Ê¨°Êï∏ÁöÑÁ´∂Áà≠Âª†ÂïÜÊñπÊ°à</div>';
                    document.getElementById('vendor-comparison').style.display = 'block';
                    return;
                }
                
                // ÂèñÂæóÂÆ¢Êà∂ÂûÉÂúæÈáèË≥áË®äÈÄ≤Ë°åÈÄ≤‰∏ÄÊ≠•ÁØ©ÈÅ∏ÔºàÂèØÈÅ∏Ôºâ
                // ÈÄôË£°Á∞°ÂåñËôïÁêÜÔºåÈ°ØÁ§∫ÊâÄÊúâÁõ∏Âêå‰∏ÄÈÄ±Ê¨°Êï∏ÁöÑÊñπÊ°à
                
                // ÁîüÊàêÊØîËºÉË°®Ê†ºHTML
                let tableHtml = `
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Âª†ÂïÜÂêçÁ®±</th>
                                <th>ÊñπÊ°àÂêçÁ®±</th>
                                <th>‰∏ÄÈÄ±Ê¨°Êï∏</th>
                                <th>ÂûÉÂúæÈáè</th>
                                <th>ÊèõÁÆó14ÂÖ¨Âçá</th>
                                <th>ÊèõÁÆó25ÂÖ¨Âçá</th>
                                <th>ÂéüÂÉπ</th>
                                <th>1ÊúàÂÑ™</th>
                                <th>3ÊúàÂÑ™</th>
                                <th>6ÊúàÂÑ™</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                matchingPlans.forEach(vendor => {
                    tableHtml += `
                        <tr>
                            <td class="vendor-name">${vendor.vendorName}</td>
                            <td>${vendor.planName}</td>
                            <td>${vendor.weeklyFreq}Ê¨°</td>
                            <td>${vendor.otherVolume}</td>
                            <td class="price-cell">${vendor.ourConvert14}ÂåÖ</td>
                            <td class="price-cell">${vendor.ourConvert25}ÂåÖ</td>
                            <td class="price-cell">$${vendor.originalPrice}</td>
                            <td class="price-cell">${vendor.discount1m === 'ÁÑ°' ? 'ÁÑ°' : '$' + vendor.discount1m}</td>
                            <td class="price-cell">${vendor.discount3m === 'ÁÑ°' ? 'ÁÑ°' : '$' + vendor.discount3m}</td>
                            <td class="price-cell">${vendor.discount6m === 'ÁÑ°' ? 'ÁÑ°' : '$' + vendor.discount6m}</td>
                        </tr>
                    `;
                });
                
                tableHtml += `
                        </tbody>
                    </table>
                `;
                
                document.getElementById('vendor-comparison-table').innerHTML = tableHtml;
                document.getElementById('vendor-comparison').style.display = 'block';
                
                console.log('Vendor comparison generated successfully');
                
            } catch (error) {
                console.error('Error generating vendor comparison:', error);
                document.getElementById('vendor-comparison-table').innerHTML = '<div class="no-comparison">ËºâÂÖ•Á´∂Áà≠Âª†ÂïÜË≥áÊñôÂ§±Êïó</div>';
                document.getElementById('vendor-comparison').style.display = 'block';
            }
        }

        // Tab switching functionality
        function showTab(tabId, clickedButton = null) {
            // Hide all tab contents
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const allTabButtons = document.querySelectorAll('.tab');
            allTabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Add active class to clicked button - use event.target if available
            if (!clickedButton && typeof event !== 'undefined' && event.target) {
                clickedButton = event.target;
            }
            if (!clickedButton) {
                clickedButton = document.querySelector(`button[onclick*="${tabId}"]`);
            }
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // Áï∂ÂàáÊèõÂà∞Â§ñÈÉ®ÂÉπÊ†ºÁÆ°ÁêÜÈ†ÅÈù¢ÊôÇÔºåËá™ÂãïËºâÂÖ•‰∏¶È°ØÁ§∫Ë≥áÊñô
            if (tabId === 'vendor-pricing') {
                setTimeout(() => {
                    loadVendorData();
                }, 100); // Áü≠Êö´Âª∂ÈÅ≤Á¢∫‰øùDOMÂ∑≤Êõ¥Êñ∞
            }
        }

        // ========== ÊúÉÂì°ÁôªÂÖ•ÂäüËÉΩ ==========
        
        // È†êÂÆöÁöÑÂ∏≥ËôüÂØÜÁ¢º
        const validCredentials = {
            username: 'reco',
            password: '123'
        };
        
        // Ê™¢Êü•ÁôªÂÖ•ÁãÄÊÖã
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            const loginTime = localStorage.getItem('loginTime');
            
            // Ê™¢Êü•ÊòØÂê¶Ë∂ÖÈÅé24Â∞èÊôÇÔºàÂèØÈÅ∏Ôºâ
            const currentTime = new Date().getTime();
            const loginTimeMs = parseInt(loginTime) || 0;
            const isSessionValid = (currentTime - loginTimeMs) < (24 * 60 * 60 * 1000); // 24Â∞èÊôÇ
            
            if (isLoggedIn && isSessionValid) {
                showMainContent();
            } else {
                showLoginForm();
                // Ê∏ÖÈô§ÈÅéÊúüÁöÑÁôªÂÖ•Ë≥áË®ä
                if (!isSessionValid) {
                    localStorage.removeItem('userLoggedIn');
                    localStorage.removeItem('loginTime');
                }
            }
        }
        
        // È°ØÁ§∫ÁôªÂÖ•Ë°®ÂñÆ
        function showLoginForm() {
            document.getElementById('login-overlay').style.display = 'flex';
            document.getElementById('logout-btn').style.display = 'none';
            // Èö±Ëóè‰∏ªË¶ÅÂÖßÂÆπ
            const container = document.querySelector('.container');
            if (container) container.style.display = 'none';
        }
        
        // È°ØÁ§∫‰∏ªË¶ÅÂÖßÂÆπ
        function showMainContent() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'block';
            // È°ØÁ§∫‰∏ªË¶ÅÂÖßÂÆπ
            const container = document.querySelector('.container');
            if (container) container.style.display = 'block';
        }
        
        // ÁôªÂÖ•È©óË≠â
        function login(username, password) {
            if (username === validCredentials.username && password === validCredentials.password) {
                localStorage.setItem('userLoggedIn', 'true');
                localStorage.setItem('loginTime', new Date().getTime().toString());
                showMainContent();
                return true;
            }
            return false;
        }
        
        // ÁôªÂá∫
        function logout() {
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('loginTime');
            showLoginForm();
        }
        
        // ÁôªÂÖ•Ë°®ÂñÆ‰∫ã‰ª∂Áõ£ËÅ¥
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñÊ™¢Êü•ÁôªÂÖ•ÁãÄÊÖã
            checkLoginStatus();
            
            // ÁôªÂÖ•Ë°®ÂñÆÊèê‰∫§‰∫ã‰ª∂
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    if (login(username, password)) {
                        document.getElementById('login-error').style.display = 'none';
                        // Ê∏ÖÈô§Ë°®ÂñÆ
                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';
                    } else {
                        document.getElementById('login-error').style.display = 'block';
                        // Ê∏ÖÈô§ÂØÜÁ¢ºÊ¨Ñ‰Ωç
                        document.getElementById('password').value = '';
                        document.getElementById('password').focus();
                    }
                });
            }
            
            // Enter ÈçµÂø´ÈÄüÁôªÂÖ•
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && document.getElementById('login-overlay').style.display === 'flex') {
                    const loginForm = document.getElementById('login-form');
                    if (loginForm) {
                        loginForm.dispatchEvent(new Event('submit'));
                    }
                }
            });
        });
        
    </script>
</body>
</html>
